<script type="text/javascript">
	var coll = <?php echo json_encode(strtolower($this->title)); ?>;
</script>
<div class="container component">
	<h1><?php echo $this->title; ?></h1>
	<?php
//	if (isset($criteria_tpl)) {
//		$this->display($criteria_tpl . '.phtml', array());
//	}
	$this->display('toolbar.phtml', array());
	if (isset($this->data) && $this->data instanceof Mongodloid_Cursor) :
		print '<table id="data_table" class="table table-striped table-bordered">';
		print '<thead><tr><th>#</th>';
		foreach ($this->columns as $value) {
			print '<th>' . $value . '</th>';
		}
		print '</tr></thead><tbody>';

		$c = $this->offset;
		foreach ($this->data as $item) {
			print '<tr>';
			print '<td><label class="checkbox">#' . ($c + 1) . '&nbsp;<input value="' . $item['_id'] . '" type="checkbox" id="chk' . $c++ . '"/></label></td>';
			foreach (array_keys($this->columns) as $h) {
				$data = $item->get($h);
				print '<td>';
				if (isset($edit_key) && $h == $edit_key) {
					$url = $this->baseUrl . '/admin/edit?type=' . strtolower($this->title) . '&id=' . $item['_id'];
					print '<a href="#popupModal" data-remote="' . $url . '" role="button" data-toggle="modal">' . $data . '</a>';
				} else if (($h == 'from' || $h == 'to' || $h == 'unified_record_time' || $h == 'notify_time') && $data) {
					// TODO: move he_IL to config
					$d = new Zend_Date($data->sec, null, new Zend_Locale('he_IL'));
					echo $d->getIso();
				} else {
					print $data;
				}
				print '</td>';
			}
			print '</tr>';
		}
		print '</tbody></table>';

		// print pagination
		echo $this->pagination;
		echo $this->sizeList;
	else :
		print "No data";
	endif;
	?>

    <div class="modal fade hide" id="popupModal" tabindex="-1" role="dialog" aria-labelledby="popupModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="popupModalLabel"></h3>
		</div>
		<div class="modal-body">

		</div>
		<div class="modal-footer">
			<button id="cancelPopup" class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
			<button id="save" class="btn btn-primary">Save changes</button>
		</div>
    </div>

    <div class="modal fade hide" id="confirmModal" tabindex="-2" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="confirmModalLabel"></h3>
		</div>
		<div class="modal-body">
		</div>
		<div class="modal-footer">
			<button id="cancelConfirm" class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
			<button id="confirm" class="btn btn-primary">Remove</button>
		</div>
    </div>
</div>