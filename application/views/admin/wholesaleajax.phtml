<?php

echo '<div class="wholesale-popup">
<h2>' . $this->direction . ' (' . ($this->carrier ? $this->carrier : $this->from_day) . ')' . '</h2>';
$graph_keys = array(
	'group_by',
	'hours',
	'cost',
);
$graph = Admin_Graphs::prepareGraph($this->data, $this->group_by_display, $this->group_by, array_diff($graph_keys, array('group_by')), array_diff($graph_keys, array('group_by')), array('graph_id' => ($direction . '_call_graph'), 'graph_class' => 'wholesale-graph'));
echo Admin_Graphs::printGraph($graph, false, 1);

echo '<table border="1" class="wholesale-table">';

$keys = array(
	'group_by',
	'duration',
	'cost',
);
//print table headers
echo "<tr>";
echo '<th rowspan="2">' . $this->group_by_display . '</th>
			<th colspan="2">' . current($this->data)['usaget'] . '</th>';
echo "</tr>";
echo "<tr>";
foreach (array_diff($keys, array('group_by')) as $k) {
	echo "<th" . ($k == 'group_by' ? ' rowspan="2"' : '') . ">" . ($k == 'group_by' ? $this->group_by_display : $k) . "</th>";
}
echo "</tr>";

foreach ($this->data as $item) {
	echo '<tr>';
	foreach ($keys as $k) :
		echo "<td>" . (isset($item[$k]) ? $item[$k] : '&nbsp;') . "</td>";
	endforeach;
	echo "</tr>";
}

echo '</table>';