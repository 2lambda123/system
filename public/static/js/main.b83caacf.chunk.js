(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{165:function(e,t,n){e.exports='\x3c!-- Footer --\x3e\n<div class="footer">\n  <div class="shell">\n    <div class="section">\n      <div class="table footer">\n        <table style="font-size:16px;font-weight: 300;">\n          <tbody>\n            <tr>\n              <td>\n                <ul class="list-contacts step-company-details-footer">\n                <li><i class="fa fa-map-marker" aria-hidden="true"></i> 221 Murray Street, New York, NY 10007</li>\n\n                <li><i class="fa fa-phone" aria-hidden="true"></i> 1-800-123-4567</li>\n\n                <li><i class="fa fa-globe" aria-hidden="true"></i> http://billrun.com</a></li>\n\n                <li><i class="fa fa-at" aria-hidden="true"></i> cloud_support@billrun.com</a></li>\n                </ul>\n              </td>\n              <td>\n                <p class="credentials"> <span class="text">powered by</span> <img class="billrun-logo" src="'+n(421)+'" alt=""></p>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  </div>\n</div>\n</div>\n'},242:function(e){e.exports={customerIdentification:{sid:"Subscriber id (BillRun system field)"},lines:{arate:"Product reference",arate_key:"Product key",arategroup:"Campaign name",lastname:"Subscriber's surname",firstname:"Subscriber's first name",start:"Start time",channel:"Calling channel",stamp:"Unique record ID",billrun:"Billing cycle",src:"Calling ID",in_group:"Campaign inclusive units",clid:"Full Calling ID",dst:"Destination extension",charging_type:"Subscriber type",aprice:"Charge before taxes",log_stamp:"File unique ID",file:"File name",plan:"Subscriber's plan key",plan_ref:"Plan reference",billsec:"Billing duration",dcontext:"Destination context",lastapp:"Last dial plan",uniqueid:"Unique ID",sid:"Subscriber ID",userfield:"User field",amaflags:"Call indicator",usaget:"Activity type",duration:"Call duration",over_group:"Deviation units",usagev:"Activity volume",urt:"Record time",disposition:"Disposition",accountcode:"CDR account ID",type:"Input processor name",source:"Record source",connection_type:"Postpaid / Prepaid",end:"End time",aid:"Customer ID",process_time:"Process time",usagesb:"Accumulative usage",row_number:"Record number",realtime:"Realtime?",dstchannel:"Destination channel",answer:"Answer time",session_id:"Session ID",request_type:"Request type",record_type:"Record type",billrun_pretend:"Pretend?",request_num:"Request number",granted_return_code:"Return code",final_charge:"Total charge",pp_includes_name:"Bucket name",charging_usaget:"Charging activity type",balance_before:"Balance before",source_ref:"Update source reference",balance_ref:"Balance reference",balance_after:"Balance after",balance_normalized:"Balance normalized",pp_includes_external_id:"Bucket external ID"},queue:{calc_name:"Calculator stage",calc_time:"Last Calculation Time",realtime:"Realtime?",session_id:"Session ID",request_type:"Request type",record_type:"Record type",billrun_pretend:"Pretend?",request_num:"Request number",granted_return_code:"Return code"},account:{aid:"Customer ID",firstname:"First Name",lastname:"Last Name"},subscription:{aid:"Customer ID",sid:"Subscriber ID",firstname:"First Name",lastname:"Last Name",services:"Services",plan:"Plan",plan_activation:"Plan activation date"},report:{report_type_0:"Simple",report_type_1:"Grouped",count_group:"Count"},event:{type:"Event Type",notify_time:"Notify Time",creation_time:"Creation Time",value:"Value",stamp:"Unique record ID",returned_value:"Response"},autorenew:{aid:"Customer ID",sid:"Subscriber ID",bucket_group:"Bucket Group",cycles:"Total Cycles",cycles_remaining:"Remaining Cycles",next_renew:"Next Renew",last_renew:"Last Renew",interval:"Interval"},service:{description:"Title",name:"Key",period_type:"Eligibility Period",custom_period_type:"Custom"},plan:{description:"Title",name:"Key",upfront:"Charging Mode"},product:{usage_type_value:"Usage Type",usage_type_unit:"Usage Type Unit",pricing_method:"Pricing Method",description:"Title",key:"Key",usage_type:"Unit Type",price_from:"Pricing From",price_to:"Pricing To",price_value:"Price Per Interval",price_interval:"Pricing Interval",price_plan:"Plan Price Override"},import:{permanentchange:"Update","rates.percentage":"Plan Price Override by Percentage"},foreign:{account_subscribers:"Customer Members"},aid:"Customer ID",sid:"Subscriber ID",effective_date:"Effective Date"}},243:function(e){e.exports={service:{collection:"services",uniqueField:"name",itemName:"service",itemsName:"services",itemType:"service",itemsType:"services",settingsKey:"services"},plan:{collection:"plans",uniqueField:"name",itemName:"plan",itemsName:"plans",itemType:"plan",itemsType:"plans",settingsKey:"plans"},charging_plan:{collection:"prepaidgroups",uniqueField:"name",itemName:"buckets group",itemsName:"buckets groups",itemType:"charging_plan",itemsType:"charging_plans"},prepaid_plan:{collection:"plans",uniqueField:"name",itemName:"prepaid plan",itemsName:"prepaid plans",itemType:"prepaid_plan",itemsType:"prepaid_plans"},prepaid_include:{collection:"prepaidincludes",uniqueField:"name",itemName:"prepaid bucket",itemsName:"prepaid buckets",itemType:"prepaid_include",itemsType:"prepaid_includes"},product:{collection:"rates",uniqueField:"key",itemName:"product",itemsName:"products",itemType:"product",itemsType:"products",settingsKey:"rates"},discount:{collection:"discounts",uniqueField:"key",itemName:"discount",itemsName:"discounts",itemType:"discount",itemsType:"discounts"},subscription:{collection:"subscribers",uniqueField:["sid","aid"],itemName:"subscriber",itemsName:"subscribers",itemType:"subscription",itemsType:"subscriptions",settingsKey:"subscribers.subscriber"},customer:{collection:"accounts",uniqueField:"aid",itemName:"customer",itemsName:"customers",itemType:"customer",itemsType:"customers",settingsKey:"subscribers.account"},report:{collection:"reports",uniqueField:"key",itemName:"report",itemsName:"reports",itemType:"report",itemsType:"reports"},usage:{collection:"lines",settingsKey:"lines",uniqueField:"stamp",itemName:"usage",itemsName:"usages",itemType:"usage",itemsType:"usages"},queue:{collection:"queue",uniqueField:"stamp",itemName:"queue",itemsName:"queues",itemType:"queue",itemsType:"queues"},tax:{collection:"taxes",uniqueField:"key",itemName:"tax",itemsName:"tax rates",itemType:"tax",itemsType:"taxes",settingsKey:"taxes"},logFile:{collection:"log",uniqueField:"stamp",itemName:"received files",itemsName:"received files",itemType:"logFile",itemsType:"logFiles"},event:{collection:"events",uniqueField:"stamp",itemName:"events",itemsName:"events",itemType:"event",itemsType:"events"},auto_renew:{collection:"autorenew",itemName:"recurring charge",itemsName:"recurring charges",itemType:"auto_renew",itemsType:"auto_renews"}}},244:function(e){e.exports={products:{title:"Products",icon:"fa-book",route:"products",show:!0,roles:[],order:1,parent:"root"},prepaid:{title:"Prepaid",icon:"fa-cubes",route:"",show:!0,roles:[],order:2,parent:"root"},prepaid_plans:{title:"Plans",icon:"",route:"prepaid_plans",show:!0,roles:[],order:0,parent:"prepaid"},prepaid_includes:{title:"Buckets",icon:"",route:"prepaid_includes",show:!0,roles:[],order:1,parent:"prepaid"},charging:{title:"Buckets Groups",icon:"",route:"charging_plans",show:!0,roles:[],order:2,parent:"prepaid"},recurring:{title:"Recurring Charges",icon:"",route:"auto_renews",show:!0,roles:[],order:3,parent:"prepaid"},postpaid:{title:"Postpaid",icon:"fa-puzzle-piece",route:"",show:!0,roles:[],order:3,parent:"root"},postpaid_plans:{id:"postpaid",title:"Plans",icon:"",route:"plans",show:!0,roles:[],order:0,parent:"postpaid"},services:{title:"Services",icon:"",route:"services",show:!0,roles:[],order:1,parent:"postpaid"},discounts:{title:"Discounts",icon:"",route:"discounts",show:!0,roles:[],order:2,parent:"postpaid"},customers:{title:"Customers",icon:"fa-users",route:"customers",show:!0,roles:[],order:4,parent:"root"},usage:{title:"Usage",icon:"fa-list",route:"usage",show:!0,roles:[],order:5,parent:"root"},cycle:{title:"Billing Cycle",icon:"fa-clock-o",route:"",show:!0,roles:[],order:6,parent:"root"},run_cycle:{title:"Run",icon:"",route:"run_cycle",show:!0,roles:[],order:0,parent:"cycle"},invoices:{title:"Invoices",icon:"fa-file-text-o",route:"invoices",show:!0,roles:[],order:7,parent:"root"},tax:{title:"Tax",icon:"fa-percent",route:"",show:!0,roles:[],order:7.1,parent:"root"},taxes:{title:"Rates",icon:"",route:"taxes",show:!0,roles:[],order:0,parent:"tax"},tax_mapping:{title:"Mapping Rules",icon:"",route:"taxes/mapping-rules",show:!0,roles:[],order:1,parent:"tax"},templates:{title:"Templates",icon:"fa-newspaper-o",route:"",show:!0,roles:[],order:7.3,parent:"root"},invoice_template:{title:"Invoice Template",icon:"",route:"invoice-template",show:!0,roles:["admin"],order:0,parent:"templates"},email_templates:{title:"Email Templates",icon:"",route:"email_templates",show:!0,roles:["admin"],order:1,parent:"templates"},reports:{title:"Reports",icon:"fa-list-alt",route:"reports",show:!0,roles:[],order:7.5,parent:"root"},users:{title:"User Management",icon:"fa-user",route:"users",show:!0,roles:[],order:8,parent:"root"},audit_trail:{title:"Audit Trail",icon:"fa-history",route:"audit-trail",show:!0,roles:[],order:9,parent:"root"},settings:{title:"Settings",icon:"fa-cog",route:"",show:!0,roles:["admin"],order:10,parent:"root"},settings_general:{title:"General Settings",icon:"",route:"settings",show:!0,roles:["admin"],order:0,parent:"settings"},input_processors:{title:"Input Processors",icon:"",route:"input_processors",show:!0,roles:["admin"],order:1,parent:"settings"},export_generators:{title:"Export Generators",icon:"",route:"export_generators",show:!0,roles:["admin"],order:2,parent:"settings"},payment_gateways:{title:"Payment Gateways",icon:"",route:"payment_gateways",show:!0,roles:["admin"],order:3,parent:"settings"},collections:{title:"Collection",icon:"",route:"collections",show:!0,roles:["admin"],order:4,parent:"settings"},custom_fields:{title:"Custom Fields",icon:"",route:"custom_fields",show:!0,roles:["admin"],order:6,parent:"settings"},events:{title:"Events",icon:"",route:"events",show:!0,roles:["admin"],order:7,parent:"settings"}}},245:function(e){e.exports={entities:{balance:{title:"balance",listTitle:"balances"},fraud:{title:"fraud"}},operators:{fraud:{conditions:[{id:"in",title:"Is In"},{id:"nin",title:"Is Not In"}],threshold:[{id:"in",title:"Is"},{id:"nin",title:"Is Not"},{id:"gt",title:"Is Greater Than",type:"number"},{id:"gte",title:"Is Greater Than Or Equal",type:"number"},{id:"lt",title:"Is Less Than",type:"number"},{id:"lte",title:"Is Less Than Or Equal",type:"number"}]},balance:{conditions:[{id:"in",title:"In"},{id:"not_in",title:"Is Not"},{id:"is",title:"Is"},{id:"is_not",title:"Is Not"},{id:"is_less_than",title:"Is Less Than",type:"number"},{id:"is_less_than_or_equal",title:"Is Less Than Or Equal",type:"number"},{id:"is_greater_than",title:"Is Greater Than",type:"number"},{id:"is_greater_than_or_equal",title:"Is Greater Than Or Equal",type:"number"},{id:"reached_constant",title:"Reached Constant",type:"tags"},{id:"reached_constant_recurring",title:"Reached Constant (Recurring)",type:"number"},{id:"has_changed",title:"Has Changed",extra_field:!1},{id:"has_changed_to",title:"Has Changed To"},{id:"has_changed_from",title:"Has Changed From"}]}},conditionsFields:[{id:"usaget",entity:"line",effectOnUsaget:!0,inputConfig:{inputType:"select",callback:"getUsageTypesOptions"}},{id:"type",title:"Input processor name / BillRun type",effectOnUsaget:!0,inputConfig:{inputType:"select",callback:"getFileTypeOptions"}},{id:"subscriber.plan",entity:"line",inputConfig:{inputType:"select",callback:"getPlansOptions"}},{id:"arate_key",entity:"line",effectOnUsaget:!0,inputConfig:{inputType:"select",callback:"getProductsOptions"}}],thresholdFields:[{id:"usagev",entity:"line",allowedWithUsage:["single"],type:"number"},{id:"aprice",entity:"line",allowedWithUsage:["single","multiple","empty"],type:"number"},{id:"final_charge",entity:"line",allowedWithUsage:["multiple","empty"],type:"number"},{id:"in_group",entity:"line",allowedWithUsage:["single"],type:"number"},{id:"over_group",entity:"line",allowedWithUsage:["single"],type:"number"},{id:"out_group",title:"Out Group",allowedWithUsage:["single"],type:"number"}]}},246:function(e){e.exports={conditions:[{id:"$eq",title:"Equal"},{id:"$ne",title:"Does Not Equal"},{id:"$exists",title:"Exists"},{id:"$existsFalse",title:"Does Not Exist"},{id:"$lt",title:"Is Less Than"},{id:"$lte",title:"Is Less Than Or Equal"},{id:"$gt",title:"Is Greater Than"},{id:"$gte",title:"Is Greater Than Or Equal"},{id:"$in",title:"Is Included In"},{id:"$isTrue",title:"Is True (Boolean)"},{id:"$isFalse",title:"Is False (Boolean)"},{id:"$regex",title:"Matches regular expression"}],paramsConditions:[{id:"match",title:"Equals"},{id:"equalFalse",title:"Does Not Equal"},{id:"longestPrefix",title:"Longest Prefix"}]}},247:function(e){e.exports={allowed_entities:["customer","subscription"],allowed_entities_actions:{create:["customer","subscription","product"],permanentchange:["product"]},default_values_allowed_actions:{create:["customer","subscription","product"],permanentchange:[]},predefined_values_allowed_actions:{create:["customer","subscription","product"],permanentchange:[]},hidden_actions_fields:{create:{customer:[],subscription:[],product:["effective_date"]},permanentchange:{customer:[],subscription:[],product:["tariff_category","key","usage_type","usage_type_value","from"]}},allowed_plays:["product"]}},248:function(e){e.exports={default_new_step_status:!1,step_types:{mail:{label:"Mail",icon:"fa-envelope-o",enable:!0},sms:{label:"SMS",icon:"fa-commenting-o",enable:!1},http:{label:"HTTP",icon:"fa-link",enable:!0}},http:{mthods:["get","post"],decoders:["json","xml"]}}},249:function(e){e.exports={entities:{customer:"account",subscription:"subscriber",product:"product",service:"service",plan:"plan",tax:"tax",usage:"usage"},defaultDisabledFields:{customer:["first_name","last_name","firstname","lastname","address"],subscription:["firstname","lastname","plan","services"]},defaultHiddenFields:{customer:["aid","payment_gateway"],subscription:["sid","aid","plan_activation","play"],product:["from","to","play","tax"],service:["from","to","include","play","tax"],tax:["from","to"],plan:["from","to","play","tax"]},unReorderFields:{product:["key","description","rates"],service:["name","description","price"],tax:["key","description"],plan:["name","description","price","upfront"]},fields:[{id:"text",type:"string",title:"Text"},{id:"boolean",title:"Boolean",type:"boolean",defaultValue:!1,exclude:["unique","mandatory","searchable","multiple","select_options","select_list"]},{id:"textarea",type:"string",title:"Text Area",exclude:["multiple","select_options","select_list"]},{id:"percentage",type:"number",title:"Percentage",exclude:["multiple","select_options","select_list"]},{id:"ranges",type:"array",title:"Range",exclude:["select_options","select_list"],includeEntity:["subscription"]}],foreignFields:{entities:{usage:["customer","subscription","product","service","plan","account_subscribers","tax"]},translate:{unixTimeToString:{title:"Unixtime To String",options:["Y-m-d H:i:s"]},unixTimeToMongoDate:{title:"Unixtime To MongoDate"}},conditions:[{id:"$nin",title:"Does Not Equal"},{id:"$in",title:"Equal"},{id:"$lt",title:"Is Less Than",type:"number"},{id:"$lte",title:"Is Less Than Or Equal",type:"number"},{id:"$gt",title:"Is Greater Than",type:"number"},{id:"$gte",title:"Is Greater Than Or Equal",type:"number"},{id:"$regex",title:"Matches regular expression"}]}}},260:function(e,t){e.exports="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAA8AAD/4QQKaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjMtYzAxMSA2Ni4xNDU2NjEsIDIwMTIvMDIvMDYtMTQ6NTY6MjcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0idXVpZDo1RDIwODkyNDkzQkZEQjExOTE0QTg1OTBEMzE1MDhDOCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpBMzI1QzFGRUM0NEYxMUU2QTE3OUQ3RTBEMDJDRUJBMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpBMzI1QzFGREM0NEYxMUU2QTE3OUQ3RTBEMDJDRUJBMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBJbGx1c3RyYXRvciBDQyAyMDE1IChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ1dWlkOjkwOTQ0NzEyLWZhMjAtNGY3MS04MzZjLTA4OTMzZWVmOTY3OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2Y2Q2Y2M0My04MjU3LWQ1NGQtYTU4YS0xM2MwYmExMzFhMzciLz4gPGRjOnRpdGxlPiA8cmRmOkFsdD4gPHJkZjpsaSB4bWw6bGFuZz0ieC1kZWZhdWx0Ij5CaWxscnVuLWludm9pY2UtdjEuMjwvcmRmOmxpPiA8L3JkZjpBbHQ+IDwvZGM6dGl0bGU+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+0ASFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAPHAFaAAMbJUccAgAAAgACADhCSU0EJQAAAAAAEPzhH4nIt8l4LzRiNAdYd+v/7gAOQWRvYmUAZMAAAAAB/9sAhAAGBAQEBQQGBQUGCQYFBgkLCAYGCAsMCgoLCgoMEAwMDAwMDBAMDg8QDw4MExMUFBMTHBsbGxwfHx8fHx8fHx8fAQcHBw0MDRgQEBgaFREVGh8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx//wAARCABhAFADAREAAhEBAxEB/8QAogAAAgMBAQEBAAAAAAAAAAAAAAcEBQYDAgEIAQACAwEBAAAAAAAAAAAAAAAABQIDBAEGEAABAwIDAwkEBwUJAAAAAAABAgMEAAURIQYxEgdBUWFxgZEiMhOhsUIjYnKCkqIUFcGyU4Mk0VLCM2M0lBYXEQABAwIEAwcEAgMBAAAAAAABAAIDEQQhMRIFQVFhkaGx4SIyE/Bx0UKBUiMzJBX/2gAMAwEAAhEDEQA/AP1TQhFCEv8AWPGOwWNa4cAfqlxRilSW1YMtq5luZ4kcye8VQ+cDLFKLzd44sG+p3clReuKmubutX9eqEydjMP5IH2x8w9qqyunceKRS7ncScaDph5rMyHbhKVvyXnHlHapxaln8RNVF6xlr3ZmqGHJ8VW/HecZUNim1KQfYRQHoa17cjRaWzcUtdWhScJ65jI2szPnA/aPzB2Kq1s7hxWyLcriPjUdcfNNbRvGSx3tSIlxR+mT1YJBWrFhajkAlw4bpPMrvNao5wc8E9s93jlwd6XdyYVXpuihCKEJIcU+Kj0p56w2B4oiIJbmzWzm6dim21DYjnI83VtxzTcAvMbnuZcTHGcOJ5+SWDEQqzNYnPSmOGqntQhzVSXrY2FSExBhsqGtWiJBiDmo1rpiXFyGMNlSD1U6ELZaL0umZoTV760YlTKPQVhnvxQp8gdfhrfAKscVpt7SsEn28MVL4YcT5dtdj2TUK1G3P+GBNdxxaz3QlSj5m8Rhj8PVsthmpgckbbuToyI5Pacj9cPBPCti9Ol9xk1kux2FNuhublxugUgKSfE2wMnFDmKsd0dvNVE8lBTmlG73nxR6W+53gkJDjFRBIpY9y83BFVXEeMMNlZXOTFkamtx+iqi5Xhi7CP0VHUp6EGP0Ual3QvH5Nbi0ttoK1rIShKRiSTkABUmmqiWVTqt9jbsGgJMNwD1ExH3ZR5C4tslXd5eyvQMj+OKh5Js2L44SOhSkv9lS9wws9xQn5sKXIYWRt3HlFefUpHtrIP9QPVIbq3rbtdyJ70wODGsXLxZV2mYveuFrCUoUo+Jcc5IPSUeU9lbYJKiiY7PdmRmh3ub4JWcTbwu866uCt7eYiL/KMDkCWDuqw63N41knfVxSTcJfluDyGHZ5qBDYyFL3uV8TFasM1mc5bGtUxtmqy5XBq6hmoalLSvbcRx1xLbSC44s4IQkEknmAFdbUmgXdKY+idCfp7iLnckgzBmwxtDePxK+l7uvY+srLR6n5rZBb6cTmpvEq6Jh6YeYB+dOIYQOXd2rP3Rh21ffS6Y6cSpXb6MpzWSfgD/wAUe3hmXA6n/lBHuqhg/wCev1msT2f8p+uKX3D66uWPXVteJKGZLgjPg5AtyMEgnoCilXZRbvoQkdnIYrhp4HDtWeYcXJmOyHM1urUtR6VHE++qZSs0HqcSVttP6P1BdEJchwlqZOx5eDbfYpeAPZWdsD35BPILdzsgtjD4U3ogF+THa6AVrP7oHtqwbZIcyFvbZu4qxb4VujzXFI6mif8AEKl/5B/t3KwWvVTYvDG3oIMmY46ByISlv379WM2hvFxPd+VMWw4laW12G02wf0UdLayMC6fEs/aOJphDbMj9oVzWBuSky5caHHXJkuBplsYrWase8MFTgFIkAVKTuqrxJ1BdQtCVekD6UNjlwJ/eUa83cXJmf04JZM4vK1mvGEWnhy3bMRir0I+XKpJ9RR7Sgmm9wPjhDfsFddDTDpSV1I2qM5b30eF0x2nQekEhJ7kiszOH2Xmr1tKHomdw04TIhIN01GyFSApX5eC55EBJw9RwbCThiBsw9m6O3Gbk22zbNA1SDHkmMvUenWT6arlFSpOW4HUYjsByq0zxjNw7U5+VnML23f7E7/l3CMo8wdRj3Y0C5jP7N7V0SN5qSmZEUMUvtqHOFpP7amJG8wpVC5vXW2MjF2WyjoK0492NQdcRtzcO1BcFS3HXdpjpKYoVLd5MAUIx6VKGPcKwzbtE32+oqt0wGSw18vtyuzm9KXg0k4tsJyQns5T0mklxdvlPqy5LM95dmr3QellKfTeJaMG0ZxEH4lfxOoclMtstCf8AI7+PypwxY1KqeLd4TJns21pWKIaSt7D+IsDL7KffVm4TVeGjgs98+ppyS918wpu7twEjFyNHixin/UDKN8ffUa7SjqcgPBJNyGOnkAE471pnUOpNRyo9xlrh6WihsRmGCAuUtSApZWc8kqyzHUOWmEkReaE+lPZIJJZSHGkQy6qT/wCY6TDW42y62oZeol1RV+LeT7Kqdt8RV4tGDJU8/hpMYJXb5CZCORpzwL7/ACn2Uun2lw9hquG2IyVHJtFxhK3ZcZbWHxKHh7FDI0plgez3AhQ0kZrkE1RVC9tR3nnA2yhTjitiEgqJ7BXWtLjQCpXaLXWDQx30ybqkYDNEXbj9cj3U9s9r/aTs/KtZDzV7qS/R7JbS7kX1Dcis86sNuH91PLTO6uRCyvHgrJH6QlPZYhul/wDzE1RVGjlU24Oqz+W341Y/WOXbSS1aXvqfuUsa3U6pyzKpbBHe1RxIiqcTilyUqdJG0BttXqkHoJAT21vtwXvqlrWma4aOtT/GKdurdNyNQQmISLi9b2EvByV6HmdbCSPTxxGGZxzxHRTKRmoUqvQXVuZQAHForjTisW/w6uFqJnaVuTkgNEhbO+A7inaN9G6hR50kCl0tm5vqjKyi0LMYzVW+nuIoVhEvjZZkIO4qQEkZjI+ojak9XcKjDuVPTJgef5WiK4rg5bSPJiymg4w4h5pXxIIUPZTRj2vFQahagQVyctNrcO85DYWrnU2gn2ioG2jObW9gRpC7MxozA3WGkNJ5kJCR7KmyNrfaAEAKqvWqrbbEKTvB+UNjCDsP0j8PvrJc7hHFhm7koPkASwvNyn3ed6rxLr7hCGmkAkDE5IQmvPPlfM+pxKxSOLijVjzWmNOmypUDdrkEu3NSTj6bQzQziOc7f7CKafH8TNH7Oz/Cz3TxEzT+xzWg4NaTcgW12/TEbsu5gCOlQzRGBxB/mHxdQFMbWLS2qltVsWgyOzdl9vNMitSbpQ6u03f9F3h3U+mFrNseUXJ8ROKktknFRUj4mj+GsUsbmnU1IbiB9s8yR+w5jl5eCuoEvTWv4YfZUmDfm0/MQMCThy8m+jp2j30SQsuB/V63RSsnFRg5VMm3XyxP/NDjGeCZDSjuK6ljDuNJZoJYDxHUKVHNzUtnVV9SnBM1ZH0glR7yDXBuE4/YqwSFcpV9u0hJS9LcUk7UhW6D1hOAqp93K/NxXC8qHEt1wuLvpQmFOq2KUMkp+so5CiC3fIaNFVChOStZz9m0PFMiQtE3UTifktDNDOI8x5QOnaeTDOnccLLYf2k8FGWRsIqcXKi0Xom46sun/YL+FG2KX6qUuZKlLxxGX8Ie3YMqvt7cuOpyw29s64drf7PHyToACQABgBkANmFMk+RQhBAIIIxB2ihCX2ouE0R6X+qaakfpFyCt8NpxDCl843fE0fq5dFZZbYOxGBSubbRXVEdLu7yXFjV+uLIj8tqixOT4yRumfEAcBTzrCApP3t2o65G4OGoLjbqWPCVhPUY/XcvI1vwrlEqeYVHc+JBaU2QekNHCszmWzs20/j8KYvrcrm5rrhhF/wBvDXKX8KfT3gT/ADVfsqIFs3Jlfrqg30AXpzVeur22I2mrIu3RVZCW6ncATzpUsIR90E1frlcKNGkKJupZMI206qVp7hPGaki46kkfqs4nfLGZYCudW94nT9bAdFWxWgbicSuxbfjqkOo8uHmmClISAlIwSMgBsArWmaKEIoQihCKEIoQvhSk7QD10IogJSNgA6qEUX2hCKEIoQihCKEIoQuDs2O15ldwoQojmoLe3tKj2UIUdWrLYnaFd1FEL4nVtsVyK7qKIUhvUVvc2bw7KEKW1cIrvlUe0UIUgHEYihCKEIoQihChz/LQhUEvaa6uKuc20IXxFCFPjbRQhX9u8tcXVPoQihC//2Q=="},261:function(e,t){e.exports='<div class="shell">\n  <div class="container">\n    <div class="section section-invoice-head">\n      <table class="table-header">\n        <tbody>\n          <tr>\n            <td>\n              <h1>INVOICE</h1>\n            </td>\n            <td class="step-period">\n              <table class="table-inline">\n                <tbody>\n                  <tr>\n                    <td>Period</td>\n                    <td><strong>01/05 - 31/05</strong></td>\n                  </tr>\n                  <tr>\n                    <td>Invoice#</td>\n                    <td>100183</td>\n                  </tr>\n                  <tr>\n                    <td>Print Date</td>\n                    <td>19/06/2017</td>\n                  </tr>\n                </tbody>\n              </table>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n    <div class="section-info">\n      <table class="table-info">\n        <tbody><tr>\n            <td>\n              <small>to</small>\n            </td>\n            <td>\n              <h2>David Morrison</h2>\n              <span class="text">\n                <small>Account</small>\n                <span class="text">100183</span>\n              </span>\n            </td>\n          </tr>\n          <tr>\n            <td></td>\n            <td>\n714 Lexington Ave, New York, NY 10016 USA \n</td>\n          </tr>\n          <tr>\n            <td></td>\n            <td>david.morrison@example.com</td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n'},262:function(e,t){e.exports='<div class="section section-invoice-head">\n\t<div class="table">\n\t\t<table>\n\t\t\t<tbody><tr>\n\t\t\t\t<td class="page-title"><h3 class="inline">INVOICE</h3></td>\n\t\t\t\t<td>\n\t\t\t\t\t<span class="label">Customer</span>\n\t\t\t\t\t<h3 class="inline">David Morrison</h3>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<span class="label">Invoice#</span>\n\t\t\t\t\t<span>100183</span>\n\t\t\t\t</td>\n\t\t\t\t<td class="period">\n\t\t\t\t\t<span class="label">Period</span>\n\t\t\t\t\t<h3 class="inline">01/05 - 31/05</h3>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</tbody></table>\n\t</div>\x3c!-- /.table --\x3e\n</div>\n\n<div class="section section-invoice-base step-subscription-details">\n\t<h2>Subscription#1:</h2>\n\t<h1>Frank Reily</h1>\n</div>\n'},263:function(e,t){e.exports='\x3c!-- Body --\x3e\n<div class="wrapper">\n  <div class="shell">\n    <div class="container">\n        <div class="section section-invoice-details sumup">\n          <div class="section-head">\n            <h2 class="section-title section-title-alt">Invoice summary</h2>\x3c!-- /.section-title --\x3e\n          </div>\x3c!-- /.section-head --\x3e\n          <div class="section-body">\n            <div class="table table-default table-default-primary complex-sumup-wrapper">\n              <table class="complex-sumup">\n          <thead>\n            <tr>\n              <th>Description</th>\n              <th>Qty</th>\n              <th>Rate</th>\n              <th></th>\n              <th>Amount</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr class="step-plan">\n              <td class="desc step-plan">Premium unlimited plan</td>\n              <td class="qty">5</td>\n              <td class="rate">14.95</td>\n              <td class="span small-text"></td>\n              <td class="amount">$74.75</td>\n            </tr>\n            <tr class="">\n              <td class="desc">Voicemail service</td>\n              <td class="qty">1</td>\n              <td class="rate">14.95</td>\n              <td class="span small-text"></td>\n              <td class="amount">$14.95</td>\n            </tr>\n            <tr class="step-service">\n              <td class="desc">IP Phone rental</td>\n              <td class="qty">1</td>\n              <td class="rate">14.95</td>\n              <td class="span small-text"></td>\n              <td class="amount">$14.95</td>\n            </tr>\n            <tr class="">\n              <td class="desc">Call Recording</td>\n              <td class="qty">4</td>\n              <td class="rate">6.95</td>\n              <td class="span small-text"></td>\n              <td class="amount">$27.80</td>\n            </tr>\n            <tr class="step-discount">\n              <td class="desc">Premium unlimited plan discount</td>\n              <td class="qty">1</td>\n              <td class="rate">-14.95</td>\n              <td class="span small-text"></td>\n              <td class="amount">$-14.95</td>\n            </tr>\n            <tr class="">\n              <td colspan="4">Usage charges</td>\n              <td>$36.92</td>\n            </tr>\n            <tr class="">\n              <td colspan="4">Charges</td>\n              <td>$0.00</td>\n            </tr>\n            <tr class="last">\n              <td colspan="4">Refunds</td>\n              <td>$0.00</td>\n            </tr>\n            <tr class="total subtotal">\n              <td colspan="4">SUBTOTAL</td>\n              <td>$154.42</td>\n            </tr>\n            <tr class="total">\n              <td colspan="4">VAT (17%)</td>\n              <td>$26.25</td>\n            </tr>\n\x3c!--            <tr class="">\n              <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Local communications svc  tax </td>\n              <td>$14.82</td>\n            </tr>\n                <tr class="">\n              <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fl communications services tax </td>\n              <td>$21.20</td>\n            </tr>\n                <tr class="">\n              <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Federal trs fund </td>\n              <td>$1.02</td>\n            </tr>\n                <tr class="">\n              <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Federal universal service fund </td>\n              <td>$8.28</td>\n            </tr>\n                <tr class="last">\n              <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fl 911 surcharge </td>\n              <td>$2.00</td>\n            </tr>\n--\x3e\n            <tr class="grand-total">\n              <td colspan="4">GRAND TOTAL</td>\n              <td>$180.67</td>\n            </tr>\n              </tbody>\n            </table>\n          </div>\x3c!-- /.table table-default table-default-primary --\x3e\n        </div>\x3c!-- /.section-body --\x3e\n      </div>\n    </div>\n  </div>\n</div>\n'},264:function(e,t){e.exports='<div class="section section-invoice-details sumup">\n  <div class="section-head">\n    <h2 class="section-title section-title">Subscription Summary</h2>\x3c!-- /.section-title --\x3e\n  </div>\x3c!-- /.section-head --\x3e\n  <div class="section-body">\n    <div class="table table-default table-default-primary complex-sumup-wrapper">\n      <table class="complex-sumup">\n        <thead>\n          <tr>\n            <th>Description</th>\n            <th>Qty</th>\n\t\t\t<th>Rate</th>\n            <th></th>\n            <th>Amount</th>\n          </tr>\n        </thead>\n        <tbody>\n\t\t<tr class="step-plan">\n\t\t  <td class="desc step-plan">Premium unlimited plan</td>\n\t\t  <td class="qty">5</td>\n          <td class="rate">14.95</td>\n\t\t  <td class="span small-text"></td>\n\t\t  <td class="amount">$74.75</td>\n\t\t</tr>\n\t\t<tr class="">\n\t\t  <td class="desc">Voicemail service</td>\n\t\t  <td class="qty">1</td>\n          <td class="rate">14.95</td>\n\t\t  <td class="span small-text"></td>\n\t\t  <td class="amount">$14.95</td>\n\t\t</tr>\n\t\t<tr class="step-service">\n\t\t  <td class="desc">IP Phone rental</td>\n\t\t  <td class="qty">1</td>\n          <td class="rate">14.95</td>\n\t\t  <td class="span small-text"></td>\n\t\t  <td class="amount">$14.95</td>\n\t\t</tr>\n\t\t<tr class="">\n\t\t  <td class="desc">Call Recording</td>\n\t\t  <td class="qty">4</td>\n          <td class="rate">6.95</td>\n\t\t  <td class="span small-text"></td>\n\t\t  <td class="amount">$27.80</td>\n\t\t</tr>\n\t\t<tr class="step-discount">\n\t\t  <td class="desc">Premium unlimited plan discount</td>\n\t\t  <td class="qty">1</td>\n          <td class="rate">-14.95</td>\n\t\t  <td class="span small-text"></td>\n\t\t  <td class="amount">$-14.95</td>\n\t\t</tr>\n        <tr class="">\n          <td colspan="4">Usage charges</td>\n          <td>$36.92</td>\n        </tr>\n        <tr class="">\n          <td colspan="4">Charges</td>\n          <td>$0.00</td>\n        </tr>\n        <tr class="last">\n          <td colspan="4">Refunds</td>\n          <td>$0.00</td>\n        </tr>\n        <tr class="total subtotal">\n          <td colspan="4">SUBTOTAL</td>\n          <td>$154.42</td>\n        </tr>\n\t\t<tr class="total">\n\t\t  <td colspan="4">VAT (17%)</td>\n\t\t  <td>$26.25</td>\n\t\t</tr>\n\x3c!--        <tr class="">\n          <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Local communications svc  tax </td>\n          <td>$14.82</td>\n        </tr>\n            <tr class="">\n          <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fl communications services tax </td>\n          <td>$21.20</td>\n        </tr>\n            <tr class="">\n          <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Federal trs fund </td>\n          <td>$1.02</td>\n        </tr>\n            <tr class="">\n          <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Federal universal service fund </td>\n          <td>$8.28</td>\n        </tr>\n            <tr class="last">\n          <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fl 911 surcharge </td>\n          <td>$2.00</td>\n        </tr>\n--\x3e\n        <tr class="grand-total">\n          <td colspan="4">GRAND TOTAL</td>\n          <td>$180.67</td>\n        </tr>\n      </tbody>\n      </table>\n    </div>\x3c!-- /.table table-default table-default-primary --\x3e\n  </div>\x3c!-- /.section-body --\x3e\n</div>\n'},265:function(e,t){e.exports='<div class="section section-invoice-details step-usage-details">\n\t<div class="section-head">\n\t\t<h2 class="section-title">Usage Details</h2>\x3c!-- /.section-title --\x3e\n\t</div>\x3c!-- /.section-head --\x3e\n\n\t<div class="section-body">\n\t\t<div class="table table-default">\n\t\t\t<table class="table-usage">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Date &amp; Time</th>\n\t\t\t\t\t\t<th>Type</th>\n\t\t\t\t\t\t<th>Rate</th>\n\t\t\t\t\t\t<th>Volume</th>\n\t\t\t\t\t\t<th>Amount</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>01/05/2017 08:34</td>\n\t\t\t\t\t\t<td>Incoming SMS</td>\n\t\t\t\t\t\t<td>Incoming SMS in Italy</td>\n\t\t\t\t\t\t<td>1</td>\n\t\t\t\t\t\t<td>$ 1.00</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>02/05/2017 10:05</td>\n\t\t\t\t\t\t<td>Outgoing SMS</td>\n\t\t\t\t\t\t<td>Domestic SMS</td>\n\t\t\t\t\t\t<td>1</td>\n\t\t\t\t\t\t<td>$ 0.24</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>02/05/2017 10:08</td>\n\t\t\t\t\t\t<td>Outgoing call</td>\n\t\t\t\t\t\t<td>Domestic calls</td>\n\t\t\t\t\t\t<td>00:12:41</td>\n\t\t\t\t\t\t<td>$ 10.00</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>03/05/2017 12:15</td>\n\t\t\t\t\t\t<td>Outgoing call</td>\n\t\t\t\t\t\t<td>Domestic calls</td>\n\t\t\t\t\t\t<td>00:04:56</td>\n\t\t\t\t\t\t<td>$ 3.50</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>05/05/2017 08:34</td>\n\t\t\t\t\t\t<td>Outgoing call</td>\n\t\t\t\t\t\t<td>Domestic calls</td>\n\t\t\t\t\t\t<td>00:09:14</td>\n\t\t\t\t\t\t<td>$ 7.02</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>05/05/2017 10:05</td>\n\t\t\t\t\t\t<td>Outgoing call</td>\n\t\t\t\t\t\t<td>Domestic calls</td>\n\t\t\t\t\t\t<td>00:08:11</td>\n\t\t\t\t\t\t<td>$ 6.24</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr class="step-products">\n\t\t\t\t\t\t<td>06/05/2017 12:07</td>\n\t\t\t\t\t\t<td>Outgoing call</td>\n\t\t\t\t\t\t<td>International call to France</td>\n\t\t\t\t\t\t<td>00:07:33</td>\n\t\t\t\t\t\t<td>$ 8.42</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>06/05/2017 12:15</td>\n\t\t\t\t\t\t<td>Outgoing call</td>\n\t\t\t\t\t\t<td>Domestic calls</td>\n\t\t\t\t\t\t<td>00:00:53</td>\n\t\t\t\t\t\t<td>$ 0.50</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\x3c!-- /.table table-default --\x3e\n\t</div>\x3c!-- /.section-body --\x3e\n</div>\n'},282:function(e,t,n){e.exports=n(528)},421:function(e,t,n){e.exports=n.p+"static/media/footer-logo.1f38670a.png"},422:function(e,t,n){},423:function(e,t,n){},523:function(e,t,n){},524:function(e,t,n){},525:function(e,t,n){},526:function(e,t,n){},527:function(e,t,n){},528:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(25),o=n.n(i),l=n(14),s=n(18),c=n(4),u=n(5),p=n(7),d=n(6),m=n(8),g=n(2),f=n(1),h=function(e){var t=e.hide,n=e.progress,a=e.progressLabel,i=e.reversed,o=e.saveLabel,l=e.hideSave,s=e.disableSave,c=e.onClickSave,u=e.cancelLabel,p=e.hideCancel,d=e.disableCancel,m=e.onClickCancel;return t?null:r.a.createElement("div",{style:{marginTop:12}},!l&&r.a.createElement(f.c,{onClick:c,bsStyle:i?"default":"primary",disabled:n||s,style:{minWidth:90,marginRight:10}},n&&r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-spinner fa-pulse"}),"\xa0\xa0"),n&&null!==a?a:o),!p&&r.a.createElement(f.c,{onClick:m,bsStyle:i?"primary":"default",disabled:d,style:{minWidth:90}},u),e.children)};h.defaultProps={children:null,hide:!1,hideCancel:!1,hideSave:!1,progress:!1,disableSave:!1,disableCancel:!1,cancelLabel:"Cancel",saveLabel:"Save",progressLabel:null,reversed:!1,onClickCancel:function(){},onClickSave:function(){}};var v=h,y=n(241),b=function(e){var t=e.inputNew,n=e.inputOld,a=e.title,i=e.show,o=e.onClose,l=e.diffType,s=e.closeLabel;return r.a.createElement(f.r,{show:i,onHide:o},r.a.createElement(f.r.Header,{closeButton:!0},r.a.createElement(f.r.Title,null,a)),r.a.createElement(f.r.Body,null,r.a.createElement("pre",null,r.a.createElement(y.a,{inputA:n,inputB:t,type:l}))),r.a.createElement(f.r.Footer,null,r.a.createElement("div",{className:"push-left",style:{width:"50%",display:"inline-block"}},r.a.createElement("p",{className:"text-center",style:{backgroundColor:"salmon",marginBottom:5}}," Old value "),r.a.createElement("p",{className:"text-center",style:{backgroundColor:"lightgreen",marginBottom:5}}," New value ")),r.a.createElement("div",{className:"push-right",style:{width:"50%",display:"inline-block"}},r.a.createElement(f.c,{onClick:o},s))))};b.defaultProps={show:!0,closeLabel:"Close",diffType:"json",title:"Diff"};var E=b,C=function(e){return r.a.createElement("div",null,r.a.createElement("p",null,e.loadingLabel),e.onClick&&r.a.createElement(f.c,{onClick:e.onClick,bsStyle:"default"},e.buttonLabel))};C.defaultProps={buttonLabel:"Back",loadingLabel:"Loading..."};var _=C,O=n(16),S=n.n(O),T=n(10),k=n.n(T),I=function(e){var t=e.from,n=e.to,a=e.status,i="";if(a.length)i=k()("cycle",{expired:"expired"===a,future:"future"===a,active:"active"===a});else{var o=S()(t),l=S()(n);i=k()("cycle",{expired:l.isBefore(S()()),future:o.isAfter(S()()),active:!l.isBefore(S()())&&!o.isAfter(S()())})}return r.a.createElement("div",{className:i})};I.defaultProps={from:"",to:"",status:""};var N=I,w=n(20),j=n(26),R=n.n(j),x=n(19),F=n.n(x),P={datetimeFormat:"DD/MM/YYYY HH:mm",datetimeLongFormat:"DD/MM/YYYY HH:mm:ss",dateFormat:"DD/MM/YYYY",timeFormat:"HH:mm",apiDateFormat:"YYYY-MM-DD",apiDateTimeFormat:"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]",listDefaultItems:10,planCycleUnlimitedValue:"UNLIMITED",serviceCycleUnlimitedValue:"UNLIMITED",productUnlimitedValue:"UNLIMITED",fieldKeyRegex:/^[A-Za-z0-9._]*$/,keyUppercaseRegex:/^[A-Z0-9_]+$/,keyUppercaseCleanRegex:/[^A-Z|0-9_]/g,keyRegex:/^[A-Za-z0-9_]*$/,keyCleanRegex:/[^a-z|A-Z|0-9_]/g,defaultLogo:"billRun-cloud-logo.png",billrunCloudLogo:"billRun-cloud-logo.png",billrunLogo:"billRun-logo.png",queue_calculators:["customer","rate","pricing"],logoMaxSize:2,importMaxSize:8,chargingBufferDays:5},M=n(242),A={entities:["usage","subscription","customer","logFile","queue","event","bills"],fields:{usage:[{id:"urt",type:"datetime"},{id:"lastname"},{id:"firstname"},{id:"stamp"},{id:"in_group",type:"number"},{id:"full_price",type:"number",title:"Plan / Service Full Price"},{id:"name",type:"string",title:"Plan / Service / Discount key"},{id:"aprice",type:"number"},{id:"final_charge",type:"number"},{id:"file"},{id:"billsec",type:"number"},{id:"sid",type:"number"},{id:"over_group",type:"number"},{id:"usagev",type:"number"},{id:"aid",type:"number"},{id:"process_time",type:"datetime"},{id:"in_queue",type:"boolean"},{id:"usagesb",type:"number"},{id:"type",title:"Input processor name / BillRun type",inputConfig:{inputType:"select",callback:"getFileTypeOptions",options:[{value:"flat",label:"Subscription"},"service",{value:"credit",label:"Charge / Refund"},"discount","all"]}},{id:"session_id",type:"string"},{id:"billrun_pretend",type:"boolean"},{id:"billrun_status",title:"Billing cycle status",aggregatable:!1,inputConfig:{inputType:"select",options:[{value:"current",label:"Current"},{value:"first_unconfirmed",label:"First Unconfirmed"},{value:"last_confirmed",label:"Last Confirmed"},{value:"confirmed",label:"Confirmed"}]}},{id:"arate_key",inputConfig:{inputType:"select",callback:"getProductsOptions"}},{id:"arategroup",inputConfig:{inputType:"select",callback:"getGroupsOptions"}},{id:"billrun",inputConfig:{inputType:"select",callback:"getCyclesOptions"}},{id:"plan",inputConfig:{inputType:"select",callback:"getPlansOptions"}},{id:"usaget",inputConfig:{inputType:"select",callback:"getUsageTypesOptions"}},{id:"pp_includes_name",inputConfig:{inputType:"select",callback:"getBucketsOptions"}},{id:"pp_includes_external_id",inputConfig:{inputType:"select",callback:"getBucketsExternalIdsOptions"}},{id:"charging_usaget",inputConfig:{inputType:"select",callback:"getUsageTypesOptions"}},{id:"balance_before",type:"number"},{id:"balance_after",type:"number"},{id:"balance_normalized",type:"number"},{id:"start",title:"Proration start date",type:"datetime"},{id:"end",title:"Proration end date",type:"datetime"},{id:"tax_data.taxes.key",title:"Tax key",inputConfig:{inputType:"select",callback:"getTaxesOptions"}},{id:"tax_data.total_tax",type:"number",title:"Tax rate"},{id:"tax_data.total_amount",type:"number",title:"Total taxes"}],subscribers:[{id:"aid",type:"number"},{id:"sid",type:"number"},{id:"plan",inputConfig:{inputType:"select",callback:"getPlansOptions"}},{id:"services",inputConfig:{inputType:"select",callback:"getServicesOptions"}},{id:"plan_activation",type:"date"},{id:"deactivation_date",type:"date"},{id:"play",inputConfig:{inputType:"select",callback:"getPlayTypeOptions"}}],account:[{id:"aid",type:"number"}],event:[{id:"type",inputConfig:{inputType:"select",options:["is","in","is_not","is_less_than","is_less_than_or_equal","is_greater_than","is_greater_than_or_equal","reached_constant","reached_constant_recurring","has_changed","has_changed_to","has_changed_from"]}},{id:"aid",type:"number"},{id:"sid",type:"number"},{id:"creation_time",type:"date"},{id:"notify_time",type:"date"},{id:"value"},{id:"stamp"},{id:"event_code",inputConfig:{inputType:"select",callback:"getEventCodeOptions"}},{id:"returned_value",searchable:!1}],logFile:[{id:"file_name",title:"File name"},{id:"stamp",title:"Unique record ID"},{id:"start_process_time",type:"date"},{id:"received_time",type:"date"},{id:"process_time",type:"date"},{id:"logfile_status",columnable:!1,title:"Status",inputConfig:{inputType:"select",options:[{value:"not_processed",label:"Received"},{value:"processing",label:"Processing"},{value:"processed",label:"Processed"},{value:"crashed",label:"Crashed"}]}},{id:"source",title:"Source",inputConfig:{inputType:"select",callback:"getFileTypeOptions"}}],queue:[{id:"calc_name",title:"Calculator Name",inputConfig:{inputType:"select",callback:"getCalcNameOptions"}},{id:"in_queue_since",type:"date"}],bills:[{id:"type",inputConfig:{inputType:"select",options:[{value:"inv",label:"Invoice"},{value:"rec",label:"Payment / Transaction"}]},title:"Type"},{id:"cancelled",type:"boolean",title:"Cancelled Payment?"},{id:"cancel",type:"string",title:"Cancelled BillRun Transaction ID"},{id:"cancellation",type:"boolean",title:"Cancellation Transaction?"},{id:"rejected",type:"boolean",title:"Rejected Payment?"},{id:"rejection",type:"boolean",title:"Rejection Transaction?"},{id:"aid",type:"number",title:"Customer ID"},{id:"invoice_id",type:"number",title:"Invoice ID"},{id:"due_date",type:"date",title:"Due Date"},{id:"due",type:"number",title:"Original Due Date"},{id:"payer_name",type:"string",title:"Payer Name"},{id:"amount",type:"number",title:"Original Absolute Due Amount"},{id:"lastname",type:"string",title:"Customer's Last Name"},{id:"firstname",type:"string",title:"Customer's First Name"},{id:"payment_method",type:"string",title:"Payment Method"},{id:"urt",type:"date",title:"Creation Time"},{id:"invoice_date",type:"date",title:"Invoice Date"},{id:"total_paid",type:"number",title:"Total Paid Amount"},{id:"left_to_pay",type:"number",title:"Bill Unpaid Amount"},{id:"vatable_left_to_pay",type:"number",title:"Bill Vatable Left Amount"},{id:"waiting_payments",type:"number",title:"Pending BillRun's Transaction ID"},{id:"paid",inputConfig:{inputType:"select",options:[{value:"0",label:"Unpaid"},{value:"1",label:"Paid"},{value:"2",label:"Awaiting Payment"}]},title:"Status"},{id:"payment_gateway.name",inputConfig:{inputType:"select",options:[{value:"CreditGuard",label:"CreditGuard"}]},title:"Payment Gateway"},{id:"dir",inputConfig:{inputType:"select",options:[{value:"fc",label:"From Customer"},{value:"tc",label:"To Customer"}]},title:"Direction"},{id:"gateway_details.four_digits",type:"string",title:"Last 4 Digits"},{id:"left",type:"number",title:"Bill Reserved Amount"},{id:"waiting_for_confirmation",type:"boolean",title:"Waiting For Confirmation?"},{id:"txid",type:"string",title:"BillRun Transaction ID"},{id:"vendor_response.status",type:"string",title:"Vendor Response Status"},{id:"last_checked_pending",type:"date",title:"Last Status Check"},{id:"original_txid",type:"string",title:"Original BillRun Transaction ID"},{id:"rejection_code",type:"string",title:"Rejection Code"}]},conditionsOperators:[{id:"last_days",title:"Last (days)",include:["fieldid:urt"],type:"number",suffix:"Days"},{id:"last_days_include_today",title:"Last (days including today)",include:["fieldid:urt"],type:"number",suffix:"Days"},{id:"last_hours",title:"Last (hours)",include:["fieldid:urt"],type:"number",suffix:"Hours"},{id:"eq",title:"Equals",include:["date","datetime","boolean","fieldid:billrun_status","fieldid:logfile_status"]},{id:"in",title:"Equals",include:["string","number"],exclude:["fieldid:billrun_status","fieldid:logfile_status"]},{id:"ne",title:"Does not equal",include:["boolean"],exclude:[]},{id:"nin",title:"Does not equal",include:["string","number"],exclude:["fieldid:billrun_status","fieldid:logfile_status"]},{id:"lt",title:"<",include:["number","date","datetime","fieldid:billrun"],exclude:[]},{id:"lte",title:"<=",include:["number","date","datetime","fieldid:billrun"],exclude:[]},{id:"gt",title:">",include:["number","date","datetime","fieldid:billrun"],exclude:[]},{id:"gte",title:">=",include:["number","date","datetime","fieldid:billrun"],exclude:[]},{id:"like",title:"Contains",include:["string","number"],exclude:["fieldid:logfile_status"]},{id:"starts_with",title:"Starts with",include:["string"],exclude:["fieldid:logfile_status"]},{id:"ends_with",title:"Ends with",include:["string"],exclude:["fieldid:logfile_status"]},{id:"in_range",title:"Include\u200e",include:["ranges","range"]},{id:"nin_range",title:"Does not include\u200e",include:["ranges","range"]},{id:"exists",title:"Exists",type:"boolean",include:["string","number","boolean","date","datetime","ranges","range"],exclude:["fieldid:billrun_status","fieldid:logfile_status"],options:["yes","no"]}],aggregateOperators:[{id:"group",title:"Group",include:["string","number","boolean","date"],exclude:["fieldid:count_group","fieldid:tax_data.total_amount"]},{id:"sum",title:"Sum",include:["number"],exclude:["fieldid:count_group","fieldid:tax_data.total_tax"]},{id:"avg",title:"Average",include:["number"],exclude:["fieldid:count_group","fieldid:tax_data.total_tax"]},{id:"first",title:"First",include:["string","number","boolean","date","ranges","range"],exclude:["fieldid:count_group"]},{id:"last",title:"Last",include:["string","number","boolean","date","ranges","range"],exclude:["fieldid:count_group"]},{id:"max",title:"Max",include:["number","date"],exclude:["fieldid:count_group"]},{id:"min",title:"Min",include:["number","date"],exclude:["fieldid:count_group"]},{id:"push",title:"List",include:["string","number","boolean","date"],exclude:["fieldid:count_group"]},{id:"addToSet",title:"Unique List",include:["string","number","boolean","date","ranges","range"],exclude:["fieldid:count_group"]},{id:"count",title:"Count",include:["fieldid:count_group"]}],outputFormats:[{id:"date_format",title:"Date",options:[{value:"d/m/Y",label:"31/12/2017"},{value:"m/d/Y",label:"12/31/2017"},{value:"Y-m-d",label:"2017-12-31"}]},{id:"datetime_format",title:"Date time",options:[{value:"d/m/Y H:i",label:"31/12/2017 22:05"},{value:"d/m/Y H:i:s",label:"31/12/2017 22:05:59"},{value:"m/d/Y h:i A",label:"12/31/2017 10:05 PM"},{value:"m/d/Y h:i:s A",label:"12/31/2017 10:05:59 PM"},{value:"c",label:"ISO 8601"}]},{id:"date_override",title:"Subtract / Add time",type:"number",valueTypes:[{value:"seconds",label:"Seconds"},{value:"minutes",label:"Minutes"},{value:"hours",label:"Hours"},{value:"days",label:"Days"},{value:"weeks",label:"Weeks"},{value:"months",label:"Months"},{value:"years",label:"Years"}]},{id:"time_format",title:"Time",options:[{value:"H:i",label:"22:05"},{value:"H:i:s",label:"22:05:59"},{value:"h:i A",label:"10:05 PM"},{value:"h:i:s A",label:"10:05:59 PM"}]},{id:"multiplication",title:"Multiply by a number"},{id:"default_empty",title:"Default Value",addOption:!0,options:[{value:"current_time",label:"Current Time"},{value:"current_start",label:"Current Billing Cycle Start"},{value:"current_end",label:"Current Billing Cycle End"},{value:"first_unconfirmed_start",label:"First Unconfirmed Billing Cycle Start"},{value:"first_unconfirmed_end",label:"First Unconfirmed Cycle End"},{value:"last_confirmed_start",label:"Last Confirmed Billing Cycle Start"},{value:"last_confirmed_end",label:"Last Confirmed Billing Cycle End"}]},{id:"vat_format",title:"Vat",options:[{value:"add_tax",label:"Add Vat"},{value:"remove_tax",label:"Remove Vat"}]},{id:"currency_format",title:"Currency",options:[{value:"suffix",label:"1234$"},{value:"prefix",label:"$1234"}]},{id:"billing_cycle",title:"Billing cycle",options:[{value:"start",label:"Start Date"},{value:"end",label:"End Date"}]}]},D=n(243),L=n(244),U=n(245),V=n(246),B=n(247),q=n(248),z=n(249),H=g.c.Map(),Y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Array.isArray(e)?e:[e];if(H.isEmpty()&&(H=g.c.fromJS(P)),!H.has(n[0]))switch(n[0]){case"env":var a=g.c.Map().withMutations(function(e){Object.entries(Object({NODE_ENV:"production",PUBLIC_URL:"",REACT_APP_serverApiUrl:"",REACT_APP_storageVersion:"2.0.4",REACT_APP_serverApiVersion:"5.9.5",REACT_APP_serverApiTimeOut:"300000",REACT_APP_mailSupport:"cloud_support@billrun.com",REACT_APP_billrunCloudLogo:"billRun-cloud-logo.png",REACT_APP_billrunLogo:"billRun-logo.png"})).forEach(function(t){if(t[0].startsWith("REACT_APP_")){var n=t[0].replace("REACT_APP_",""),a=t[1];"true"===t[1]?a=!0:"false"===t[1]?a=!1:R()(a)&&(a=parseFloat(a)),e.set(n,a)}})});H=H.set("env",a);break;case"reports":H=H.set("reports",g.c.fromJS(A));break;case"fieldNames":H=H.set("fieldNames",g.c.fromJS(M));break;case"systemItems":H=H.set("systemItems",g.c.fromJS(D));break;case"mainMenu":H=H.set("mainMenu",g.c.fromJS(L));break;case"events":H=H.set("events",g.c.fromJS(U));break;case"rates":H=H.set("rates",g.c.fromJS(V));break;case"import":H=H.set("import",g.c.fromJS(B));break;case"collections":H=H.set("collections",g.c.fromJS(q));break;case"customFields":H=H.set("customFields",g.c.fromJS(z));break;default:console.log("Config caregory not exists ".concat(n))}return H.getIn(n,t)},G=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=Y(["fieldNames",t,e],!1);if("string"===typeof a&&a.length>0)return a;var r=Y(["fieldNames",e],!1);return"string"===typeof r&&r.length>0?r:null!==n?n:e},K=function(e){switch(e){case"account":case"customer":return"account";case"subscription":case"subscriptions":case"subscribers":case"subscriber":return"subscription";case"lines":case"line":case"usage":return"lines";case"service":case"services":return"service";case"plan":case"plans":return"plan";case"rate":case"rates":case"product":case"products":return"product";default:return e}},W=function(e){switch(e){case"account":case"customer":return"customer";case"lines":case"line":case"usage":return"usage";default:return K(e)}},J=function(e){return e.get("first_name",e.get("firstname",""))},Q=function(e){return e.get("last_name",e.get("lastname",""))},$=function(e){return e.get("aid","")},Z=function(e){return e.get("sid","")},X=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.c.Map();switch(e){case"clone":case"create":var a=Y(["systemItems",t]);return a?"Create New ".concat(Object(x.titleCase)(a.get("itemName",a.get("itemType","")))):"Create";case"loading":case"closeandnew":var r=Y(["systemItems",t]);return r?"customer"===t?"Edit ".concat(Object(x.titleCase)(r.get("itemName",r.get("itemType","")))," - ").concat(J(n)," ").concat(Q(n)," [").concat($(n),"]"):"subscription"===t?"Edit ".concat(Object(x.titleCase)(r.get("itemName",r.get("itemType","")))," - ").concat(J(n)," ").concat(Q(n)," [").concat(Z(n),"]"):"auto_renew"===t?"Edit ".concat(Object(x.titleCase)(r.get("itemName",r.get("itemType","")))):"Edit ".concat(Object(x.titleCase)(r.get("itemName",r.get("itemType","")))," - ").concat(n.get(r.get("uniqueField",""),"")):"Edit";case"view":var i=Y(["systemItems",t]);return i?"customer"===t?"".concat(Object(x.titleCase)(i.get("itemName",i.get("itemType","")))," - ").concat(J(n)," ").concat(Q(n)," [").concat($(n),"]"):"subscription"===t?"".concat(Object(x.titleCase)(i.get("itemName",i.get("itemType","")))," - ").concat(J(n)," ").concat(Q(n)," [").concat(Z(n),"]"):"".concat(Object(x.titleCase)(i.get("itemName",i.get("itemType","")))," - ").concat(n.get(i.get("uniqueField",""),"")):"View";case"update":var o=Y(["systemItems",t]);return o?"customer"===t?"Update ".concat(Object(x.titleCase)(o.get("itemName",o.get("itemType","")))," - ").concat(J(n)," ").concat(Q(n)," [").concat($(n),"]"):"subscription"===t?"Update ".concat(Object(x.titleCase)(o.get("itemName",o.get("itemType","")))," - ").concat(J(n)," ").concat(Q(n)," [").concat(Z(n),"]"):"Update ".concat(Object(x.titleCase)(o.get("itemName",o.get("itemType","")))," - ").concat(n.get(o.get("uniqueField",""),"")):"Update";default:return""}},ee=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S()();if(g.c.Map.isMap(e)){var a=e.get(t,!1);if("string"===typeof a)return S()(a);var r=e.getIn([t,"sec"],!1);if("number"===typeof r)return S.a.unix(r)}return n},te=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return g.c.Map.isMap(e)?e.getIn(["_id","$id"],t):t},ne=function(e){var t=e.getIn(["revision_info","early_expiration"],null);if(null!==t)return t;var n=ee(e,"to");return n.isAfter(S()())&&n.isBefore(S()().add(50,"years"))},ae=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"to";return ee(e,t).isBefore(S()().add(50,"years"))},re=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"create";if(g.c.Map.isMap(e)){if(null===te(e,null))return"create";var n=e.getIn(["revision_info","status"],""),a=e.getIn(["revision_info","is_last"],!0);return["expired"].includes(n)||"active"===n&&!a?"view":["future"].includes(n)||ne(e)?"update":"closeandnew"}return t},ie=function(e,t){return t&&te(e,!1)?S.a.max(t,ee(e,"originalValue",ee(e,"from",S()(0)))):te(e,!1)?ee(e,"originalValue",ee(e,"from",S()(0))):t||void 0},oe=function(e){return g.c.Map.isMap(e)?{value:e.get("value",""),label:e.get("label","")}:{value:e,label:Object(x.sentenceCase)(e)}},le=function(e){return oe(e.has("title")?g.c.Map({value:e.get("id"),label:e.get("title")}):e.get("id"))},se=function(e){return oe(g.c.Map({value:e.get("field_name"),label:e.get("title",e.get("field_name"),"")}))},ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("unique",!1)&&!e.get("generated",!1)&&e.get("editable",!0)},ue=function(e,t,n,a,r,i,o){var l=""===a?"":t.find(function(e){return e.get("id")===a},null,g.c.Map({title:i})).get("title",""),s=a===i?l:t.find(function(e){return e.get("id")===i},null,g.c.Map({title:i})).get("title",""),c=""===r?"":n.find(function(e){return e.get("id")===r},null,g.c.Map()).get("title",""),u=r===o?c:n.find(function(e){return e.get("id")===o},null,g.c.Map()).get("title",""),p=""===c||"group"===r?l:"".concat(l," (").concat(c,")");return""===e||e===p?""===u||"group"===o?s:"".concat(s," (").concat(u,")"):e},pe=function(e){return"account"===e?"customer":"subscriber"===e?"subscription":e},de=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Y(["systemItems",pe(e),"settingsKey"],e);return t?n.split("."):n}(e,!0),r=n.length>0?[].concat(Object(w.a)(a),Object(w.a)(n)):a;return t?r:r.join(".")},me=function(e,t){return e.find(function(e){return e.get("key","")===t})||g.c.Map()},ge=function(e){return e.get("rates",g.c.Map()).keySeq().first()||""},fe=function(e,t){return e.getIn(["rates",t,"BASE","rate",0,"uom_display","range"],"")},he=function(e,t,n){var a=t.find(function(e){return e.get("usage_type","")===n})||g.c.Map();return(e.find(function(e){return e.get("type","")===a.get("property_type","")})||g.c.Map()).get("uom",g.c.List())},ve=function(e,t){return(e.find(function(e){return e.get("usage_type","")===t})||g.c.Map()).get("property_type","")},ye=function(e,t,n,a){return(he(e,t,n).find(function(e){return e.get("name","")===a})||g.c.Map()).get("label","")},be=function(e,t,n,a,r){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if("UNLIMITED"===r)return"UNLIMITED";var o=(he(e,t,n).find(function(e){return e.get("name","")===a})||g.c.Map()).get("unit",1);return r.toString().split(",").map(function(e){return i?e*o:e/o}).join()},Ee=function(e,t,n,a,r){var i=n.get("rates",g.c.Map()).withMutations(function(n){n.forEach(function(i,o){i.forEach(function(i,l){var s="product"===r?o:l,c="product"===r?l:o;i.get("rate",g.c.List()).forEach(function(i,o){var l=i.getIn(["uom_display","range"],"counter"),u=i.getIn(["uom_display","interval"],"counter"),p=be(e,t,s,l,i.get("from"),a),d=R()(p)?parseFloat(p):p,m=i.get("to"),g="UNLIMITED"===m?"UNLIMITED":be(e,t,s,l,m,a),f=R()(g)?parseFloat(g):g,h=be(e,t,s,u,i.get("interval"),a),v=R()(h)?parseFloat(h):h,y="product"===r?[s,c,"rate",o]:[c,s,"rate",o];n.setIn([].concat(y,["from"]),d),n.setIn([].concat(y,["to"]),f),n.setIn([].concat(y,["interval"]),v)});var u=i.get("percentage",null);if(null!==u){var p="product"===r?[s,c]:[c,s],d=a?u/100:100*u;n.setIn([].concat(p,["percentage"]),d)}})})});return i.isEmpty()?g.c.Map():i},Ce=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Ee(e,t,n,a,"product")},_e=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Ee(e,t,n,a,"plan")},Oe=function(e){return!1!==e.get("cost",!1)?"cost":e.get("usage_types",g.c.Map()).keySeq().get(0,!1)},Se=function(e){return!1!==e.get("cost",!1)?"cost":g.c.List(e.get("usage_types",g.c.Map()).keySeq().toArray())},Te=function(e){return"cost"===Oe(e)},ke=function(e){return Te(e)?e.get("cost",""):e.get("value","")},Ie=function(e){return Te(e)?g.c.List(["cost"]):g.c.List(e.get("usage_types",g.c.Map()).keySeq().toArray())},Ne=function(e){return Te(e)?"cost":e.get("usage_types",g.c.Map()).valueSeq().get(0,g.c.Map()).get("unit",!1)},we=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=n.get("include",g.c.Map()).withMutations(function(n){n.get("groups",g.c.Map()).forEach(function(r,i){var o=Ne(r),l=Oe(r);if(o&&l&&!Te(r)){var s=ke(r),c=be(e,t,l,o,s,a),u="UNLIMITED"===c?c:parseFloat(c);n.setIn(["groups",i,"value"],u)}})});return r.isEmpty()?g.c.Map():r},je=function(e){if(["","default"].includes(e.get("balance_period","default")))return{type:"default",unit:"",value:""};var t=e.get("balance_period","").split(" "),n=t[t.length-1],a=Number(t[t.length-2]);return{type:"custom_period",unit:n,value:"days"===n?a+1:a}},Re=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.get("fields",g.c.List()).map(function(e){return g.c.Map({value:e,label:e})}).sortBy(function(e){return e.get("value","")}).concat(g.c.fromJS(t))},xe=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).reduce(function(e,t,n){return"".concat(e,".").concat(n,".").concat(t)},"rates")},Fe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"field_name";if(e.has("title"))return e;var a=K(!t&&e.has("entity")?e.get("entity"):t),r=e.get(n,""),i=Object(x.sentenceCase)(e.get(n,""));return e.set("title",G(r,a,i))},Pe=function(e){return[void 0,null].includes(e)?g.c.List():Array.isArray(e)?g.c.List(Object(w.a)(e)):g.c.Iterable.isIterable(e)?e.toList():g.c.List([e])},Me=function(e,t){var n=e.get("title","").toUpperCase(),a=t.get("title","").toUpperCase();return n<a?-1:n>a?1:0},Ae=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"exclude",a=e.get(n,g.c.List());return!a.isEmpty()&&a.includes(t)},De=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"include",a=e.get(n,g.c.List());return!!a.isEmpty()||a.includes(t)},Le=function(e){return e.has("foreign")},Ue=function(e){return"unixTimeToString"!==e.getIn(["foreign","translate","type"],"")},Ve=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!t)return!1;var a=e.get("changeable_props",null);return null===a?!e.get("system",!1):""===n?!a.isEmpty():a.includes(n)},Be=function(e){return e.map(function(e){return{value:e.get("name",""),label:e.get("label",e.get("name",""))}}).toArray()},qe=function(e){var t=e.revisions,n=e.size,a=e.item,i=e.start,o=e.itemName,l=g.c.List().withMutations(function(e){var n=g.c.Map();t.forEach(function(t){var a=g.c.Map({closed:!0,to:t.get("to","")});(ne(t)||function(e,t){var n=ee(e,"from",!1),a=ee(t,"to",!1);return!(!n||!a)&&n.isAfter(a.add(1,"days"))}(n,t))&&e.push(a),e.push(t),n=t})}).reverse(),s=null!==i?i:l.findIndex(function(e){return te(e)===te(a)}),c=Math.floor((n-1)/2),u=Math.max(s-c,0),p=u+n;p>=l.size&&(p=l.size,u=Math.max(p-n,0));var d=l.size>n&&p<l.size,m=l.size>n&&u>0,f=function(e){return r.a.createElement("li",{key:"".concat(te(a,""),"-more-").concat(e),className:"more ".concat(e)},r.a.createElement("div",{style:{height:"22px"}},"\xa0"),r.a.createElement("div",null,r.a.createElement("div",null,"\xa0"),r.a.createElement("div",null,"\xa0")))};return r.a.createElement("ul",{className:"revision-history-list"},m&&f("before"),l.slice(u,p).map(function(e,t,n){if(e.get("closed",!1))return function(e){var t=ee(e,"to");return r.a.createElement("li",{key:"".concat(te(e,""),"-closed"),className:"closed"},r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("i",{style:{fontSize:19},className:"fa fa-times-circle"})),r.a.createElement("small",{className:"date"},t.format("MMM DD"),r.a.createElement("br",null),t.format("YYYY"))))}(e);var i=ee(e,"from"),l=te(e,"")===te(a,""),s=k()("revision",{active:l,first:0===t,last:t===n.size-1});return r.a.createElement("li",{key:"".concat(te(e,"")),className:s},r.a.createElement("div",null,r.a.createElement("div",null,l?r.a.createElement(N,{status:e.getIn(["revision_info","status"],"")}):r.a.createElement(st,{item:e,itemName:o,type:"edit"},r.a.createElement(N,{status:e.getIn(["revision_info","status"],"")}))),r.a.createElement("small",{className:"date"},i.format("MMM DD"),r.a.createElement("br",null),i.format("YYYY"))))}),d&&f("after"))};qe.defaultProps={revisions:g.c.List(),item:g.c.Map(),itemName:"",size:5,start:null};var ze=qe,He=function(e){return r.a.createElement(f.r,{show:e.show,bsSize:e.modalSize},r.a.createElement(f.r.Header,{closeButton:null!==e.onHide,onHide:e.onHide},r.a.createElement(f.r.Title,null,e.title)),r.a.createElement(f.r.Body,null,e.children),(e.onCancel||e.onOk)&&r.a.createElement(f.r.Footer,null,e.onCancel&&r.a.createElement(f.c,{bsSize:"small",style:{minWidth:90},onClick:e.onCancel,bsStyle:e.styleCancel},e.labelCancel),e.onOk&&r.a.createElement(f.c,{bsSize:"small",style:{minWidth:90},onClick:e.onOk,bsStyle:e.styleOk,disabled:e.progress},e.progress&&r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-spinner fa-pulse"}),"\xa0\xa0"),e.progress&&null!==e.labelProgress?e.labelProgress:e.labelOk)))};He.defaultProps={children:null,title:"",show:!1,progress:!1,labelOk:"OK",labelCancel:"Cancel",labelProgress:null,modalSize:void 0,onHide:null,onOk:null,onCancel:null,styleOk:"primary",styleCancel:void 0};var Ye=He,Ge=function(e){return r.a.createElement(f.r,{show:e.show},r.a.createElement(f.r.Header,{closeButton:!1},r.a.createElement(f.r.Title,null,e.message)),e.children&&r.a.createElement(f.r.Body,null,e.children),r.a.createElement(f.r.Footer,null,"alert"!==e.type&&r.a.createElement(f.c,{bsSize:"small",style:{minWidth:90,marginRight:5},onClick:e.onCancel},e.labelCancel),r.a.createElement(f.c,{bsSize:"small",style:{minWidth:90},onClick:e.onOk,bsStyle:"delete"===e.type?"danger":"primary"},e.labelOk)))};Ge.defaultProps={show:!1,type:"confirm",children:null,labelCancel:"Cancel",labelOk:"Ok",onCancel:null};var Ke=Ge,We=function(e){var t=e.label,n=e.onClick,i=e.type,o=e.action,l=e.disabled,s=e.title,c=e.data,u=e.buttonStyle,p=Object(a.useCallback)(function(){return n(c)},[n,c]);return r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:p,style:u,disabled:l,title:s},r.a.createElement("i",{className:"fa fa-plus"}),o.length>0&&" ".concat(o),t.length>0&&" ".concat(t),i.length>0&&" ".concat(i))};We.defaultProps={label:"New",action:"",type:"",title:"",data:null,disabled:!1,buttonStyle:{marginTop:15},onClick:function(){}};var Je=Object(a.memo)(We),Qe=function(e){var t=e.type,n=e.label,i=e.data,o=e.actionStyle,l=e.showIcon,s=e.actionSize,c=e.actionClass,u=e.show,p=e.enable,d=e.helpText,m=e.renderFunc,g=e.onClick,h=Object(a.useMemo)(function(){return"boolean"===typeof u&&u||"function"===typeof u&&u(i,t)},[u,i,t]),v=Object(a.useMemo)(function(){return"function"===typeof p?p(i,t):p},[p,i,t]),y=Object(a.useMemo)(function(){return"string"===typeof d?d:d(i,t)},[d,i,t]),b=Object(a.useMemo)(function(){return null!==m&&"function"===typeof m},[m]),E=Object(a.useCallback)(function(){g(i,t)},[g,i,t]),C=Object(a.useMemo)(function(){return k()("fa fa-fw",{"fa-eye":"view"===t,"fa-pencil":"edit"===t,"fa-files-o":"clone"===t,"fa-file-excel-o":"export_csv"===t,"danger-red":["enable","remove"].includes(t),"fa-trash-o":"remove"===t,"fa-toggle-off":"enable"===t,"fa-toggle-on":"disable"===t,"fa-plus":["add","expand"].includes(t),"fa-calendar":"move"===t,"fa-repeat":"reopen"===t,"fa-cloud-upload":"import"===t,"fa-refresh":"refresh"===t,"fa-arrow-left":"back"===t,"fa-minus":"collapse"===t,"fa-cog":"settings"===t})},[t]);return h?r.a.createElement("span",{className:"action-button"},r.a.createElement(ut,{helpText:y},b?e.renderFunc(e):r.a.createElement(f.c,{onClick:E,bsStyle:"default"===o?void 0:o,bsSize:s,className:c,disabled:!v},l&&r.a.createElement("i",{className:C}),l&&n.length>0&&r.a.createElement("span",null,"\xa0"),n.length>0&&n))):null};Qe.defaultProps={type:"",data:null,label:"",helpText:"",actionStyle:"link",actionSize:void 0,actionClass:"",showIcon:!0,enable:!0,show:!0,renderFunc:null,onClick:function(){}};var $e=Object(a.memo)(Qe),Ze=function(e){var t=e.actions,n=e.data;return e.isGroup?r.a.createElement(f.d,{className:"actions-buttons"},t.map(function(e,t){return r.a.createElement($e,Object.assign({},e,{data:n,key:t}))})):r.a.createElement("div",{className:"actions-buttons"},t.map(function(e,t,a){var i=t===a.length-1,o=!0;"undefined"!==typeof e.show&&(o="function"===typeof e.show?e.show(n):e.show);var l=k()({mr10:!i&&o,mr0:i||!o});return r.a.createElement("span",{key:t,className:l},r.a.createElement($e,Object.assign({},e,{data:n})))}))};Ze.defaultProps={actions:[],data:null,isGroup:!1};var Xe=Object(a.memo)(Ze),et=n(43),tt=function(e){var t=e.items;return r.a.createElement("div",null,t)};tt.defaultProps={items:[]};var nt=Object(et.SortableContainer)(tt),at=function(e){var t=e.element;return e.disabled?r.a.createElement("i",{className:"fa fa-bars fa-fw",style:{opacity:".05",lineHeight:"35px"}}):t};at.defaultProps={element:r.a.createElement("i",{className:"fa fa-bars fa-fw",style:{cursor:"row-resize",opacity:".25",lineHeight:"35px"}}),disabled:!1};var rt=Object(et.SortableHandle)(at),it=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.value,n=e.format,a=e.timezone,i=e.emptyValue,o=t?S()(t).tz(a).format(n):i;return r.a.createElement("span",null,o)}}]),t}(a.Component);it.defaultProps={value:S()(),format:Y("dateFormat","DD/MM/YYYY"),emptyValue:"-"};var ot=Object(l.connect)(function(e,t){return{timezone:e.settings.getIn(["billrun","timezone"])}})(it),lt=function(e){var t=e.itemName,n=e.item,a=e.type;if(!t.length||["subscription"].includes(t))return e.children;var i=Y(["systemItems",t,"itemType"],""),o=Y(["systemItems",t,"itemsType"],"");switch(a){case"list":var l="/".concat(o);return r.a.createElement(s.b,{to:l},e.children);case"edit":var c="".concat(o,"/").concat(i,"/").concat(te(n,""));return r.a.createElement(s.b,{to:c},e.children);case"clone":var u="".concat(o,"/").concat(i,"/").concat(te(n,""));return r.a.createElement(s.b,{to:u,query:{action:"clone"}},e.children);default:return e.children}};lt.defaultProps={children:null,item:g.c.Map(),itemName:"",type:"view"};var st=lt,ct=function(e){var t=e.helpText,n=e.children;if(null===n)return null;if(""===t)return n;var a=r.a.createElement(f.B,{id:"tooltip"},t);return r.a.createElement(f.t,{overlay:a,placement:"top"},n)};ct.defaultProps={children:null,helpText:""};var ut=ct,pt=n(24),dt=n(252),mt=n(250),gt=n.n(mt),ft=function(e){var t=e.value,n=e.onChange,a=e.editable,i=e.disabled,o=e.multi,l=e.clearable,s=e.noResultsText,c=e.options,u=e.allowCreate,p=e.addLabelText,d=e.placeholder,m=Object(pt.a)(e,["value","onChange","editable","disabled","multi","clearable","noResultsText","options","allowCreate","addLabelText","placeholder"]),g=(o?t.split(","):[t]).filter(function(e){return""!==e}),f=i,h=o,v=l,y=s;"undefined"!==typeof s&&"string"===typeof s&&(y=function(){return s});var b=p;if("undefined"!==typeof p&&"string"===typeof p&&(b=function(e){return p.replace("{label}",e)}),!a){var E=c.filter(function(e){return g.includes(e.value)}).map(function(e){return e.label}).join(", ");return r.a.createElement("div",{className:"non-editable-field"},E)}var C=function(e,t){var a=t.action,r=t.removedValue,i=t.name,l="";return"clear"!==a&&(l=o?e.map(function(e){return e.value}).join(","):e.value),n(l,{option:e,action:a,removedValue:r,name:i})},_="";if(h)_=g.map(function(e){var t=c.findIndex(function(t){return e===t.value});return-1!==t?c[t]:{value:e,label:e}});else if(""!==t){var O=c.findIndex(function(e){return t===e.value});_=-1!==O?c[O]:{value:t,label:t}}else _=null;return u?r.a.createElement(gt.a,Object.assign({},m,{options:c,placeholder:d,value:_,classNamePrefix:"react-select",onChange:C,isMulti:h,isClearable:v,isDisabled:f,noOptionsMessage:y,formatCreateLabel:b})):r.a.createElement(dt.a,Object.assign({},m,{placeholder:d,options:c,value:_,classNamePrefix:"react-select",onChange:C,isMulti:h,isClearable:v,isDisabled:f,noOptionsMessage:y}))};ft.defaultProps={value:[],disabled:!1,editable:!0,multi:!1,clearable:!0,allowCreate:!1,noResultsText:void 0,placeholder:void 0,addLabelText:void 0,options:[],inputProps:{},onChange:function(){}};var ht=ft,vt=function(e){var t=e.onChange,n=e.value,a=e.editable,i=e.disabled,o=e.tooltip,l=e.suffix,s=e.preffix,c=Object(pt.a)(e,["onChange","value","editable","disabled","tooltip","suffix","preffix"]);if(a){var u=r.a.createElement("input",Object.assign({},c,{type:"number",className:"form-control",value:n,onChange:t,disabled:i,title:o}));return null!==l||null!==s?r.a.createElement(f.o,null,null!==s&&r.a.createElement(f.o.Addon,null,s),u,null!==l&&r.a.createElement(f.o.Addon,null,l)):u}return r.a.createElement("div",{className:"non-editable-field"},r.a.createElement("span",null,null!==s&&s,parseFloat(n),null!==l&&l))};vt.defaultProps={required:!1,disabled:!1,editable:!0,placeholder:"",tooltip:"",suffix:null,preffix:null,onChange:function(){}};var yt=vt,bt=function(e){var t=e.onChange,n=e.id,a=e.value,i=e.editable,o=e.disabled,l=i?r.a.createElement("input",{type:"number",step:"any",id:n,className:"form-control",min:"0",value:a,onChange:t,disabled:o}):r.a.createElement("span",null,parseFloat(a,10));return r.a.createElement("div",{className:"non-editable-field"},l)},Et=n(45),Ct=function(e){var t=e.editable,n=e.value,a=e.disabled,i=e.placeholder,o=e.onChange,l=e.dateFormat,s=e.message,c=e.minDate,u=Object(pt.a)(e,["editable","value","disabled","placeholder","onChange","dateFormat","message","minDate"]),p=l||Y("dateFormat","DD/MM/YYYY");if(!t){var d=S.a.isMoment(n)&&n.isValid()?n.format(p):n;return r.a.createElement("div",{className:"non-editable-field"},d)}var m=a&&!n?"":i,g=S.a.isMoment(n)&&n.isValid()?n:null,f=S.a.isMoment(c)?c:void 0;return r.a.createElement(Et.a,Object.assign({},u,{minDate:f,className:"form-control",dateFormat:p,selected:g,onChange:o,disabled:a,placeholderText:m}),s)};Ct.defaultProps={required:!1,disabled:!1,editable:!0,placeholder:"",message:null,onChange:function(){}};var _t=Ct,Ot=function(e){var t=e.editable,n=e.value,a=e.disabled,i=e.placeholder,o=e.onChange,l=e.dateFormat,s=e.timeFormat,c=e.message,u=e.timeIntervals,p=e.minDate,d=Object(pt.a)(e,["editable","value","disabled","placeholder","onChange","dateFormat","timeFormat","message","timeIntervals","minDate"]);if(!t){var m=S.a.isMoment(n)&&n.isValid()?n.format(l):n;return r.a.createElement("div",{className:"non-editable-field"},m)}var g=a&&!n?"":i,f=S.a.isMoment(n)&&n.isValid()?n:null,h=S.a.isMoment(p)?p:void 0;return r.a.createElement(Et.a,Object.assign({},d,{minDate:h,calendarClassName:"date-picker-with-time",className:"form-control DatePickerTime",showTimeSelect:!0,timeIntervals:u,dateFormat:l,timeFormat:s,selected:f,onChange:o,disabled:a,placeholderText:g}),c)};Ot.defaultProps={required:!1,disabled:!1,editable:!0,placeholder:"",message:null,dateFormat:Y("datetimeFormat","DD/MM/YYYY HH:mm"),timeFormat:Y("timeFormat","HH:mm"),timeIntervals:15,onChange:function(){}};var St=Ot,Tt=n(256),kt=n.n(Tt),It=function(e){e.editable;var t=e.value,n=e.disabled,a=e.placeholder,i=e.onChange,o=e.inputProps,l=e.onlyUnique,s=Object(pt.a)(e,["editable","value","disabled","placeholder","onChange","inputProps","onlyUnique"]),c={placeholder:n?"":a},u=Object.assign(c,o),p=Array.isArray(t)?t:[t];return r.a.createElement(kt.a,Object.assign({},s,{addOnBlur:!0,value:p,onChange:i,inputProps:u,disabled:n,renderTag:function(t){var n=t.tag,a=t.key,i=t.disabled,o=t.onRemove,l=t.classNameRemove,s=t.getTagDisplayValue,c=Object(pt.a)(t,["tag","key","disabled","onRemove","classNameRemove","getTagDisplayValue"]),u=e.getTagDisplayValue||s;return r.a.createElement("span",Object.assign({key:a},c),!i&&r.a.createElement("span",{className:l,onClick:function(){o(a)}},"\xd7"),u(n))},onlyUnique:l}))};It.defaultProps={value:[],required:!1,disabled:!1,editable:!0,placeholder:"",inputProps:{},onChange:function(){},getTagDisplayValue:null,onlyUnique:!1};var Nt=It,wt=function(e){var t=e.onChange,n=e.id,a=e.value,i=e.editable,o=e.disabled,l=i?r.a.createElement("input",{type:"text",className:"form-control address",id:n,value:a,onChange:t,disabled:o}):r.a.createElement("span",null,a);return r.a.createElement("div",null,l)},jt=function(e){var t=e.onChange,n=e.value,a=e.editable,i=e.disabled,o=e.suffix,l=e.preffix,s=Object(pt.a)(e,["onChange","value","editable","disabled","suffix","preffix"]);if(a){var c=r.a.createElement("input",Object.assign({},s,{type:"text",className:"form-control",value:n,onChange:t,disabled:i}));return null!==o||null!==l?r.a.createElement(f.o,null,null!==l&&r.a.createElement(f.o.Addon,null,l),c,null!==o&&r.a.createElement(f.o.Addon,null,o)):c}return r.a.createElement("div",{className:"non-editable-field"},r.a.createElement("span",null,null!==l&&"".concat(l," "),n,null!==o&&" ".concat(o)))};jt.defaultProps={required:!1,disabled:!1,editable:!0,placeholder:"",suffix:null,preffix:null,onChange:function(){}};var Rt=jt,xt=function(e){var t=e.onChange,n=e.id,a=e.value,i=e.placeholder,o=void 0===i?"":i,l=e.disabled;return e.editable?r.a.createElement("textarea",{id:n,className:"form-control",value:a,onChange:t,placeholder:o,disabled:l}):r.a.createElement("span",null,a)},Ft=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={value:n.props.value===n.props.unlimitedValue?"":n.props.value,unlimited:n.props.value==n.props.unlimitedValue},n.onUnlimitedChanged=function(e){var t=n.props.unlimitedValue,a=e.target.checked,r=a?t:n.state.value;n.setState({unlimited:a}),n.props.onChange(r)},n.onValueChanged=function(e){var t=e.target.value;n.setState({value:t}),n.props.onChange(t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.value,n=e.unlimited,a=this.props,i=a.unlimitedLabel,o=a.disabled,l=a.editable,s=a.suffix;return l?r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement("input",{checked:n,onChange:this.onUnlimitedChanged,type:"checkbox",disabled:o}),r.a.createElement("small",{style:{verticalAlign:"bottom"}}," ",i)),r.a.createElement(f.k,{disabled:n||o,onChange:this.onValueChanged,type:"text",value:n?"":t}),null!==s&&r.a.createElement(f.o.Addon,null,s)):r.a.createElement("div",{className:"non-editable-field"},i)}}]),t}(a.Component);Ft.defaultProps={unlimitedLabel:"Unlimited",unlimitedValue:"UNLIMITED",disabled:!1,editable:!0,suffix:null};var Pt=n(35),Mt=n.n(Pt),At=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChange=function(e){var t=n.state.id,a=e.target.checked;n.props.onChange({target:{id:t,value:a}})},n.state={id:e.id||Mt.a.v4()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state.id,t=this.props,n=t.value,a=t.editable,i=t.disabled,o=t.label;return a?o.length?r.a.createElement("label",{htmlFor:e},r.a.createElement("input",{style:{verticalAlign:"top"},type:"checkbox",id:e,checked:n,disabled:i,onChange:this.onChange}),"\xa0\xa0",o):r.a.createElement("input",{type:"checkbox",id:e,checked:n,disabled:i,onChange:this.onChange}):r.a.createElement("span",null,n?"Yes":"No")}}]),t}(a.PureComponent);At.defaultProps={id:void 0,label:"",value:!1,editable:!0,checked:!1,disabled:!1,onChange:function(){}};var Dt=At,Lt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).renderInput=function(){var e=n.state.id,t=n.props,a=t.name,i=t.value,o=t.disabled,l=t.checked,s=t.onChange;return r.a.createElement("input",{type:"radio",style:{verticalAlign:"top"},name:a,id:e,value:i,checked:l,disabled:o,onChange:s})},n.state={id:e.id||Mt.a.v4()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state.id,t=this.props,n=t.value,a=t.editable,i=t.label,o=t.disabled,l=t.labelStyle;if(!a&&null!==i)return r.a.createElement("div",{className:"non-editable-field"},i);if(!a)return r.a.createElement("div",{className:"non-editable-field"},n);var s=this.renderInput();return null!==i?r.a.createElement("label",{htmlFor:e,style:l,className:o?"disabled":""},s,"\xa0",i):s}}]),t}(a.PureComponent);Lt.defaultProps={id:void 0,name:void 0,label:null,value:"",editable:!0,checked:!1,disabled:!1,labelStyle:{paddingTop:10},onChange:function(){}};var Ut=Lt,Vt=[{value:"mr",label:"Mr."},{value:"mrs",label:"Mrs."},{value:"miss",label:"Miss"},{value:"dr",label:"Dr."},{value:"sir",label:"Sir"}],Bt=function(e){return r.a.createElement(en,{fieldType:"select",options:Vt,onChange:function(t){var n={target:{id:e.id,value:t}};e.onChange(n)},value:e.value})},qt=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChangedState=function(e){var t=n.props.disabledValue,a=e.target.checked,r=a?n.state.value:t;n.props.onChange(r),n.setState({off:!a})},n.onValueChanged=function(e){var t=n.getValue(e);n.setState({value:t}),n.props.onChange(t)},n.getValue=function(e){var t=n.props.inputProps.fieldType;switch(void 0===t?"text":t){case"date":return e;default:return e.target.value}};var a=e.compare(e.value,e.disabledValue),r=a?e.disabledValue:e.value;return n.state={value:r,off:a},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){if(!this.props.compare(e.value,this.props.value)){var t=e.compare(e.value,e.disabledValue),n=t?e.disabledValue:e.value;this.setState({value:n,off:t})}}},{key:"render",value:function(){var e=this.state,t=e.value,n=e.off,a=this.props,i=a.label,o=a.disabled,l=a.editable,s=a.suffix,c=a.inputProps,u=a.disabledDisplayValue;return l?r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement("label",{className:"mb0"},r.a.createElement("input",{style:{verticalAlign:"bottom"},checked:!n,onChange:this.onChangedState,type:"checkbox",disabled:o})," ",i)),r.a.createElement(en,Object.assign({disabled:n||o,onChange:this.onValueChanged,value:n?u:t},c)),null!==s&&r.a.createElement(f.o.Addon,null,s)):r.a.createElement("div",{className:"non-editable-field"},n?u:t)}}]),t}(a.Component);qt.defaultProps={label:"Enable",disabledValue:null,disabledDisplayValue:"",disabled:!1,editable:!0,suffix:null,inputProps:{},compare:function(e,t){return e===t}};var zt=n(205),Ht=n.n(zt),Yt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={showWYSIWYG:!1},n.initEditor=function(){var e=n.props,t=e.configName,a=e.editorName,r=CKEDITOR&&CKEDITOR.instances[a],i=t.length?"br/config/".concat(t,".js"):"";if(n.state.showWYSIWYG){if(r){window.CKEDITOR.instances[a].getData()!==unescape(n.props.value)&&window.setTimeout(function(){return n.toggleEditor(r,i)},100)}}else window.setTimeout(function(){return n.toggleEditor(r,i)},100)},n.toggleEditor=function(e,t){var a=n.props,r=a.editorName,i=a.disabled,o=n.props,l=o.fields,s=o.editorHeight;e&&e.destroy(!0);var c={readOnly:i,customConfig:t,toolbar:"Basic",height:s,placeholder_select:{placeholders:l}};window.CKEDITOR.replace(r,c),window.CKEDITOR.dtd.$removeEmpty.i=0,window.CKEDITOR.dtd.$removeEmpty.span=!1,window.CKEDITOR.instances[r].on("change",n.onChange),n.setState({showWYSIWYG:!0})},n.onChange=Ht()(function(){var e=n.props.editorName,t=window.CKEDITOR.instances[e].getData();n.props.onChange(t)},250),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.initEditor()}},{key:"shouldComponentUpdate",value:function(e,t){return this.props.value!==e.value}},{key:"componentDidUpdate",value:function(e,t){this.initEditor()}},{key:"componentWillUnmount",value:function(){var e=this.props.editorName,t=CKEDITOR&&CKEDITOR.instances[e];t&&t.destroy(!0)}},{key:"render",value:function(){var e=this.props,t=e.value,n=e.editorName,a=e.editorHeight,i=e.disabled,o=unescape(t||"");return r.a.createElement("div",{className:"TextEditor"},r.a.createElement("textarea",{name:n,value:o,style:{width:"100%",height:a},onChange:function(){},disabled:i}))}}]),t}(a.Component);Yt.defaultProps={fields:[],value:"",configName:"",editorHeight:250,disabled:!1};var Gt=Yt,Kt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeFrom=function(e){var t=n.props.value,a=n.getValue(e);n.props.onChange(t.set("from",a))},n.onChangeTo=function(e){var t=n.props.value,a=n.getValue(e);n.props.onChange(t.set("to",a))},n.getValue=function(e){var t=n.props.inputProps.fieldType;switch(void 0===t?"text":t){case"date":case"select":return e;default:return e.target.value}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.onChange,e.value),n=e.placeholder,a=e.editable,i=e.compact,o=e.inputProps.fieldType,l=void 0===o?"text":o,s=Object(pt.a)(e,["onChange","value","placeholder","editable","compact","inputProps"]),c=g.c.Map.isMap(t)?t.get("from",""):"",u=g.c.Map.isMap(t)?t.get("to",""):"",p="undefined"!==typeof n.from?n.from:"",d="undefined"!==typeof n.to?n.to:"";return a?r.a.createElement(f.o,{style:{width:"100%"}},!i&&r.a.createElement(f.o.Addon,null,r.a.createElement("small",null,"From")),r.a.createElement(en,Object.assign({},s,{fieldType:l,value:c,onChange:this.onChangeFrom,placeholder:p})),!i&&r.a.createElement(f.o.Addon,null,r.a.createElement("small",null,"To")),i&&r.a.createElement(f.o.Addon,null,r.a.createElement("small",null,"-")),r.a.createElement(en,Object.assign({},s,{fieldType:l,value:u,onChange:this.onChangeTo,placeholder:d}))):r.a.createElement("span",{className:"non-editable-field"},"".concat(c," - ").concat(u))}}]),t}(a.PureComponent);Kt.defaultProps={value:g.c.Map({from:"",to:""}),placeholder:{from:"",to:""},inputProps:{},editable:!0,compact:!1,onChange:function(){}};var Wt=Kt,Jt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChange=function(e,t){var a=n.props.value;n.props.onChange(a.set(t,e))},n.onAdd=function(){var e=n.props.value;n.props.onChange(e.push(g.c.Map({from:"",to:""})))},n.onRemove=function(e){var t=n.props.value;n.props.onChange(t.delete(e))},n.state={id:e.id||Mt.a.v4()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=(t.onChange,t.value),a=t.editable,i=t.disabled,o=t.label,l=t.multi,s=t.removable,c=Object(pt.a)(t,["onChange","value","editable","disabled","label","multi","removable"]),u=this.state.id;if(!a)return r.a.createElement("span",null,n.map(function(e,t){return r.a.createElement("span",{key:"range_".concat(u,"_").concat(t)},t>0&&", ",r.a.createElement(Wt,{value:e,editable:!1}))}));var p=n.map(function(t,n){return r.a.createElement(f.l,{key:"range_".concat(u,"_").concat(n),className:"rangesField form-inner-edit-row mr0 ml0"},r.a.createElement(f.o,{style:{width:"100%"}},r.a.createElement(Wt,Object.assign({},c,{value:t,onChange:function(t){e.onChange(t,n)},editable:!0,disabled:i})),s&&r.a.createElement(f.o.Button,null,r.a.createElement(f.c,{onClick:function(){e.onRemove(n)},disabled:i},r.a.createElement("i",{className:"fa fa-fw fa-trash-o danger-red"})))))}),d=n.size>0&&n.some(function(e){return""===e.get("from","")||""===e.get("to","")});return r.a.createElement("div",null,p,(l||!l&&0===n.size)&&r.a.createElement(Je,{buttonStyle:{marginTop:5,marginBottom:10},onClick:this.onAdd,action:"Add",label:"",type:o,disabled:i||d}))}}]),t}(a.PureComponent);Jt.defaultProps={id:void 0,value:g.c.List([]),label:"",inputProps:{},multi:!1,editable:!0,removable:!0,disabled:!0,onChange:function(){}};var Qt=Jt,$t=function(e){var t=e.onChange,n=e.value,a=e.editable,i=e.disabled,o=e.tooltip,l=e.preffix,s=Object(pt.a)(e,["onChange","value","editable","disabled","tooltip","preffix"]),c=R()(n)?parseFloat((100*parseFloat(n)).toFixed(3)):n;return a?r.a.createElement(f.o,null,null!==l&&r.a.createElement(f.o.Addon,null,l),r.a.createElement("input",Object.assign({},s,{type:"number",className:"form-control",value:c,onChange:function(e){var n=e.target.value,a=R()(n)?parseFloat(n)/100:n;t({target:{value:a}})},disabled:i,title:o})),r.a.createElement(f.o.Addon,null,"%")):r.a.createElement("div",{className:"non-editable-field"},r.a.createElement("span",null,null!==l&&"".concat(l," "),c,R()(c)&&"%"))};$t.defaultProps={required:!1,disabled:!1,editable:!0,placeholder:"",tooltip:"",suffix:null,preffix:null,onChange:function(){}};var Zt=$t,Xt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).createInput=function(){var e=n.props,t=e.fieldType,a=(e.style,e.className,Object(pt.a)(e,["fieldType","style","className"]));switch(t){case"number":return r.a.createElement(yt,a);case"price":return r.a.createElement(bt,a);case"date":return r.a.createElement(_t,a);case"datetime":return r.a.createElement(St,a);case"tags":return r.a.createElement(Nt,a);case"address":return r.a.createElement(wt,a);case"textarea":return r.a.createElement(xt,a);case"unlimited":return r.a.createElement(Ft,a);case"toggeledInput":return r.a.createElement(qt,a);case"checkbox":return r.a.createElement(Dt,a);case"radio":return r.a.createElement(Ut,a);case"salutation":return r.a.createElement(Bt,a);case"textEditor":return r.a.createElement(Gt,a);case"select":return r.a.createElement(ht,a);case"ranges":return r.a.createElement(Qt,a);case"range":return r.a.createElement(Wt,a);case"percentage":return r.a.createElement(Zt,a);default:return r.a.createElement(Rt,a)}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.style,n=e.className;return r.a.createElement("div",{className:k()("Field",n),style:t},this.createInput())}}]),t}(a.PureComponent);Xt.defaultProps={value:void 0,required:!1,disabled:!1,editable:!0,fieldType:"text",label:"",style:{},className:void 0,onChange:function(){}};var en=Xt,tn=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={value:n.props.value},n.onChangeValue=function(e){var t=e.target.value;n.setState({value:t}),n.props.onChange&&n.props.onChange(t)},n.onAction=function(){var e=n.props.clearAfterAction,t=n.state.value;n.props.onAction(t),e&&n.onChangeValue({target:{value:""}})},n.getActionLabel=function(){var e=n.props.actionLabel;return e.length>0?" ".concat(e):null},n.getActionStyle=function(){switch(n.props.actionType){case"add":return"primary";case"remove":default:return}},n.isButtonDisabled=function(){var e=n.props.actionType,t=n.state.value;return"add"===e&&t.length<1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.inputProps,n=e.actionType,a=this.state.value,i=k()("fa fa-fw",{"danger-red":"remove"===n,"fa-trash-o":"remove"===n,"fa-plus":"add"===n});return r.a.createElement(f.o,null,r.a.createElement(en,Object.assign({},t,{onChange:this.onChangeValue,value:a})),r.a.createElement(f.o.Button,null,r.a.createElement(f.c,{onClick:this.onAction,bsStyle:this.getActionStyle(),disabled:this.isButtonDisabled()},r.a.createElement("i",{className:i}),this.getActionLabel())))}}]),t}(a.PureComponent);tn.defaultProps={fieldType:void 0,inputProps:{},actionLabel:"",actionType:"add",value:"",clearAfterAction:!1,onChange:null};var nn=tn,an=function(e){var t=e.progressIndicator;e.enterTimeout,e.exitTimeout;return r.a.createElement("div",{className:"progress-indicator-container",style:{position:"fixed",top:0,width:"100%",zIndex:5001}},t&&r.a.createElement("div",{key:"progressIndicator",className:"system-progress-indecator"}))};an.defaultProps={progressIndicator:!1,enterTimeout:250,exitTimeout:250};var rn=Object(l.connect)(function(e){return{progressIndicator:e.progressIndicator>0}})(an),on=n(17),ln=function(e,t){return ee(e,t).format(Y("dateFormat","DD/MM/YYYY"))},sn=function(e){return"Cycle of ".concat(ln(e,"start_date")," - ").concat(ln(e,"end_date"))},cn=function(e,t){return e.settings.getIn(["taxation"])},un=function(e,t){return e.settings.getIn(["plays"])},pn=function(e,t){return e.settings.get("usage_types")},dn=function(e,t){return e.settings.getIn(["rates","fields"])},mn=function(e,t){return e.settings.get("invoice_export")},gn=function(e,t){return e.settings.getIn(["events"])},fn=function(e,t){return e.settings.getIn(["collection"])},hn=function(e){var t=g.c.Set(),n=e.getIn(["processor","default_usaget"],"");return""!==n&&(t=t.add(n)),e.getIn(["processor","usaget_mapping"],g.c.List()).forEach(function(e){var n=e.get("usaget","");""!==n&&(t=t.add(n))}),t.toList()},vn=function(e,t){return e.settings.get("file_types",g.c.List())},yn=Object(on.a)(vn,function(e){var t=g.c.List();return e.forEach(function(e){var n=hn(e),a=e.getIn(["parser","custom_keys"],g.c.List());n.forEach(function(n){t=t.push(g.c.Map({fileType:e.get("file_type",""),usageType:n,customKeys:a}))})}),t}),bn=Object(on.a)(vn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return g.c.Map().withMutations(function(t){e.forEach(function(e){var n=hn(e);t.set(e.get("file_type"),n)})})}),En=Object(on.a)(vn,function(e){var t=g.c.Set();return e.forEach(function(e){var n=e.getIn(["parser","structure"],g.c.List()).filter(function(e){return!0===e.get("checked",!0)}).map(function(e){return e.get("name","")});t=t.concat(n)}),t.toList()}),Cn=Object(on.a)(vn,function(e){var t=g.c.Set();return e.forEach(function(e){e.get("rate_calculators",g.c.Map()).forEach(function(e){e.forEach(function(e){e.forEach(function(e){var n=e.filter(function(e){return e.get("rate_key","").startsWith("params.")}).map(function(e){return e.get("rate_key","")});t=t.concat(n)})})})}),t.toList()}),_n=Object(on.a)(cn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("mapping")}),On=Object(on.a)(function(e,t){return e.settings.get("import")},function(e){return e}),Sn=Object(on.a)(cn,function(e){return e}),Tn=Object(on.a)(Sn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("tax_type")}),kn=Object(on.a)(function(e,t){return e.settings.getIn(["pricing"])},function(e){return e}),In=Object(on.a)(function(e,t){return e.settings.getIn(["system"])},function(e){return e}),Nn=Object(on.a)(un,function(e){return e}),wn=Object(on.a)(Nn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e?e.filter(function(e){return e.get("enabled",!0)}):g.c.List()}),jn=Object(on.a)(wn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List()).size>1}),Rn=Object(on.a)(un,function(e){return e?e.filter(function(e){return e.get("enabled",!0)}):void 0}),xn=Object(on.a)(In,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("closed_cycle_changes")}),Fn=Object(on.a)(function(e,t){return e.settings.get("billrun")},function(e){return e}),Pn=Object(on.a)(function(e,t){return e.settings.get("minimum_entity_start_date")},function(e){return e&&R()(e)?S.a.unix(e):S()(0)}),Mn=Object(on.a)(kn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("currency")}),An=(Object(on.a)(Fn,function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("charging_day");return R()(e)?e:Number(e)}),Object(on.a)(vn,function(e){if(e)return e.map(function(e){return e.get("file_type","")})})),Dn=Object(on.a)(pn,function(e){if(e)return e.map(function(e){return e.get("usage_type","")})}),Ln=Object(on.a)(function(e,t){return e.settings.getIn(["events","balance"])},function(e){if(e)return e.map(function(e){return e.get("event_code","")})}),Un=Object(on.a)(pn,function(e){return e}),Vn=Object(on.a)(function(e,t){return e.settings.get("property_types")},function(e){return e}),Bn=Object(on.a)(function(e,t){var n=Array.isArray(t.entityName)?t.entityName:[t.entityName];return e.settings.getIn([].concat(Object(w.a)(n),["fields"]))},function(e){return e}),qn=Object(on.a)(function(e,t){return e.settings.getIn(["subscribers","account","fields"])},function(e){if(e)return e.map(function(e){return""!==e.get("title","")?e:e.set("title",G(e.get("field_name",""),"account"))})}),zn=Object(on.a)(qn,function(e){return e?e.map(function(e){return e.get("field_name","")}):e}),Hn=Object(on.a)(Rn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List()).reduce(function(e,t){return e.set(t.get("name"),t.get("label"))},g.c.Map())}),Yn=Object(on.a)(function(e,t){return e.settings.getIn(["subscribers","subscriber","fields"])},function(e){if(e)return e.map(function(e){return""!==e.get("title","")?e:e.set("title",G(e.get("field_name",""),"subscription"))})}),Gn=Object(on.a)(Yn,Hn,jn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Map(),n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.map(function(e){return n?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Map(),n=e.get("plays",g.c.List());if(!n.isEmpty()){var a=n.reduce(function(e,n){return e.push(t.get(n,n))},g.c.List()).join(", ");return e.set("title","".concat(e.get("title","")," (").concat(a,")"))}return e}(e,t):e})}),Kn=Object(on.a)(function(e,t){return e.settings.getIn(["lines","fields"])},function(e){if(e)return e.map(function(e){return""!==e.get("title","")?e:e.has("foreign")?e.set("title",G(e.getIn(["foreign","field"],""),K(e.getIn(["foreign","entity"],"")))):e.set("title",G(e.get("field_name",""),"lines"))})}),Wn=Object(on.a)(dn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List()).map(function(e){return Fe(e,"product")})}),Jn=Object(on.a)(dn,function(e){if(e){var t=e.find(function(e){return"tariff_category"===e.get("field_name","")});if(t)return g.c.List(t.get("select_options","").split(","))}}),Qn=Object(on.a)(function(e,t){return e.settings.getIn(["services","fields"])},function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List()).map(function(e){return Fe(e,"service")})}),$n=Object(on.a)(function(e,t){return e.settings.getIn(["taxes","fields"])},function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List()).map(function(e){return Fe(e,"tax")})}),Zn=Object(on.a)(function(e,t){return e.settings.getIn(["plans","fields"])},function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List()).map(function(e){return Fe(e,"plan")})}),Xn=Object(on.a)(function(e,t){return e.settings.getIn(["template_token"])},function(e){return e}),ea=Object(on.a)(Xn,function(e,t,n){return n},function(e,t){return e?e.filter(function(e,n){return t.includes(n)}).reduce(function(e,t,n){return g.c.List([].concat(Object(w.a)(e),Object(w.a)(t.map(function(e){return"".concat(n,"::").concat(e)}))))},g.c.List()):g.c.List()}),ta=Object(on.a)(fn,function(e){return e?e.get("settings",g.c.Map()):void 0}),na=Object(on.a)(fn,function(e){return e?e.get("steps",g.c.List()):void 0}),aa=Object(on.a)(na,function(e){return e?e.sortBy(function(e){return parseFloat(e.get("do_after_days",0))}):void 0}),ra=Object(on.a)(gn,function(e){return e?e.get("settings",g.c.Map()):void 0}),ia=Object(on.a)(mn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("header")}),oa=Object(on.a)(mn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("footer")}),la=Object(on.a)(mn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("html_translation")}),sa=Object(on.a)(mn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("templates")}),ca=Object(on.a)(mn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("status")}),ua=Object(on.a)(function(e,t){return e.settings.getIn(["payment_gateways"])},function(e){return e}),pa=Object(on.a)(function(e,t){return e.settings.get("email_templates")},function(e){return e}),da=Object(on.a)(gn,function(e,t){return t.eventType},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1?arguments[1]:void 0;return e.get(t)}),ma=Object(on.a)($n,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List()).filter(function(e){return e.get("field_name","").startsWith("params.")}).map(se).insert(0,{value:"key",label:"Key"}).toArray()}),ga=Object(on.a)(Kn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List()).filter(Le).map(se).push({value:"type",label:"Type"}).push({value:"usaget",label:"Usage Type"}).push({value:"file",label:"File name"}).toArray()}),fa=Object(on.a)(Kn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List()).filter(Le).map(se).push({value:"condition_result",label:"Condition Result"}).push({value:"hard_coded",label:"Hard Coded"}).push({value:"type",label:"Type"}).push({value:"usaget",label:"Usage Type"}).push({value:"file",label:"File name"}).toArray()}),ha=Object(on.a)(Kn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List()).filter(Le).map(se).push({value:"type",label:"Type"}).push({value:"usaget",label:"Usage Type"}).push({value:"file",label:"File name"}).push({value:"computed",label:"Computed"}).toArray()}),va=function(e,t){if(null!==e)return e.map(function(e){return g.c.Map({label:"".concat(e.get("description","")," (").concat(e.get(t,""),")"),value:e.get(t,"")})})},ya=function(e){return e.list.get("available_groups",null)},ba=function(e){return e.list.get("pp_includes",null)},Ea=Object(on.a)(function(e){return e.list.get("cycles_list",null)},function(e){if(null!==e)return e.map(function(e){return g.c.Map({label:sn(e),value:e.get("billrun_key","")})})}),Ca=Object(on.a)(function(e){return e.list.get("event_products",null)},function(e){return null===e?void 0:e}),_a=Object(on.a)(function(e){return e.list.get("all_rates",null)},function(){return"key"},va),Oa=Object(on.a)(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return e.list.get(n,null)},function(){return"key"},va),Sa=Object(on.a)(function(e){return e.list.get("available_services",null)},function(){return"name"},va),Ta=Object(on.a)(function(e){return e.list.get("available_taxRates",null)},function(){return"key"},va),ka=Object(on.a)(function(e){return e.list.get("available_plans",null)},function(){return"name"},va),Ia=Object(on.a)(Hn,function(e){if(null!==e)return e.map(function(e,t){return g.c.Map({label:e,value:t})})}),Na=Object(on.a)(ya,function(e){if(null!==e)return g.c.Set().withMutations(function(t){e.forEach(function(e){e.getIn(["include","groups"],g.c.Map()).keySeq().forEach(function(e){t.add(e)})})}).toList()}),wa=Object(on.a)(ba,function(e){if(null!==e)return e.map(function(e){return g.c.Map({label:e.get("name",""),value:e.get("name","")})})}),ja=Object(on.a)(ba,function(e){if(null!==e)return e.map(function(e){return g.c.Map({label:e.get("external_id",""),value:e.get("external_id","")})})}),Ra=Object(on.a)(function(e){return e.list.get("log")},function(e){return e}),xa=Object(on.a)(function(e){return e.list.get("autocompleteUser",null)},function(e){if(null!==e)return e.map(function(e){return e.get("username")})}),Fa=Object(on.a)(function(e){return e.list.get("autocompleteAuditTrailEntityTypes",null)},function(e){if(null!==e)return e.map(function(e){return{key:e.get("name",""),val:Object(x.sentenceCase)(e.get("name",""))}})}),Pa=Object(on.a)(ya,function(e){if(null!==e)return g.c.Map().withMutations(function(t){e.forEach(function(e){e.getIn(["include","groups"],g.c.Map()).forEach(function(e,n){t.set(n,e)})})})}),Ma=Object(on.a)(function(){return Y("queue_calculators",[])},function(e){var t=[!1].concat(Object(w.a)(e));return e.map(function(e,n){return g.c.Map({label:Object(x.sentenceCase)(e),value:t[n]})})}),Aa=function(){return{type:"PROGRESS_INDICATOR_START"}},Da=function(){return{type:"PROGRESS_INDICATOR_FINISH"}},La="success",Ua="warning",Va="danger",Ba="info",qa="DISMISS_ALL_ALERTS",za="DISMISS_ALERT",Ha="SHOW_ALERT",Ya={default:4e3,success:2e3,warning:4e3,danger:6e3,info:4e3},Ga=g.c.Record({type:"info",message:"",id:"",timeout:Ya.default});function Ka(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ba,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ya.default,a=Mt.a.v4(),r=new Ga({message:e,type:t,id:a,timeout:n});return{type:Ha,alert:r}}function Wa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Success",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ya.success;return Ka(e,La,t)}function Ja(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Warning",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ya.warning;return Ka(e,Ua,t)}function Qa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Error",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ya.danger;return Ka(e,Va,t)}function $a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Info",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ya.info;return Ka(e,Ba,t)}var Za=function(e){e.status;return Object(pt.a)(e,["status"])},Xa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(17574===e.code)throw window.location.reload(),new Error("login is required");return e},er=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!e||0===e.status)throw e;return e},tr=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n){var a=e.data[0].data,r=a.details,i=a.data,o=a.status,l=a.warnings,s=void 0===l?"warning":l;n(Da());var c=null;try{if("undefined"===typeof r)throw new Error;c=r}catch(u){try{if("undefined"===typeof i)throw new Error;c=i}catch(p){}}if(1===o)t&&n(Wa(t));else if(2===o)try{(Array.isArray(s)?s:[s]).forEach(function(e){n(Ja(e,15e3))})}catch(u){}return{status:o,data:c}}},nr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Error, please try again...";return function(n){if(console.log("Api Error Handler, error: ",e),n({type:"PROGRESS_INDICATOR_DISMISS"}),!1!==t){var a;if("string"===typeof e.message)a=e.message;else try{a=e.error[0].error.data.message}catch(r){try{a=e.error[0].error.message}catch(i){try{a=e.error.error[0].error.message}catch(o){a=t}}}n(Qa(a||t))}return{status:0,error:e}}},ar=function(e){return"".concat(Y(["env","serverApiUrl"],"")).concat(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch(e.api){case"billapi":case void 0:return"/billapi/".concat(e.entity,"/").concat(e.action);case"save":case"savePPIncludes":return"/admin/".concat(e.api);case"paymentgateways":case"billrun":return"/".concat(e.api,"/").concat(e.action);default:return"/api/".concat(e.api)}}(e)).concat(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t="";return e&&Array.isArray(e)&&e.length>0&&(t=e.reduce(function(e,t,n){var a=Object.keys(t)[0],r=0===n?e:"".concat(e,"&");return"".concat(r).concat(encodeURIComponent(a),"=").concat(encodeURIComponent(t[a]))},"?")),t}(e.params))},rr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ar(e,t),a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={credentials:"include"};return e&&Object.assign(t,e),t}(e.options),r=e.name?{name:e.name}:{};return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Request timeout";return new Promise(function(a,r){var i=setTimeout(function(){r(new Error(n))},e);t.then(function(e){clearTimeout(i),a(e)}).catch(function(e){clearTimeout(i),r(e)})})}(e.timeout||Y(["env","serverApiTimeOut"],3e5),fetch(n,a),t.timeOutMessage).then(function(e){return e.json()}).then(Xa).then(er).then(function(e){return Object.assign(r,{data:e,status:1})}).catch(function(e){return Object.assign(r,{error:e,status:0})})},ir=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.assign({requiredAllSuccess:!0},t),a=(Array.isArray(e)?e:[e]).map(function(e){return rr(e,n)});return Promise.all(a).then(function(e){var t=e.filter(function(e){return e.status}).map(Za),a=e.filter(function(e){return!e.status}).map(Za);if(t.length===e.length)return Promise.resolve({data:t});if(a.length===e.length)return Promise.reject({error:a});var r={error:a,data:t};return n.requiredAllSuccess?Promise.reject(r):Promise.resolve(r)})},or="GOT_LIST",lr="ADD_TO_LIST",sr="REMOVE_FROM_LIST",cr="CLEAR_LIST",ur="SET_NEXT_PAGE",pr=function(e,t){return{type:or,collection:e,list:t}},dr=function(e,t){return{type:lr,collection:e,items:t}},mr=function(e,t){return function(n){return n(Aa()),ir(t).then(function(t){try{return n(pr(e,t.data[0].data.details)),n((a=t.data[0].data.next_page,{type:ur,nextPage:a})),n(tr(t))}catch(r){throw console.log("fetchList error: ",r),new Error("Error retreiving list")}var a}).catch(function(e){return n(nr(e,"Network error - please refresh and try again"))})}},gr=function(e){return{type:cr,collection:e}},fr=function(e,t){return function(n){return n(mr(e,t))}},hr=function(e,t){return function(n){return n(function(e,t){return function(n){return n(Aa()),ir(t).then(function(t){try{return n(dr(e,t.data[0].data.details)),n(tr(t))}catch(a){throw console.log("fetchToList error: ",a),new Error("Error retreiving list")}}).catch(function(e){return n(nr(e,"Network error - please refresh and try again"))})}}(e,t))}},vr=n(30),yr=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=Array.isArray(e)?e:[e],r={key:{$nin:[].concat(Object(w.a)(t),[""])},to:{$gt:S()().toISOString()},tariff_category:"retail",$and:[]};"cost"!==a[0]&&r.$and.push({$or:a.map(function(e){return Object(vr.a)({},"rates.".concat(e),{$exists:!0})})}),""!==n&&r.$and.push({$or:[{play:{$exists:!0,$in:[].concat(Object(w.a)(n.split(",")),["",null])}},{play:{$exists:!1}}]});var i=new FormData;return i.append("collection","rates"),i.append("size",99999),i.append("page",0),i.append("project",JSON.stringify({key:1,name:1})),i.append("query",JSON.stringify(r)),{api:"find",options:{method:"POST",body:i}}},br=function(e,t){var n=new FormData;return n.append("category",t),n.append("action","set"),n.append("data",JSON.stringify(e)),{api:"settings",name:t,options:{method:"POST",body:n}}},Er=function(e,t){var n=new FormData;return n.append("category","file_types"),n.append("action",t),n.append("data",JSON.stringify(e)),{api:"settings",options:{method:"POST",body:n}}},Cr=function(e,t){return{api:"settings",params:[{category:"file_types"},{action:t},{data:JSON.stringify({file_type:e})}]}},_r=function(e,t,n,a){return{entity:"lines",action:"get",params:[{size:a},{page:t},{sort:JSON.stringify(n)},{query:JSON.stringify(e)}]}},Or=function(e,t,n,a){return{entity:"queue",action:"get",params:[{size:a},{page:t},{sort:JSON.stringify(n)},{query:JSON.stringify(e)}]}},Sr=function(e,t,n,a){return{entity:"balances",action:"get",params:[{size:a},{page:t},{sort:JSON.stringify(n)},{query:JSON.stringify(e)}]}},Tr=function(e,t,n,a){return{entity:"balances",action:"get",params:[{size:a},{page:t},{sort:JSON.stringify(n)},{query:JSON.stringify(e)}]}},kr=function(){return{api:"aggregate",params:[{collection:"log"},{pipelines:JSON.stringify([{$match:{source:"audit"}},{$group:{_id:"$collection"}},{$project:{name:"$_id",_id:0}},{$sort:{name:1}}])}]}},Ir=function(e){return{api:"settings",params:[{category:"payment_gateways"},{action:"set"},{data:JSON.stringify(e)}]}},Nr=function(e){return{api:"settings",params:[{category:"payment_gateways"},{action:"unset"},{data:JSON.stringify({name:e})}]}},wr=function(e,t,n){return{entity:e,action:t,options:{method:"POST",body:n}}},jr=function(e){return{action:"uniqueget",entity:e,params:[{query:JSON.stringify({"include.groups":{$exists:!0}})},{project:JSON.stringify({name:1,include:1})},{page:0},{size:9999}]}},Rr=function(e,t){return{action:"get",entity:e,params:[{query:JSON.stringify({_id:t})},{page:0},{size:1}]}},xr=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;switch(e){case"users":t="get";break;default:t="uniqueget"}return{action:t,entity:e,params:[{page:0},{size:9999},{query:JSON.stringify(a)},{project:JSON.stringify(n)},{sort:JSON.stringify(r||n)}]}},Fr=function(){return xr("services",{name:1,description:1,play:1,quantitative:1,balance_period:1},{},{name:1})},Pr=function(){return xr("prepaidincludes")},Mr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{key:1,description:1,play:1},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{key:1};return xr("rates",e,t,n)},Ar=function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{key:1,description:1};return xr("rates",e,{tariff_category:"retail"})}({key:1,description:1,rates:1})},Dr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:1,description:1},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{name:1};return xr("plans",e,t,n)},Lr=function(){return xr("users",{username:1})},Ur=function(){return[jr("plans"),jr("services")]},Vr=function(e){return{action:"uniqueget",entity:"rates",params:[{query:JSON.stringify({key:{$regex:"^".concat(e,"$")}})},{page:0},{size:1}]}},Br=function(e,t,n,a,r){return{action:"get",entity:"log",params:[{size:r},{page:t},{project:JSON.stringify(n)},{sort:JSON.stringify(a)},{query:JSON.stringify(e)}]}},qr=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=new FormData;return r.append("page",0),r.append("size",9999),r.append("project",JSON.stringify(a)),r.append("sort",JSON.stringify(a)),r.append("query",JSON.stringify(Object(vr.a)({},t,{$in:n}))),{action:"uniqueget",entity:e,options:{method:"POST",body:r}}},zr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return qr("rates","key",e,t)},Hr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=[{aid:e}];return""!==t&&n.push({billrun_key:t}),{api:"resetlines",params:n}},Yr=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a={api:"billrun",action:"cycles",params:[]};return e&&a.params.push({from:e}),t&&a.params.push({to:t}),a.params.push({newestFirst:n?1:0}),a},Gr=function(e){return{api:"billrun",action:"cycle",params:[{stamp:e}]}},Kr=function(e){return{action:"get",entity:"billrun",params:[{query:JSON.stringify({billrun_key:e})},{project:JSON.stringify({_id:1})}]}},Wr=function(){return{api:"operations",params:[{action:"charge_account"},{filtration:"all"}]}},Jr=function(e){return{api:"report",params:[{action:"exportCSV"},{report:e}]}},Qr=function(e,t){return{api:"accountinvoices",params:[{action:"expected_invoice"},{aid:e},{billrun_key:t}]}},$r=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={val:null},n.onSelectPlan=function(e){e&&n.props.onSelectPlan(e),n.setState({val:null})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.planType;this.props.dispatch(fr("available_plans",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{name:1,description:1},n={connection_type:{$exists:!0}};return""!==e&&(n.connection_type.$eq=e),xr("plans",t,n)}(e)))}},{key:"render",value:function(){var e=this.props,t=e.options,n=e.selectedOptions,a=t.filter(function(e){return!n.includes(e.get("value",""))}).map(oe).toArray();return r.a.createElement("div",{className:"PlanSearch"},r.a.createElement(en,{fieldType:"select",value:this.state.val,onChange:this.onSelectPlan,options:a,placeholder:"Search by plan name...",noResultsText:"No plans found, please try another name"}))}}]),t}(a.Component);$r.defaultProps={options:g.c.List(),selectedOptions:[],onSelectPlan:function(){},planType:""};var Zr=Object(l.connect)(function(e,t){return{options:ka(e,t)}})($r),Xr=function(e,t){return t.item},ei=function(e,t){return t.location&&t.location.query&&t.location.query.action&&t.location.query.action.length>0?t.location.query.action:null},ti=function(e,t,n){if(n&&n.startsWith("source"))return e.entity.get(n);switch(n){case"prepaid_include":case"autorenew":case"customer":case"subscription":case"discount":case"reports":case"importer":case"tax":return e.entity.get(n);case"charging_plan":return e.plan;default:return e[n]}},ni=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;switch(e.get("entity")){case"customer":return t;case"subscription":return n;case"product":return a;default:return}},ai=Object(on.a)(ti,function(e,t,n){var a=Y(["systemItems",n,"collection"],"");return e.entityList.revisions.get(a)},function(e,t,n){return Y(["systemItems",n,"uniqueField"],"name")},function(e,t,n){if(t&&te(e,!1))return t.get(e.get(n,""))}),ri=Object(on.a)(function(e,t){if(t.location&&t.location.query&&"undefined"!==typeof t.location.query.tab)return parseInt(t.location.query.tab)||void 0},function(e){return e}),ii=Object(on.a)(function(e,t){if(t.location&&t.location.query&&"undefined"!==typeof t.location.query.t)return t.location.query.t},function(e){return e}),oi=Object(on.a)(function(e,t){if(t.location&&t.location.query&&"undefined"!==typeof t.location.query.u)return t.location.query.u},function(e){return e}),li=Object(on.a)(function(e,t){if(t.location&&t.location.query&&"undefined"!==typeof t.location.query.sig)return t.location.query.sig},function(e){return e}),si=Object(on.a)(function(e,t){if(t.location&&t.location.query&&"undefined"!==typeof t.location.query.message)return t.location.query.message},function(e){if(e)try{return JSON.parse(e)}catch(t){return}}),ci=Object(on.a)(function(e,t,n){return ti(e,0,"source".concat(Object(x.upperCaseFirst)(n)))},function(e){return e}),ui=Object(on.a)(ti,function(e){return e}),pi=Object(on.a)(function(e,t){return t.params&&t.params.itemId&&t.params.itemId.length>0?t.params.itemId:null},function(e){return e}),di=Object(on.a)(ei,pi,ui,function(e,t,n){return e||(t?te(n,!1)?re(n):"loading":"create")}),mi=Object(on.a)(function(e,t){return t.params&&t.params.itemType&&t.params.itemType.length>0?t.params.itemType:null},function(e){return Y(["import","allowed_entities"],g.c.List()).includes(e)?e:void 0}),gi=Object(on.a)(ei,pi,ui,function(e,t,n){return e||(t?te(n,!1)?"update":"loading":"create")}),fi=Object(on.a)(xn,Pn,function(e,t){return e?null:t}),hi=Object(on.a)(Xr,fi,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return ie(e,t)}),vi=Object(on.a)(ei,function(e){return e||void 0}),yi=Object(on.a)(ci,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("rates")}),bi=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).handleSelectTab=function(e){var t=n.props.location,a=t.pathname,r=t.query;n.props.router.push({pathname:a,query:Object.assign({},r,{tab:e})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.children,a=e.activeTab;return r.a.createElement("div",null,r.a.createElement(f.A,{defaultActiveKey:a,animation:!1,id:t,onSelect:this.handleSelectTab},n))}}]),t}(a.Component);bi.defaultProps={id:Mt.a.v4(),children:null,activeTab:1};var Ei=Object(s.f)(Object(l.connect)(function(e,t){return{activeTab:ri(e,t)}})(bi)),Ci=n(257),_i=n.n(Ci),Oi=function(e){var t=e.steps,n=e.activeIndex;return r.a.createElement("div",{className:"stepper-container"},r.a.createElement(_i.a,{titleTop:5,lineMarginOffset:10,circleTop:0,size:24,titleFontSize:12,circleFontSize:12,activeStep:n,steps:t}))};Oi.defaultProps={activeStep:0,steps:[]};var Si=Oi,Ti=n(50),ki=n(22),Ii=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).handleTouchTap=n.handleTouchTap.bind(Object(ki.a)(n)),n.handleRequestClose=n.handleRequestClose.bind(Object(ki.a)(n)),n.state={open:!1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleTouchTap",value:function(e){this.setState({open:!0,anchorEl:e.currentTarget})}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"render",value:function(){var e=this.props.contents;if(!e||""===e)return null;var t=r.a.createElement(f.B,{id:"tooltip"},e);return r.a.createElement("span",{style:{margin:5}},r.a.createElement(f.t,{placement:"top",overlay:t},r.a.createElement("i",{className:"fa fa-question-circle",style:{cursor:"pointer"}})))}}]),t}(a.Component),Ni={name:"Unique key for the plan",description:"The title of the plan",add_product:"Add product to override price",add_include:"Add include unit type",include_groups:"Plan Include Groups",included_services:"Services that are included in the plan"},wi={name:"The key of the service",description:"The title of the service",service_period_type_cycle:"Eligibility period is for a fixed / infinite number of billing cycles since subscribing to the service. Service price / includes are per cycle.",service_period_type_custom_period:"Service is charged once for the whole period. Includes are valid for the whole defined period and are independent of the billing cycle."},ji={name:"Group name should be unique for all plans",products:"Products should be unique for all plans",shared_desc:"The includes will be shared with all the customer's subscribers. This is useful for family or organization package",pooled_desc:"When the 'Pooled' option is activated, each subscriber, under the same customer, will 'Add' its 'Includes' allocation to the customer pool. The allocation can be either monetary allocation or a volume [call minutes, GBs of data, etc] based.",quantityAffected_desc:"When the 'Quantity Affected' option is activated, each subscriber, under the same customer, will 'Add' its 'Includes' allocation to the customer pool, multiplied by the subscribers' service quantity. The allocation can be either monetary allocation or a volume [call minutes, GBs of data, etc] based."},Ri={description:"Title",key:"Key",tieredPricing:"tiered pricing defines a price PER unit within a range",volumePricing:"volume pricing defines a price for ALL units within the range",addToRetail:"in case of non retail rate, determine whether or not the product will be included in the retail price"},xi={description:"Title",key:"Key"},Fi={method_simple:"All Rows",method_grouped:"Group rows",block_conditions:"You can use conditions to refine reports to show only results that meet specific criteria.",block_columns_simple:"Please add one or more report columns.",block_columns_grouped:"Please add one or more report columns and their function.",block_sort:"You can set sort fields to control the order in which data appears in a report.",block_formatter:"You can set column format to change default style of report value.",block_preview:"Click on preview to generate the report.",add_sort_disabled_no_fields:"To add sort first select report columns",add_formatter_disabled_no_fields:"To add column format first select report columns",add_conditions_disabled_no_entity:"To add conditions first select report entity",add_columns_disabled_no_entity:"To add columns first select report entity"},Pi={email_after_confirmation:'Once an invoice is confirmed, it will be emailed to the customer\'s email for customer eligible for the "email" shipping method'},Mi={key:"The key of the tax",description:"The title of the tax"},Ai={regexHelper:"In case you want to run a regular expression on the computed field before calculating the rate",mustMetHelper:"This means than in case the condition is not met - a rate will not be found"},Di=function(e){var t=e.item,n=e.conditionFieldsOptions,i=e.valueWhenOptions,o=e.onSaveComputedLineKey,l=e.onHideComputedLineKey,s=Object(a.useState)(t),c=Object(Ti.a)(s,2),u=c[0],p=c[1],d=["$exists","$existsFalse","$isTrue","$isFalse"].includes(u.get("operator",""));if(!u)return null;var m=function(e){return function(t){var n=t.target.value;p(u.setIn(e,n))}},h=function(e){return function(t){var n=u.withMutations(function(n){n.setIn(e,t);var a=e[1];if("operator"===e[0]){var r="$regex"===u.get("operator","")&&"$regex"!==t,i="$regex"!==u.get("operator","")&&"$regex"===t;(r||i||d)&&(n.deleteIn(["line_keys",1]),n.deleteIn(["line_keys",0,"regex"]))}"hard_coded"===t?n.deleteIn(["projection",a,"value"]):"condition_result"===t&&(n.deleteIn(["projection",a,"value"]),n.deleteIn(["projection",a,"regex"]))});p(n)}},v=function(e){var t=e.target.value,n=u.withMutations(function(e){e.set("type",t),"regex"===t&&(e.deleteIn(["line_keys",1]),e.delete("operator"),e.delete("must_met"),e.delete("projection"))});p(n)},y=Y(["rates","conditions"],Object(g.b)()).map(le).toArray(),b="regex"===u.get("type","regex");return r.a.createElement(Ye,{title:"Computed Rate Key",show:!0,onOk:function(){o(u)},onHide:l,labelOk:"OK",modalSize:"large"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:2},"Computation Type"),r.a.createElement(f.g,{sm:10},r.a.createElement("span",null,r.a.createElement("span",{className:"inline mr10"},r.a.createElement(en,{fieldType:"radio",name:"computed-type",id:"computed-type-regex",value:"regex",checked:b,onChange:v,label:"Regex"})),r.a.createElement("span",{className:"inline"},r.a.createElement(en,{fieldType:"radio",name:"computed-type",id:"computed-type-condition",value:"condition",checked:!b,onChange:v,label:"Condition"}))))),r.a.createElement("div",{className:"separator"}),r.a.createElement(f.l,{key:"computed-field-1"},r.a.createElement(f.g,{sm:2,componentClass:f.h},b?"Field":"First Field"),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",onChange:h(["line_keys",0,"key"]),value:u.getIn(["line_keys",0,"key"],""),options:n,allowCreate:!0})),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{value:u.getIn(["line_keys",0,"regex"],""),disabledValue:"",onChange:h(["line_keys",0,"regex"]),disabled:""===u.getIn(["line_keys",0,"key"],"")||d,label:r.a.createElement("span",null,"Regex",r.a.createElement(Ii,{contents:Ai.regexHelper})),fieldType:"toggeledInput"}))),!b&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.l,{key:"computed-operator"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Operator"),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",onChange:h(["operator"]),value:u.get("operator",""),options:y}))),r.a.createElement(f.l,{key:"computed-field-2"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Second Field"),r.a.createElement(f.g,{sm:5},"$regex"===u.get("operator","")&&r.a.createElement(en,{value:u.getIn(["line_keys",1,"key"],""),onChange:function(e){var t=e.target.value;p(u.setIn(["line_keys",1,"key"],t))}}),"$regex"!==u.get("operator","")&&r.a.createElement(en,{fieldType:"select",onChange:h(["line_keys",1,"key"]),value:u.getIn(["line_keys",1,"key"],""),options:n,disabled:d})),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{value:u.getIn(["line_keys",1,"regex"],""),disabledValue:"",onChange:h(["line_keys",1,"regex"]),disabled:""===u.getIn(["line_keys",1,"key"],"")||"$regex"===u.get("operator",""),label:r.a.createElement("span",null,"Regex",r.a.createElement(Ii,{contents:Ai.regexHelper})),fieldType:"toggeledInput"}))),r.a.createElement(f.l,{key:"computed-must-met"},r.a.createElement(f.g,{componentClass:f.h,sm:2},"Must met?",r.a.createElement(Ii,{contents:Ai.mustMetHelper})),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"checkbox",id:"computed-must-met",value:u.get("must_met",!1),onChange:function(e){var t=e.target.value,n=u.withMutations(function(e){e.set("must_met",t),t&&e.setIn(["projection","on_false"],Object(g.b)())});p(n)},className:"input-min-line-height"}))),r.a.createElement(f.l,{key:"computed-cond-project-true"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Value when True"),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",onChange:h(["projection","on_true","key"]),value:u.getIn(["projection","on_true","key"],"condition_result"),options:i})),["hard_coded"].includes(u.getIn(["projection","on_true","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(en,{value:u.getIn(["projection","on_true","value"],""),onChange:m(["projection","on_true","value"])})),!["","hard_coded","condition_result"].includes(u.getIn(["projection","on_true","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(en,{value:u.getIn(["projection","on_true","regex"],""),disabledValue:"",onChange:h(["projection","on_true","regex"]),disabled:""===u.getIn(["projection","on_true","key"],""),label:"Regex",fieldType:"toggeledInput"}))),r.a.createElement(f.l,{key:"computed-cond-project-false"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Value when False"),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",onChange:h(["projection","on_false","key"]),value:u.getIn(["projection","on_false","key"],"condition_result"),options:i,disabled:u.get("must_met",!1)})),["hard_coded"].includes(u.getIn(["projection","on_false","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(en,{value:u.getIn(["projection","on_false","value"],""),onChange:m(["projection","on_false","value"])})),!["","hard_coded","condition_result"].includes(u.getIn(["projection","on_false","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(en,{value:u.getIn(["projection","on_false","regex"],""),disabledValue:"",onChange:h(["projection","on_false","regex"]),disabled:""===u.getIn(["projection","on_false","key"],""),label:"Regex",fieldType:"toggeledInput"}))))))};Di.defaultProps={item:Object(g.b)(),conditionFieldsOptions:[],valueWhenOptions:[]};var Li=Di,Ui=function(e){var t=e.condition,n=e.index,i=e.priorityIndex,o=e.type,l=e.onUpdate,s=e.onRemove,c=e.allowRemove,u=e.lineKeyOptions,p=e.paramsKeyOptions,d=e.paramsTypeOptions,m=e.conditionFieldsOptions,h=e.valueWhenOptions,v=Object(a.useState)(null),y=Object(Ti.a)(v,2),b=y[0],E=y[1],C=Object(a.useMemo)(function(){return Object(g.b)({type:t.getIn(["computed","type"],"regex"),line_keys:t.getIn(["computed","line_keys"],Object(g.a)()),operator:t.getIn(["computed","operator"],""),must_met:t.getIn(["computed","must_met"],!1),projection:Object(g.b)({on_true:Object(g.b)({key:t.getIn(["computed","projection","on_true","key"],"condition_result"),regex:t.getIn(["computed","projection","on_true","regex"],""),value:t.getIn(["computed","projection","on_true","value"],"")}),on_false:Object(g.b)({key:t.getIn(["computed","projection","on_false","key"],"condition_result"),regex:t.getIn(["computed","projection","on_false","regex"],""),value:t.getIn(["computed","projection","on_false","value"],"")})})})},[t]),_=Object(a.useCallback)(function(e){"computed"===e?E(C):t.has("computed")&&l([n,"computed"],null),l([n,"line_key"],e)},[l,n,C,t]),O=Object(a.useCallback)(function(e){l([n,"type"],e)},[l,n]),S=Object(a.useCallback)(function(e){l([n,"entity_key"],e)},[l,n]),T=Object(a.useCallback)(function(e){l([n,"line_key"],"computed"),l([n,"computed"],e),E(null)},[l,n]),k=Object(a.useMemo)(function(){return[{type:"remove",onClick:s,show:c,helpText:"Remove Condition ".concat(n+1," of Priority ").concat(i+1),actionStyle:"default"}]},[s,c,i,n]),I=Object(a.useMemo)(function(){var e=t.getIn(["computed","operator"],""),n=Y(["rates","conditions"],Object(g.b)()).find(function(t){return t.get("id","")===e},null,Object(g.b)()).get("title",""),a=t.getIn(["computed","line_keys",0,"key"],""),r=m.find(function(e){return e.value===a}),i=t.getIn(["computed","line_keys",1,"key"],""),o=m.find(function(e){return e.value===i});return[{type:"edit",onClick:function(){E(C)},label:"".concat(r?r.label:a," ").concat(n," ").concat(o?o.label:i),show:"computed"===t.get("line_key",""),actionClass:"pr0 pl0 mt5"}]},[t,m,C]),N=Object(a.useMemo)(function(){return d.map(le).toArray()},[d]);return r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",null,"CDR Field")),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{fieldType:"select",options:u,onChange:_,value:t.get("line_key","")}),r.a.createElement(Xe,{actions:I,data:n})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",null,"Operator")),r.a.createElement(f.g,{sm:3},r.a.createElement(en,{fieldType:"select",options:N,onChange:O,value:t.get("type",""),disabled:""===t.get("line_key","")})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",null,Object(x.titleCase)(o)," Parameter")),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{fieldType:"select",options:p,onChange:S,value:t.get("entity_key",""),disabled:""===t.get("type","")})),r.a.createElement(f.g,{sm:1},r.a.createElement(Xe,{actions:k,data:n})),r.a.createElement(f.g,{sm:12,smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("hr",{className:"mt10 mb10"})),b&&r.a.createElement(Li,{onSaveComputedLineKey:T,onHideComputedLineKey:function(){E(null)},item:b,conditionFieldsOptions:m,valueWhenOptions:h}))};Ui.defaultProps={condition:Object(g.b)(),index:0,allowRemove:!0,priorityIndex:0,lineKeyOptions:[],paramsKeyOptions:[],conditionFieldsOptions:[],valueWhenOptions:[],paramsTypeOptions:Y(["rates","paramsConditions"],Object(g.a)())};var Vi=Object(a.memo)(Ui),Bi={marginTop:5},qi=function(e){var t=e.priority,n=e.index,i=e.type,o=e.paramsKeyOptions,l=e.lineKeyOptions,s=e.conditionFieldsOptions,c=e.valueWhenOptions,u=e.onUpdate,p=e.onRemove,d=e.onAdd,m=Object(a.useMemo)(function(){return[n]},[n]),h=Object(a.useMemo)(function(){return[].concat(Object(w.a)(m),["filters"])},[m]),v=Object(a.useMemo)(function(){return t.get("filters",Object(g.a)())},[t]),y=Object(a.useCallback)(function(e,t){null===t?u(h,v.deleteIn(e)):u([].concat(Object(w.a)(h),Object(w.a)(e)),t)},[u,h,v]),b=Object(a.useCallback)(function(e){p([].concat(Object(w.a)(h),[e]))},[p,h]),E=Object(a.useMemo)(function(){return[{type:"remove",onClick:p,helpText:"Remove Priority ".concat(n+2),actionClass:"pr0 pl0 pt0"}]},[p,n]),C=r.a.createElement("div",null,"Priority ".concat(n+2),r.a.createElement("div",{className:"pull-right"},r.a.createElement(Xe,{actions:E,data:m})));return r.a.createElement(f.v,{header:C,collapsible:!0,className:"collapsible",defaultExpanded:!0},r.a.createElement("div",{className:"priority-conditions"},r.a.createElement(f.g,{sm:12,className:"form-inner-edit-rows"},v.isEmpty()&&r.a.createElement("small",null,"No conditions found"),!v.isEmpty()&&r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{className:"ml5 mb0"},"CDR Field")),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{className:"mb0"},"Operator")),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{className:"mb0"},Object(x.titleCase)(i)," Parameter")),r.a.createElement(f.g,{sm:1,xsHidden:!0})),v.map(function(e,t){return r.a.createElement(Vi,{key:t,index:t,priorityIndex:n,allowRemove:v.size>1,type:i,lineKeyOptions:l,paramsKeyOptions:o,conditionFieldsOptions:s,valueWhenOptions:c,condition:e,onUpdate:y,onRemove:b})})),r.a.createElement(f.g,{sm:12,className:"ml5 pl0"},r.a.createElement(Je,{onClick:d,data:h,label:"Add Condition",buttonStyle:Bi}))))};qi.defaultProps={priority:Object(g.b)(),lineKeyOptions:[],paramsKeyOptions:[],conditionFieldsOptions:[],valueWhenOptions:[],index:0};var zi=Object(a.memo)(qi),Hi={},Yi={marginLeft:21},Gi=Object(g.b)(),Ki=Object(g.b)({filters:Object(g.a)([Gi]),cache_db_queries:!0}),Wi=function(e){var t=e.type,n=e.category,i=e.priorities,o=e.lineKeyOptions,l=e.paramsKeyOptions,s=e.conditionFieldsOptions,c=e.valueWhenOptions,u=e.onAdd,p=e.onUpdate,d=e.onRemove,m=Object(a.useCallback)(function(e){u([n,"priorities"].concat(Object(w.a)(e)),Gi)},[u,n]),h=Object(a.useCallback)(function(){var e=Ki.set("uiFlag",Object(g.b)({id:Mt.a.v4()}));u([n,"priorities"],e)},[u,n]),v=Object(a.useCallback)(function(e){var t=e.target.value;p([n,"default_fallback"],t)},[p,n]),y=Object(a.useCallback)(function(e,t){p([n,"priorities"].concat(Object(w.a)(e)),t)},[p,n]),b=Object(a.useCallback)(function(e){d([n,"priorities"].concat(Object(w.a)(e)))},[d,n]);return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:r.a.createElement("div",{style:Yi},"Priority 1")},r.a.createElement(en,{fieldType:"checkbox",value:!0,label:"Use product/service/plan override tax rate if defined",disabled:!0})),i.get("priorities",Object(g.a)()).map(function(e,a){return r.a.createElement(zi,{key:e.getIn(["uiFlag","id"],a),index:a,category:n,type:t,priority:e,count:i.size,lineKeyOptions:o,paramsKeyOptions:l,conditionFieldsOptions:s,valueWhenOptions:c,onAdd:m,onUpdate:y,onRemove:b})}),r.a.createElement(f.v,{header:r.a.createElement("div",{style:Yi},"Priority ",i.get("priorities",Object(g.a)()).size+2)},r.a.createElement(en,{fieldType:"checkbox",value:!0,label:"Use tax rate referenced by product/service/plan",disabled:!0})),r.a.createElement(f.v,{header:r.a.createElement("div",{style:Yi},"Priority ",i.get("priorities",Object(g.a)()).size+3)},r.a.createElement(en,{fieldType:"checkbox",value:i.get("default_fallback",!1),onChange:v,label:"Use default tax rate"})),r.a.createElement(Je,{label:"Add Priority",onClick:h,buttonStyle:Hi}))};Wi.defaultProps={priorities:Object(g.b)(),lineKeyOptions:[],paramsKeyOptions:[],conditionFieldsOptions:[],valueWhenOptions:[]};var Ji=Wi,Qi="SET_PAGE_TITLE",$i="SYSTEM_REQUIREMENTS_LOADING_COMPLETE",Zi="READY",Xi="RUNNING",eo="FINISHED",to="STARTING",no="PAUSED",ao="CANCELED";function ro(e){return{type:Qi,title:e}}var io=function(){return{type:"SET_ON_BOARDING_STEP",step:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0}},oo=function(){return{type:"SET_ON_BOARDING_STATE",state:Zi}},lo=function(){return{type:"SET_ON_BOARDING_STATE",state:no}},so=function(){return{type:"SET_ON_BOARDING_STATE",state:Xi}},co=function(){return{type:"SET_ON_BOARDING_STATE",state:eo}},uo=function(){return{type:"SET_ON_BOARDING_STATE",state:ao}},po=function(e){return{type:"CONFIRM_SHOW",confirm:e}},mo=function(e,t,n){return{type:"EDIT_FORM_SHOW",item:e,component:t,config:n}},go=function(e){return{type:"EDIT_FORM_SET_ERROR",fieldId:e,message:arguments.length>1&&void 0!==arguments[1]?arguments[1]:null}},fo=function(e){return{type:"SET_PAGE_FLAG",page:e,flag:arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,value:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null}},ho=Object(on.a)(function(e){return e.guiState.page.getIn(["onBoarding","state"])},function(e){return e}),vo=Object(on.a)(function(e){return e.guiState.page.getIn(["onBoarding","step"])},function(e){return e}),yo=Object(on.a)(ho,function(e){return e===Xi}),bo=Object(on.a)(ho,function(e){return e===eo}),Eo=Object(on.a)(ho,function(e){return e===Zi}),Co=Object(on.a)(ho,function(e){return e===no}),_o=Object(on.a)(ho,function(e){return e===to}),Oo=Object(on.a)(function(e){return e.guiState.page.getIn(["formModalData","item"])},function(e){return e}),So=Object(on.a)(function(e){return e.guiState.page.getIn(["formModalData","component"])},function(e){return e}),To=Object(on.a)(function(e){return e.guiState.page.getIn(["formModalData","config"])},function(e){return e}),ko=Object(on.a)(function(e){return e.guiState.page.getIn(["formModalData","errors"])},function(e){return e}),Io=Object(on.a)(function(e){return e.guiState.page.getIn(["formModalData","show"])},function(e){return e}),No=Object(on.a)(function(e){return e.guiState.page.getIn(["confirm"])},function(e){return e}),wo=Object(on.a)(function(e){return e.guiState.menu.getIn(["main"])},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.reduce(function(e,t){return t.get("subMenus",g.c.List()).isEmpty()?e:e.push.apply(e,Object(w.a)(t.get("subMenus",g.c.List())))},e).reduce(function(e,t){if(""!==t.get("route","")){var n=g.c.Map({view:t.get("roles",g.c.List())});return e.set(t.get("route","-"),n)}return e},g.c.Map())}),jo=Object(on.a)(function(e){return e.guiState.page.get("flag")},function(e,t,n){return n},function(e,t,n,a){return a},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=null!==n?[t,n]:[t];return e.getIn(a,void 0)}),Ro=function(e){var t=e.confirm,n=e.dispatch;if(!1===t.get("show",!1))return null;var a=function(e){return function(){e&&"function"===typeof e&&e(),n({type:"CONFIRM_HIDE"})}},i=t.get("labelOk"),o=a(t.get("onOk")),l=t.get("labelCancel"),s=a(t.get("onCancel")),c=t.get("message"),u=t.get("type"),p=t.get("children");return r.a.createElement(Ke,{show:!0,labelOk:i,onOk:o,labelCancel:l,onCancel:s,message:c,type:u},p)};Ro.defaultProps={confirm:g.c.Map()};var xo=Object(l.connect)(function(e){return{confirm:No(e)}})(Ro),Fo=n(34),Po=function(e){var t=e.show,n=e.item,a=e.component,i=e.config,o=e.hideModal,l=e.closeModal,s=e.errors,c=Object(pt.a)(e,["show","item","component","config","hideModal","closeModal","errors"]);if(!t)return null;if(t&&!a)throw new Error("ReduxFormModal require component parameter");var u=i.toJS(),p=u.title,d=u.labelOk,m=void 0===d?"Save":d,g=u.onOk,f=u.labelCancel,h=void 0===f?"Cancel":f,v=u.onCancel,y=u.modalSize,b=void 0===y?"large":y,E=u.allowSubmitWithError,C=void 0!==E&&E,_=Object(pt.a)(u,["title","labelOk","onOk","labelCancel","onCancel","modalSize","allowSubmitWithError"]),O=o(v);return r.a.createElement(Ye,{show:!0,title:p,onOk:function(){if(!C&&s.some(function(e){return!e||e.length>0}))return!1;return o(g)(n)},labelOk:m,onCancel:O,labelCancel:h,onHide:l,modalSize:b},function(e,t){var n=t.item,a=t.setItem,i=t.updateField,o=t.removeField,l=t.setError,s=Object(pt.a)(t,["item","setItem","updateField","removeField","setError"]);return r.a.createElement(e,Object.assign({},s,{item:n,setItem:a,setError:l,updateField:i,removeField:o}))}(a,Object(Fo.a)({item:n,errors:s},c,_)))};Po.defaultProps={show:!1,item:void 0,component:void 0,config:g.c.Map(),errors:g.c.Map()};var Mo=Po,Ao=Object(l.connect)(function(e){return{show:Io(e),item:Oo(e),component:So(e),config:To(e),errors:ko(e)}},function(e){return{closeModal:function(){var t={message:"Are you sure you want to close and discard all changes?",labelOk:"Yes",type:"delete",onOk:function(){return e({type:"EDIT_FORM_HIDE"})}};return e(po(t))},hideModal:function(t){return function(n){if(t&&"function"===typeof t){var a=t(n);return a&&a.then&&"function"===typeof a.then?a.then(function(){e({type:"EDIT_FORM_HIDE"})}).catch(function(){}):!1!==a&&e({type:"EDIT_FORM_HIDE"})}return e({type:"EDIT_FORM_HIDE"})}},setItem:function(t){e({type:"EDIT_FORM_SET_ITEM",item:t})},updateField:function(t,n){e(function(e,t){return{type:"EDIT_FORM_UPDATE_ITEM_FIELD",path:e,value:t}}(t,n))},removeField:function(t){e(function(e){return{type:"EDIT_FORM_DELETE_ITEM_FIELD",path:e}}(t))},setError:function(t,n){e(go(t,n))}}})(Mo),Do=function(){return{type:"TOGGLE_SIDE_BAR",state:arguments.length>0&&void 0!==arguments[0]?arguments[0]:null}},Lo=function(){return{type:"PREPARE_MAIN_MENU_STRUCTURE",mainMenuOverrides:arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}},Uo=function(e){return Y("mainMenu",g.c.Map()).withMutations(function(t){e&&e.size&&e.forEach(function(e,n){t.has(n)&&e.forEach(function(e,a){t.setIn([n,a],e)})})})},Vo=function e(t,n){return t.filter(function(e){return e.get("parent")===n}).map(function(e,t){return e.set("id",t)}).toList().sort(function(e,t){return e.get("order",999)<t.get("order",999)?-1:1}).map(function(n,a){var r=e(t,n.get("id"));return n.withMutations(function(e){r.size&&e.set("subMenus",r),e.set("order",a)})})},Bo="UPDATE_SETTING",qo="GOT_SETTINGS",zo="ADD_PAYMENT_GATEWAY",Ho="REMOVE_PAYMENT_GATEWAY",Yo="UPDATE_PAYMENT_GATEWAY",Go="REMOVE_SETTING_FIELD",Ko="PUSH_TO_SETTING",Wo="SET_FIELD_POSITION",Jo=function(e){return{type:zo,gateway:e}},Qo=function(e){return{type:Ho,gateway:e}},$o=function(e){return{type:Yo,gateway:e}},Zo=function(e,t,n){return{type:Bo,category:e,name:t,value:n}},Xo=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{type:Ko,category:e,path:n,value:t}},el=function(e,t){return{type:Go,category:e,name:t}},tl=function(e,t){var n="data:image/png;base64,".concat(e);return Zo("files",t,n)},nl=function(e){var t=function(e,t){var n=new FormData;return n.append("action","save"),n.append("metadata",JSON.stringify(t)),n.append("query",JSON.stringify({filename:"file"})),n.append("file",e),{api:"files",name:"saveFile",options:{method:"POST",body:n}}}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return ir(t)},al=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"file";return function(n){var a=localStorage.getItem(t);if(a)return n(tl(a,t));var r=function(e){return{api:"files",params:[{action:"read"},{query:JSON.stringify(e)}]}}(e);return ir(r).then(function(e){return e.data&&e.data[0]&&e.data[0].data&&e.data[0].data.desc?(localStorage.setItem(t,e.data[0].data.desc),n(tl(e.data[0].data.desc,t)),!0):e}).catch(function(e){return n(nr(e)),e})}},rl=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n,a){var r=t.success,i=void 0===r?"Settings saved successfuly!":r,o=t.error,l=void 0===o?"Error saving settings":o;n(Aa());var s=a().settings,c=Array.isArray(e)?e:[e],u=c.length>1,p=c.map(function(e){var t=s.getIn(e.split("."));return"taxation"===e&&(t=t.set("vat",t.get("vat")/100)),u?Object(vr.a)({},e,t):t}),d=u?"ROOT":c[0],m=u?p:p[0],g=br(m,d);return ir(g).then(function(e){return n(tr(e,i))}).catch(function(e){return n(nr(e,l))})}},il=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return function(t){var n=(Array.isArray(e)?e:[e]).map(function(e){return function(e){return{api:"settings",name:e,params:[{category:e},{data:JSON.stringify({})}]}}(e)});return ir(n).then(function(e){var n;return t((n=e.data,{type:qo,settings:n})),!0}).catch(function(e){return t(nr(e)),!1})}},ol=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e?localStorage.clear():e.forEach(function(e){localStorage.removeItem(e)})},ll=function(e,t){return function(n){n(Aa());var a,r="remove"===t?(a=e,{api:"settings",params:[{category:"shared_secret"},{action:"unset"},{data:JSON.stringify({key:a})}]}):function(e){return{api:"settings",params:[{category:"shared_secret"},{action:"set"},{data:JSON.stringify(e)}]}}(e);return ir(r).then(function(e){var a=["create"].includes(t)?"created":"";return""===a&&(a=["remove"].includes(t)?"removed":"updated"),n(tr(e,"The secret key was ".concat(a)))}).catch(function(e){return n(nr(e,"Error saving Secret"))})}},sl="Oops! Something went wrong. Please try again in a few moments.",cl="GOT_ENTITY",ul="UPDATE_ENTITY_FIELD",pl="DELETE_ENTITY_FIELD",dl="CLEAR_ENTITY",ml="CLONE_RESET_ENTITY",gl=function(e,t,n){return{type:ul,collection:e,path:t,value:n}},fl=function(e,t){return{type:pl,collection:e,path:t}},hl=function(e,t){return{type:cl,collection:e,entity:t}},vl=function(e,t){return{type:cl,collection:"source".concat(Object(x.upperCaseFirst)(e)),entity:t}},yl=function(e,t){return{type:ml,collection:e,uniquefields:Y(["systemItems",t,"uniqueField"],[])}},bl=function(e){return{type:dl,collection:e}},El=function(e,t,n){return function(e,t){var n=Y("apiDateFormat","YYYY-MM-DD");switch(t){case"move":var a=new FormData,r={_id:e.getIn(["_id","$id"],"undefined")};a.append("query",JSON.stringify(r));var i=e.has("from")?{from:ee(e,"from").format(n)}:{to:ee(e,"to").format(n)};return a.append("update",JSON.stringify(i)),a;case"close":var o=new FormData,l={_id:e.getIn(["_id","$id"],"undefined")};o.append("query",JSON.stringify(l));var s={to:ee(e,"to").format(n)};return o.append("update",JSON.stringify(s)),o;case"delete":var c=new FormData,u={_id:e.getIn(["_id","$id"],"undefined")};return c.append("query",JSON.stringify(u)),c;case"create":var p=new FormData,d=ee(e,"from").format(n),m=e.withMutations(function(e){e.set("from",d).delete("originalValue")});return p.append("update",JSON.stringify(m)),p;case"import":var g=new FormData;return g.append("update",JSON.stringify(e)),g;case"update":var f=new FormData,h={_id:e.getIn(["_id","$id"],"undefined")},v=e.withMutations(function(e){e.delete("_id").delete("originalValue")});return f.append("query",JSON.stringify(h)),f.append("update",JSON.stringify(v)),f;case"closeandnew":var y=new FormData,b=e.withMutations(function(t){var n=ee(e,"originalValue",null);null!==n&&n.isSame(ee(e,"from",S()(0)),"days")&&t.delete("from"),t.delete("_id").delete("originalValue")});y.append("update",JSON.stringify(b));var E={_id:e.getIn(["_id","$id"],"undefined")};return y.append("query",JSON.stringify(E)),y;case"reopen":var C=new FormData,_={_id:te(e,"undefined")},O={from:e.get("from","undefined")};return C.append("query",JSON.stringify(_)),C.append("update",JSON.stringify(O)),C;default:return new FormData}}(t,n)},Cl=function(e,t,n){return function(a){a(Aa());var r=function(e,t,n){return"closeandnew"===n&&ee(t,"from").isSame(ee(t,"originalValue",S()(0)),"day")?"update":"clone"===n?"create":n}(0,t,n),i=El(0,t,r),o=wr(e,r,i);return ir(o,{timeOutMessage:sl}).then(function(e){return a(tr(e))}).catch(function(e){return a(nr(e,"Error saving Entity"))})}},_l=function(e,t){return function(n){return n(Aa()),ir(t,{timeOutMessage:sl}).then(function(t){return n(hl(e,t.data[0].data.details[0])),n(tr(t))}).catch(function(e){return n(nr(e,"Error retreiving Entity"))})}},Ol=function(e,t){return function(n){return n(_l(e,t))}},Sl=function(e,t){return function(n){return n(Cl(e,t,"delete"))}},Tl=function(e,t){return function(n){return n(Cl(e,t,"close"))}},kl=function(e,t,n){return function(a){var r=g.c.Map().withMutations(function(e){e.set("_id",t.get("_id")),"to"===n?e.set("to",t.get("to")):e.set("from",t.get("from"))});return a(Cl(e,r,"move"))}},Il=function(e,t,n){return function(a){var r=g.c.Map({_id:t.get("_id"),from:n});return a(Cl(e,r,"reopen"))}},Nl="LOGOUT",wl=function(e){return Ol("users",function(e){return Rr("users",e)}(e))},jl=function(e,t){return Cl("users",e,t)},Rl=function(e){return function(t){return t(Sl("users",e))}},xl=function(e,t){return{type:ul,collection:"users",path:e,value:t}},Fl=function(e){return{type:pl,collection:"users",path:e}},Pl=function(e){return{type:"LOGIN",data:e}},Ml=function(){return{type:Nl}},Al=function(e,t){return function(n){var a=function(e,t){var n=new FormData;return n.append("username",e),n.append("password",t),{api:"auth",options:{method:"POST",body:n}}}(e,t);return n(Aa()),n({type:"CLEAR_LOGIN_ERROR"}),ir(a).then(function(e){return n(Pl(e.data[0].data.details)),n(Da()),e}).catch(function(e){return n(function(e){return{type:"LOGIN_ERROR",error:e}}("Incorrect username or password, please try again.")),n(Da()),e})}},Dl=function(){return function(e){var t={api:"auth",params:[{action:"logout"}]};return e(Aa()),ir(t).then(function(t){return e(Ml()),e(Da()),ol(),t}).catch(function(t){return e(Da()),ol(),t})}},Ll=function(e){return function(t){t(Aa());var n=function(e){return{api:"passwordretrieval",params:[{action:"sendForm"},{email:e}]}}(e);return ir(n).then(function(e){return t(tr(e,"The email was sent successfuly"))}).catch(function(e){return t(nr(e,"Error sending email"))})}},Ul=function(e,t,n,a){return function(r){r(Aa());var i=function(e,t,n,a){return{action:"changepassword",entity:"users",params:[{query:JSON.stringify({_id:e})},{update:JSON.stringify({password:a})},{_sig_:t},{_t_:n}]}}(e,t,n,a);return ir(i).then(function(e){return r(tr(e,"The password was changed successfuly"))}).catch(function(e){return r(nr(e))})}},Vl=function(e){var t=e.route,n=e.id,a=e.active,i=e.icon,o=e.title,l=e.onSetActive,c=k()({active:a});return r.a.createElement(s.b,{to:"/".concat(t),id:n,className:c,onClick:function(){l(n)}},r.a.createElement("i",{className:i}),r.a.createElement("span",null,o))};Vl.defaultProps={route:"",id:"",active:!1,icon:"",title:"",onSetActive:function(){}};var Bl=Vl,ql=function(e){var t=e.id,n=e.open,a=e.active,i=e.icon,o=e.title,l=e.collapse,s=e.children,c=k()("sub-menu",{open:n}),u=k()({active:!1!==a}),p=r.a.createElement("a",{href:"#id",id:t,onClick:function(n){n.preventDefault(),e.onClick(t)},className:u,key:"main_link"},r.a.createElement("i",{className:i}),r.a.createElement("span",null,o),r.a.createElement("span",{className:"fa arrow"})),d=r.a.createElement("ul",{className:"nav nav-second-level"},s);if(!(l||!n&&!1!==a))return r.a.createElement("li",{className:c},p,d);var m=!1===a?r.a.createElement(f.B,{id:t},r.a.createElement("i",{className:"fa ".concat(i," fa-fw")})," ",o):r.a.createElement(f.B,{id:"".concat(t,"_").concat(a.get("id","open"))},r.a.createElement("span",null,r.a.createElement("i",{className:"fa ".concat(i," fa-fw")})," ",o,"\xa0",r.a.createElement("i",{className:"fa fa-angle-right fa-fw"})," ",a.get("title","")));return r.a.createElement("li",{className:c},r.a.createElement(f.t,{placement:l?"right":"top",overlay:m},p),d)};ql.defaultProps={children:null,id:"",title:"",icon:"",open:!1,active:!1,collapse:!1,onClick:function(){}};var zl=ql,Hl=n(274),Yl=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={startIndex:0,autoStart:!0,run:!1},n.onCancel=function(){n.props.dispatch(uo())},n.onPause=function(){n.props.dispatch(lo())},n.onFinish=function(){n.onStepChanged(0),n.props.dispatch(co())},n.onPending=function(){n.onStepChanged(0),n.props.dispatch(oo()),n.setState({autoStart:!0})},n.onStart=function(){n.props.dispatch(so())},n.onRestart=function(){n.onStepChanged(0),n.onStart(),n.setState({autoStart:!0})},n.onStepChanged=function(e){n.props.dispatch(io(e))},n.switchToRun=function(){n.setState({run:!0})},n.askCancel=function(){var e={message:"Are you sure you want to skip the tour ?",onOk:n.onCancel,labelOk:"Skip tour",type:"delete"};n.props.dispatch(po(e))},n.getSteps=function(){return[{title:"1. Customer details",text:r.a.createElement("span",null,"Customer name, id and address. Invoices are generated per customer.",r.a.createElement("br",null),r.a.createElement(s.b,{to:"customers/customer",onClick:n.onPause},"Click here to create a customer")),style:{beacon:{offsetY:-75}},selector:".table-info",type:"click"},{title:"2. Plans",text:r.a.createElement("span",null,"A customer can have multiple subscriptions, each one tied to exactly one plan with recurring charges.",r.a.createElement("br",null),r.a.createElement(s.b,{to:"plans/plan",onClick:n.onPause},"Click here to create a plan")),style:{beacon:{offsetY:-25}},selector:".step-plan",type:"click"},{title:"3. Services",text:r.a.createElement("span",null,"Every subscription can register to extra services that are charged periodically.",r.a.createElement("br",null),r.a.createElement(s.b,{to:"services/service",onClick:n.onPause},"Click here to create a service")),style:{beacon:{offsetY:-25}},selector:".step-service",type:"click"},{title:"4. Discounts",text:r.a.createElement("span",null,"Build automatic discounts based on various combinations on subscription plans / services.",r.a.createElement("br",null),r.a.createElement(s.b,{to:"discounts/discount",onClick:n.onPause},"Click here to create a discount")),style:{beacon:{offsetY:-25}},selector:".step-discount",type:"click"},{title:"5. Subscription details",text:r.a.createElement("span",null,"This section appears for every subscription of the customer and shows aggregated amounts in the subscription level."),style:{beacon:{offsetY:-25}},selector:".step-subscription-details",type:"click"},{title:"6. Usage details",text:r.a.createElement("span",null,"If billing also by usage, the usage details can be included in the invoice (optional).",r.a.createElement("br",null),"BillRun's input processors can receive events either in online (HTTP request) or offline (files) mode.",r.a.createElement("br",null),r.a.createElement(s.b,{to:{pathname:"/select_input_processor_template",query:{action:"new"}},onClick:n.onPause},"Click here to set up an input processor")),style:{beacon:{offsetY:-25}},selector:".table-usage",type:"click"},{title:"7. Products",text:r.a.createElement("span",null,"You can create different products which define pricing rules based on various usage events.",r.a.createElement("br",null),r.a.createElement(s.b,{to:"/products/product",onClick:n.onPause},"Click here to create a product")),style:{beacon:{offsetY:-25}},selector:".step-products",type:"click"},{title:"8. Company details",text:r.a.createElement("span",null,"Your company logo, name, address, etc. appear at the invoice header & footer.",r.a.createElement("br",null),r.a.createElement(s.b,{to:{pathname:"/settings",query:{tab:1}},onClick:n.onPause},"Set up your company details here")),style:{beacon:{offsetY:-25}},selector:".step-company-details-header",type:"click"},{title:"9. Billing cycle management",text:r.a.createElement("span",null,"You are in full control of the billing cycle run. See the billing cycle run progress as it runs and watch invoices as soon as they're created. Confirm or reset the cycle after reviewing it and charge your customers, all functionalities available from one screen!",r.a.createElement("br",null),r.a.createElement(s.b,{to:"run_cycle",onClick:n.onPause},"Go to billing cycle management screen")),style:{beacon:{offsetY:-65}},selector:".step-period",type:"click"}]},n.joyrideEventHandler=function(e){var t=n.props.step;if(["close"].includes(e.action)||"finished"!==e.type)if("error:target_not_found"===e.type){var a="next"===e.action?e.index+1:e.index-1;n.setState({startIndex:a}),n.onStepChanged(a)}else if("close"===e.action&&"finished"===e.type){var r=Math.max(e.steps.length-2,0);n.setState({startIndex:r,run:!0,autoStart:!1})}else"start"===e.action?0!==t&&n.setState({startIndex:t}):"next"===e.action&&"step:before"===e.type?n.onStepChanged(e.index):"back"===e.action&&"step:after"===e.type&&n.onStepChanged(e.index-1);else n.onFinish()},n.renderIsReadyContent=function(){return r.a.createElement(f.x,null,r.a.createElement(f.g,{smPush:1,sm:10},r.a.createElement("p",null,"In this short tutorial we will walk you through the main features of BillRun by examining a sample BillRun invoice and guiding you how to do it yourself with just a few clicks.")),r.a.createElement(f.g,{smPush:1,sm:10},r.a.createElement(f.c,{onClick:n.onStart,bsStyle:"success"},"Let's start the tour!")))},n.renderIsFinishedContent=function(){return r.a.createElement(f.x,null,r.a.createElement(f.g,{smPush:1,sm:10},r.a.createElement("p",null,"We're done!"),r.a.createElement("p",null,"Thank you for taking the tour!")),r.a.createElement(f.g,{smPush:1,sm:10},r.a.createElement(f.c,{onClick:n.onPending,bsStyle:"success"},"Start Using Billrun!")))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e,t){var n=this.props,a=n.isPaused,r=n.isRunnig,i=this.state.autoStart;(a&&!e.isPaused||!r&&e.isRunnig)&&(i||t.autoStart?setTimeout(this.switchToRun,500):this.switchToRun()),e.isRunnig||this.setState({startIndex:0})}},{key:"render",value:function(){var e=this.props,t=e.isRunnig,n=e.isFinished,a=e.isStarting,i=e.mobalTitle,o=this.state,l=o.startIndex,s=o.autoStart,c=o.run;return a?r.a.createElement(Ye,{show:!0,title:i,labelCancel:"Maybe later",onCancel:this.onPending,onHide:this.onPending},r.a.createElement("div",{className:"text-center"},this.renderIsReadyContent())):t?r.a.createElement(Hl.a,{type:"continuous",showStepsProgress:!1,scrollToFirstStep:!0,scrollToSteps:!0,disableOverlay:!0,showOverlay:!0,debug:!1,stepIndex:l,steps:this.getSteps(),run:c,autoStart:s,callback:this.joyrideEventHandler}):n?r.a.createElement(Ye,{show:!0,title:i,labelCancel:"Start Tour Again",onCancel:this.onRestart,onHide:this.onPending},r.a.createElement("div",{className:"text-center"},this.renderIsFinishedContent())):null}}]),t}(a.Component);Yl.defaultProps={step:0,isRunnig:!1,isFinished:!1,isStarting:!1,isPaused:!1,mobalTitle:r.a.createElement("span",null,"Welcome to BillRun",r.a.createElement("i",{className:"fa fa-registered",style:{fontSize:12,verticalAlign:"text-top"}}),"\xa0Cloud!")};var Gl=Object(l.connect)(function(e){return{isRunnig:yo(e),isFinished:bo(e),isStarting:_o(e),isPaused:Co(e),step:vo(e)}})(Yl),Kl=function(e){var t=e.isRunnig,n=e.isReady,a=e.isPaused,i=e.eventKeyBase,o=e.onRun,l=e.onStart;return n?r.a.createElement(f.q,{eventKey:i,onClick:l,active:!1},"Start Tour"):a?r.a.createElement(f.q,{eventKey:i,onClick:o,className:"running",active:!0},r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-play fa-fw"})," Resume Tour")):t?r.a.createElement(f.q,{eventKey:i,className:"running",active:!0},"You are in  tour"):null};Kl.defaultProps={eventKeyBase:1,isRunnig:!1,isReady:!1,isPaused:!1,onRun:function(){},onStart:function(){}};var Wl=Kl,Jl=Object(l.connect)(function(e){return{isRunnig:yo(e),isReady:Eo(e),isPaused:Co(e)}},function(e){return{onRun:function(){e(so())},onStart:function(){e({type:"SET_ON_BOARDING_STATE",state:to})}}})(Wl),Ql=n(259),$l=n.n(Ql),Zl=n(260),Xl=n.n(Zl),es=function(e){var t=e.page,n=e.total;return r.a.createElement("div",{className:"section section-header"},r.a.createElement("div",{className:"table"},r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"step-company-details-header"},r.a.createElement("img",{src:Xl.a,alt:"logo",style:{width:60,objectFit:"contain"}}),"\xa0\xa0Company Name"),r.a.createElement("td",null,r.a.createElement("div",{className:"paging"},"page ",r.a.createElement("span",{className:"page"},t)," of ",r.a.createElement("span",{className:"topage"},n))))))))};es.defaultProps={page:1,total:1};var ts=es,ns=n(261),as=n.n(ns),rs=n(262),is=n.n(rs),os=n(263),ls=n.n(os),ss=n(264),cs=n.n(ss),us=n(265),ps=n.n(us),ds=n(165),ms=n.n(ds),gs=(n(422),n(423),function(){return r.a.createElement("div",{className:"invoice-help"},r.a.createElement(ts,{page:"1",total:"2"}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:as.a}}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:ls.a}}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:ms.a}}),r.a.createElement("hr",{className:"page-separator"}),r.a.createElement(ts,{page:"2",total:"2"}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:is.a}}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:cs.a}}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:ps.a}}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:ms.a}}))});gs.defaultProps={};var fs=gs,hs=function(e){var t=e.onPause,n=e.onStop;return r.a.createElement($l.a,{onEscape:t},r.a.createElement("div",{className:"ExampleInvoice"},r.a.createElement("div",{className:"invoice-page-modal"}),r.a.createElement("div",{className:"invoice-page-wrapper"},r.a.createElement("div",{className:"clearfix",style:{marginBottom:25}},r.a.createElement("div",{className:"pull-left"},r.a.createElement("h4",{style:{margin:0}},"Example Invoice")),r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.c,{bsStyle:"link",onClick:t,className:"close"},r.a.createElement("i",{className:"fa fa-times",style:{color:"#222222",fontSize:16,marginTop:-10,marginRight:-10}})))),r.a.createElement(fs,null),r.a.createElement("hr",null),r.a.createElement(v,{saveLabel:"Pause",onClickSave:t,cancelLabel:"End Tour",onClickCancel:n}))))};hs.defaultProps={onPause:function(){},onStop:function(){}};var vs=hs,ys=Object(l.connect)(null,function(e){return{onPause:function(){e(lo())},onStop:function(){var t=function(){e(io(0)),e(oo())};e(po({message:"Are you sure you want to end the tour ?",onOk:t,labelOk:"End tour",labelCancel:"Continue tour",type:"delete"}))}}})(vs),bs=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showCollapseButton:!1,openSmallMenu:!1,openSubMenu:[]},n.setOpenMenusItems=function(){var e=n.props,t=e.router,a=e.menuItems,r=n.state.openSubMenu;a.filter(n.filterEnabledMenu).filter(n.filterPermission).forEach(function(e){e.get("subMenus",g.c.List()).filter(function(e){return t.isActive(e.get("route",""))}).size>0&&n.setState({openSubMenu:[].concat(Object(w.a)(r),[e.get("id")])})})},n.onWindowResize=function(){var e=window.innerWidth<768;n.state.showCollapseButton!==e&&n.setState({showCollapseButton:e,openSmallMenu:!e})},n.onCollapseSidebar=function(){n.props.dispatch(Do())},n.onSetActive=function(){n.setState({openSmallMenu:!1})},n.onToggleSubMenu=function(e){var t=n.state.openSubMenu,a=t.includes(e)?t.filter(function(t){return t!==e}):[].concat(Object(w.a)(t),[e]);n.setState({openSubMenu:a}),n.props.dispatch(Do(!1))},n.toggleSmallMenu=function(){n.setState({openSmallMenu:!n.state.openSmallMenu})},n.resetMenuActive=function(){n.onSetActive("")},n.clickLogout=function(e){e.preventDefault(),n.props.dispatch(Dl()).then(function(){n.props.router.push("/")})},n.filterEnabledMenu=function(e){return e.get("show",!1)},n.filterHiddenMenu=function(e,t){return!n.props.hiddenItems.includes(e.get("id",""))},n.filterPermission=function(e){var t=n.props.userRoles,a=e.get("roles",g.c.List());return 0===a.size||(!!t.includes("admin")||a.toSet().intersect(t).size>0)},n.renderSubMenu=function(e,t){var a=n.props,i=a.router,o=a.collapseSideBar,l=n.state.openSubMenu,s=e.get("id",""),c=e.get("icon",""),u=e.get("title",""),p=e.get("subMenus",g.c.List()).filter(n.filterEnabledMenu).filter(n.filterHiddenMenu).filter(n.filterPermission),d=p.filter(function(e){return i.isActive(e.get("route",""))}),m=l.includes(s);return r.a.createElement(zl,{key:t,active:d.get(0,!1),icon:"fa ".concat(c," fa-fw"),id:s,onClick:n.onToggleSubMenu,open:m,title:u,collapse:o},p.map(n.renderMenu))},n.renderMenu=function(e,t){return e.get("subMenus")?n.renderSubMenu(e,t):n.renderMenuItem(e,t)},n.renderMenuItem=function(e,t){var a=n.props,i=a.router,o=a.collapseSideBar,l=e.get("id",""),s=e.get("icon",""),c=e.get("title",""),u=e.get("route",""),p=o,d=r.a.createElement("li",{key:t},r.a.createElement(Bl,{active:i.isActive(u),icon:"fa ".concat(s," fa-fw"),id:l,onSetActive:n.onSetActive,route:u,title:c}));if(!p)return d;var m=""===s?r.a.createElement(f.B,{id:"".concat(l,"_").concat(t)},c):r.a.createElement(f.B,{id:"".concat(l,"_").concat(t)},r.a.createElement("i",{className:"fa ".concat(s," fa-fw")})," ",c);return r.a.createElement(f.t,{key:"".concat(l,"_").concat(t),placement:o?"right":"top",overlay:m},d)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.onWindowResize(),window.addEventListener("resize",this.onWindowResize)}},{key:"componentDidMount",value:function(){this.setOpenMenusItems()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.routes,a=t.collapseSideBar,r=e.routes[e.routes.length-1].path,i=n[n.length-1].path;a||r===i||this.setOpenMenusItems()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onWindowResize)}},{key:"render",value:function(){var e=this.state,t=e.showCollapseButton,n=e.openSmallMenu,a=this.props,i=a.userName,o=a.companyNeme,l=a.menuItems,c=a.logo,u=a.collapseSideBar,p=a.router,d=k()("navbar","navbar-default","navbar-fixed-top",{"collapse-sizebar":u,"small-screen-menu":t}),m=k()("navbar-default","sidebar","main-menu","scrollbox",{"small-screen-menu":t&&n}),g=k()("nav","navbar-top-links","navbar-right",{"small-screen-menu":t});return r.a.createElement("nav",{className:d,id:"top-nav",role:"navigation"},t&&r.a.createElement("button",{type:"button",className:"navbar-toggle",onClick:this.toggleSmallMenu,style:{position:"absolute",right:0,top:0}},r.a.createElement("span",{className:"sr-only"},"Toggle navigation"),r.a.createElement("span",{className:"icon-bar"}),r.a.createElement("span",{className:"icon-bar"}),r.a.createElement("span",{className:"icon-bar"})),r.a.createElement("div",{className:"navbar-header"},r.a.createElement(s.b,{to:"/",className:"navbar-brand",onClick:this.resetMenuActive},r.a.createElement("img",{src:c,style:{height:22},alt:"Logo"}),r.a.createElement("span",{className:"brand-name"},o)),!t&&r.a.createElement(f.c,{bsSize:"xsmall",id:"btn-collapse-menu",onClick:this.onCollapseSidebar},r.a.createElement("i",{className:"fa fa-chevron-left"}),r.a.createElement("i",{className:"fa fa-chevron-left"}))),r.a.createElement("ul",{className:g},r.a.createElement(Jl,{eventKeyBase:2}),r.a.createElement(f.s,{id:"nav-user-menu",eventKey:1,title:r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-user fa-fw"}),i)},r.a.createElement(f.q,{eventKey:1.1,href:"#about",active:p.isActive("about")},r.a.createElement("i",{className:"fa fa-question-circle fa-fw"})," About"),r.a.createElement(f.q,{eventKey:1.2,onClick:this.clickLogout},r.a.createElement("i",{className:"fa fa-sign-out fa-fw"})," Logout"))),(!t||t&&n)&&r.a.createElement("div",{className:m,role:"navigation"},r.a.createElement("div",{className:"sidebar-nav"},r.a.createElement("ul",{className:"nav in",id:"side-menu"},l.filter(this.filterEnabledMenu).filter(this.filterHiddenMenu).filter(this.filterPermission).map(this.renderMenu)))))}}]),t}(a.Component);bs.defaultProps={companyNeme:"",userName:"",menuItems:g.c.List(),userRoles:[],collapseSideBar:!1,routes:[],hiddenItems:[]};var Es=Object(s.f)(Object(l.connect)(function(e){return{companyNeme:e.settings.get("tenant",g.c.Map()).get("name"),userName:e.user.get("name")||void 0,menuItems:e.guiState.menu.get("main")||void 0,collapseSideBar:e.guiState.menu.get("collapseSideBar")||void 0,userRoles:e.user.get("roles")||void 0,logo:e.settings.getIn(["files","logo"])||void 0}})(bs)),Cs=n(266),_s=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).handleAlertDismiss=function(){var e=n.props.alert.id;n.props.handleAlertDismiss(e)},n.autoHideTimer=null,n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.alert.timeout,n=e.transitioTime;t>0&&(clearTimeout(this.autoHideTimer),this.autoHideTimer=setTimeout(this.handleAlertDismiss,t+n))}},{key:"componentWillUnmount",value:function(){clearTimeout(this.autoHideTimer)}},{key:"render",value:function(){var e=this.props.alert,t=e.type,n=e.message,a=[La,Va,Ba,Ua].includes(t)?t:Ba;return r.a.createElement(f.a,{bsStyle:a,onDismiss:this.handleAlertDismiss},r.a.createElement("div",null,n))}}]),t}(a.Component);_s.defaultProps={transitioTime:0};var Os=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleAlertsDismiss=function(){n.props.hideAllAlerts()},n.handleAlertDismiss=function(e){n.props.hideAlert(e)},n.renderClearAll=function(){return r.a.createElement("div",{style:{textAlign:"right"}},r.a.createElement(f.c,{onClick:n.handleAlertsDismiss},n.props.clearAllButtobLabel))},n.renderAlert=function(e){var t=n.props,a=t.enterTimeout,i=t.exitTimeout;return r.a.createElement(_s,{alert:e,handleAlertDismiss:n.handleAlertDismiss,key:e.get("id"),transitioTime:a+i+100})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.enterTimeout,n=e.exitTimeout,a=e.alerts,i=e.showClearAllButton,o=a.map(this.renderAlert);return r.a.createElement(Cs.CSSTransition,{timeout:{enter:t,exit:n},classNames:"alerts"},r.a.createElement("div",{className:"alert-notifier-container"},o,i&&o.size>1&&this.renderClearAll()))}}]),t}(a.Component);Os.defaultProps={alerts:g.c.List(),clearAllButtobLabel:"Clear All",showClearAllButton:!0,enterTimeout:500,exitTimeout:300};var Ss={hideAllAlerts:function(){return{type:qa}},hideAlert:function(e){return{type:za,id:e}}},Ts=Object(l.connect)(function(e){return{alerts:e.alerts}},Ss)(Os),ks=function(){return r.a.createElement(f.g,{md:12,style:{textAlign:"center",marginTop:50}},r.a.createElement("i",{className:"fa fa-frown-o fa-fw",style:{fontSize:70}}),r.a.createElement("h3",{style:{color:"#777"}},"404"),r.a.createElement("h5",{style:{color:"#777"}},"The page you are looking for cannot be found"),r.a.createElement("br",null),r.a.createElement("p",null,r.a.createElement(s.b,{to:"/"},"Return to home page")))},Is=function(){return r.a.createElement(f.g,{md:12,style:{textAlign:"center",marginTop:50}},r.a.createElement("i",{className:"fa fa-frown-o fa-fw",style:{fontSize:70}}),r.a.createElement("h3",{style:{color:"#777"}},"403"),r.a.createElement("h5",{style:{color:"red"}},"You don't have permission to access this page"),r.a.createElement("br",null),r.a.createElement("p",null,r.a.createElement(s.b,{to:"/"},"Return to home page")))},Ns=Object(l.connect)(null,function(e){return{logout:e(Dl())}})(function(e){var t=e.logout;return r.a.createElement(f.g,{md:12,style:{textAlign:"center",marginTop:50}},r.a.createElement("i",{className:"fa fa-smile-o fa-fw",style:{fontSize:70}}),r.a.createElement("h5",{style:{color:"#777"}},"You already logged in"),r.a.createElement("br",null),r.a.createElement("p",null,r.a.createElement(s.b,{to:"/"},"Return to home page"),"or",r.a.createElement(f.c,{variant:"link",onClick:t},r.a.createElement("i",{className:"fa fa-sign-out fa-fw"}),"Logout")))}),ws=function(e){var t=e.onIgnore;return r.a.createElement(f.g,{md:12,style:{textAlign:"center",marginTop:50}},r.a.createElement("i",{className:"fa fa-heartbeat fa-fw",style:{fontSize:70}}),r.a.createElement("h3",{style:{color:"#777"}},"500"),r.a.createElement("h5",{style:{color:"red"}},"Something went wrong."),r.a.createElement("br",null),r.a.createElement("p",null,r.a.createElement(f.c,{bsStyle:"link",onClick:function(){return window.location.reload()}},"Reload page"),"or",r.a.createElement(f.c,{bsStyle:"link",onClick:function(){return window.location="/"}},"Return to home page"),t&&r.a.createElement("span",null,"or",r.a.createElement(f.c,{bsStyle:"link",onClick:t},"Ignore error and continue"))))};ws.defaultProps={onIgnore:null};var js=Y(["env","billrunCloudLogo"],Y(["env","billrunLogo"],"")),Rs="".concat("","/assets/img/").concat(js),xs=Y(["env","mailSupport"],""),Fs=function(){return r.a.createElement("div",{style:{marginTop:"10%",textAlign:"center"}},r.a.createElement(f.u,null,"Welcome to ",r.a.createElement("img",{alt:"BillRun Cloud",title:"BillRun Cloud",src:Rs,style:{height:50,marginBottom:20}})),""!==xs&&r.a.createElement("p",null,"For any support topics please contact",r.a.createElement("br",null),r.a.createElement("a",{href:"mailto:".concat(xs)},xs)))},Ps=Y(["env","billrunCloudLogo"],Y(["env","billrunLogo"],"")),Ms="".concat("","/assets/img/").concat(Ps),As=Y(["env","serverApiVersion"],""),Ds=function(){return r.a.createElement("div",{style:{marginTop:20,textAlign:"left"}},""!==Ps&&r.a.createElement("img",{alt:"BillRun Cloud",title:"BillRun Cloud",src:Ms,style:{height:25,marginBottom:20}}),""!==As&&r.a.createElement("h5",null,"version ",r.a.createElement("strong",null,As)))},Ls="".concat("","/assets/img/").concat(Y(["env","billrunLogo"],"")),Us=function(){return r.a.createElement("div",{id:"footer"},r.a.createElement("div",null,r.a.createElement("p",{className:"muted credit"},r.a.createElement("span",{style:{verticalAlign:"middle",marginRight:5}},r.a.createElement("small",null,"Powered by")),r.a.createElement("a",{href:"http://bill.run/",target:"_blank",rel:"noreferrer noopener powered-by"},r.a.createElement("img",{src:Ls,style:{height:20},alt:"Logo"})))))},Vs=function(e){var t=e.show,n=e.sending,i=e.onCancel,o=e.updateSending,l=e.onResetPass,s=Object(a.useState)(""),c=Object(Ti.a)(s,2),u=c[0],p=c[1],d=Object(a.useState)(""),m=Object(Ti.a)(d,2),g=m[0],h=m[1],v=n?"Sending":"Reset",y=k()("fa",{"fa-envelope-o":!n,"fa-spinner fa-pulse":n});return r.a.createElement(Ye,{title:"Reset Password",show:t,closeButton:!0,onHide:i},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{validationState:""!==g?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Email"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(f.k,{type:"text",name:"mail",onChange:function(e){p(e.target.value),h("")},value:u,disabled:n}),r.a.createElement(f.n,null,"The email you registered as username"),""!==g&&r.a.createElement(f.n,null,g))),r.a.createElement(f.c,{bsStyle:"success",bsSize:"lg",block:!0,onClick:function(){if(""===u)return h("Email is required"),!1;o(!0),l(u)},disabled:n},r.a.createElement("i",{className:y}),"\xa0",v)))};Vs.defaultProps={show:!0,sending:!1};var Bs=Vs,qs=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={username:"",password:"",error:"",progress:!1,resetPassword:!1,sending:!1},n.clickLogin=function(e){var t=n.state,a=t.username,r=t.password;n.setState({progress:!0}),e.preventDefault(),n.props.dispatch(Al(a,r)).then(function(){!0!==n.unmounted&&n.setState({progress:!1})})},n.clickResetPassword=function(){n.setState({resetPassword:!0})},n.onChangeUsername=function(e){var t=e.target.value;n.setState({username:t,error:""})},n.onChangePassword=function(e){var t=e.target.value;n.setState({password:t,error:""})},n.onCancel=function(){n.setState({resetPassword:!1})},n.updateSending=function(e){n.setState({sending:e})},n.onResetPass=function(e){n.props.dispatch(Ll(e)).then(n.afterSendingMail)},n.afterSendingMail=function(){n.setState({sending:!1}),n.setState({resetPassword:!1})},n.renderLoginForm=function(){var e=n.state,t=e.error,a=e.progress,i=e.resetPassword,o=e.sending;return r.a.createElement(f.g,{md:4,mdOffset:4},r.a.createElement(f.v,{header:"Please Sign In",className:"login-panel"},r.a.createElement(f.j,{onSubmit:n.clickLogin},r.a.createElement("fieldset",null,r.a.createElement(f.l,{validationState:t.length>0?"error":null},r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement("i",{className:"fa fa-user fa-fw"})),r.a.createElement(f.k,{autoFocus:!0,type:"text",placeholder:"Email address",value:n.state.username,onChange:n.onChangeUsername}))),r.a.createElement(f.l,{validationState:t.length>0?"error":null},r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement("i",{className:"fa fa-key fa-fw"})),r.a.createElement(f.k,{type:"password",placeholder:"Password",value:n.state.password,onChange:n.onChangePassword}))),r.a.createElement(f.c,{type:"submit",bsStyle:"success",bsSize:"large",block:!0,onClick:n.clickLogin,disabled:a},a&&r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-spinner fa-pulse"})," \xa0\xa0\xa0"),"Login"))),t.length>0&&r.a.createElement(f.a,{bsStyle:"danger",style:{marginTop:15},className:"mb0"},t),r.a.createElement(f.c,{type:"button",bsStyle:"link",bsSize:"small",block:!0,onClick:n.clickResetPassword,disabled:a},"Forgot Your Password?")),i&&r.a.createElement(Bs,{sending:o,updateSending:n.updateSending,onCancel:n.onCancel,onResetPass:n.onResetPass}))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.state.error!==e.error&&this.setState({error:e.error})}},{key:"componentWillUnmount",value:function(){this.unmounted=!0}},{key:"render",value:function(){return this.props.auth?r.a.createElement(Ns,null):r.a.createElement(f.x,null,this.renderLoginForm())}}]),t}(a.Component);qs.defaultProps={auth:!1,error:""};var zs=Object(l.connect)(function(e){return{auth:e.user.get("auth"),error:e.user.get("error")}})(qs),Hs=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={password:"",password1:"",error:"",sending:!1},n.validate=function(){var e=n.state,t=e.password;return t===e.password1&&""!==t},n.onPasswordChange=function(e){var t=n.state.password1,a=e.target.value.trim(),r="";a.length<1?r="Password is required":t.length>0&&a!==t&&(r="Passwords do not match"),n.setState({error:r,password:a})},n.onPassword1Change=function(e){var t=n.state.password,a=e.target.value.trim(),r="";a.length<1?r="Please fill confirm password":a!==t&&(r="Passwords do not match"),n.setState({error:r,password1:a})},n.onSavePassword=function(e){e.preventDefault();var t=n.props,a=t.itemId,r=t.signature,i=t.timestamp,o=n.state.password;n.validate()&&(n.setState({sending:!0}),n.props.dispatch(Ul(a,r,i,o)).then(n.afterSave))},n.afterSave=function(e){n.setState({sending:!1}),1===e.status&&n.props.router.push("/login")},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){!0===this.props.auth&&this.props.router.push("/")}},{key:"render",value:function(){var e=this.state,t=e.password,n=e.password1,a=e.error,i=e.sending,o=this.props.username,l=a.length>0||a.length>0;return r.a.createElement(f.g,{md:4,mdOffset:4},r.a.createElement(f.v,{header:"Reset Password",className:"login-panel"},r.a.createElement(f.j,null,r.a.createElement("fieldset",null,r.a.createElement(f.l,null,r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement("i",{className:"fa fa-user fa-fw"})),r.a.createElement(en,{value:o,disabled:!0}))),r.a.createElement(f.l,{validationState:l?"error":null},r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement("i",{className:"fa fa-key fa-fw"})),r.a.createElement(f.k,{autoFocus:!0,type:"password",placeholder:"New password",value:t,onChange:this.onPasswordChange,disabled:i,style:{borderBottom:0}}),r.a.createElement(f.k,{type:"password",placeholder:"Confirm new password",value:n,onChange:this.onPassword1Change,disabled:i})),a.length>0&&r.a.createElement(f.n,null,a))),r.a.createElement(f.c,{type:"submit",bsStyle:"primary",bsSize:"lg",block:!0,onClick:this.onSavePassword,disabled:i},i&&r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-spinner fa-pulse"})," \xa0"),"Save"))))}}]),t}(a.Component);Hs.defaultProps={auth:!1,itemId:"",signature:"",timestamp:"",username:""};var Ys=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:pi(e,t),signature:li(e,t),timestamp:ii(e,t),username:oi(e,t),auth:e.user.get("auth")}})(Hs)),Gs=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){!0===this.props.auth&&this.props.router.push("/")}},{key:"render",value:function(){return r.a.createElement(zs,null)}}]),t}(a.Component);Gs.defaultProps={auth:!1};var Ks=Object(s.f)(Object(l.connect)(function(e){return{auth:e.user.get("auth")}})(Gs)),Ws=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).getView=function(){var e=n.props,t=e.auth,a=e.systemRequirementsLoad,r="waiting";switch(!1===t?r="noLogin":a&&!0===t&&(r="ready"),r){case"ready":return n.renderWithLayout();case"noLogin":return n.renderWithoutLayout();default:return n.renderAppLoading()}},n.renderAppLoading=function(){var e=n.props.logo;return r.a.createElement("div",null,r.a.createElement(rn,null),r.a.createElement(Ts,null),r.a.createElement("div",{className:"container"},r.a.createElement(f.g,{md:4,mdOffset:4},r.a.createElement("div",{style:{marginTop:"33%",textAlign:"center"}},r.a.createElement("img",{alt:"logo",src:e,style:{height:50}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("p",null,"Loading...")))))},n.renderWithoutLayout=function(){return r.a.createElement("div",null,r.a.createElement(rn,null),r.a.createElement(Ts,null),r.a.createElement("div",{className:"container"},n.props.children))},n.renderWithLayout=function(){var e=n.props,t=e.title,a=e.children,i=e.routes,o=e.isTourRunnig,l="CSI"===e.taxType?["tax"]:[];return r.a.createElement("div",{id:"wrapper"},r.a.createElement(rn,null),r.a.createElement(xo,null),r.a.createElement(Ao,null),r.a.createElement(Ts,null),r.a.createElement(Gl,null),r.a.createElement(Es,{routes:i,hiddenItems:l}),r.a.createElement("div",{id:"page-wrapper",className:"page-wrapper"},o&&r.a.createElement(ys,null),r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},t&&r.a.createElement(f.u,null,t))),r.a.createElement("div",null,a),r.a.createElement("div",{id:"footer-push"})),r.a.createElement(Us,null))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(function(e){var t={api:"auth"};return e(Aa()),ir(t).then(function(t){return e(Pl(t.data[0].data.details)),e(Da()),t}).catch(function(t){return e(Ml()),e(Da()),t})})}},{key:"componentDidMount",value:function(){var e=this.props,t=e.routes,n=e.title,a=t[t.length-1].title||n;a.length&&this.props.dispatch(ro(a))}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.props,a=n.title,r=n.auth;null===n.mainMenuOverrides&&null!==e.mainMenuOverrides&&this.props.dispatch(Lo(e.mainMenuOverrides));var i=e.routes[e.routes.length-1].title;"undefined"!==typeof i&&i!==a&&this.props.dispatch(ro(i)),!0!==r&&!0===e.auth&&this.props.dispatch(il(["pricing","tenant","menu","billrun","usage_types","property_types","plays","taxation"])).then(function(e){return e?t.props.logoName:""}).then(function(e){return!(e&&e.length>0)||t.props.dispatch(al({filename:e},"logo"))}).then(function(){t.props.dispatch({type:$i})})}},{key:"render",value:function(){return r.a.createElement("div",null,this.getView())}}]),t}(a.Component);Ws.displayName="App",Ws.defaultProps={mainMenuOverrides:null,auth:null,title:"",logoName:"",taxType:"",systemRequirementsLoad:!1,isTourRunnig:!1};var Js=Object(s.f)(Object(l.connect)(function(e){return{auth:e.user.get("auth"),title:e.guiState.page.get("title"),systemRequirementsLoad:e.guiState.page.get("systemRequirementsLoad"),mainMenuOverrides:e.settings.getIn(["menu","main"]),logo:e.settings.getIn(["files","logo"]),logoName:e.settings.getIn(["tenant","logo"]),isTourRunnig:yo(e),taxType:Tn(e)}})(Ws)),Qs=function(e){var t=function(t){function n(){return Object(c.a)(this,n),Object(p.a)(this,Object(d.a)(n).apply(this,arguments))}return Object(m.a)(n,t),Object(u.a)(n,[{key:"render",value:function(){var t=this.props,n=t.auth,a=t.roles,i=t.permissions,o=t.action,l=t.location,s=Object(pt.a)(t,["auth","roles","permissions","action","location"]);if(!a||!n)return r.a.createElement(zs,null);if(0===i.size)return null;if(a.includes("admin"))return r.a.createElement(e,Object.assign({},s,{location:l}));var c=l.pathname.substr(1),u=i.getIn([c,o],g.c.List());return 0===u.size?r.a.createElement(e,Object.assign({},s,{location:l})):0===u.toSet().intersect(a).size?r.a.createElement(Is,{location:l}):r.a.createElement(e,Object.assign({},s,{location:l}))}}]),n}(a.Component);t.defaultProps={auth:null,roles:null,permissions:g.c.Map(),action:"view"};return Object(l.connect)(function(e,t){return{auth:e.user.get("auth"),roles:e.user.get("roles"),permissions:wo(e),action:vi(e,t)}})(t)},$s=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={hasError:!1},n.onClickAskCloseImport=function(){n.setState(function(){return{hasError:!1}})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidCatch",value:function(e,t){0}},{key:"render",value:function(){return this.state.hasError,this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),t}(a.Component),Zs=n(166),Xs=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).getRowAction=function(e,t,a){var r=n.props.actions.filter(function(n){var a="undefined"!==typeof n.onClickColumn,r=n.onClickColumn===e.id,i=n.onClickColumn===t;return a&&(r||i)});return 0!==r.length&&r.reduce(function(e,t){if(!1===e){if("undefined"===typeof t.onClick)return!1;if("undefined"!==typeof t.enable)if(!("function"===typeof t.enable?t.enable(a):t.enable))return!1;if("undefined"!==typeof t.show)if(!("function"===typeof t.show?t.show(a):t.show))return!1;return t.onClick}return e},!1)},n.onClickHeader=function(e){var t=-1*n.props.sort.get(e,1);n.props.onSort(Object(vr.a)({},e,t))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"displayByType",value:function(e,t){switch(e.type){case"date":return r.a.createElement(ot,{value:S()(t.get(e.id,0)),format:Y("dateFormat","DD/MM/YYYY")});case"time":case"datetime":return S()(t.get(e.id,0)).format(Y("datetimeFormat","DD/MM/YYYY HH:mm"));case"mongodate":return S.a.unix(t.getIn([e.id,"sec"],0)).format(Y("dateFormat","DD/MM/YYYY"));case"mongotime":case"mongodatetime":return S.a.unix(t.getIn([e.id,"sec"],0)).format(Y("datetimeFormat","DD/MM/YYYY HH:mm"));case"timestamp":return S.a.unix(t.get(e.id,0)).format(Y("datetimeFormat","DD/MM/YYYY HH:mm"));case"fullDate":return S.a.unix(t.getIn([e.id,"sec"])).format(Y("datetimeLongFormat","DD/MM/YYYY HH:mm:ss"));case"text":default:return t.get(e.id,"")}}},{key:"printEntityField",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1?arguments[1]:void 0;return g.c.Iterable.isIterable(e)?t.parser?t.parser(e,t):this.displayByType(t,e):this.printEntityField(g.c.fromJS(e),t)}},{key:"buildRow",value:function(e,t){var n=this,a=this.props,i=a.onClickEdit,o=a.edit;return t.map(function(a,l){if(!1===a.display)return null;var s,c=n.getRowAction(a,l,e);return s=c?r.a.createElement("button",{className:"btn btn-link",onClick:c.bind(n,e)},n.printEntityField(e,a)):o&&(0===l&&"state"!==a.id||1===l&&"state"===t[0].id)?r.a.createElement("button",{className:"btn btn-link",onClick:i.bind(n,e)},n.printEntityField(e,a)):n.printEntityField(e,a),r.a.createElement("td",{key:l,className:a.cssClass},s)})}},{key:"render",value:function(){var e=this,t=this.props,n=t.sort,a=t.items,i=t.fields,o=void 0===i?[]:i,l=t.onClickEdit,s=t.edit,c=void 0!==s&&s,u=t.editText,p=t.className,d=t.enableRemove,m=t.onClickRemove,g=t.enableEnabled,h=t.onClickEnabled,v=t.actions,y=o.map(function(t,a){var i=t.sort?e.onClickHeader.bind(e,t.id):function(){},o=t.sort?{cursor:"pointer"}:{},l=null;if(!1===t.display)return null;if(t.sort){var s=k()("sort-indicator","fa",{"fa-sort-down":-1===n.get(t.id,0),"fa-sort-up":1===n.get(t.id,0),"fa-sort":0===n.get(t.id,0)});l=r.a.createElement("i",{className:s})}return t.title||t.placeholder?r.a.createElement("th",{key:a,onClick:i,className:t.cssClass,style:o},t.title||t.placeholder,l):r.a.createElement("th",{key:a,onClick:i,className:t.cssClass,style:o},Object(x.titleCase)(t.id),l)}),b=o.length;g&&(y=[r.a.createElement("th",{key:-1})].concat(Object(w.a)(y)),b+=1),c&&(y.push(r.a.createElement("th",{key:o.length},"\xa0")),b+=1),d&&(y.push(r.a.createElement("th",{key:o.length+1},"\xa0")),b+=1),v.length>0&&(y.push(r.a.createElement("th",{key:o.length+1},"\xa0")),b+=1);var E=r.a.createElement(Zs.Tooltip,{id:"tooltip"},u||"Edit"),C=a?a.size<1?r.a.createElement("tr",null,r.a.createElement("td",{colSpan:b,style:{textAlign:"center"}},"No items found")):a.map(function(t,n){return r.a.createElement("tr",{key:n,className:t.get("enabled",!0)?"":"disabled disabled-bg"},g&&r.a.createElement("td",{className:"edit-tb"},r.a.createElement("input",{type:"checkbox",checked:t.get("enabled",!0),onChange:h.bind(e,t)})),e.buildRow(t,o),c&&r.a.createElement("td",{className:"edit-tb"},r.a.createElement("button",{className:"btn btn-link",onClick:l.bind(e,t)},u||r.a.createElement(Zs.OverlayTrigger,{overlay:E,placement:"left"},r.a.createElement("i",{className:"fa fa-pencil"})))),d&&r.a.createElement("td",{className:"edit-tb"},r.a.createElement(f.c,{onClick:m.bind(e,t),bsSize:"small",className:"pull-left"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0Remove")),v.length>0&&r.a.createElement("td",{className:"td-actions"},r.a.createElement(Xe,{actions:v,data:t})))}):null;return r.a.createElement("div",{className:"List row ".concat(p)},r.a.createElement("div",{className:"table-responsive col-lg-12"},r.a.createElement("table",{className:"table table-hover table-striped table-bordered"},r.a.createElement("thead",null,r.a.createElement("tr",null,y)),r.a.createElement("tbody",null,C))))}}]),t}(a.Component);Xs.defaultProps={enableRemove:!1,onClickRemove:function(){},onClickEdit:function(){},onSort:function(){},sort:g.c.Map(),className:"",enableEnabled:!1,onClickEnabled:function(){},actions:[]};var ec=Xs,tc=function(e){var t=e.size,n=e.count,a=e.page,i=e.nextPage,o=a*t,l="previous".concat(0===a?" disabled":""),s="next".concat(i?"":" disabled "),c=0===n?0:"".concat(o+1," to ").concat(o+n),u="Page ".concat(a+1);return r.a.createElement("div",{className:"col-12"},r.a.createElement("div",{className:"col-6 pull-left"},r.a.createElement("ul",{className:"pagination"},r.a.createElement("li",{className:l},r.a.createElement("a",{onClick:function(t){t.preventDefault(),a>0&&e.onChangePage(a-1)}},r.a.createElement("i",{className:"fa fa-chevron-left"}))),r.a.createElement("span",{className:"detalis",style:{padding:"0 10px"}},u,0!==c&&" | ".concat(c)),r.a.createElement("li",{className:s},r.a.createElement("a",{onClick:function(t){t.preventDefault(),i&&e.onChangePage(a+1)}},r.a.createElement("i",{className:"fa fa-chevron-right"}))))),r.a.createElement("div",{className:"col-6 pull-right"},e.onChangeSize&&r.a.createElement("select",{value:t,className:"form-control",onChange:function(t){var n=t.target.value;e.onChangeSize(n)},style:{paddingTop:0,paddingBottom:0,height:25}},r.a.createElement("option",{value:5},"5"),r.a.createElement("option",{value:10},"10"),r.a.createElement("option",{value:15},"15"),r.a.createElement("option",{value:20},"20"))))};tc.defaultProps={page:0,nextPage:!1};var nc=tc,ac=n(81),rc=n.n(ac),ic=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={states:n.props.states},n.onSelectState=function(e,t){var a=n.state.states,r=parseInt(e.val()),i=t?a.push(r):a.filter(function(e){return e!==r});n.setState({states:i})},n.onDropdownHide=function(){var e=n.state.states;n.props.onChangeState(e)},n.buttonTitle=function(){return""},n.getHistoryOptions=function(){var e=n.state.states;return[{value:2,label:'<span><div class="cycle expired option" /> Closed</span>',selected:e.includes(2),disabled:e.includes(2)&&1===e.size},{value:0,label:'<span><div class="cycle active option" /> Active</span>',selected:e.includes(0),disabled:e.includes(0)&&1===e.size},{value:1,label:'<span><div class="cycle future option" /> Planned</span>',selected:e.includes(1),disabled:e.includes(1)&&1===e.size}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.states,n=this.state.states;g.c.is(n,t)||this.setState({states:t})}},{key:"shouldComponentUpdate",value:function(e,t){var n=this.state.states;return!g.c.is(n,t.states)}},{key:"render",value:function(){return r.a.createElement(rc.a,{multiple:!0,enableHTML:!0,data:this.getHistoryOptions(),onChange:this.onSelectState,buttonWidth:"100%",nonSelectedText:"Select State",allSelectedText:"<span><div class='cycle all option' /> All States</span>",selectAllNumber:!1,onDropdownHide:this.onDropdownHide,buttonTitle:this.buttonTitle})}}]),t}(a.Component);ic.defaultProps={states:g.c.List()};var oc=ic,lc=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).unfilterCond=function(e){return"undefined"===typeof e||null===e?"":g.c.Map.isMap(e)?e.get("$regex",""):"".concat(e)},n.onClearFilter=function(){n.setState({filter_by:[],string:""},function(){n.onClickFilterBtn()})},n.onChangeFilterString=n.onChangeFilterString.bind(Object(ki.a)(n)),n.onSelectFilterField=n.onSelectFilterField.bind(Object(ki.a)(n)),n.onClickFilterBtn=n.onClickFilterBtn.bind(Object(ki.a)(n)),n.buildQueryString=n.buildQueryString.bind(Object(ki.a)(n)),n.filterCond=n.filterCond.bind(Object(ki.a)(n));var a="",r=[];if(!e.filter.isEmpty()){var i=e.filter.first();r=e.filter.keySeq().toArray(),a=n.unfilterCond(i)}return n.state={string:a,filter_by:r},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){}},{key:"onChangeFilterString",value:function(e){var t=e.target.value;this.setState({string:t})}},{key:"filterCond",value:function(e,t){var n=this.props.fields.find(function(t){return t.id===e});if(!n)return{$regex:t,$options:"i"};switch(n.type){case"number":return parseFloat(t);case"datetime":return t;case"text":default:return{$regex:t,$options:"i"}}}},{key:"buildQueryString",value:function(){var e=this,t=this.state,n=t.string,a=t.filter_by,r=this.props.base,i=Object.values(r).reduce(function(t,n,a){return Object.assign({},t,Object(vr.a)({},a,e.filterCond(a,n)))},{});return n.replace(/\s/gi,"")?a.reduce(function(t,a){return Object.assign({},t,Object(vr.a)({},a,e.filterCond(a,n)))},i):i}},{key:"onClickFilterBtn",value:function(){(0,this.props.onFilter)(this.buildQueryString())}},{key:"onSelectFilterField",value:function(e,t){var n=e.val(),a=this.state.filter_by,r=a.includes(n);if(!t||!r)return!t&&r?this.setState({filter_by:a.filter(function(e){return e!==n})}):this.setState({filter_by:a.concat(n)})}},{key:"render",value:function(){var e=this.props,t=e.fields,n=void 0===t?[]:t,a=e.children,i=this.state,o=i.filter_by,l=i.string,s=n.filter(function(e){return!1!==e.showFilter}).map(function(e,t){var n=o.includes(e.id);return{value:e.id,label:e.placeholder,selected:n}});return r.a.createElement("div",{className:"Filter row",style:{marginBottom:10}},r.a.createElement("div",{className:"filter-warp"},r.a.createElement("div",{className:"pull-left"},r.a.createElement("input",{id:"filter-string",placeholder:"Search for...",onChange:this.onChangeFilterString,value:l,className:"form-control"})),r.a.createElement("div",{className:"pull-left"},r.a.createElement(rc.a,{data:s,multiple:!0,onChange:this.onSelectFilterField,buttonWidth:"100%",nonSelectedText:"Search in fields"})),r.a.createElement("div",{className:"search-button pull-left"},r.a.createElement("button",{className:"btn btn-default search-btn",onClick:this.onClickFilterBtn,type:"submit",disabled:l&&0===o.length||!l&&0===o.length},r.a.createElement("i",{className:"fa fa-search"}))),r.a.createElement("div",{className:"search-button pull-left"},r.a.createElement("button",{className:"btn btn-default search-btn",onClick:this.onClearFilter,type:"button"},r.a.createElement("i",{className:"fa fa-eraser"}))),a))}}]),t}(a.Component);lc.defaultProps={filter:g.c.Map(),fields:[],base:{},children:null},(function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={filters:n.props.filter},n.onChangeInput=function(e){var t=e.target,a=t.id,r=t.value;n.onChange(a,r)},n.onChangeDate=function(e,t){var a=t?t.toJSON():"";n.onChange("urt",a)},n.onChangeDateFrom=function(e,t){var a=t?t.toJSON():"",r=n.state.filters.get(e,{});r.from=a,n.onChange(e,r)},n.onChangeDateTo=function(e,t){var a=t?t.toJSON():"",r=n.state.filters.get(e,{});r.to=a,n.onChange(e,r)},n.onChange=function(e,t){var a=n.state.filters;t?n.setState({filters:a.set(e,t)}):n.setState({filters:a.delete(e)})},n.onClear=function(){var e=g.c.Map();n.setState({filters:e}),n.props.onFilter(e.toJS())},n.onApplay=function(){var e=n.state.filters;n.props.onFilter(e.toJS())},n.getFilterInput=function(e){var t=n.state.filters.get(e.id,"");switch(e.type){case"select":var a=e.options.map(function(e,t){var n,a;return e&&e.key&&e.val?(n=e.val,a=e.key):a=n=e,r.a.createElement("option",{key:t,value:a},n)});return r.a.createElement("select",{id:e.id,className:"form-control",value:t,onChange:n.onChangeInput},"[",r.a.createElement("option",{key:"select",value:""},"Select..."),", ...",a,"]");case"date":return r.a.createElement(Et.a,{className:"form-control",dateFormat:"DD/MM/YYYY",selected:t.length?S()(t):null,onChange:n.onChangeDate.bind(Object(ki.a)(n),e.id),isClearable:!0,placeholderText:"Select Date..."});case"date-range":var i=t?t.from:"";i=i?S()(i):null;var o=t?t.to:"";return o=o?S()(o):null,r.a.createElement("div",{style:{width:"100%"}},r.a.createElement("div",{className:"pull-left",style:{width:"48%"}},r.a.createElement(Et.a,{className:"form-control",dateFormat:"DD/MM/YYYY",selected:i,selectsStart:!0,startDate:i,endDate:o,onChange:n.onChangeDateFrom.bind(Object(ki.a)(n),e.id),isClearable:!0,placeholderText:"Select Start Date..."})),r.a.createElement("div",{className:"pull-right",style:{width:"48%"}},r.a.createElement(Et.a,{className:"form-control",dateFormat:"DD/MM/YYYY",selected:o,selectsEnd:!0,startDate:i,endDate:o,onChange:n.onChangeDateTo.bind(Object(ki.a)(n),e.id),isClearable:!0,placeholderText:"Select End Date..."})));default:return r.a.createElement("input",{id:e.id,onChange:n.onChangeInput,value:t,placeholder:"Search...",className:"form-control"})}},n.renderTitles=function(e,t,n){var a=F.a.titleCase(e.title||e.placeholder||e.id),i={width:"".concat(100/(0===n.length?1:n.length),"%")};return r.a.createElement("th",{style:i,key:t},a)},n.renderInputs=function(e,t,a){var i=n.getFilterInput(e),o=k()({pl0:0===t,pr0:t===a.length-1});return r.a.createElement("td",{className:o,key:t},i)},n.renderActions=function(){var e=n.props.fields;return[r.a.createElement("td",{colSpan:e.length-1,className:"pl0",key:"search"},r.a.createElement(f.c,{bsStyle:"primary",onClick:n.onApplay,className:"full-width mr10"},r.a.createElement("i",{className:"fa fa-search"}),"\xa0Search")),r.a.createElement("td",{className:"pr0",key:"reset"},r.a.createElement(f.c,{onClick:n.onClear,className:"full-width"},r.a.createElement("i",{className:"fa fa-eraser danger-red"}),"\xa0Reset"))]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.fields,t=e.map(this.renderTitles),n=e.map(this.renderInputs),a=this.renderActions();return r.a.createElement("div",{className:"AdvancedFilter"},r.a.createElement(f.z,{responsive:!0,className:"mb10"},r.a.createElement("thead",null,r.a.createElement("tr",null,t)),r.a.createElement("tbody",null,r.a.createElement("tr",null,n),r.a.createElement("tr",null,a))))}}]),t}(a.Component)).defaultProps={fields:[],filter:g.c.Map()};var sc=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showConfirmClose:!1,showCloseDetails:!1,closeDate:ne(n.props.item)?ee(n.props.item,"to",null):null},n.onClickCloseConfirm=function(){n.setState({showConfirmClose:!1,showCloseDetails:!1,closeDate:null})},n.onClickCloseOk=function(){var e=n.state.closeDate,t=n.props,a=t.itemName,r=t.item,i=Y(["systemItems",a,"collection"],"");if(r){var o=r.set("to",e.toISOString());n.props.dispatch(Tl(i,o)).then(n.afterClose)}},n.afterClose=function(e){var t=n.state.closeDate,a=n.props.item,r=t.format(Y("dateFormat","DD/MM/YYYY"));if(e.status){n.props.dispatch(Wa("Close date was set to ".concat(r)));var i=te(a,"");n.onClickCloseConfirm(),n.props.onCloseItem(i)}},n.toggleCloseAction=function(){var e=n.state.showCloseDetails;n.setState({showCloseDetails:!e})},n.toggleCloseConfirm=function(){var e=n.state.showConfirmClose;n.setState({showConfirmClose:!e})},n.onChangeFrom=function(e){var t=n.state.closeDate,a=n.props.dangerousFrom;e&&e.isBefore(a)?n.confirmSelectedDate(e,t):n.setState({closeDate:e})},n.confirmSelectedDate=function(e,t){var a=e.format(Y("dateFormat","DD/MM/YYYY")),r={message:"Billing cycle for the date you have chosen is already over.",children:"Are you sure you want to use ".concat(a,"?"),onOk:function(){n.setState({closeDate:e})},onCancel:function(){n.setState({closeDate:t})}};n.props.dispatch(po(r))},n.dayDateClass=function(e){var t=n.props,a=t.minDate,r=t.dangerousFrom;if(e.isBetween(a,r))return"danger-red"},n.renderDateFromfields=function(){var e=n.props,t=e.item,a=e.minDate,i=n.state.closeDate,o=ee(t,"to",null),l=null===i||o&&i&&o.isSame(i),s=[S()()];return r.a.createElement("div",{className:"inline"},r.a.createElement("div",{className:"inline"},r.a.createElement(en,{fieldType:"date",value:i,onChange:n.onChangeFrom,isClearable:!0,placeholderText:"Select Date...",minDate:a.clone().add(1,"days"),highlightDates:s,dayClassName:n.dayDateClass})),r.a.createElement(f.c,{onClick:n.toggleCloseConfirm,style:{marginLeft:5,verticalAlign:"bottom"},disabled:l,bsStyle:"primary",className:"inline"},"OK"))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(il(["minimum_entity_start_date","system"]))}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.itemName,a=this.state,i=a.showCloseDetails,o=a.showConfirmClose;return"active"===t.getIn(["revision_info","status"],"")&&t.getIn(["revision_info","is_last"],!1)?r.a.createElement("div",null,r.a.createElement(f.c,{bsStyle:"link",onClick:this.toggleCloseAction,style:{verticalAlign:"bottom",lineHeight:"24px"}},"Close ",Y(["systemItems",n,"itemName"],"item")," ",r.a.createElement("i",{className:"fa fa-angle-right"})),i&&this.renderDateFromfields(),r.a.createElement(Ke,{onOk:this.onClickCloseOk,onCancel:this.onClickCloseConfirm,show:o,message:"Are you sure you want to close the revision?",labelOk:"Yes"})):null}}]),t}(a.Component);sc.defaultProps={item:g.c.Map(),minDate:S()(0),dangerousFrom:S()(0),onCloseItem:function(){}};var cc=Object(l.connect)(function(e,t){return{minDate:hi(e,t),dangerousFrom:Pn(e,t)}})(sc),uc=n(3),pc=n.n(uc),dc=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={startDate:ee(n.props.item,"from",null),endDate:ee(n.props.item,"to",null),activeTab:n.props.item.getIn(["revision_info","movable_from"],!0)?1:2,progress:!1,showEndConfirm:!1,showStartConfirm:!1},n.onClickEndMoveOk=function(){n.onClickOk("to")},n.onClickStartMoveOk=function(){n.onClickOk("from")},n.onClickOk=function(e){var t=n.state,a=t.startDate,r=t.endDate,i=n.props.item.withMutations(function(e){return e.set("from",a.toISOString()).set("to",r.toISOString())});n.onClickCloseConfirm(),n.props.onMoveItem(i,e)},n.onClickCancel=function(){n.props.onCancelMoveItem()},n.onChangeDateFrom=function(e){var t=n.props,a=t.item,r=t.minStartDate,i=n.state.startDate;null!==e?e.isBefore(r)&&!e.isSame(ee(a,"from",null),"day")?n.confirmSelectedDate(e,i,"startDate"):n.setState({startDate:e}):n.setState({startDate:ee(a,"from",null)})},n.onChangeDateTo=function(e){var t=n.props,a=t.item,r=t.minStartDate,i=n.state.endDate;null!==e?e.isBefore(r)&&!e.isSame(ee(a,"to",null),"day")?n.confirmSelectedDate(e,i,"endDate"):n.setState({endDate:e}):n.setState({endDate:ee(a,"to",null)})},n.confirmSelectedDate=function(e,t,a){var r=e.format(Y("dateFormat","DD/MM/YYYY")),i={message:"Billing cycle for the date you have chosen is already over.",children:"Are you sure you want to use ".concat(r,"?"),onOk:function(){n.setState(Object(vr.a)({},a,e))},onCancel:function(){n.setState(Object(vr.a)({},a,t))}};n.props.dispatch(po(i))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n.toggleStartConfirm=function(){var e=n.state.showStartConfirm;n.setState({showStartConfirm:!e})},n.toggleEndConfirm=function(){var e=n.state.showEndConfirm;n.setState({showEndConfirm:!e})},n.onClickCloseConfirm=function(){n.setState({showEndConfirm:!1,showStartConfirm:!1})},n.onUnlimitedChanged=function(e){var t=n.props.item,a=e.target.value,r=S()().add(50,"years").isBefore(ee(t,"to",null));a?r?n.setState({endDate:ee(t,"to",null)}):n.setState({endDate:S()().add(100,"years")}):r?n.setState({endDate:S()().add(1,"day")}):n.setState({endDate:ee(t,"to",null)})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(il(["minimum_entity_start_date","system"]))}},{key:"componentWillReceiveProps",value:function(e){g.c.is(this.props.item,e.item)||this.setState({startDate:ee(e.item,"from",null),endDate:ee(e.item,"to",null)})}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.revisions,a=e.itemName,i=e.minStartDate,o=this.state,l=o.startDate,s=o.endDate,c=o.activeTab,u=o.progress,p=o.showEndConfirm,d=o.showStartConfirm;if(n.isEmpty())return null;var m=Pe(Y(["systemItems",a,"uniqueField"],"")).get(0,""),g="".concat(t.get(m,"")," - Move"),h={marginLeft:5,verticalAlign:"bottom"},v=l.isSame(ee(t,"from",null),"days")||u,y=s.isSame(ee(t,"to",null),"days")||u,b=Y("dateFormat","DD/MM/YYYY"),E=S()().add(50,"years").isBefore(s),C="Are you sure you want to set start date to be ".concat(l.format(b)," ?"),_="Are you sure you want to set end date to be  ".concat(E?"infinite":s.format(b)," ?"),O=n.findIndex(function(e){return te(e)===te(t)}),T=0===O,k=ie(n.get(O+1,null),S()(0)),I=ee(t,"to"),N=ie(t,S()(0)),w=T?S()().add(200,"years"):ee(n.get(O-1),"to"),j=!t.getIn(["revision_info","movable_from"],!0),R=!t.getIn(["revision_info","movable_to"],!0)||E&&T,x=[ee(t,"from",null)],F=[ee(t,"to",null)];return r.a.createElement(Ye,{show:!0,title:g,labelCancel:"Close",onCancel:this.onClickCancel,onHide:this.onClickCancel},r.a.createElement("div",{className:"text-center move-modal"},r.a.createElement(ze,{revisions:n,item:t,size:10}),r.a.createElement(f.j,{horizontal:!0,style:{padding:"35px 50px 0 50px"}},r.a.createElement(f.l,null,r.a.createElement(f.A,{bsStyle:"pills",defaultActiveKey:c,animation:!1,id:"move-entity",onSelect:this.handleSelectTab},r.a.createElement(f.y,{title:"Move Start Date",eventKey:1,disabled:!t.getIn(["revision_info","movable_from"],!0)},r.a.createElement("br",null),r.a.createElement(f.g,{sm:3,className:"text-right",style:{padding:"10px 15px"}},"\xa0"),r.a.createElement(f.g,{sm:6,className:"pr0"},r.a.createElement(en,{fieldType:"date",value:l,minDate:k,maxDate:I,onChange:this.onChangeDateFrom,isClearable:!0,placeholder:"Select Start Date...",disabled:j,dayClassName:function(e){return k.isBefore(i)&&!e.isSame(ee(t,"from",null),"days")&&e.isBetween(k,i,"day","[)")?"danger-red":void 0},highlightDates:x})),r.a.createElement(f.g,{sm:3,className:"pl0 text-left"},r.a.createElement(f.c,{onClick:this.toggleStartConfirm,style:h,disabled:v,bsStyle:"primary"},"OK"),r.a.createElement(Ke,{onOk:this.onClickStartMoveOk,onCancel:this.onClickCloseConfirm,show:d,message:C,labelOk:"Yes"}))),r.a.createElement(f.y,{title:"Move End Date",eventKey:2,disabled:!t.getIn(["revision_info","movable_to"],!0)},r.a.createElement("br",null),r.a.createElement(f.g,{sm:3,className:"text-right",style:{padding:"10px 15px"}},r.a.createElement(en,{value:E,onChange:this.onUnlimitedChanged,fieldType:"checkbox",label:"Infinite",disabled:!T})),r.a.createElement(f.g,{sm:6,className:"pr0"},r.a.createElement(en,{fieldType:"date",value:E&&T?null:s,onChange:this.onChangeDateTo,isClearable:!0,minDate:N,maxDate:w,disabled:R,placeholder:"Select End Date...",dayClassName:function(e){return N.isBefore(i)&&!e.isSame(ee(t,"to",null),"days")&&e.isBetween(N,i,"day","[)")?"danger-red":void 0},highlightDates:F})),r.a.createElement(f.g,{sm:3,className:"pl0 text-left"},r.a.createElement(f.c,{onClick:this.toggleEndConfirm,style:h,disabled:y,bsStyle:"primary"},"OK"),r.a.createElement(Ke,{onOk:this.onClickEndMoveOk,onCancel:this.onClickCloseConfirm,show:p,message:_,labelOk:"Yes"}))))))))}}]),t}(a.Component);dc.defaultProps={itemId:pc.a.string,item:g.c.Map(),revisions:g.c.List(),minStartDate:S()(0),onMoveItem:function(){},onCancelMoveItem:function(){}};var mc=Object(l.connect)(function(e,t){return{minStartDate:Pn(e,t),item:t.revisions.find(function(e){return te(e)===t.itemId})}})(dc),gc=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={fromDate:null,validationErrors:g.c.Map({from:""})},n.onClickOk=function(){var e=n.state,t=e.fromDate,a=e.validationErrors,r=n.props.item;null===t?n.setState({fromDate:t,validationErrors:a.set("from","required")}):n.props.onReopenItem(r,t.toISOString())},n.onClickCancel=function(){n.props.onCancelReopenItem()},n.onChangeFromDate=function(e){var t=n.state.validationErrors,a=null===e?"required":"";n.setState({fromDate:e,validationErrors:t.set("from",a)})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.revisions,a=e.itemName,i=this.state,o=i.fromDate,l=i.validationErrors,s=n.first(),c=ee(s,"to"),u=Pe(Y(["systemItems",a,"uniqueField"],g.c.List())).get(0,""),p="".concat(t.get(u,"")," - Reopen"),d=l.get("from","");return r.a.createElement(Ye,{show:!0,title:p,labelCancel:"Close",onCancel:this.onClickCancel,onHide:this.onClickCancel,labelOk:"Reopen",onOk:this.onClickOk},r.a.createElement("div",{className:"text-center reopen-modal"},r.a.createElement(f.j,{horizontal:!0,style:{padding:"35px 50px 0 50px"}},r.a.createElement(f.l,{validationState:d.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:4},"Reopen From Date"),r.a.createElement(f.g,{sm:6,className:"pr0"},r.a.createElement(en,{fieldType:"date",value:o,minDate:c,onChange:this.onChangeFromDate,isClearable:!0,placeholder:"Select Reopen From Date..."}),r.a.createElement(f.n,null,d.length>0?d:null))))))}}]),t}(a.Component);gc.defaultProps={item:g.c.Map(),revisions:g.c.List(),onReopenItem:function(){},onCancelReopenItem:function(){}};var fc=gc,hc="CLEAR_ENTITY_LIST",vc="CLEAR_ITEMS",yc="SET_NEXT_PAGE",bc="SET_ITEMS",Ec="SET_FILTER",Cc="SET_PAGE",_c="SET_SORT",Oc="SET_SIZE",Sc="SET_STATE",Tc="SET_REVISIONS",kc="CLEAR_REVISIONS",Ic=function(e,t){return{type:_c,collection:e,sort:t}},Nc=function(e,t){return{type:Oc,collection:e,size:t}},wc=function(e,t){return{type:Ec,collection:e,filter:t}},jc=function(e,t){return{type:Cc,collection:e,page:t}},Rc=function(e,t){return{type:Sc,collection:e,state:t}},xc=function(e,t){return{type:kc,collection:e,key:t}},Fc=function(e){return{type:hc,collection:e}},Pc=function(e){return{type:vc,collection:e}},Mc=function(e,t){return function(n){return n(Aa()),ir(t).then(function(t){try{return n(function(e,t){return{type:bc,collection:e,list:t}}(e,t.data[0].data.details)),n(function(e,t){return{type:yc,collection:e,nextPage:t}}(e,t.data[0].data.next_page)),n(tr(t))}catch(a){throw console.log("fetchList error: ",a),new Error("Error retreiving list")}}).catch(function(e){return n(nr(e,"Network error - please refresh and try again"))})}},Ac=function(e,t,n){return function(a){var r=Pe(n),i=Pe(t),o=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:9999,r=t.reduce(function(t,a,r){var i=n.get(r,"");switch("string"===typeof i&&(i=i.toString().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),e){case"subscribers":return t.set(a,i);default:return t.set(a,{$regex:"^".concat(i,"$")})}},g.c.Map({})),i=t.reduce(function(e,t){return e.set(t,1)},g.c.Map({from:1,to:1,description:1,revision_info:1}));return{action:"get",entity:e,params:[{sort:JSON.stringify({from:-1})},{query:JSON.stringify(r)},{project:JSON.stringify(i)},{page:0},{size:a},{state:JSON.stringify([0,1,2])}]}}(e,i,r);return ir(o).then(function(t){try{return a(function(e,t,n){return{type:Tc,collection:e,key:t,revisions:n}}(e,n,t.data[0].data.details)),a(tr(t))}catch(r){throw console.log("fetch revision error: ",r),new Error("fetch revision error")}}).catch(function(e){return a(nr(e,"Network error - please refresh and try again"))})}},Dc=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showConfirmRemove:!1,itemToRemove:null,showMoveModal:!1,itemToMove:null,itemToReopen:null},n.isItemLast=function(e){return e.getIn(["revision_info","is_last"],!0)},n.isItemEditable=function(e){return["future"].includes(e.getIn(["revision_info","status"],""))||n.isItemActive(e)&&n.isItemLast(e)},n.isItemMovable=function(e){return e.getIn(["revision_info","movable_from"],!0)||e.getIn(["revision_info","movable_to"],!0)},n.isItemReopenable=function(e){var t=n.props.items,a=t.indexOf(e),r=a>0?t.get(a-1,g.c.Map()):g.c.Map(),i=t.first();return["expired"].includes(e.getIn(["revision_info","status"],""))&&!["expired"].includes(r.getIn(["revision_info","status"],""))&&ae(i)},n.isItemActive=function(e){return["active"].includes(e.getIn(["revision_info","status"],""))},n.isItemExpired=function(e){return["expired"].includes(e.getIn(["revision_info","status"],""))},n.parseEditShow=function(e){return n.isItemEditable(e)},n.parseViewShow=function(e){return!n.isItemEditable(e)},n.parseMoveEnable=function(e){return n.isItemMovable(e)},n.parseReopenEnable=function(e){return n.isItemReopenable(e)},n.parserState=function(e){return r.a.createElement(N,{status:e.getIn(["revision_info","status"],"")})},n.parseFromDate=function(e){var t=ee(e,"from",null);return S.a.isMoment(t)?r.a.createElement(ot,{value:t,format:Y("dateFormat","DD/MM/YYYY")}):"-"},n.parseToDate=function(e){var t=ee(e,"to",null),a=n.isItemExpired(e)||n.isItemActive(e)&&!n.isItemLast(e);return S.a.isMoment(t)&&(ne(e)||a)?r.a.createElement(ot,{value:t.subtract(1,"seconds"),format:Y("dateFormat","DD/MM/YYYY")}):"-"},n.onClickEdit=function(e){var t=n.props.itemName;if(n.props.onSelectItem(),n.props.onActionEdit)n.props.onActionEdit(e,t);else{var a=te(e,""),r=Y(["systemItems",t,"itemType"],""),i=Y(["systemItems",t,"itemsType"],"");n.props.router.push("".concat(i,"/").concat(r,"/").concat(a))}},n.onClickRemove=function(e){n.setState({showConfirmRemove:!0,itemToRemove:e})},n.onClickRemoveClose=function(){n.setState({showConfirmRemove:!1,itemToRemove:null})},n.onClickClone=function(e){var t=n.props.itemName;if(n.props.onSelectItem(),n.props.onActionClone)n.props.onActionClone(e,t,"clone");else{var a=te(e,""),r=Y(["systemItems",t,"itemType"],""),i=Y(["systemItems",t,"itemsType"],"");n.props.router.push({pathname:"".concat(i,"/").concat(r,"/").concat(a),query:{action:"clone"}})}},n.onClickRemoveOk=function(){var e=n.props.itemName,t=n.state.itemToRemove,a=Y(["systemItems",e,"collection"],"");n.props.dispatch(Sl(a,t)).then(n.afterRemove)},n.onClickMove=function(e){n.setState({showMoveModal:!0,itemToMove:e})},n.onClickMoveClose=function(){n.setState({showMoveModal:!1,itemToMove:null})},n.onClickMoveOk=function(e,t){var a=n.props.itemName,r=Y(["systemItems",a,"collection"],"");n.props.dispatch(kl(r,e,t)).then(n.afterMove)},n.afterMove=function(e){e.status&&(n.props.dispatch(Wa("Revision was moved")),n.props.onCloseItem())},n.afterRemove=function(e){var t=n.state.itemToRemove,a=n.props.itemName;if(e.status){n.props.dispatch(Wa("Revision was removed"));var r=Y(["systemItems",a,"collection"],""),i=Pe(Y(["systemItems",a,"uniqueField"],g.c.List())),o=i.map(function(e){return t.get(e,"")}),l=te(t);n.props.dispatch(Ac(r,i,o)),n.onClickRemoveClose(),n.props.onDeleteItem(l)}},n.onClickReopen=function(e){n.setState({showReopenModal:!0,itemToReopen:e})},n.onClickReopenClose=function(){n.setState({showReopenModal:!1,itemToReopen:null})},n.onClickReopenOk=function(e,t){var a=n.props.itemName,r=Y(["systemItems",a,"collection"],"");n.props.dispatch(Il(r,e,t)).then(n.afterReopen)},n.afterReopen=function(e){e.status&&(n.props.dispatch(Wa("Revision was reopened")),n.onClickReopenClose(),n.props.onCloseItem())},n.getActionHelpText=function(e,t){var a=n.props.itemName;switch(Object(x.lowerCase)(t)){case"clone":return"Clone as new ".concat(Y(["systemItems",a,"itemName"],"item"));case"remove":return"Remove revision";case"edit":return"Edit revision";case"view":return"View revision details";case"move":return"Move revision in time";case"reopen":return"Reopen revision";default:return Object(x.sentenceCase)(t)}},n.getListFields=function(){return[{id:"state",parser:n.parserState,cssClass:"state"},{id:"from",title:"Start date",parser:n.parseFromDate,cssClass:"short-date"},{id:"to",title:"To date",parser:n.parseToDate}]},n.getListActions=function(){return[{type:"view",helpText:n.getActionHelpText,onClick:n.onClickEdit,show:n.parseViewShow,onClickColumn:"from"},{type:"edit",helpText:n.getActionHelpText,onClick:n.onClickEdit,show:n.parseEditShow,onClickColumn:"from"},{type:"clone",helpText:n.getActionHelpText,onClick:n.onClickClone},{type:"move",helpText:n.getActionHelpText,onClick:n.onClickMove,enable:n.parseMoveEnable},{type:"reopen",helpText:n.getActionHelpText,onClick:n.onClickReopen,enable:n.parseReopenEnable},{type:"remove",helpText:n.getActionHelpText,onClick:n.onClickRemove}]},n.renderMoveModal=function(){var e=n.props,t=e.items,a=e.itemName,i=n.state,o=i.showMoveModal,l=i.itemToMove;return o?r.a.createElement(mc,{itemId:te(l),itemName:a,revisions:t,onMoveItem:n.onClickMoveOk,onCancelMoveItem:n.onClickMoveClose}):null},n.renderReopenModal=function(){var e=n.props,t=e.items,a=e.itemName,i=n.state,o=i.showReopenModal,l=i.itemToReopen;return o?r.a.createElement(fc,{item:l,itemName:a,revisions:t,onReopenItem:n.onClickReopenOk,onCancelReopenItem:n.onClickReopenClose}):null},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.items,n=e.itemName,a=this.state.showConfirmRemove,i=this.getListFields(),o=this.getListActions(),l=t.find(this.isItemActive);return r.a.createElement("div",null,r.a.createElement(ec,{items:t,fields:i,edit:!1,actions:o,className:"scrollbox screen-height-70"}),l&&r.a.createElement(cc,{itemName:n,item:l,onCloseItem:this.props.onCloseItem}),r.a.createElement(Ke,{onOk:this.onClickRemoveOk,onCancel:this.onClickRemoveClose,show:a,message:"Are you sure you want to remove this revision?",labelOk:"Yes"}),this.renderMoveModal(),this.renderReopenModal())}}]),t}(a.Component);Dc.defaultProps={items:g.c.List(),onSelectItem:function(){},onDeleteItem:function(){},onCloseItem:function(){}};var Lc=Object(s.f)(Object(l.connect)()(Dc)),Uc=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showList:!1},n.onEnter=function(){var e=n.props,t=e.collection,a=e.item,r=e.revisionBy;if(!e.revisions){var i=Pe(r).map(function(e){return a.get(e,"")});n.props.dispatch(Ac(t,r,i))}},n.onCloseItem=function(){var e=n.props,t=e.collection,a=e.item,r=e.revisionBy,i=Pe(r).map(function(e){return a.get(e,"")});n.props.dispatch(Ac(t,r,i))},n.showManageRevisions=function(){var e=n.refs.revisionOverlay;(void 0===e?{}:e).hide(),n.setState({showList:!0})},n.hideManageRevisions=function(){n.setState({showList:!1})},n.renderRevisionTooltip=function(){var e=n.props,t=e.item,a=e.revisions,i=e.size,o=e.revisionBy,l=e.allowManageRevisions,s=e.itemName,c=Pe(o).get(0,""),u="".concat(t.get(c,"")," - Revision History");return a?r.a.createElement(f.w,{id:"".concat(te(t,""),"-revisions"),title:u,className:"entity-revision-history-popover"},r.a.createElement(ze,{revisions:a,item:t,size:i,itemName:s}),r.a.createElement("hr",{style:{margin:0,borderColor:"#3A3A3A",borderWidth:2}}),l&&r.a.createElement(f.c,{bsStyle:"link",style:{color:"#fff"},onClick:n.showManageRevisions},"Manage Revisions")):r.a.createElement(f.w,{id:"".concat(te(t,""),"-loading"),title:u,className:"entity-revision-history-popover"},r.a.createElement("div",{style:{padding:15}},r.a.createElement("i",{className:"fa fa-spinner fa-pulse"}),"\xa0\xa0\xa0loading..."),r.a.createElement("hr",null),r.a.createElement("div",{style:{padding:"8px 12px 7px"}},"\xa0"))},n.renderVerisionList=function(){var e=n.props,t=e.item,a=e.itemName,i=e.revisions,o=e.revisionBy,l=n.state.showList,s=Pe(o).get(0,""),c="".concat(t.get(s,"")," - Revision History");return r.a.createElement(Ye,{title:c,show:l,onCancel:n.hideManageRevisions,onHide:n.hideManageRevisions,labelCancel:"Close"},r.a.createElement(Lc,{items:i,itemName:a,onSelectItem:n.hideManageRevisions,onActionEdit:n.props.onActionEdit,onActionClone:n.props.onActionClone,onCloseItem:n.onCloseItem}))},n.renderHelpTooltip=function(){var e=n.props.item;return r.a.createElement(f.B,{id:"".concat(te(e,""),"-help")},"Click to get",r.a.createElement("br",null),"revision history")},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.item;return r.a.createElement("div",null,r.a.createElement(f.t,{trigger:"click",rootClose:!0,placement:"right",ref:"revisionOverlay",overlay:this.renderRevisionTooltip(),onEnter:this.onEnter},r.a.createElement(f.t,{overlay:this.renderHelpTooltip(),placement:"left"},r.a.createElement("div",{className:"clickable"},r.a.createElement(N,{status:e.getIn(["revision_info","status"],"")})))),this.renderVerisionList())}}]),t}(a.Component);Uc.defaultProps={item:g.c.Map(),revisions:void 0,size:5,allowManageRevisions:!0};var Vc=Object(l.connect)(function(e,t){var n=Y(["systemItems",t.itemName,"uniqueField"],""),a=Y(["systemItems",t.itemName,"collection"],""),r=Pe(n).map(function(e){return t.item.get(e,"")}).join("_");return{revisions:e.entityList.revisions.getIn([a,r]),collection:a,revisionBy:n}})(Uc),Bc=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onClickNew=function(){var e=n.props,t=e.itemsType,a=e.itemType;n.props.router.push("".concat(t,"/").concat(a))},n.onClickRefresh=function(){var e=n.props.collection;n.fetchItems(n.props),n.props.dispatch(xc(e))},n.onSort=function(e){var t=n.props.itemsType;n.props.dispatch(jc(t,0)),n.props.dispatch(Ic(t,e))},n.onFilter=function(e){var t=n.props.itemsType;n.props.dispatch(jc(t,0)),n.props.dispatch(wc(t,e))},n.onPageChange=function(e){var t=n.props.itemsType;n.props.dispatch(jc(t,e))},n.onSizeChange=function(e){var t=n.props.itemsType;n.props.dispatch(jc(t,0)),n.props.dispatch(Nc(t,e))},n.onStateChange=function(e){var t=n.props.itemsType;n.props.dispatch(jc(t,0)),n.props.dispatch(Rc(t,e))},n.onClickEditItem=function(e){var t=n.props,a=t.itemsType,r=t.itemType,i=e.getIn(["_id","$id"]);n.props.router.push("".concat(a,"/").concat(r,"/").concat(i))},n.onClickViewItem=function(e){var t=n.props,a=t.itemsType,r=t.itemType,i=e.getIn(["_id","$id"]);n.props.router.push("".concat(a,"/").concat(r,"/").concat(i,"?action=view"))},n.buildQuery=function(e){var t=e.collection,n=e.page,a=e.size,r=e.sort,i=e.filter,o=e.state,l=e.baseFilter,s=e.projectFields,c=e.api,u=e.showRevisionBy,p=u?Object(Fo.a)({},s,{to:1,from:1,revision_info:1}):s,d=Object(Fo.a)({},i.toObject(),l),m={or_fields:Object.keys(i.toObject())},g={action:c,entity:t,params:[{sort:JSON.stringify(r)},{query:JSON.stringify(d)},{project:JSON.stringify(p)},{page:n},{size:a},{options:JSON.stringify(m)}]};return u&&g.params.push({states:JSON.stringify(o)}),g},n.fetchItems=function(e){var t=e.itemsType;n.props.dispatch(Mc(t,n.buildQuery(e)))},n.parserState=function(e){var t=n.props,a=t.itemType,i=t.allowManageRevisions;return r.a.createElement(Vc,{item:e,itemName:a,allowManageRevisions:i})},n.addStateColumn=function(e){return[{id:"state",parser:n.parserState,cssClass:"state"}].concat(Object(w.a)(e))},n.getListActions=function(){var e=n.props.listActions,t=[{type:"refresh",label:"Refresh",actionStyle:"primary",showIcon:!0,onClick:n.onClickRefresh,actionSize:"xsmall"},{type:"add",label:"Add New",actionStyle:"primary",showIcon:!0,onClick:n.onClickNew,actionSize:"xsmall"}];return null===e?t:e.map(function(e){var n=t.find(function(t){return t.type===e.type});return n?Object.assign(n,e):e}).reverse()},n.renderPanelHeader=function(){var e=n.props,t=e.itemType,a=e.itemsType,i=Y(["systemItems",t,"itemsName"],F.a.noCase(a));return r.a.createElement("div",null,"List of all available ",i,r.a.createElement("div",{className:"pull-right"},r.a.createElement(Xe,{actions:n.getListActions()})))},n.renderFilter=function(){var e=n.props,t=e.filter,a=e.filterFields;return r.a.createElement(lc,{filter:t,fields:a,onFilter:n.onFilter},n.renderStateFilter())},n.renderStateFilter=function(){var e=n.props,t=e.state;return e.showRevisionBy?r.a.createElement("div",{className:"pull-right"},r.a.createElement(oc,{states:t,onChangeState:n.onStateChange})):null},n.renderPager=function(){var e=n.props,t=e.items,a=e.size,i=e.page,o=e.nextPage;return r.a.createElement(nc,{page:i,size:a,count:t.size,nextPage:o,onChangePage:n.onPageChange,onChangeSize:n.onSizeChange})},n.getActions=function(){var e=n.props,t=e.actions,a=e.showRevisionBy?1:0,r={type:"edit",showIcon:!0,helpText:"Edit",onClick:n.onClickEditItem,show:!0,onClickColumn:a},i={type:"view",showIcon:!0,helpText:"View",onClick:n.onClickViewItem,show:!0,onClickColumn:a};return t.map(function(e){switch(e.type){case"edit":return Object.assign(r,e);case"view":return Object.assign(i,e);default:return e}})},n.renderList=function(){var e=n.props,t=e.items,a=e.sort,i=e.tableFields,o=e.showRevisionBy,l=n.getActions(),s=o?n.addStateColumn(i):i;return r.a.createElement(ec,{sort:a,items:t,fields:s,onSort:n.onSort,actions:l})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.forceRefetchItems,n=e.items,a=e.sort,r=e.defaultSort,i=e.itemsType;(t||null==n||n.isEmpty())&&this.fetchItems(this.props),a.isEmpty()&&!r.isEmpty()&&this.props.dispatch(Ic(i,r))}},{key:"componentWillUpdate",value:function(e,t){var n=this.props.page!==e.page,a=this.props.size!==e.size,r=!g.c.is(this.props.filter,e.filter),i=!g.c.is(this.props.sort,e.sort),o=!g.c.is(this.props.state,e.state),l=g.c.fromJS(this.props.baseFilter),s=g.c.fromJS(e.baseFilter),c=!g.c.is(l,s),u=this.props.refreshString!==e.refreshString;(n||a||r||i||o||c||u)&&this.fetchItems(e)}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){return null===this.props.items?r.a.createElement(_,null):r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:this.renderPanelHeader()},this.renderFilter(),this.renderList()),this.renderPager()))}}]),t}(a.Component);Bc.defaultProps={items:null,api:"uniqueget",page:0,size:Y("listDefaultItems",10),nextPage:!1,editable:!0,allowManageRevisions:!0,showRevisionBy:!1,inProgress:!1,forceRefetchItems:!1,baseFilter:{},tableFields:[],filterFields:[],projectFields:{},sort:g.c.Map(),defaultSort:g.c.Map(),filter:g.c.Map(),state:g.c.List([0,1,2]),refreshString:"",actions:[],listActions:null};var qc=Object(s.f)(Object(l.connect)(function(e,t){return{collection:t.collection||t.itemsType,items:e.entityList.items.get(t.itemsType),page:e.entityList.page.get(t.itemsType),state:e.entityList.state.get(t.itemsType),nextPage:e.entityList.nextPage.get(t.itemsType),sort:e.entityList.sort.get(t.itemsType),filter:e.entityList.filter.get(t.itemsType),size:e.entityList.size.get(t.itemsType),inProgress:e.progressIndicator>0}})(Bc)),zc=n(122),Hc=n.n(zc),Yc=n(123),Gc=n.n(Yc),Kc=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).playsValueToList=function(e){return""===e?g.c.List():g.c.List.isList(e)?e:Array.isArray(e)?g.c.List(Object(w.a)(e)):g.c.List(e.split(","))},n.onChange=function(e){var t=n.props.entity,a=n.playsValueToList(t.get("play","")),r=n.playsValueToList(e);if(a.every(function(e){return r.includes(e)}))return n.props.onChange(r.join(","));var i={children:"By removing play value all play related data will be removed",message:"Are you sure you want to change play?",onOk:function(){n.props.onChange(e,!0)},onCancel:function(){n.forceUpdate()},type:"delete",labelOk:"Yes"};return n.props.dispatch(po(i))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(il(["plays"]))}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.availablePlays,a=t.mandatory,r=t.editable,i=t.onChange,o=t.entity,l=!e.availablePlays.isEmpty()&&g.c.is(n,e.availablePlays);null===o.get("play",null)&&a&&r&&l&&i(e.availablePlays.find(function(e){return e.get("enabled",!0)&&e.get("default",!1)},null,e.availablePlays.first()).get("name",""))}},{key:"render",value:function(){var e=this.props,t=e.availablePlays,n=e.entity,a=e.editable,i=e.multi,o=e.mandatory,l=e.labelStyle,s=e.fieldStyle;if(!function(e){return e.size>1}(t))return null;var c=i?"Play/s":"Play",u=this.playsValueToList(n.get("play","")).join(",");return r.a.createElement(f.l,{key:"play"},r.a.createElement(f.g,{componentClass:f.h,sm:l.sm,lg:l.lg},c,o&&r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:s.sm,lg:s.lg},r.a.createElement(en,{fieldType:"select",options:Be(t),value:u,onChange:this.onChange,multi:i,placeholder:"",clearable:!o,editable:a})))}}]),t}(a.Component);Kc.defaultProps={availablePlays:g.c.List(),editable:!0,labelStyle:{sm:3,lg:2},fieldStyle:{sm:8,lg:9},multi:!1,mandatory:!1,onChange:function(){}};var Wc=Object(l.connect)(function(e,t){return{availablePlays:Rn(e,t)}})(Kc),Jc=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={fileError:null,delimiterError:null,operations:g.c.List()},n.setoperation=function(e,t){var a=Y(["import","allowed_entities_actions"],g.c.List()).filter(function(t){return t.includes(e)}).keySeq().map(function(e){return g.c.Map({value:e,label:Object(x.sentenceCase)(G(e,"import"))})}).toList();a.size>0&&(""===t||0===a.filter(function(e){return e.get("value","")===t}).size)&&n.props.onChange("operation",a.getIn([0,"value"],"")),n.setState({operations:a})},n.resetFile=function(){n.props.onChange("fileContent",""),n.props.onChange("fileName","")},n.onChangeOperation=function(e){n.props.onChange("operation",e)},n.onParseCsvComplete=function(e,t){0===e.errors.length?(n.props.onChange("fileContent",e.data),n.props.onChange("fileName",t.name)):(n.setState({fileError:"Error in CSV file"}),n.resetFile())},n.onParseScvError=function(e,t){n.setState({fileError:"Error in CSV file"}),n.resetFile()},n.onFileUpload=function(e){var t=n.props.item,a=e.target.files;if(n.isValidFile(a[0])){var r=t.get("fileDelimiter",",");Hc.a.parse(a[0],{skipEmptyLines:!0,delimiter:r,header:!1,complete:n.onParseCsvComplete,error:n.onParseScvError})}else{var i=1024*Y("importMaxSize",8)*1024;n.setState({fileError:"Max file size is ".concat(Gc()(i).human())}),e.target.value=null}},n.onFileReset=function(e){e.target.value=null,n.resetFile()},n.onChangeDelimiter=function(e){e.length?(n.props.onChange("fileDelimiter",e),n.setState({delimiterError:null})):(n.props.onDelete("fileDelimiter"),n.setState({delimiterError:"Delimiter is required"}))},n.onChangeEntity=function(e){n.props.onDelete("map"),n.props.onDelete("multiFieldAction"),n.props.onDelete("play"),e.length?n.props.onChange("entity",e):n.props.onDelete("entity")},n.onSelectExistingMapper=function(e){n.props.onSelectMapping(e)},n.onChangePlay=function(e){n.props.onDelete("map"),n.props.onDelete("multiFieldAction"),e.length?n.props.onChange("play",e):n.props.onDelete("play")},n.isValidFile=function(e){var t=1024*Y("importMaxSize",8)*1024;return e.size<=t},n.createEntityTypeOptions=function(e){return e.map(function(e){return{value:e,label:Object(x.sentenceCase)(Y(["systemItems",e,"itemName"],e))}})},n.createSavedMapperOptions=function(){return n.props.mapperOptions.map(function(e){return{value:e.get("label",""),label:e.get("label","")}}).toList()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.item;this.setoperation(e.get("entity",""),e.get("operation",""))}},{key:"componentWillReceiveProps",value:function(e){var t=e.item;this.props.item.get("entity","")!==t.get("entity","")&&this.setoperation(t.get("entity",""),t.get("operation",""))}},{key:"render",value:function(){var e=this.state,t=e.delimiterError,n=e.fileError,a=e.operations,i=this.props,o=i.item,l=i.delimiterOptions,s=i.entityOptions,c=i.mapperName,u=i.mapperOptions,p=i.showPlay,d=o.get("fileDelimiter",""),m=o.get("operation",""),g=o.get("entity",""),h=o.get("fileName",""),v=s&&1===s.length,y=this.createEntityTypeOptions(s),b=""!==h,E=a.map(oe).toJS(),C=this.createSavedMapperOptions().toJS();return r.a.createElement("div",{className:"StepUpload"},!v&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},"Entity"),r.a.createElement(f.g,{sm:9},r.a.createElement(en,{fieldType:"select",onChange:this.onChangeEntity,options:y,value:g,placeholder:"Select entity to import....",clearable:!1}))),r.a.createElement(f.l,{validationState:null===t?null:"error"},r.a.createElement(f.g,{sm:3,componentClass:f.h},"Delimiter"),r.a.createElement(f.g,{sm:9},r.a.createElement(en,{fieldType:"select",allowCreate:!0,onChange:this.onChangeDelimiter,options:l,value:d,placeholder:"Select or add new",addLabelText:"{label}",clearable:!1,disabled:b}),null!==t&&r.a.createElement(f.n,null,t,"."),b&&r.a.createElement(f.n,{className:"mb0"},"To change delimiter please remove CSV file."))),r.a.createElement(f.l,{validationState:null===n?null:"error"},r.a.createElement(f.g,{sm:3,componentClass:f.h},"Upload CSV"),r.a.createElement(f.g,{sm:9},r.a.createElement("div",{style:{paddingTop:5}},""!==h?r.a.createElement("p",{style:{margin:0}},h,r.a.createElement(f.c,{bsStyle:"link",title:"Remove file",onClick:this.onFileReset,style:{padding:"0 0 0 10px",marginBottom:1}},r.a.createElement("i",{className:"fa fa-minus-circle danger-red"}))):r.a.createElement("input",{type:"file",accept:".csv",onChange:this.onFileUpload,onClick:this.onFileReset}),null!==n&&r.a.createElement(f.n,null,n,".")))),a.size>1&&r.a.createElement(f.l,{validationState:null===t?null:"error"},r.a.createElement(f.g,{sm:3,componentClass:f.h},"Import Action"),r.a.createElement(f.g,{sm:9},r.a.createElement(en,{fieldType:"select",onChange:this.onChangeOperation,options:E,value:m,placeholder:"Select import action",addLabelText:"{label}",clearable:!1,disabled:1===a.size||""===g}))),p&&r.a.createElement(Wc,{entity:o,onChange:this.onChangePlay,labelStyle:{sm:3,lg:3},fieldStyle:{sm:9,lg:9}}),u.size>0&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},"Saved Mapper"),r.a.createElement(f.g,{sm:9},r.a.createElement(en,{fieldType:"select",onChange:this.onSelectExistingMapper,options:C,value:c,placeholder:"Select saved mapper",clearable:!0}))))}}]),t}(a.Component);Jc.defaultProps={item:g.c.Map(),mapperOptions:g.c.List(),delimiterOptions:[{value:"\t",label:"Tab"},{value:" ",label:"Space"},{value:",",label:"Comma"}],entityOptions:[],showPlay:!1,mapperName:"",onChange:function(){},onDelete:function(){},onSelectMapping:function(){}};var Qc=Jc,$c=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activityTypeError:"",propertyTypeError:""},n.onChangeField=function(e){var t=e.target,a=t.id,r=t.value,i="label"===a?["usage_type","label"]:[a],o="label"===a?[F.a.snakeCase(r),r]:[r];n.setState({activityTypeError:""===r?"Activity type required":""}),n.props.onUpdateItem(i,o)},n.onChangePropertyType=function(e){n.setState({propertyTypeError:""===e?"Property type required":""}),n.props.onUpdateItem(["property_type","invoice_uom","input_uom"],[e,"",""])},n.onChangeInvoiceUom=function(e){n.props.onUpdateItem("invoice_uom",e)},n.onChangeInputUom=function(e){n.props.onUpdateItem("input_uom",e)},n.getAvailablePropertyTypes=function(){return n.props.propertyTypes.map(function(e){return{value:e.get("type",""),label:e.get("type","")}}).toArray()},n.getUom=function(e){return n.props.propertyTypes.find(function(t){return t.get("type","")===e},null,g.c.Map()).get("uom",g.c.List())},n.getAvailableUom=function(){var e=n.props.item;return n.getUom(e.get("property_type","")).map(function(e){return{value:e.get("name",""),label:e.get("label","")}}).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.getAvailableUom();return r.a.createElement(Ye,{title:"Activity Type",show:!0,onOk:this.props.onSave,onCancel:this.props.onCancel,labelOk:"OK"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{validationState:""!==this.state.activityTypeError?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:4},"Activity Type"),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{id:"label",onChange:this.onChangeField,value:this.props.item.get("label",""),disabled:!this.props.editBase}),""!==this.state.activityTypeError&&r.a.createElement(f.n,null,this.state.activityTypeError))),r.a.createElement(f.l,{validationState:""!==this.state.propertyTypeError?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:4},"Property Type"),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",onChange:this.onChangePropertyType,value:this.props.item.get("property_type",""),options:this.getAvailablePropertyTypes(),disabled:!this.props.editBase}),""!==this.state.propertyTypeError&&r.a.createElement(f.n,null,this.state.propertyTypeError))),this.props.selectUoms&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:4},"Invoice Unit of Measure"),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",onChange:this.onChangeInvoiceUom,value:this.props.item.get("invoice_uom",""),options:e}))),this.props.selectUoms&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:4},"Default Unit of Measure"),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",onChange:this.onChangeInputUom,value:this.props.item.get("input_uom",""),options:e})))))}}]),t}(a.Component);$c.defaultProps={item:g.c.Map(),propertyTypes:g.c.List(),selectUoms:!1,editBase:!0};var Zc=$c,Xc=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={currentItem:null},n.onChangeUsaget=function(e){n.props.onChangeUsaget(e)},n.onChangeUnit=function(e){return function(t){n.props.onChangeUnit(t,e)}},n.onCancelNewUsageType=function(){n.setState({currentItem:null})},n.onSaveNewUsageType=function(){var e=n.props.usageTypesData,t=n.state.currentItem;n.setState({currentItem:null}),n.props.dispatch(Zo("usage_types",e.size,t)),n.props.dispatch(rl("usage_types")),n.props.onChangeUsaget(t.get("usage_type",""))},n.onClickNewUsageType=function(){n.setState({currentItem:g.c.Map()})},n.onUpdateUsageType=function(e,t){var a=n.state.currentItem,r=Array.isArray(e)?e:[e],i=Array.isArray(t)?t:[t];n.setState({currentItem:a.withMutations(function(e){r.forEach(function(t,n){return e.set(t,i[n])})})})},n.getAvailableUsageTypes=function(){var e=n.props,t=e.usageTypesData,a=e.usagetFilter;return t.filter(a).map(function(e){return{value:e.get("usage_type",""),label:e.get("label","")}}).toJS()},n.getAvailableUnits=function(){var e=n.props,t=e.propertyTypes,a=e.usageTypesData,r=e.usaget,i=e.unitFilter,o=e.showDisplayUnits,l=a.find(function(e){return e.get("usage_type","")===r})||g.c.Map();return(t.find(function(e){return e.get("type","")===l.get("property_type","")})||g.c.Map()).get("uom",g.c.List()).filter(function(e){return!1!==e.get("unit",!1)||o&&!1!==e.get("convertFunction",!1)}).filter(i).map(function(e){return{value:e.get("name",""),label:e.get("label","")}}).toArray()},n.renderUsageTypeSelect=function(){var e=n.props,t=e.enabled,a=e.editable,i=e.usaget;return e.showSelectTypes&&r.a.createElement(en,{fieldType:"select",options:n.getAvailableUsageTypes(),value:i,disabled:!t,editable:a,onChange:n.onChangeUsaget})},n.renderAddUsageTypeButton=function(){return r.a.createElement(f.c,{className:"btn-primary",onClick:n.onClickNewUsageType,disabled:!n.props.enabled},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0")},n.renderUnitSelect=function(){var e=n.props,t=e.enabled,a=e.editable,i=e.unit,o=e.usaget;return r.a.createElement(en,{fieldType:"select",onChange:n.onChangeUnit(o),value:i,options:n.getAvailableUnits(),disabled:!t||!o,editable:a})},n.renderNewUsageTypeForm=function(){var e=n.props.propertyTypes,t=n.state.currentItem;return t&&r.a.createElement(Zc,{item:t,propertyTypes:e,onUpdateItem:n.onUpdateUsageType,onSave:n.onSaveNewUsageType,onCancel:n.onCancelNewUsageType})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.usageTypesData,n=e.propertyTypes,a=[];t.isEmpty()&&a.push("usage_types"),n.isEmpty()&&a.push("property_types"),a.length>0&&this.props.dispatch(il(["usage_types","property_types"]))}},{key:"componentWillReceiveProps",value:function(e){this.props.usaget!==e.usaget&&this.onChangeUnit(e.usaget)("")}},{key:"render",value:function(){var e=this.props,t=e.showUnits,n=e.showAddButton,a=e.showSelectTypes,i=e.editable;return a?r.a.createElement("span",null,r.a.createElement(f.g,{sm:7,className:"pr0 pl0"},n&&i?r.a.createElement(f.o,null,r.a.createElement(f.o.Button,null,this.renderAddUsageTypeButton()),this.renderUsageTypeSelect()):this.renderUsageTypeSelect()),r.a.createElement(f.g,{sm:5,className:"pr0"},t&&this.renderUnitSelect()),this.renderNewUsageTypeForm()):r.a.createElement("span",null,t&&this.renderUnitSelect(),this.renderNewUsageTypeForm())}}]),t}(a.Component);Xc.defaultProps={usageTypesData:g.c.List(),propertyTypes:g.c.List(),usaget:"",unit:"",onChangeUsaget:function(){},onChangeUnit:function(){},editable:!0,enabled:!0,showUnits:!0,showAddButton:!0,usagetFilter:function(){return!0},unitFilter:function(){return!0},showSelectTypes:!0,showDisplayUnits:!1};var eu=Object(l.connect)(function(e,t){return{usageTypesData:Un(e,t),propertyTypes:Vn(e,t)}})(Xc),tu=function(e){var t=e.mapFrom,n=e.mapTo,a=e.defaultValue,i=e.options,o=e.mapResult,l=e.operation,s=e.defaultValuesOperation,c=e.entity,u=e.multiFieldAction,p=function(n){""!==n?(e.onChange(["map",t.value],n),t.multiple&&!u.has(t.value)&&e.onChange(["multiFieldAction",t.value],"append")):(e.onDelete(["map",t.value]),t.multiple&&e.onDelete(["multiFieldAction",t.value]))},d=function(t){e.onChange(["map","usage_type_unit"],t)},m=function(t){e.onChange(["map","usage_type_value"],t)},g=function(n){e.onChange(["multiFieldAction",t.value],n),"remove"===n&&e.onDelete(["map",t.value])},h=t.unique||"create"!==l&&t.multiple,v=function(){switch(t.value){case"usage_type":return r.a.createElement(eu,{usaget:o.get("usage_type_value"),unit:o.get("usage_type_unit"),onChangeUsaget:m,onChangeUnit:d});case"tariff_category":var e=t.select_options&&t.select_options.length?t.select_options.split(",").filter(function(e){return""!==e}).map(function(e){return{value:e,label:Object(x.sentenceCase)(e)}}):[];return r.a.createElement(en,{fieldType:"select",value:n,onChange:p,options:e,placeholder:"Select ".concat(t.label)});default:var a=t.multiple&&"remove"===u.get(t.value,"");return r.a.createElement(en,{fieldType:"select",allowCreate:!0,options:i,value:n,onChange:p,placeholder:"Select CSV field or set default value...",addLabelText:'Click to set default value "{label}" for all rows',disabled:a})}},y=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?r.a.createElement("span",null,function(e){switch(e){case"append":return r.a.createElement("i",{className:"fa fa-plus"});case"replace":return r.a.createElement("i",{className:"fa fa-refresh"});case"remove":return r.a.createElement("i",{className:"fa fa-trash-o danger-red"});default:return""}}(e),"\xa0"):"";switch(e){case"append":return r.a.createElement("span",null,t,"Append");case"replace":return r.a.createElement("span",null,t,"Replace");case"remove":return r.a.createElement("span",null,t,"Remove");default:return"Select action..."}};return r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},t.label,t.mandatory&&null===a&&"create"===l&&r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:9},h?r.a.createElement(f.o,null,v(),t.unique&&r.a.createElement(f.o.Addon,null,r.a.createElement(f.p,{bsStyle:"info"},"Unique field")),function(){if("create"===l||!t.multiple)return null;var e=u.get(t.value,!1),n=r.a.createElement("span",{className:"control-label"},y(e));return r.a.createElement(f.i,{onSelect:g,id:"".concat(t.value,"-actions"),componentClass:f.o.Button,title:n},function(){var e=!o.has(t.value)&&"remove"!==u.get(t.value,!1);return["append","replace","remove"].map(function(n){var a=u.get(t.value,!1)===n;return r.a.createElement(f.q,{eventKey:n,active:a,key:"".concat(t.value,"-").concat(n,"-action"),disabled:e&&"remove"!==n},y(n))})}())}()):v(),"string"===typeof t.help&&""!==t.help&&r.a.createElement(f.n,{className:"mb0 mt0"},t.help),null!==a&&s.get(l).includes(c)&&r.a.createElement(f.n,{className:"mb0"},"Default value if no value is selected:\xa0",r.a.createElement(f.p,{bsStyle:"primary",style:{padding:"1px 6px",fontWeight:"bold"}},!0===a?"Yes":!1===a?"No":a))))};tu.defaultProps={mapResult:g.c.Map(),mapFrom:"",mapTo:"",defaultValue:null,options:[],entity:"",operation:"",defaultValuesOperation:Y(["import","default_values_allowed_actions"],g.c.Map()),multiFieldAction:g.c.Map(),onChange:function(){},onDelete:function(){}};var nu=tu,au=function(e){var t=e.item,n=e.fields,a=e.ignoredHeaders,i=e.mapperPrefix,o=e.defaultFieldsValues,l=t.get("fileContent",[])||[],s=t.getIn(["linker","field"],"")||"",c=t.getIn(["linker","value"],"")||"",u=t.getIn(["updater","field"],"")||"",p=t.getIn(["updater","value"],"")||"",d=t.get("operation","create"),m=l[0]||[],g=function(t){""!==t?e.onChange(["linker","field"],t):e.onDelete(["linker","field"])},h=function(t){""!==t?e.onChange(["linker","value"],t):e.onDelete(["linker","value"])},v=function(t){""!==t?e.onChange(["updater","field"],t):e.onDelete(["updater","field"])},y=function(t){""!==t?e.onChange(["updater","value"],t):e.onDelete(["updater","value"])},b=function(t){""!==t?e.onChange(["map","effective_date"],t):e.onDelete(["map","effective_date"])},E=function(e,t){return e.mandatory&&!t.mandatory?-1:!e.mandatory&&t.mandatory?1:e.unique&&!t.unique?-1:!e.unique&&t.unique?1:n.findIndex(function(t){return t.value===e.value})>n.findIndex(function(e){return e.value===t.value})?1:-1},C=function(t){return!t.generated&&!1!==t.show&&"effective_date"!==t.value&&t.editable&&(!t.hasOwnProperty("linker")||!t.linker)&&e.customFilterFields(t)},_=m.map(function(e,t){return{label:e,value:"".concat(i).concat(t)}}).filter(function(e){return!a.includes(e.label)});return r.a.createElement(f.g,{md:12,className:"StepMapper scrollbox"},function(){if(0===l.length)return r.a.createElement(f.p,{bsStyle:"default"},"Please upload file.");if(0===m.length)return r.a.createElement(f.p,{bsStyle:"default"},"No CSV headers was found, please check your file.");var a=n.filter(C).sort(E).map(function(n){var a=o.find(function(e,t){return t===n.value});return r.a.createElement(nu,{key:"header_".concat(n.value),defaultValue:a,mapFrom:n,mapTo:t.getIn(["map",n.value],""),operation:d,entity:t.get("entity"),options:_,mapResult:t.get("map"),multiFieldAction:t.get("multiFieldAction"),mapperPrefix:i,onChange:e.onChange,onDelete:e.onDelete})}),O=function(){var e=n.filter(function(e){return e.hasOwnProperty("linker")&&e.linker}).map(function(e){return{value:e.value,label:e.label}});return 0===e.length?null:r.a.createElement(f.v,{header:"Linker",className:"mb0"},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},"Link to field",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:9},r.a.createElement(en,{fieldType:"select",onChange:g,options:e,value:s,placeholder:"Select field to link..."}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},"Link by value from",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:9},r.a.createElement(en,{fieldType:"select",onChange:h,options:_,value:c,placeholder:"Select CSV field to link..."}))))}(),S=function(){var e=n.filter(function(e){return e.hasOwnProperty("updater")&&e.updater}).map(function(e){return{value:e.value,label:e.label}});return 0===e.length?null:r.a.createElement(f.v,{header:"Updater"},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:6,componentClass:f.h,className:"text-left"},"Unique field used for the update",r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(en,{fieldType:"select",onChange:v,options:e,value:u,placeholder:"Select field to  update by..."})),r.a.createElement(f.g,{sm:6,componentClass:f.h,className:"text-left"},"Match unique field to CSV column",r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(en,{fieldType:"select",onChange:y,options:_,value:p,placeholder:"Select CSV field to update..."}))),r.a.createElement("hr",{className:"mt0 mb10"}),r.a.createElement(f.l,{className:"mb0"},r.a.createElement(f.g,{sm:3,componentClass:f.h},"Update Revision by Effective Date",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:9},r.a.createElement(en,{fieldType:"select",onChange:b,options:_,value:t.getIn(["map","effective_date"],""),placeholder:"Select CSV field to update..."}))))}();return r.a.createElement("div",null,null!==S&&"permanentchange"===d&&S,r.a.createElement("div",null,a),null!==O&&O)}())};au.defaultProps={item:g.c.Map(),fields:[],defaultFieldsValues:g.c.Map(),ignoredHeaders:[],mapperPrefix:"",customFilterFields:function(){return!0},onChange:function(){},onDelete:function(){}};var ru=au,iu=function(e){var t=e.fields,n=e.rows,i=e.selectedMapper,o=e.defaultMappedName,l=e.saveMapper,s=e.removeMapper,c=e.entity,u=Object(a.useState)(["",null].includes(i)?o:i),p=Object(Ti.a)(u,2),d=p[0],m=p[1],h=n.get(0,g.c.Map()),v=h.filter(function(e,t){return["__UPDATER__","effective_date"].includes(t)}),y=h.filter(function(e,t){return!["__LINKER__","__UPDATER__","__MULTI_FIELD_ACTION__","__CSVROW__","__ERRORS__","effective_date"].includes(t)}),b=function(e){var t=["",null].includes(e)?o:e;l(t)},E=[{type:"edit",helpText:"Update mapper with new mapping or name",onClick:b,show:null!==i,actionSize:"xsmall",actionStyle:"primary"},{type:"add",helpText:"Save Mapper for latter use",onClick:b,show:null===i,actionSize:"xsmall",actionStyle:"primary"},{type:"remove",helpText:"Remove Mapper",onClick:function(e){m(""),s(e)},show:null!==i,actionSize:"xsmall",actionStyle:"danger"}],C=function(e,t){return e.isEmpty()?null:r.a.createElement(f.v,{header:"Errors",key:t},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:12},e.sortBy(function(e,t){return parseInt(t)}).map(function(e,t){return r.a.createElement("dl",{className:"mb0",key:t},r.a.createElement("dt",null,"row ",t),e.map(function(e,n){return r.a.createElement("dd",{key:"".concat(t,"-").concat(n)},"- ",e)}))}).toList().toArray())))};return r.a.createElement("div",{className:"StepValidate"},r.a.createElement("div",null,r.a.createElement("h4",{className:"pull-left"},"Example Import"),r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.o,{style:{width:300,marginTop:7}},r.a.createElement(f.o.Addon,{style:{fontSize:13,padding:"6px 9px"}},"Mapper"),r.a.createElement("input",{type:"text",className:"form-control",value:d,onChange:function(e){var t=e.target.value;m(t)},placeholder:"Enter mapper name",style:{height:28,fontSize:13}}),r.a.createElement(f.o.Button,null,r.a.createElement(Xe,{actions:E,data:d,isGroup:!0})))),r.a.createElement("div",{className:"clearfix"})),r.a.createElement("hr",{className:"mt0 mb0"}),r.a.createElement("div",{className:"row-fields scrollbox"},n.map(function(e){return e.filter(function(e,t){return"__ERRORS__"===t}).map(C).toList().toArray()}),y.size>0&&r.a.createElement(f.v,{header:"Map"},y.map(function(e,n){var a=t.find(function(e){return e.value===n}),i=["number","string","boolean"].includes(typeof e)?e:"complex value cannot be displayed in preview";return r.a.createElement(f.l,{key:"row_".concat(n)},r.a.createElement(f.g,{sm:3,componentClass:f.h},a?a.label:G(n,K(c),Object(x.sentenceCase)(n))),r.a.createElement(f.g,{sm:9},r.a.createElement(en,{value:i,disabled:!0})))}).toList().toArray()),h.filter(function(e,t){return"__LINKER__"===t}).map(function(e,n){var a=t.find(function(t){return t.value===e.get("field","")});return r.a.createElement(f.v,{header:"Linker",className:"mb0",key:n},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},a?a.label:e.get("field","")),r.a.createElement(f.g,{sm:9},r.a.createElement(en,{value:e.get("value",""),disabled:!0}))))}).toList().toArray(),v.size>0&&r.a.createElement(f.v,{header:"Updater",className:"mb0"},v.map(function(e,n){var a="effective_date"===n?"effective_date":e.get("field",""),i="effective_date"===n?e:e.get("value",""),o=t.find(function(e){return e.value===a});return r.a.createElement(f.l,{key:n},r.a.createElement(f.g,{sm:3,componentClass:f.h},o?o.label:a),r.a.createElement(f.g,{sm:9},r.a.createElement(en,{value:i,disabled:!0})))}).toList().toArray())))};iu.defaultProps={fields:[],entity:"",selectedMapper:"",defaultMappedName:"",rows:g.c.List(),saveMapper:function(){},removeMapper:function(){}};var ou=iu,lu=n(267),su=function(e){var t=e.item,n=t.get("fileDelimiter",","),a=t.get("fileContent",[])||[],i=t.get("fileName","errors"),o=t.get("result",g.c.List())||g.c.List(),l=function(){return r.a.createElement("div",{className:"scrollbox"},o.sortBy(function(e,t){return parseInt(t)}).map(function(e,t){return r.a.createElement("dl",{className:"mb0",key:"status_".concat(t)},r.a.createElement("dt",null,"row ".concat(t," "),!0===e&&r.a.createElement(f.p,{bsStyle:"success"},"Success"),!1===e&&r.a.createElement(f.p,{bsStyle:"info"},"No errors"),!1!==e&&!0!==e&&!g.c.Iterable.isIterable(e)&&r.a.createElement(f.p,{bsStyle:"danger"},e)),g.c.Iterable.isIterable(e)&&e.map(function(e,n){return r.a.createElement("dd",{key:"status_error_".concat(t,"_").concat(n)},"- ",r.a.createElement(f.p,{bsStyle:"danger"},e))}).toArray())}).toList().toArray())};return r.a.createElement("div",{className:"StepResult"},r.a.createElement("h4",null,"Import status"),function(){if(0===o.length)return r.a.createElement("div",null,r.a.createElement(f.p,{bsStyle:"default"},"No records were imported"));if(o.every(function(e){return!0===e}))return r.a.createElement("div",null,r.a.createElement(f.p,{bsStyle:"success"},o.size," records were successfully imported"));if(o.every(function(e){return!0!==e}))return r.a.createElement("div",null,r.a.createElement("p",null,"No records were imported, please fix errors and try again."),r.a.createElement("hr",{style:{marginBottom:0}}),l());var e=o.filter(function(e){return!0===e}),t=function(){var e=[];return o.forEach(function(t,n){!0!==t&&a[n-1]&&e.push([].concat(Object(w.a)(a[n-1]),[t,n]))}),e}(),s=[].concat(Object(w.a)(a[0]),["import_error_message","import_error_row"]);return r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement(f.p,{bsStyle:"success"},e.length)," rows were successfully imported.",r.a.createElement("br",null),r.a.createElement(f.p,{bsStyle:"danger"},o.size-e.length)," rows were faild import.",r.a.createElement("br",null),"Please remove successfully imported rows from file, fix errors and try again."),r.a.createElement(lu.CSVLink,{data:t,headers:s,separator:n,filename:"errors_".concat(i)},"Click here to download CSV file with errors"),r.a.createElement("hr",{style:{marginBottom:0}}),l())}())};su.defaultProps={item:g.c.Map()};var cu=su,uu=g.c.Map({map:g.c.Map(),fileDelimiter:","}),pu=function(){return hl("importer",uu)},du=function(e,t){return gl("importer",e,t)},mu=function(e){return fl("importer",e)},gu=function(e,t,n){return function(e,t,n){return function(a){a(Aa());var r=El(0,t,"import");r.append("operation",n);var i=wr(e,"import",r);return ir(i,{timeOutMessage:sl}).then(function(e){return a(tr(e))}).catch(function(e){return a(nr(e,"Error saving Entities"))})}}(e,t,n)},fu=n(33),hu=Object(on.a)(qn,function(e){return e?-1!==e.findIndex(ce)?e:e.push(g.c.Map({unique:!0,generated:!1,mandatory:!0,field_name:"account_import_id",title:"Customer Import ID (for subscriber import)"})):e}),vu=Object(on.a)(Yn,hu,function(e,t){if(e){var n=t.filter(ce);return n.size>0?e.withMutations(function(e){n.forEach(function(t){e.push(g.c.Map({linker:!0,field_name:t.get("field_name","linker"),title:t.get("title",t.get("field_name","linker"))}))})}):e.push(g.c.Map({linker:!0,field_name:"account_import_id",title:"Customer Import ID"}))}return e}),yu=Object(on.a)(Wn,function(e){var t=["to","rates","tax"],n=["key"],a=["tariff_category"];return g.c.List().withMutations(function(r){e.forEach(function(e){var i=e.withMutations(function(e){n.includes(e.get("field_name",""))&&e.set("unique",!0),a.includes(e.get("field_name",""))&&e.set("mandatory",!0),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("unique",!1)||"key"===e.get("field_name","")&&e.get("mandatory",!1)&&e.get("system",!1)||"name"===e.get("field_name","")&&e.get("mandatory",!1)&&e.get("system",!1)}(e)&&e.set("updater",!0)}),o=i.get("editable",!0),l=t.includes(i.get("field_name",""));if(o&&!l?r.push(i):r.push(i.set("show",!1)),"tax"===i.get("field_name","")){var s=g.c.Map({field_name:"tax__taxation",title:"Taxation"});r.push(Fe(s,"product"));var c=g.c.Map({field_name:"tax__custom_tax",title:"Tax custom rate"});r.push(Fe(c,"product"));var u=g.c.Map({field_name:"tax__custom_logic",title:"Tax custom logic"});r.push(Fe(u,"product"))}if("rates"===i.get("field_name","")){var p=g.c.Map({field_name:"price_from"});r.push(Fe(p,"product"));var d=g.c.Map({field_name:"price_to"});r.push(Fe(d,"product"));var m=g.c.Map({field_name:"price_interval"});r.push(Fe(m,"product"));var f=g.c.Map({field_name:"price_value"});r.push(Fe(f,"product"));var h=g.c.Map({field_name:"price_plan"});r.push(Fe(h,"product"));var v=g.c.Map({field_name:"rates.percentage",help:"Field will effect only if 'Plan Price Override' value is different from BASE"});r.push(Fe(v,"import"))}});var i=g.c.Map({field_name:"usage_type",mandatory:!0});r.push(i);var o=g.c.Map({field_name:"effective_date",mandatory:!0});r.push(o)})}),bu=Object(on.a)(On,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("mapping",g.c.List()).toList()}),Eu=Object(on.a)(ui,hu,vu,yu,function(e,t,n,a){return Object(fu.d)(function(e){return e?e.toArray():void 0},function(t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Map();if(e){var n=t.get("entity",""),a={subscription:[{value:"from",label:"From",editable:!0,generated:!1,unique:!1,mandatory:!0},{value:"to",label:"To",editable:!0,generated:!1,unique:!1,mandatory:!0}]};return e.withMutations(function(t){(a[n]||[]).filter(function(t){return-1===e.findIndex(function(e){return e.value===t.value})}).forEach(function(e){t.push(e)})})}}(t,e)},function(t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Map(),n=K(t.get("entity",""));if(e)return e.map(function(e){return{value:e.get("field_name",""),label:e.get("title",G(e.get("field_name",""),n)),editable:e.get("editable",!0),generated:e.get("generated",!1),unique:e.get("unique",!1),mandatory:e.get("mandatory",!1),linker:e.get("linker",!1),updater:e.get("updater",!1),select_options:e.get("select_options",!1),multiple:e.get("multiple",!1),help:e.get("help",!1),show:e.get("show",!0),plays:e.get("plays",g.c.List())}})}(t,e)},ni)(e,t,n,a)}),Cu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={status:"create",stepIndex:0,mapperPrefix:"__csvindex__"},n.onChange=function(e,t){var a=n.props.item.get("operation","create");n.props.dispatch(du(e,t)),"operation"===e&&a!==t&&n.onSelectMapping()},n.onDelete=function(e){n.props.dispatch(mu(e))},n.onFinish=function(){n.props.onFinish&&n.props.onFinish()},n.onImport=function(){var e=n.props.item,t=e.get("entity",""),a=e.get("operation","create"),r=n.alterData(n.getFormatedRows());if(r.size>0&&""!==t){n.setState({status:"progress"});var i=Y(["systemItems",t,"collection"],"");n.props.dispatch(gu(i,r,a)).then(n.afterImport)}else n.props.dispatch(Qa("No Import data found"))},n.onNextStep=function(){var e=n.state.stepIndex;n.setState({stepIndex:e+1})},n.onPrevStep=function(){var e=n.state.stepIndex;n.setState({stepIndex:e-1})},n.combineRateLines=function(e,t,a){var r=n.props,i=r.importFields,o=r.item,l=i.filter(function(e){return e.multiple}).map(function(e){return e.value}),s=o.get("operation","create"),c=["__MULTI_FIELD_ACTION__","__UPDATER__","__CSVROW__","__ERRORS__","price_plan","price_from","price_to","price_interval","price_value","usage_type_value","usage_type_unit"],u=["tax__type","tax__taxation","tax__custom_logic","tax__custom_tax"];return e.withMutations(function(e){if(""!==t.get("rates.percentage","")&&"BASE"!==t.get("price_plan","BASE")){var n=["rates",t.get("usage_type_value","_KEEP_SOURCE_USAGE_TYPE_"),t.get("price_plan","BASE"),"percentage"],r=parseFloat(t.get("rates.percentage",1));e.setIn(n,r)}else if(""!==t.get("price_value",""))if(t.has("price_from")&&t.has("price_to")&&t.has("price_interval")&&t.has("price_value")&&(t.has("usage_type_unit")&&t.has("usage_type_value")&&"create"===s||"create"!==s)){var i=["rates",t.get("usage_type_value","_KEEP_SOURCE_USAGE_TYPE_"),t.get("price_plan","BASE"),"rate"],p=g.c.Map({from:t.get("price_from",0),to:t.get("price_to","UNLIMITED"),interval:t.get("price_interval",0),price:t.get("price_value",0),uom_display:g.c.Map({range:t.get("usage_type_unit","_KEEP_SOURCE_USAGE_TYPE_UNIT_"),interval:t.get("usage_type_unit","_KEEP_SOURCE_USAGE_TYPE_UNIT_")})});e.updateIn(i,g.c.List(),function(e){return e.push(p)})}else{var d=["price_from","price_to","price_interval","price_value"];"create"===o.get("operation","create")&&(d.push("usage_type_value"),d.push("usage_type_unit")),d.forEach(function(n){t.has(n)||e.update("__ERRORS__",g.c.Map(),function(e){return e.update(t.get("__CSVROW__","unknown"),g.c.List(),function(e){return e.push("missing ".concat(n," data"))})})})}t.forEach(function(n,r){if(0===a||c.includes(r)||u.includes(r)||l.includes(r)||n===e.get(r,"")||e.update("__ERRORS__",g.c.Map(),function(e){return e.update(t.get("__CSVROW__","unknown"),g.c.List(),function(e){return e.push("different values for ".concat(r," field"))})}),l.includes(r)){var i=e.get(r,g.c.List());if(!g.c.List.isList(i)){var o=i.split(",").map(function(e){return e.trim()});e.set(r,g.c.List(o))}var s=g.c.Set(e.get(r,g.c.List()));s=s.concat(n.split(",").map(function(e){return e.trim()})),e.set(r,s.toList())}if(u.includes(r)&&t.has(r)){var p=r.split("__"),d=[p[0],0,p[1]];0!==a&&n!==e.getIn(d,"")?e.update("__ERRORS__",g.c.Map(),function(e){return e.update(t.get("__CSVROW__","unknown"),g.c.List(),function(e){return e.push("different values for ".concat(Object(x.titleCase)(p[0])," ").concat(Object(x.titleCase)(p[1])," field"))})}):e.update(p[0],g.c.List(),function(e){return e.update(0,g.c.Map(),function(e){return e.set(p[1],t.get(r,""))})})}});var m=e.get("__CSVROW__",g.c.List());g.c.List.isList(m)||(m=g.c.List([m])),0!==a&&(m=m.push(t.get("__CSVROW__","unknown"))),e.set("__CSVROW__",m),e.delete("tax__custom_logic").delete("tax__custom_tax").delete("tax__taxation").delete("rates.percentage").delete("price_plan").delete("price_from").delete("price_to").delete("price_interval").delete("price_value").delete("usage_type_value").delete("usage_type_unit")})},n.alterProductsData=function(e){return g.c.List().withMutations(function(t){var a=n.props.item.get("operation","create"),r="create"===a?"from":"effective_date",i=g.c.fromJS(e).sortBy(function(e){return e.get(r,"")}).reverse().groupBy(function(e){return e.getIn(["__UPDATER__","value"],e.get("key","key"))}).map(function(e){return e.sortBy(function(e){return e.get("price_from","")}).groupBy(function(e){return e.get(r,"")}).map(function(e){return e.reduce(n.combineRateLines,e.first())})}),o=!1;i.forEach(function(e){e.forEach(function(e){e.withMutations(function(n){e.has(r)||n.update("__ERRORS__",g.c.Map(),function(t){return t.withMutations(function(t){e.get("__CSVROW__",g.c.List()).forEach(function(e){t.update(e,g.c.List(),function(e){return e.push("missing ".concat(r," field"))})})})}),"permanentchange"!==a||e.has("__UPDATER__")||n.update("__ERRORS__",g.c.Map(),function(t){return t.withMutations(function(t){e.get("__CSVROW__",g.c.List()).forEach(function(e){t.update(e,g.c.List(),function(e){return e.push("missing updater field")})})})}),n.has("__ERRORS__")&&(o=!0),t.push(n)})})}),n.props.dispatch(du("error",o))})},n.alterData=function(e){switch(n.props.item.get("entity","")){case"product":return n.alterProductsData(e);default:return e}},n.saveMapper=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mapper was saved",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Error saving mapper";n.props.dispatch(Zo("import","mapping",e));var r={success:t,error:a};n.props.dispatch(rl("import.mapping",r))},n.removeMapper=function(){var e=n.props,t=e.item,a=e.savedMappers,r=t.get("mapperName","");n.saveMapper(a.filter(function(e){return e.get("label","")!==r}),"Mapper '".concat(r,"' was removed")),n.props.dispatch(du("mapperName",""))},n.onSaveMapping=function(e){var t=n.props,a=t.item,r=t.savedMappers,i=a.get("mapperName",""),o=r.findIndex(function(t){return t.get("label","")===e}),l=a.get("map",g.c.List()),s=a.get("linker",g.c.Map()),c=a.get("updater",g.c.Map()),u=a.get("multiFieldAction",g.c.Map()),p=g.c.Map({label:e,map:l,updater:c,linker:s,multiFieldAction:u});if(""===i||-1===o){if(-1!==o)return void n.props.dispatch(Qa('Mapper with name "'.concat(e,'" already exists')));n.saveMapper(r.push(p),"Mapper '".concat(e,"' was saved")),n.props.dispatch(du("mapperName",e))}else n.saveMapper(r.set(o,p),"Mapper '".concat(e,"' was updated")),n.props.dispatch(du("mapperName",e))},n.onSelectMapping=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=n.props.savedMappers.find(function(t){return t.get("label","")===e},null,g.c.Map()),a=t.get("map",g.c.Map())===g.c.List()?g.c.Map():t.get("map",g.c.Map());n.props.dispatch(du("map",a.filter(function(e,t){return n.customFilterMapperFields({value:t})})));var r=t.get("linker",g.c.Map())===g.c.List()?g.c.Map():t.get("linker",g.c.Map());n.props.dispatch(du("linker",r));var i=t.get("updater",g.c.Map())===g.c.List()?g.c.Map():t.get("updater",g.c.Map());n.props.dispatch(du("updater",i));var o=t.get("multiFieldAction",g.c.Map())===g.c.List()?g.c.Map():t.get("multiFieldAction",g.c.Map());n.props.dispatch(du("multiFieldAction",o)),n.props.dispatch(du("mapperName",e))},n.getOkButtonLable=function(){switch(n.state.stepIndex){case 2:case"2":return"Confirm and Import";case 3:case"3":return"Close";default:return"Next"}},n.getOkButtonAction=function(){switch(n.state.stepIndex){case 2:case"2":return n.onImport;case 3:case"3":return n.onFinish;default:return n.onNextStep}},n.getFormatedRows=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=n.props,a=t.item,r=t.predefinedValues,i=t.defaultValues,o=t.importFields,l=t.predefinedValuesOperation,s=t.defaultValuesOperation,c=n.state.mapperPrefix,u=a.get("fileContent",[]),p=a.get("linker",null),d=a.get("updater",null),m=a.get("entity",[]),f=a.get("operation","create"),h=a.get("map",g.c.List()),v=a.get("multiFieldAction",null);return g.c.List().withMutations(function(t){if(Array.isArray(u))for(var n=-1===e?u.length:Math.min(e+1,u.length),a=function(e){var n=g.c.Map().withMutations(function(t){if(h.forEach(function(n,a){var r=n;if(n.startsWith(c)){var i=n.substring(c.length);r=u[e][i]}var l=o.find(function(e){return e.value===a});"ranges"===(l?l.type:"string")&&(r=g.c.List().withMutations(function(e){r.split(",").forEach(function(t){var n=t.split("-");e.push(g.c.Map({from:n[0],to:n[1]}))})})),t.set(a,r)}),["create"].includes(f)&&l.get(f,g.c.List()).includes(m)&&r.has(m)&&r.get(m,g.c.Map()).forEach(function(e,n){t.set(n,e)}),["create"].includes(f)&&s.get(f,g.c.List()).includes(m)&&i.has(m)&&i.get(m,g.c.Map()).forEach(function(e,n){""===t.get(n,"")&&t.set(n,e)}),null!==p&&""!==p.get("field","")&&""!==p.get("value","")){var n=p.get("value","").substring(c.length);t.set("__LINKER__",g.c.Map({field:p.get("field",""),value:u[e][n]}))}if(null!==d&&""!==d.get("field","")&&""!==d.get("value","")){var a=d.get("value","").substring(c.length);t.set("__UPDATER__",g.c.Map({field:d.get("field",""),value:u[e][a]}))}null===v||v.isEmpty()||t.set("__MULTI_FIELD_ACTION__",v),t.set("__CSVROW__",e+1)});t.push(n)},y=1;y<n;y++)a(y)})},n.afterImport=function(e){if([1,2].includes(e.status)){var t=g.c.fromJS(e.data)||g.c.Map(),a=t.every(function(e){return!0===e}),r=t.every(function(e){return!0!==e});a||t.size>0&&!r?n.setState({status:"finish"}):n.setState({status:"create"}),n.onChange("result",t),n.onNextStep()}else n.onDelete("result"),n.setState({status:"create"})},n.customFilterMapperFields=function(e){var t=n.props,a=t.item,r=t.hiddenActionFields,i=a.get("entity",""),o=e.plays||g.c.List(),l=a.get("play","");if(!o.isEmpty()&&""!==l&&!o.includes(l))return!1;var s=a.get("operation","create");return!r.getIn([s,i],g.c.List()).includes(e.value)},n.renderStepper=function(){var e=n.state.stepIndex;return r.a.createElement(Si,{activeIndex:e,steps:t.importerSteps})},n.renderStepContent=function(){var e=n.props,t=e.item,a=e.importFields,i=e.entityOptions,o=e.ignoredHeaders,l=e.defaultValues,s=e.savedMappers,c=e.showPlay,u=n.state,p=u.stepIndex,d=u.mapperPrefix,m=t.get("entity",""),f=t.get("mapperName","");switch(p){case 0:return r.a.createElement(Qc,{item:t,entityOptions:i,onChange:n.onChange,onDelete:n.onDelete,onSelectMapping:n.onSelectMapping,mapperName:f,mapperOptions:s,showPlay:c});case 1:return r.a.createElement(ru,{item:t,customFilterFields:n.customFilterMapperFields,onChange:n.onChange,onDelete:n.onDelete,fields:a,defaultFieldsValues:l.get(m,g.c.Map()),ignoredHeaders:o,mapperPrefix:d});case 2:return r.a.createElement(ou,{entity:m,fields:a,rows:n.alterData(n.getFormatedRows()),selectedMapper:""===f?null:f,defaultMappedName:""===t.get("fileName","")?void 0:t.get("fileName"),saveMapper:n.onSaveMapping,removeMapper:n.removeMapper});case 3:return r.a.createElement(cu,{item:t});default:return r.a.createElement("p",null,"Not valid Step")}},n.renderActionButtons=function(){var e=n.state,t=e.stepIndex,a=e.status,i=n.props.item,o="progress"===a,l="finish"===a,s=2===t&&i.get("error",!1);return r.a.createElement(v,{cancelLabel:n.getOkButtonLable(),onClickCancel:n.getOkButtonAction(),disableCancel:o||s,saveLabel:"Back",hideCancel:3===t&&null===n.props.onFinish,disableSave:0===t||o||l,onClickSave:n.onPrevStep,reversed:!0})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.entityOptions;this.props.dispatch(pu()),e&&1===e.length&&this.onChange("entity",e[0]),this.props.dispatch(il("import.mapping"))}},{key:"componentWillReceiveProps",value:function(e){e.restartString!==this.props.restartString&&(this.props.dispatch(pu()),this.setState({status:"create",stepIndex:0}))}},{key:"componentWillUnmount",value:function(){this.props.dispatch(bl("importer"))}},{key:"render",value:function(){return r.a.createElement("div",{className:"Importer"},this.renderStepper(),r.a.createElement("hr",{style:{margin:"20px -15px 0 -15px"}}),r.a.createElement(f.j,{horizontal:!0,className:"mb0"},this.renderStepContent()),r.a.createElement("div",{className:"clearfix"}),r.a.createElement("hr",{className:"mt0"}),this.renderActionButtons())}}]),t}(a.Component);Cu.defaultProps={entityOptions:Y(["import","allowed_entities"],g.c.List()).toJS(),item:g.c.Map(),importFields:[],predefinedValues:g.c.Map(),defaultValues:g.c.Map(),defaultValuesOperation:Y(["import","default_values_allowed_actions"],g.c.Map()),predefinedValuesOperation:Y(["import","predefined_values_allowed_actions"],g.c.Map()),hiddenActionFields:Y(["import","hidden_actions_fields"],g.c.Map()),ignoredHeaders:["import_error_message","import_error_row"],savedMappers:g.c.List(),restartString:"",showPlay:!1,onFinish:null},Cu.importerSteps=[{title:"Upload File"},{title:"Field Map"},{title:"Validate"},{title:"Finish"}];var _u=Object(l.connect)(function(e,t){var n=ui(e,t,"importer"),a=n?n.get("entity",""):"",r=Y(["import","allowed_plays"],g.c.List()),i=jn(e,t);return{item:n,importFields:Eu(e,t,"importer"),savedMappers:bu(e,t,"importer"),showPlay:i&&r.includes(a)}})(Cu),Ou=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={refreshString:""},n.onCloseImport=function(){var e=n.props,t=e.item;if(e.importEntity){if(["subscription","customer"].includes(t.get("entity","")))n.props.dispatch(Fc("customers")),n.props.dispatch(Fc("subscribers"));else{var a=Y(["systemItems",t.get("entity",""),"itemsType"],"");n.props.dispatch(Fc(a))}var r=["subscription","customer"].includes(t.get("entity",""))?"customer":t.get("entity",""),i=Y(["systemItems",r,"itemsType"],"");n.props.router.push("/".concat(i))}else n.setState({refreshString:S()().format()})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.importEntity;if(e){var t=Y(["systemItems",e,"itemsName"],e);this.props.dispatch(ro(Object(x.titleCase)("Import ".concat(t))))}else this.props.dispatch(ro("Import"));this.props.dispatch(il(["rates.fields","subscribers.account","subscribers.subscriber"]))}},{key:"componentWillReceiveProps",value:function(e){var t=e.importEntity;if(this.props.importEntity!==t)if(t){var n=Y(["systemItems",t,"itemsName"],t);this.props.dispatch(ro(Object(x.titleCase)("Import ".concat(n))))}else this.props.dispatch(ro("Import"))}},{key:"render",value:function(){var e=this.state.refreshString,t=this.props.importEntity,n=t?[t]:t,a=Y("apiDateFormat","YYYY-MM-DD"),i=S()().format(a),o=S()().add(100,"years").format(a),l=g.c.Map({from:i,to:o}),s=g.c.Map({from:i,to:o}),c=g.c.Map({from:i,to:o,price_plan:"BASE",pricing_method:"tiered",price_from:0,price_to:Y("productUnlimitedValue","")}),u=g.c.Map({subscription:l,customer:s,product:c}),p=g.c.Map({});return r.a.createElement(f.v,null,r.a.createElement(_u,{entityOptions:n,onFinish:this.onCloseImport,defaultValues:u,predefinedValues:p,alterData:this.alterData,restartString:e}))}}]),t}(a.Component);Ou.defaultProps={importEntity:void 0,item:g.c.Map()};var Su=Object(s.f)(Object(l.connect)(function(e,t){return{importEntity:mi(e,t)||void 0,item:ui(e,t,"importer")}})(Ou)),Tu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={showImport:!1,showCloseImportConfirm:!1,refreshString:""},n.getListFields=function(){var e=n.props,t=e.accountFields,a=e.accountAllwaysShownFields;return t.filter(function(e){return e.get("show_in_list",!1)||a.includes(e.get("field_name",""))}).map(function(e){return{id:e.get("field_name"),placeholder:e.get("title",G(e.get("field_name",""),"account")),sort:!0,type:"aid"===e.get("field_name")?"number":"text"}}).toJS()},n.getListActions=function(){return[{type:"add"},{type:"refresh"},{type:"import",label:"Import",actionStyle:"primary",showIcon:!0,onClick:n.onClickImprt,actionSize:"xsmall"}]},n.getActions=function(){return[{type:"edit"}]},n.onCloseImport=function(){n.setState({showImport:!1,showCloseImportConfirm:!1,refreshString:S()().format()})},n.onClickImprt=function(){n.setState({showImport:!0})},n.onClickAskCloseImport=function(){n.setState({showCloseImportConfirm:!0})},n.onClickCancelCloseConfirm=function(){n.setState({showCloseImportConfirm:!1})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.accountFields;(null===e||e.isEmpty())&&this.props.dispatch(il(["subscribers"]))}},{key:"render",value:function(){var e=this.props.accountFields,t=this.state,n=t.showImport,a=t.refreshString,i=t.showCloseImportConfirm;if(null===e)return r.a.createElement(_,null);var o=this.getListFields(),l=this.getListActions(),s=this.getActions(),c=Y("apiDateFormat","YYYY-MM-DD"),u=S()().format(c),p=S()().add(100,"years").format(c),d=g.c.Map({from:u,to:p}),m=g.c.Map({from:u,to:p});return r.a.createElement("div",null,r.a.createElement(qc,{collection:"accounts",itemsType:"customers",itemType:"customer",tableFields:o,filterFields:o,actions:s,listActions:l,refreshString:a}),r.a.createElement(Ye,{show:n,title:"Import",onHide:this.onClickAskCloseImport,modalSize:"large"},r.a.createElement(_u,{entityOptions:["customer","subscription"],onFinish:this.onCloseImport,defaultValues:g.c.Map({subscription:d,customer:m})})),r.a.createElement(Ke,{onOk:this.onCloseImport,onCancel:this.onClickCancelCloseConfirm,show:i,message:"Are you sure you want to close import ?",labelOk:"Yes"}))}}]),t}(a.Component);Tu.defaultProps={accountFields:null,accountAllwaysShownFields:g.c.List(["aid","firstname","lastname"])};var ku=Object(s.f)(Object(l.connect)(function(e,t){return{accountFields:qn(e,t)}})(Tu)),Iu=n(32),Nu=n.n(Iu),wu=function(e,t,n,a,r){return function(i){i(Aa());var o=function(e,t,n,a,r){return{api:"pay",params:[{method:e},{payments:JSON.stringify([{amount:n,aid:t,payer_name:a,dir:"fc",deposit_slip:"",deposit_slip_bank:"",cheque_no:r,source:"web"}])}]}}(e,t,n,a,r);return ir(o).then(function(e){return i(tr(e,"Payment sent successfully!"))}).catch(function(e){return i(nr(e,"Error paying"))})}},ju=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={validationErrors:Object(g.b)({method:"required",monetaryValue:"required"}),method:"",monetaryValue:""},n.initDefaultValues=function(){var e=n.props.debt;null!==e&&n.onChangeMonetaryValue({target:{value:Math.abs(e)}})},n.onChangeValue=function(e,t){var a=n.state.validationErrors,r={};r[e]=t,0===t.length?r.validationErrors=a.set(e,"required"):r.validationErrors=a.set(e,""),n.setState(r)},n.onChangeMethodValue=function(e){n.onChangeValue("method",e)},n.onChangeMonetaryValue=function(e){var t=e.target.value;n.onChangeValue("monetaryValue",t)},n.onChangeChequeNumValue=function(e){var t=e.target.value;n.onChangeValue("chequeNum",t)},n.getAvailableMethods=function(){return n.props.methods.map(function(e,t){return{value:t,label:e}}).toList().toArray()},n.onPay=function(){var e=n.props,t=e.aid,a=e.payerName,r=n.state,i=r.method,o=r.monetaryValue,l=r.chequeNum;n.props.dispatch(wu(i,t,o,a,l)).then(n.afterPay)},n.afterPay=function(e){e.status&&n.props.onClose()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.initDefaultValues()}},{key:"render",value:function(){var e=this.props.currency,t=this.state,n=t.validationErrors,a=t.method,i=t.monetaryValue,o=t.chequeNum,l=this.getAvailableMethods();return r.a.createElement(Ye,{show:!0,labelOk:"Pay",title:"Offline Payment",onOk:this.onPay,onCancel:this.props.onClose},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{validationState:n.get("method","").length>0?"error":null},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Method"),r.a.createElement(f.g,{sm:8},r.a.createElement(en,{fieldType:"select",onChange:this.onChangeMethodValue,value:a,options:l}),n.get("method","").length>0?r.a.createElement(f.n,null,n.get("method","")):"")),r.a.createElement(f.l,{validationState:n.get("monetaryValue","").length>0?"error":null},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Monetary Value"),r.a.createElement(f.g,{sm:8},r.a.createElement(f.o,null,r.a.createElement(en,{id:"monetaryValue",onChange:this.onChangeMonetaryValue,value:i,fieldType:"number"}),r.a.createElement(f.o.Addon,null,Nu()(e))),n.get("monetaryValue","").length>0?r.a.createElement(f.n,null,n.get("monetaryValue","")):"")),"cheque"===a&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Cheque Number"),r.a.createElement(f.g,{sm:8},r.a.createElement(en,{id:"chequeNum",onChange:this.onChangechequeNumValue,value:o,fieldType:"number"})))))}}]),t}(a.Component);ju.defaultProps={payerName:"",methods:Object(g.b)({cash:"Cash",cheque:"Cheque",credit:"Credit Card"}),currency:"",debt:null};var Ru=Object(l.connect)(function(e,t){return{currency:Mn(e,t)}})(ju),xu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).getCyclesSelectOptions=function(){var e=n.props,t=e.cycles,a=e.statusesToDisplay;return t.filter(function(e){return a.contains(e.get("cycle_status",""))}).map(function(e){return{value:e.get("billrun_key",""),label:sn(e)}}).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(fr("cycles_list",Yr(this.props.from,this.props.to,this.props.newestFirst)))}},{key:"componentWillUnmount",value:function(){this.props.dispatch(gr("cycles_list"))}},{key:"render",value:function(){var e=this.props,t=e.multi,n=e.selectedCycles;return r.a.createElement(en,{fieldType:"select",multi:t,value:n,onChange:this.props.onChange,options:this.getCyclesSelectOptions()})}}]),t}(a.Component);xu.defaultProps={cycles:Object(g.a)(),selectedCycles:"",statusesToDisplay:Object(g.a)(["current","future","running","to_run","finished","confirmed"]),onChange:function(){},multi:!1,from:"",to:"",newestFirst:!0};var Fu=Object(l.connect)(function(e){return{cycles:e.list.get("cycles_list")}})(xu),Pu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showList:!1},n.initFormDate=function(){var e=n.props.mode;if(["closeandnew"].includes(e)){var t=S()().add(1,"day");n.onChangeFrom(t)}},n.showManageRevisions=function(){n.setState({showList:!0})},n.hideManageRevisions=function(){n.setState({showList:!1})},n.onDeleteItem=function(e){var t=n.props,a=t.item,r=t.revisions,i=t.itemName;if(te(a)===e)if(r.size>1){var o=Y(["systemItems",i,"itemType"],""),l=Y(["systemItems",i,"itemsType"],""),s=r.findIndex(function(e){return te(e)===te(a)}),c=-1!==s?r.get(s+1,r.get(s-1,"")):r.get(0,"");n.props.onActionEdit?n.props.onActionEdit(c):n.props.router.push("".concat(l,"/").concat(o,"/").concat(te(c)))}else n.props.backToList(!0);else n.props.reLoadItem();n.props.clearList()},n.onCloseItem=function(){n.props.clearRevisions(),n.props.clearList(),n.props.reLoadItem()},n.renderVerisionList=function(){var e=n.props,t=e.itemName,a=e.revisions,i=e.item,o=n.state.showList,l=Pe(Y(["systemItems",t,"uniqueField"],"")).get(0,""),s="".concat(i.get(l,"")," - Revision History");return r.a.createElement(Ye,{title:s,show:o,onCancel:n.hideManageRevisions,onHide:n.hideManageRevisions,labelCancel:"Close"},r.a.createElement(Lc,{items:a,itemName:t,onSelectItem:n.hideManageRevisions,onDeleteItem:n.onDeleteItem,onCloseItem:n.onCloseItem,onActionEdit:n.props.onActionEdit,onActionClone:n.props.onActionClone}))},n.onChangeFrom=function(e){var t=n.props,a=t.item,r=t.dangerousFrom;if(e&&(n.props.onChangeFrom(["from"],e.format("YYYY-MM-DD")),e.isBefore(r)&&!e.isSame(ee(a,"originalValue"),"day"))){var i=ee(a,"from");n.confirmSelectedDate(e,i)}},n.filterLegalFromDate=function(e){var t=n.props.minFrom;return e.isSameOrAfter(t,"day")},n.renderRevisionsBlock=function(){var e=n.props,t=e.item,a=e.revisions,i=e.revisionItemsInTimeLine,o=e.mode,l=e.itemName;return["clone","create"].includes(o)?null:r.a.createElement("div",{className:"inline pull-right"},r.a.createElement("div",{className:"inline mr10"},r.a.createElement(ze,{revisions:a,item:t,itemName:l,size:i})),r.a.createElement("div",{className:"inline"},r.a.createElement(f.c,{bsStyle:"link",className:"pull-right",style:{padding:"0 10px 15px 10px"},onClick:n.showManageRevisions},"Manage Revisions")))},n.renderDateViewBlock=function(){var e=n.props.item,t=ee(e,"originalValue"),a=ee(e,"to").subtract(1,"seconds"),i=Y("dateFormat","DD/MM/YYYY");return r.a.createElement("div",{className:"inline",style:{width:190,padding:0,margin:"9px 10px 0 10px"}},r.a.createElement("p",{style:{lineHeight:"32px"}},r.a.createElement(ot,{value:t,format:i})," - ",r.a.createElement(ot,{value:a,format:i})))},n.onChangeToggleFrom=function(e){var t=n.props.item;if(S.a.isMoment(e)&&e.isValid()){var a=S()().add(1,"day"),r=ee(t,"from"),i=e.isSame(r,"day")?a:e;n.onChangeFrom(i)}else{var o=ee(t,"originalValue");n.onChangeFrom(o)}},n.confirmSelectedDate=function(e,t){var a=e.format(Y("dateFormat","DD/MM/YYYY")),r={message:"Billing cycle for the date you have chosen is already over.",children:"Are you sure you want to use ".concat(a,"?"),onOk:function(){n.onChangeFrom(e)},onCancel:function(){n.onChangeFrom(t)}};n.props.dispatch(po(r))},n.dayDateClass=function(e){var t=S()(e),a=n.props,r=a.item,i=a.minFrom,o=a.dangerousFrom,l=ee(r,"originalValue");if(t.isBetween(i,o)&&!t.isSame(l))return"danger-red"},n.renderDateSelectBlock=function(){var e=n.props,t=e.item,a=e.mode,i=e.minFrom,o=["closeandnew","clone","create"].includes(a),l=ee(t,"from"),s=ee(t,"originalValue"),c="create"===a?[S()()]:[s,S()()],u={fieldType:"date",dateFormat:Y("dateFormat","dd/MM/yyyy"),isClearable:!1,placeholder:"Select Date...",minDate:i,highlightDates:c,dayClassName:n.dayDateClass,style:{display:"grid"}};return["closeandnew"].includes(a)?r.a.createElement("div",{className:"inline",style:{width:220,padding:0,margin:"7px 7px 0"}},r.a.createElement(en,{fieldType:"toggeledInput",value:l,onChange:n.onChangeToggleFrom,label:"Change From",editable:o,inputProps:u,disabledDisplayValue:s,disabledValue:s,compare:function(e,t){return e.isSame(t,"day")}})):r.a.createElement("div",{className:"inline",style:{width:220,padding:0,margin:7}},r.a.createElement(f.j,{horizontal:!0,style:{marginBottom:0}},r.a.createElement(f.l,{style:{marginBottom:0}},r.a.createElement("div",{className:"inline",style:{verticalAlign:"top",marginRight:15}},r.a.createElement(f.h,null,"From")),r.a.createElement("div",{className:"inline",style:{padding:0,width:200}},r.a.createElement(en,{fieldType:"date",value:l,onChange:n.onChangeFrom,editable:o,dateFormat:Y("dateFormat","DD/MM/YYYY"),isClearable:!1,placeholder:"Select Date...",minDate:i,highlightDates:c,dayClassName:n.dayDateClass})))))},n.renderTitle=function(){var e=n.props.mode,t=["clone","create"].includes(e)?" ":"Revisions History";return r.a.createElement("div",{className:"inline",style:{verticalAlign:"top",marginTop:16,width:110}},r.a.createElement("p",null,r.a.createElement("small",null,t)))},n.renderMessage=function(){var e=n.props,t=e.mode,a=e.item;return"view"!==t||"active"!==a.getIn(["revision_info","status"],"")||a.getIn(["revision_info","is_last"],!0)?null:r.a.createElement(f.p,{bsStyle:"warning"},"You cannot edit the current revision because a future revision exists.")},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(il(["minimum_entity_start_date","system"])),this.initFormDate()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=this.props.item;te(t)!==te(n)&&(this.hideManageRevisions(),this.initFormDate())}},{key:"render",value:function(){var e=this.props,t=e.mode,n=e.item.getIn(["revision_info","early_expiration"],!1);return r.a.createElement("div",{className:"entity-revision-edit"},r.a.createElement("div",null,this.renderTitle(),"view"===t||n?this.renderDateViewBlock():this.renderDateSelectBlock(),this.renderRevisionsBlock(),this.renderVerisionList()),this.renderMessage())}}]),t}(a.Component);Pu.defaultProps={revisionItemsInTimeLine:3,revisions:g.c.List(),item:g.c.Map(),mode:"view",minFrom:S()(0),dangerousFrom:S()(0),onChangeFrom:function(){},backToList:function(){},reLoadItem:function(){},clearRevisions:function(){},clearList:function(){}};var Mu=Object(s.f)(Object(l.connect)(function(e,t){return{minFrom:hi(e,t),dangerousFrom:Pn(e,t),timezone:e.settings.getIn(["billrun","timezone"])}})(Pu)),Au=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).initDefaultValues=function(){var e=n.props,t=e.field,a=e.entity,r=e.fieldPath;if(null===a.getIn(r,null)){var i=n.getNoDefaultValueVal(),o=t.get("default_value",i);null!==o&&n.props.onChange(r,o)}},n.getNoDefaultValueVal=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=n.props,a=t.field,r=t.isFieldBoolean,i=t.isFieldTags,o=t.isFieldSelect,l=t.isFieldRanges;return!r&&(l?g.c.List():e?i||o&&a.get("multiple",!1)?[]:"":null)},n.pasteSplit=function(e){return e.split(new RegExp([",",";","\\(","\\)","\\*","/",":","\\?","\n","\r","\t"].join("|"))).map(function(e){return e.trim()})},n.getFieldOptios=function(e){var t=e.get("select_options","");return("string"===typeof t?t.split(",").filter(function(e){return""!==e}):t).map(oe)},n.onChange=function(e){var t=n.props.fieldPath,a=e.target.value;n.props.onChange(t,a)},n.onChangeSelect=function(e){var t=n.props,a=t.field,r=t.fieldPath;a.get("multiple",!1)?n.props.onChange(r,e.split(",")):n.props.onChange(r,e)},n.onChangeRange=function(e){var t=n.props.fieldPath;n.props.onChange(t,e)},n.onChangeTags=function(e){var t=n.props.fieldPath;n.props.onChange(t,e)},n.getFieldValue=function(){var e=n.props,t=e.entity,a=e.editable,r=e.fieldPath,i=e.isFieldTags,o=e.isFieldBoolean;if(e.isFieldRanges)return t.getIn(r,void 0);if(o){var l=t.getIn(r,"");return""===l?l:[!0,1,"true"].includes(l)}var s=t.getIn(r,[]);return i&&a?g.c.List.isList(s)?s.toArray():s:Array.isArray(s)||g.c.List.isList(s)?s.join(","):s},n.onClickRemoveInput=function(){var e=n.props,t=e.entity,a=e.fieldPath;if(a.length>1){var r,i=a.splice(a.length-1,1),o=(r=t.getIn(a)).delete.apply(r,Object(w.a)(i));n.props.onChange(a,o)}},n.renderRemovableField=function(e){return r.a.createElement(f.o,null,e,r.a.createElement(f.o.Button,null,r.a.createElement(f.c,{onClick:n.onClickRemoveInput},r.a.createElement("i",{className:"fa fa-fw fa-trash-o danger-red"}))))},n.renderField=function(){var e=n.props,t=e.editable,a=e.field,i=e.disabled,o=e.isFieldTags,l=e.isFieldSelect,s=e.isFieldBoolean,c=e.isFieldRanges,u=n.getFieldValue();if(c){var p=a.get("multiple",!1);return r.a.createElement(en,{fieldType:"ranges",onChange:n.onChangeRange,value:u,multi:p,editable:t,label:a.get("title",a.get("field_name","")),disabled:i})}if(s){return r.a.createElement(en,{fieldType:"checkbox",onChange:n.onChange,value:u,editable:t,style:{height:29,marginTop:8},disabled:i})}if(l&&t){var d=a.get("multiple",!1),m=n.getFieldOptios(a);return r.a.createElement(en,{fieldType:"select",multi:d,value:u,onChange:n.onChangeSelect,options:m,disabled:i})}if(o&&t)return r.a.createElement(en,{fieldType:"tags",value:u,onChange:n.onChangeTags,addOnPaste:!0,pasteSplit:n.pasteSplit,disabled:i});var g=""===a.get("type","")?"text":a.get("type","");return r.a.createElement(en,{fieldType:g,onChange:n.onChange,value:u,editable:t,disabled:i,preffix:a.get("preffix"),suffix:a.get("suffix")})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.initDefaultValues()}},{key:"render",value:function(){var e=this.props,t=e.field,n=e.editable,a=e.error,i=e.onlyInput,o=e.isRemoveField,l=this.renderField();if(i)return l;var s=t.get("field_name",""),c=t.get("help",""),u=t.get("description","");return r.a.createElement(f.l,{controlId:s,validationState:a?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},t.get("title",s),t.get("mandatory",!1)&&r.a.createElement("span",{className:"danger-red"}," *"),""!==u&&r.a.createElement(Ii,{contents:u})),r.a.createElement(f.g,{sm:8,lg:9},o&&n?this.renderRemovableField(l):l,a&&r.a.createElement(f.n,null,r.a.createElement("small",null,a)),""!==c&&r.a.createElement(f.n,null,r.a.createElement("small",null,c))))}}]),t}(a.Component);Au.defaultProps={entity:g.c.Map(),field:g.c.Map(),editable:!0,disabled:!1,onlyInput:!1,isFieldTags:!1,isFieldSelect:!1,isFieldBoolean:!1,isFieldRanges:!1,isRemoveField:!1,fieldPath:[],error:"",onChange:function(){}};var Du=Au,Lu=Object(l.connect)(function(e,t){return{isFieldTags:t.field&&t.field.get("multiple",!1)&&!t.field.get("select_list",!1),isFieldSelect:t.field&&t.field.get("select_list",!1),isFieldBoolean:t.field&&"boolean"===t.field.get("type",""),isFieldRanges:t.field&&"ranges"===t.field.get("type",""),isRemoveField:t.field&&["params"].includes(t.field.get("field_name","").split(".")[0]),fieldPath:t.field?t.field.get("field_name","").split("."):[]}},function(e,t){return{}})(Du),Uu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).getParamsOptions=function(){var e=n.props,t=e.fields,a=e.fieldsFilter,r=e.highlightPramas,i=null!==a?a:n.filterPrintableFields;return t.filter(i).filter(function(e){return!n.filterParamsFields(e)}).map(function(e){return{label:Object(x.titleCase)(e.get("title","")),value:e.get("field_name","").split(".")[1]}}).sort(function(e){return r.includes("params.".concat(e.value))?-1:1})},n.onAddParam=function(e){n.props.onChangeField(["params",e],null)},n.filterPrintableFields=function(e){return!1!==e.get("display",!1)&&!1!==e.get("editable",!1)&&"tariff_category"!==e.get("field_name","")&&"play"!==e.get("field_name","")},n.filterParamsFields=function(e){var t=n.props.entity,a=e.get("field_name","").split(".");return!("params"===a[0]&&!t.hasIn(a))},n.filterPlayFields=function(e){var t=n.props,a=t.entity;if(!t.isPlaysEnabled)return!0;var r=a.get("play",""),i=g.c.List("function"===typeof r.split?r.split(","):r),o=e.get("plays","all");return"all"===o||i.some(function(e){return o.indexOf(e)>-1})},n.renderField=function(e,t){var a=n.props,i=a.entity,o=a.editable,l=a.onChangeField;return r.a.createElement(Lu,{key:"key_".concat(e.get("field_name",t)),field:e,entity:i,editable:o,onChange:l})},n.renderFields=function(){var e=n.props,t=e.fields,a=e.fieldsFilter,r=null!==a?a:n.filterPrintableFields;return t.filter(n.filterPlayFields).filter(r).filter(n.filterParamsFields).map(n.renderField)},n.renderAddParamButton=function(e){var t=n.props.highlightPramas,a=e.map(function(e){var a=t.includes("params.".concat(e.value)),i=k()({"disable-label":!a});return r.a.createElement(f.q,{key:e.value,eventKey:e.value,onSelect:function(){n.onAddParam(e.value)}},r.a.createElement("span",{className:i},e.label))});return r.a.createElement(f.i,{id:"add-param-input",componentClass:f.o.Button,className:"btn-primary btn btn-xs btn-default",title:"Add parameter"},a)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.entityName,n=e.fields,a=e.entity;n.isEmpty()&&this.props.dispatch(il(t)),a.has("params")&&g.c.is(a.get("params",g.c.List()),g.c.List())&&this.props.onChangeField(["params"],g.c.Map())}},{key:"componentDidUpdate",value:function(e,t){var n=this,a=this.props,r=a.fields,i=a.entity,o=e.entity;(r.find(function(e){return"play"===e.get("field_name","")},null,g.c.Map()).get("multiple",!1)?!g.c.is(i.get("play",g.c.List()),o.get("play",g.c.List())):i.get("play","")!==o.get("play",""))&&r.forEach(function(e){n.filterPlayFields(e)||n.props.onRemoveField(e.get("field_name","").split("."))})}},{key:"render",value:function(){var e=this.props.editable,t=this.renderFields(),n=this.getParamsOptions();return t.isEmpty()&&n.isEmpty()?null:r.a.createElement("div",{className:"EntityFields"},t,!n.isEmpty()&&e&&this.renderAddParamButton(n))}}]),t}(a.Component);Uu.defaultProps={entity:g.c.Map(),fields:g.c.List(),highlightPramas:g.c.List(),fieldsFilter:null,editable:!0,isPlaysEnabled:!1,onChangeField:function(){},onRemoveField:function(){console.error("Please implement onRemoveField function for EntityFields")}};var Vu=Object(l.connect)(function(e,t){return{fields:Bn(e,t),isPlaysEnabled:jn(e,t)}})(Uu),Bu=function(e){return function(t){t(Aa());var n=function(e){return{api:"credit",params:e}}(e);return ir(n).then(function(e){return t(tr(e,"Success crediting"))}).catch(function(e){return t(nr(e,"Error crediting"))})}},qu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={validationErrors:Object(g.b)({aprice:"required",usagev:"",rate:"required",subscriber:"required"}),helperMsg:Object(g.b)({aprice:""}),paramKeyError:"",rateBy:"fix",aprice:"",usagev:1,rate:"",progress:!1,subscriber:""},n.onChangeValue=function(e,t){var a=n.state.validationErrors,r={};r[e]=t,0===t.length?r.validationErrors=a.set(e,"required"):r.validationErrors=a.set(e,""),n.setState(r)},n.updateChargingMessage=function(e,t){var a=n.props.currency,r=n.state,i=r.helperMsg;if("fix"===r.rateBy){var o=""!==e?e*t:t,l="".concat(Math.abs(o)).concat(Nu()(a)),s=o>=0?"Subscriber will be charged by ".concat(l):"".concat(l," will be refunded to the subscriber");n.setState({helperMsg:i.set("aprice",s)})}},n.onChangeCreditUsagevValue=function(e){var t=e.target.value,a=n.state.aprice;n.onChangeValue("usagev",t),n.updateChargingMessage(t,a)},n.onChangeCreditApriceValue=function(e){var t=e.target.value,a=n.state.usagev;n.onChangeValue("aprice",t),n.updateChargingMessage(a,t)},n.onChangeRateValue=function(e){n.onChangeValue("rate",e)},n.onChangeSubscriberValue=function(e){n.onChangeValue("subscriber",e)},n.onChangeCreditBy=function(e){var t,a=e.target.value,r=n.state,i=r.validationErrors,o=r.helperMsg;t="fix"===a?{rateBy:a,usagev:1,validationErrors:i.set("aprice","required").set("usagev",""),helperMsg:o.set("aprice","")}:{rateBy:a,aprice:"",usagev:"",validationErrors:i.set("aprice","").set("usagev","required"),helperMsg:o.set("aprice","The refund amount will be calculated based on the volume")},n.setState(t)},n.onCreditCharge=function(){var e=n.props,t=e.aid,a=e.propertyTypes,r=e.usageTypesData,i=n.state,o=i.rateBy,l=i.aprice,s=i.usagev,c=i.rate,u=i.validationErrors,p=i.subscriber;if(!u.valueSeq().includes("required")){var d=[{aid:t},{sid:"account_level"===p?0:p},{rate:c},{credit_time:S()().toISOString()}];if("fix"===o)d=[].concat(Object(w.a)(d),[{aprice:l},{usagev:s}]);else{var m=n.getSelectedRate(c),g=ge(m),f=fe(m,g);d=[].concat(Object(w.a)(d),[{usagev:be(a,r,g,f,s)}])}n.setState({progress:!0}),n.props.dispatch(Bu(d)).then(n.afterCharge)}},n.afterCharge=function(e){n.setState({progress:!1}),e.status&&n.props.onClose()},n.getAvailableRates=function(){return n.props.allRates.map(function(e){return{value:e.get("key"),label:e.get("key")}}).toArray()},n.getSubscribersBySid=function(){var e=n.props.subscribers.map(function(e){return{value:e.get("sid"),label:e.get("sid").toString()}}).toArray();return[{value:"account_level",label:"account level"}].concat(Object(w.a)(e))},n.getSelectedRate=function(e){return me(n.props.allRates,e)},n.getRateUnitLabel=function(e){var t=n.props,a=t.propertyTypes,r=t.usageTypesData,i=n.getSelectedRate(e),o=ge(i),l=fe(i,o),s=ye(a,r,o,l);return""!==s?"(".concat(s,")"):""},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.aid;this.props.dispatch(fr("all_retail_rates",Ar())),this.props.dispatch(il("usage_types")),this.props.dispatch(fr("subscribers_for_aid",function(e){return{action:"get",entity:"subscribers",params:[{query:JSON.stringify({aid:e,type:"subscriber"})}]}}(e)))}},{key:"render",value:function(){var e=this.state,t=e.rateBy,n=e.aprice,a=e.usagev,i=e.rate,o=e.validationErrors,l=e.helperMsg,s=e.progress,c=e.subscriber,u=this.getAvailableRates(),p=this.getSubscribersBySid();return r.a.createElement(Ye,{show:!0,progress:s,labelProgress:"Processing...",labelOk:"Apply",title:"Manual charge / refund",onOk:this.onCreditCharge,onCancel:this.props.onClose},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Rate By"),r.a.createElement(f.g,{sm:10},r.a.createElement(f.g,{sm:3},r.a.createElement(en,{fieldType:"radio",name:"rate-by",id:"rate-by-fix",value:"fix",checked:"fix"===t,onChange:this.onChangeCreditBy,label:"Fixed price"})),r.a.createElement(f.g,{sm:3},r.a.createElement(en,{fieldType:"radio",name:"rate-by",id:"rate-by-usagev",value:"usagev",checked:"usagev"===t,onChange:this.onChangeCreditBy,label:"Volume"})))),r.a.createElement(f.l,{validationState:o.get("subscriber","").length>0?"error":null},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Subscriber"),r.a.createElement(f.g,{sm:10},r.a.createElement(en,{fieldType:"select",onChange:this.onChangeSubscriberValue,value:c,options:p}),o.get("subscriber","").length>0?r.a.createElement(f.n,null,o.get("subscriber","")):"")),r.a.createElement(f.l,{validationState:o.get("aprice","").length>0?"error":null},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Charge"),r.a.createElement(f.g,{sm:10},r.a.createElement(en,{onChange:this.onChangeCreditApriceValue,value:n,fieldType:"price",disabled:"fix"!==t}),r.a.createElement(f.n,null,o.get("aprice","").length>0?o.get("aprice",""):l.get("aprice","")))),r.a.createElement(f.l,{validationState:o.get("usagev","").length>0?"error":null},r.a.createElement(f.g,{sm:2,componentClass:f.h},"usagev"===t?"Volume ".concat(this.getRateUnitLabel(i)):"Quantity"),r.a.createElement(f.g,{sm:10},r.a.createElement(en,{onChange:this.onChangeCreditUsagevValue,value:a,fieldType:"number"}),o.get("usagev","").length>0?r.a.createElement(f.n,null,o.get("usagev","")):"")),r.a.createElement(f.l,{validationState:o.get("rate","").length>0?"error":null},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Product"),r.a.createElement(f.g,{sm:10},r.a.createElement(en,{fieldType:"select",onChange:this.onChangeRateValue,value:i,options:u}),o.get("rate","").length>0?r.a.createElement(f.n,null,o.get("rate","")):""))))}}]),t}(a.Component);qu.defaultProps={allRates:Object(g.a)(),currency:"",usageTypesData:Object(g.a)(),propertyTypes:Object(g.a)(),subscribers:Object(g.a)()};var zu=Object(l.connect)(function(e,t){return{usageTypes:Dn(e,t),currency:Mn(e,t),usageTypesData:Un(e,t),propertyTypes:Vn(e,t),allRates:e.list.get("all_retail_rates"),subscribers:e.list.get("subscribers_for_aid")}})(qu),Hu=function(e){return function(e,t,n){return function(a){var r=Rr(t,n);return a(_l(e,r))}}("customer","accounts",e)},Yu=function(e){return function(t){t(Aa());var n=Rr("subscribers",e);return ir(n).then(function(e){var n=e.data[0].data.details[0];return n.originalValue=n.from,t(hl("subscription",n)),t(tr(e))}).catch(function(e){return t(nr(e,"Error retreiving subscriber"))})}},Gu=function(e,t){return Cl("accounts",e,t)},Ku=function(){return yl("subscription","subscription")},Wu=function(e,t){return function(n){return n(Cl("subscribers",e,t)).then(function(n){return Object.assign(n,{subscription:e,action:t})})}},Ju=function(e,t){return gl("customer",e,t)},Qu=function(e){return fl("customer",e)},$u=function(e,t){return function(n){n(Aa());var a=[],r=!0,i=!1,o=void 0;try{for(var l,s=t.split(",")[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var c=l.value;a.push(Hr(e,c))}}catch(u){i=!0,o=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return ir(a).then(function(e){return n(tr(e,"Customer rebalance request sent"))}).catch(function(e){return n(nr(e,"Error rebalancing customer"))})}},Zu=function(e){return function(t){t(Aa());var n=function(e){return{api:"bill",params:[{aid:e}]}}(e);return ir(n).then(function(e){return t(tr(e))}).catch(function(e){return t(nr(e))})}},Xu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showRebalanceConfirmation:!1,showOfflinePayement:!1,debt:null,selectedCyclesNames:"",expectedCyclesNames:"",showCreditCharge:!1},n.initDebt=function(){var e=n.props.customer.get("aid",null);n.props.dispatch(Zu(e)).then(function(e){e.status&&e.data&&e.data.balance&&n.setState({debt:e.data.balance.total})})},n.onRemovePaymentGateway=function(){n.onChangeCustomField(["payment_gateway","active"],g.c.Map())},n.onChangeCustomField=function(e,t){var a={target:{id:e,value:t}};n.props.onChange(a)},n.onRemoveCustomField=function(e){n.props.onRemoveField(e)},n.renderPaymentGatewayLabel=function(){var e=n.props,t=e.customer,a=e.supportedGateways,i=t.getIn(["payment_gateway","active","name"],""),o=a.filter(function(e){return i===e.get("name")});return!o.isEmpty()&&o.get(0).get("image_url","").length>0?r.a.createElement("img",{src:"".concat(Y(["env","serverApiUrl"],""),"/").concat(o.get(0).get("image_url","")),height:"30",alt:o.get(0).get("name","")}):i},n.getPaymentGatewaysActions=function(){var e=n.props,t=e.customer,a=e.payment_gateways,r=!t.getIn(["payment_gateway","active"],g.c.Map()).isEmpty();return[{type:"add",label:"Add ",onClick:n.props.onChangePaymentGateway,show:!r,actionStyle:"primary",actionSize:"xsmall",enable:!a.isEmpty()},{type:"edit",label:"Change",onClick:n.props.onChangePaymentGateway,actionStyle:"primary",actionSize:"xsmall",show:r},{type:"remove",label:"Remove",onClick:n.onClickRemovePaymentGateway,actionStyle:"danger",actionSize:"xsmall",show:r&&!1}]},n.onClickRemovePaymentGateway=function(e){var t=e.getIn(["payment_gateway","active","name"],"payment gateway"),a={message:"Are you sure you want to remove ".concat(t),onOk:n.onRemovePaymentGateway,type:"delete",labelOk:"Remove"};n.props.dispatch(po(a))},n.renderChangePaymentGateway=function(){var e=n.props.customer,t=!e.getIn(["payment_gateway","active"],g.c.Map()).isEmpty()?n.renderPaymentGatewayLabel():"None";return r.a.createElement(f.l,{controlId:"payment_gateway"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Payment Gateway"),r.a.createElement(f.g,{sm:8,lg:9},t,r.a.createElement("div",{className:"inline ml10"},r.a.createElement(Xe,{actions:n.getPaymentGatewaysActions(),data:e}))))},n.renderDebt=function(){var e=n.props.currency,t=n.state.debt,a=k()("non-editable-field",{"danger-red":t>0});return null!==t&&r.a.createElement(f.l,{controlId:"total_debt"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Total Debt"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("div",{className:a},t,Nu()(e))))},n.renderInCollection=function(){var e=n.props.customer,t=Y("dateFormat","DD/MM/YYYY");if(!0===e.get("in_collection",!1)||1===e.get("in_collection",0)){var a=S()(e.get("in_collection_from","")).format(t);return r.a.createElement("p",{className:"danger-red"},"In collection from ",a)}return null},n.onClickRebalance=function(){n.setState({showRebalanceConfirmation:!0})},n.onRebalanceConfirmationClose=function(){n.setState({showRebalanceConfirmation:!1,selectedCyclesNames:""})},n.onRebalanceConfirmationOk=function(){var e=n.props.customer,t=n.state.selectedCyclesNames;n.props.dispatch($u(e.get("aid"),t)),n.onRebalanceConfirmationClose()},n.onClickOfflinePayment=function(){n.setState({showOfflinePayement:!0})},n.onCloseOfflinePayment=function(){n.setState({showOfflinePayement:!1}),n.initDebt()},n.onChangeSelectedCycle=function(e){n.setState({selectedCyclesNames:e})},n.onChangeExpectedCycle=function(e){n.setState({expectedCyclesNames:e})},n.onClickExpectedInvoice=function(){var e=n.props.customer,t=n.state.expectedCyclesNames,a=Qr(e.get("aid"),t);window.open(ar(a))},n.renderRebalanceButton=function(){var e=n.props.customer,t=n.state,a=t.showRebalanceConfirmation,i=t.selectedCyclesNames,o="Are you sure you want to rebalance account ".concat(e.get("aid"),"?");return r.a.createElement("div",null,r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:n.onClickRebalance},"Rebalance"),r.a.createElement(Ke,{onOk:n.onRebalanceConfirmationOk,onCancel:n.onRebalanceConfirmationClose,show:a,message:o,labelOk:"Yes"},r.a.createElement(f.l,null,r.a.createElement(f.x,null,r.a.createElement(f.g,{sm:12,lg:12},"Rebalance operation will send all customer billing lines for recalculation price and bundles options. It can take few hours to finish the recalculations. Meanwhile lines pricing properties will be empty.",r.a.createElement("br",null),"This operation is useful when an update is required with reference data (plans, products, services, etc) that raised non-desired pricing results. After fixing the reference data, the operation will recalculate the billing lines.",r.a.createElement("br",null),r.a.createElement("br",null))),r.a.createElement(f.x,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h,className:"non-editable-field"},"Select cycle/s"),r.a.createElement(f.g,{sm:9,lg:8},r.a.createElement(Fu,{onChange:n.onChangeSelectedCycle,statusesToDisplay:g.c.List(["current","to_run"]),selectedCycles:i,multi:!0}))))))},n.renderOfflinePaymentsButton=function(){var e=n.props.customer,t=n.state,a=t.showOfflinePayement,i=t.debt,o="".concat(e.get("firstname","")," ").concat(e.get("lastname",""));return r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:8,lg:9,smOffset:3,lgOffset:2},r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",style:{marginTop:12},onClick:n.onClickOfflinePayment},"Offline Payment"),a&&r.a.createElement(Ru,{aid:e.get("aid"),payerName:o,debt:i,onClose:n.onCloseOfflinePayment})))},n.renderExpectedInvoiceButton=function(){var e=n.state.expectedCyclesNames,t=Y("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");return r.a.createElement("span",{className:"inline"},", Or generate expected invoices for :",r.a.createElement("span",{className:"inline",style:{verticalAlign:"middle",minWidth:290,marginLeft:5,marginRight:5}},r.a.createElement(Fu,{className:"inline",onChange:n.onChangeExpectedCycle,statusesToDisplay:g.c.List(["current","to_run","future"]),selectedCycles:e,multi:!1,from:S()().subtract(6,"month").format(t),to:S()().add(6,"month").format(t),newestFirst:!1})),r.a.createElement(f.c,{bsSize:"small",className:"btn-primary inline",disabled:!e,onClick:n.onClickExpectedInvoice},"Generate expected invoice"))},n.renderCreditCharge=function(){var e=n.props.customer,t=n.state.showCreditCharge,a=e.get("aid",null);return r.a.createElement("div",null,r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:n.onShowCreditCharge},"Manual charge / refund"),t&&r.a.createElement(zu,{aid:a,onClose:n.onCloseCreditCharge}))},n.onShowCreditCharge=function(){n.setState({showCreditCharge:!0})},n.onCloseCreditCharge=function(){n.setState({showCreditCharge:!1})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){"create"!==this.props.action&&this.initDebt(),this.props.dispatch(il("payment_gateways"))}},{key:"render",value:function(){var e=this.props,t=e.customer,n=e.action;return"create"!==n&&"undefined"===typeof t.getIn(["_id","$id"])?r.a.createElement("div",null," ",r.a.createElement("p",null,"Loading...")," "):r.a.createElement("div",{className:"Customer"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(Vu,{entityName:["subscribers","account"],entity:t,onChangeField:this.onChangeCustomField,onRemoveField:this.onRemoveCustomField}),"create"!==n&&this.renderChangePaymentGateway(),"create"!==n&&this.renderOfflinePaymentsButton(),"create"!==n&&this.renderDebt()),"create"!==n&&r.a.createElement("div",null,r.a.createElement("hr",null),this.renderInCollection(),r.a.createElement("div",null,"See Customer ",r.a.createElement(s.b,{to:'/usage?base={"aid": '.concat(t.get("aid"),"}")},"Usage")),r.a.createElement("div",null,"See Customer ",r.a.createElement(s.b,{to:'/invoices?base={"aid": '.concat(t.get("aid"),"}")},"Invoices")," ",this.renderExpectedInvoiceButton()),this.renderRebalanceButton(),r.a.createElement("hr",null),this.renderCreditCharge()))}}]),t}(a.Component);Xu.defaultProps={action:"create",currency:"",customer:g.c.Map(),supportedGateways:g.c.List(),payment_gateways:void 0};var ep=Object(l.connect)(function(e,t){return{currency:Mn(e,t),payment_gateways:ua(e,t)}})(Xu),tp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).planActivationParser=function(e){var t=ee(e,"plan_activation",!1);return t?t.format(Y("dateFormat","DD/MM/YYYY")):""},n.servicesParser=function(e){return(e.get("services",g.c.List())||g.c.List()).map(function(e){return null!==e.get("quantity",null)?"".concat(e.get("name","")," (").concat(e.get("quantity",""),")"):e.get("name","")}).join(", ")},n.addressParser=function(e){return e.get("country","").length>0?"".concat(e.get("address","")," ,").concat(e.get("country","")):e.get("address","")},n.onClickNew=function(e){var t=n.props.aid;n.props.onNew(t,e)},n.filterPlayField=function(e){var t=n.props.isPlaysEnabled;return"play"!==e.get("field_name","")||t},n.getFields=function(){var e=n.props,t=e.settings,a=e.defaultListFields;return t.filter(n.filterPlayField).filter(function(e){return e.get("show_in_list",!1)||a.includes(e.get("field_name",""))}).map(function(e){var t=e.get("field_name");switch(t){case"plan_activation":return{id:t,parser:n.planActivationParser,cssClass:"long-date text-center"};case"services":return{id:t,parser:n.servicesParser};case"address":return{id:t,parser:n.addressParser};case"sid":return{id:t,title:"ID",type:"number",sort:!0};case"play":return{id:t,sort:!0};default:var a=t;return"firstname"===t?a="first name":"lastname"===t&&(a="last name"),{id:t,title:F.a.sentenceCase(a)}}}).toArray()},n.getActions=function(){return[{type:"edit",helpText:"Edit",onClick:n.props.onClickEdit,onClickColumn:"sid"}]},n.getListActions=function(){return[{type:"add",onClick:n.onClickNew},{type:"refresh"}]},n.onActionEdit=function(e){n.props.onClickEdit(e)},n.onActionClone=function(e){n.props.onClickEdit(e,"subscription","clone")},n.filterFields=function(){return[{id:"sid",placeholder:"ID",type:"number"},{id:"firstname",placeholder:"First Name"},{id:"lastname",placeholder:"Last Name"}]},n.getSubsctiptionListProject=function(){var e=n.props,t=e.settings,a=e.defaultListFields;return g.c.Map().withMutations(function(e){e.set("from",1),e.set("to",1),e.set("revision_info",1),e.set("aid",1),a.forEach(function(t){e.set(t,1)}),t.filter(function(e){return e.get("show_in_list",!1)}).forEach(function(t){e.set(t.get("field_name",""),1)})}).toJS()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.aid,t=this.getFields(),n=this.getActions(),a=this.getListActions(),i=this.getSubsctiptionListProject(),o={aid:e,type:"subscriber"};return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(qc,{itemsType:"subscribers",itemType:"subscription",filterFields:this.filterFields(),tableFields:t,projectFields:i,showRevisionBy:!0,actions:n,listActions:a,baseFilter:o,allowManageRevisions:!1})))}}]),t}(a.Component);tp.defaultProps={settings:g.c.List(),defaultListFields:[],isPlaysEnabled:!1,aid:""};var np=Object(l.connect)(function(e,t){return{isPlaysEnabled:jn(e,t)}})(tp),ap=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangePeriodStartDate=function(e,t){t&&n.props.onChangeService(e,"from",t.format("YYYY-MM-DD"))},n.onClickRemoveCloneService=function(e){-1!==e&&n.props.onRemoveService(e)},n.onClickAddPeriodService=function(e){n.props.onAddService(e)},n.onChangeServiceQuantity=function(e,t){var a=n.props,r=a.subscriptionFrom,i=a.originSubscriptionServices,o=a.subscriptionServices,l=t.target.value,s=l>1?Number(l):1,c=o.get(e,null);if(c){var u=i.find(function(e){return e.get("name","")===c.get("name","")}),p=u&&u.get("quantity","")===s?u.get("from",""):r.format("YYYY-MM-DD");n.props.onChangeService(e,"quantity",s),n.props.onChangeService(e,"from",p)}},n.filterServiceStartDate=function(e,t){var a=n.props.subscriptionFrom;return e&&t.isSame(S()(e),"days")||t.isSameOrAfter(a)},n.renderServiceBadge=function(e,t){var a=n.props.originSubscriptionServices;if(!e.hasIn(["ui_flags","serviceId"]))return r.a.createElement(f.b,null,"new");var i=a.find(function(t){return t.getIn(["ui_flags","serviceId"],"")===e.getIn(["ui_flags","serviceId"],"")});return"byPeriod"!==t||S()(i.get("from","")).isSame(S()(e.get("from","")),"days")?"quantity"===t&&i.get("quantity","")!==e.get("quantity","")?r.a.createElement(f.b,null,"updated"):"":r.a.createElement(f.b,null,"updated")},n.renderServicesQuentity=function(e){var t=n.props,a=t.servicesOptions;return t.subscriptionServices.map(function(e,t){return e.set("index",t)}).filter(function(e){return null!==e.get("quantity",null)}).map(function(t,i){var o=a.find(function(e){return e.get("name","")===t.get("name","")},null,g.c.Map()).get("description",t.get("name","")),l=t.get("index",""),s=n.renderServiceBadge(t,"quantity"),c=e?{}:{display:"inline-block"};return r.a.createElement("tr",{key:"quentity_".concat(i)},r.a.createElement("td",{style:{verticalAlign:"middle",width:"30%",textAlign:"right",paddingRight:20,paddingBottom:5}},o),r.a.createElement("td",{style:{width:"70%",paddingBottom:5}},r.a.createElement(f.o,{style:{width:"100%"}},e?r.a.createElement(f.o.Addon,null,"Quantity ",s):"Quantity: ",r.a.createElement(en,{fieldType:"number",min:1,value:t.get("quantity",""),onChange:function(e){n.onChangeServiceQuantity(l,e)},editable:e,style:c}))))}).toArray()},n.renderServicesByPeriod=function(e){var t=n.props,a=t.servicesOptions;return t.subscriptionServices.map(function(e,t){return e.set("index",t)}).filter(function(e){return e.getIn(["ui_flags","balance_period"],!1)}).reduce(function(e,t){return e.has(t.get("name",""))?e.update(t.get("name",""),function(e){return e.push(t)}):e.set(t.get("name",""),g.c.List([t]))},g.c.Map()).map(function(t,i){var o=t.last(),l=a.find(function(e){return e.get("name","")===o.get("name","")},null,g.c.Map()).get("description",o.get("name","")),s=e?{verticalAlign:"middle",paddingBottom:47,width:"30%",textAlign:"right",paddingRight:20}:{verticalAlign:"middle",textAlign:"right",paddingRight:20};return r.a.createElement("tr",{key:"byPeriod_".concat(i)}," ",r.a.createElement("td",{style:s},l),r.a.createElement("td",{style:{width:"70%"}},t.map(function(t,a){return n.renderPeriods(t,a,e)}),e&&r.a.createElement(Je,{buttonStyle:{marginTop:5,marginBottom:10},onClick:function(e){n.onClickAddPeriodService(o.get("name",""),e)},label:"Add start date"})))}).toList().toArray()},n.renderPeriods=function(e,t,a){var i=n.props,o=i.subscriptionFrom,l=i.originSubscriptionServices;if(!a)return r.a.createElement("div",{key:"byPeriod_".concat(t,"_").concat(e.get("name","no-name"))},t+1,". Start Date:\xa0",r.a.createElement(en,{style:{display:"inline-block"},fieldType:"date",value:S()(e.get("from","")),editable:a}));var s=e.get("index",""),c=l.find(function(t){return t.get("name","")===e.get("name","")}),u=e.hasIn(["ui_flags","serviceId"])&&c?c.get("from",null):null,p=n.renderServiceBadge(e,"byPeriod");return r.a.createElement(f.o,{key:"byPeriod_".concat(t,"_").concat(e.get("name","no-name")),style:{width:"100%",marginTop:5}},r.a.createElement(f.o.Addon,null,t+1,". Start Date ",p),r.a.createElement(en,{style:{width:"100%"},fieldType:"date",filterDate:function(e){return n.filterServiceStartDate(u,e)},value:S()(e.get("from","")),onChange:function(e){n.onChangePeriodStartDate(s,e)},editable:a,highlightDates:[o]}),r.a.createElement(f.o.Addon,{onClick:function(e){n.onClickRemoveCloneService(s,e)}},r.a.createElement("i",{className:"fa fa-trash-o text-danger"})))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.editable,t=this.renderServicesQuentity(e),n=this.renderServicesByPeriod(e);return t.length+n.length>0?r.a.createElement(f.v,{header:"Services Details"},r.a.createElement("table",{style:{width:"100%"}},r.a.createElement("tbody",null,t)),t.length>0&&n.length>0&&r.a.createElement("hr",null),r.a.createElement("table",{style:{width:"100%"}},r.a.createElement("tbody",null,n))):r.a.createElement("hr",null)}}]),t}(a.Component);ap.defaultProps={editable:!0,originSubscriptionServices:g.c.List(),subscriptionServices:g.c.List(),subscriptionFrom:null,servicesOptions:g.c.List()};var rp=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).initService=function(e){var t=n.props.subscription,a=n.state.subscription,r=n.getServiceType(e),i=ee(a,"from").format("YYYY-MM-DD"),o=ee(a,"to",S()().add(100,"years")).toISOString(),l=g.c.Map({name:e,from:i,to:o}),s=(t.get("services",g.c.List())||g.c.List()).find(function(t){return t.get("name","")===e});switch(r){case"quantitative":return s&&1===s.get("quantity","")?s:l.set("quantity",1);case"balance_period":return l.setIn(["ui_flags","balance_period"],!0);default:return s||l}},n.onSave=function(){var e=n.state.subscription,t=n.props.mode,a=Object(fu.d)(n.removeServiceUiFlags)(e);n.props.onSave(a,t)},n.onChangeFrom=function(e,t){var a=n.state.subscription,r=n.updateServicesDates(a.setIn(e,t));n.setState({subscription:r})},n.onChangePlan=function(e){n.updateSubscriptionField(["plan"],e)},n.onChangePlay=function(e){n.updateSubscriptionField(["play"],e),n.filterSubscriptionServicesByPlay(e),n.filterSubscriptionPlanByPlay(e)},n.onChangeServiceDetails=function(e,t,a){var r=Array.isArray(t)?t:[t];n.updateSubscriptionField(["services",e].concat(Object(w.a)(r)),a)},n.onRemoveService=function(e){var t=(n.state.subscription.get("services",g.c.List())||g.c.List()).delete(e);n.updateSubscriptionField(["services"],t)},n.onAddService=function(e){var t=n.state.subscription,a=n.initService(e),r=(t.get("services",g.c.List())||g.c.List()).push(a);n.updateSubscriptionField(["services"],r)},n.onChangeService=function(e){var t=n.state.subscription;if(e.length){var a=g.c.Set(e.split(",")),r=t.get("services",g.c.List())||g.c.List(),i=g.c.Set(r.map(function(e){return e.get("name","")})),o=a.filter(function(e){return!i.has(e)}),l=i.filter(function(e){return!a.has(e)});o.size&&o.forEach(function(e){n.onAddService(e)}),l.size&&l.forEach(function(e){r.forEach(function(t,a){t.get("name","")===e&&n.onRemoveService(a)})})}else n.updateSubscriptionField(["services"],g.c.List())},n.filterCustomFields=function(e){var t=!["plan","services","play"].includes(e.get("field_name")),n=e.get("editable",!1),a=e.get("mandatory",!1),r=e.get("display",!0);return t&&(n||a)&&r},n.filterSubscriptionPlanByPlay=function(e){var t=n.state.subscription,a=n.props.allPlans.find(function(e){return e.get("name","")===t.get("plan","")},null,g.c.Map()).get("play",g.c.List());a.isEmpty()||a.includes(e)||n.updateSubscriptionField(["plan"],"")},n.filterSubscriptionServicesByPlay=function(e){var t=n.props.allServices,a=(n.state.subscription.get("services",g.c.List())||g.c.List()).filter(function(n){var a=t.find(function(e){return e.get("name","")===n.get("name","")},null,g.c.Map()).get("play",g.c.List());return a.isEmpty()||a.includes(e)});n.updateSubscriptionField(["services"],a)},n.updateSubscriptionField=function(e,t){n.setState(function(n){return{subscription:n.subscription.setIn(e,t)}})},n.updateServicesDates=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=n.props.subscription.get("services",g.c.List())||g.c.List(),r=t||ee(e,"from").toISOString();return e.update("services",g.c.List(),function(e){return e?e.map(function(e){var t=n.getServiceType(e),i=a.find(function(t){return t.getIn(["ui_flags","serviceId"],"")===e.getIn(["ui_flags","serviceId"],"")}),o=""===e.getIn(["ui_flags","serviceId"],"");switch(t){case"normal":return o?e.set("from",r):e;case"quantitative":var l=i&&i.get("quantity","")!==e.get("quantity","");return o||l?e.set("from",r):e;case"balance_period":var s=i&&!S()(i.get("from","")).isSame(S()(e.get("from","")),"days"),c=S()(e.get("from","")).isBefore(r,"days");return(o||s)&&c?e.set("from",r):e;default:return e}}):g.c.List()})},n.removeSubscriptionField=function(e,t){n.setState(function(n){return{subscription:n.subscription.deleteIn(e,t)}})},n.getServiceType=function(e){var t=n.props.allServices,a=g.c.Map.isMap(e)?e.get("name",""):e,r=t.find(function(e){return e.get("name","")===a});return r?r.get("quantitative",!1)?"quantitative":"default"!==r.get("balance_period","default")?"balance_period":"normal":null},n.formatSelectOptions=function(e){return e.map(function(e){return{value:e.get("name",""),label:e.get("description",e.get("name",""))}})},n.getAvailablePlans=function(){var e=n.state.subscription,t=n.props.allPlans,a=e.get("play",!1);return[!1,""].includes(a)?n.formatSelectOptions(t):n.formatSelectOptions(t.filter(function(e){return e.get("play",g.c.List()).isEmpty()||e.get("play",g.c.List()).includes(a)}))},n.getPlanIncludedServices=function(e){if(""===e)return"-";var t=n.props.allPlans.find(function(t){return t.get("name","")===e},null,g.c.Map()).getIn(["include","services"],g.c.List());return t.size?t.join(", "):"-"},n.getAvailableServices=function(){var e=n.state.subscription,t=n.props.allServices,a=e.get("play",!1);return[!1,""].includes(a)?n.formatSelectOptions(t):n.formatSelectOptions(t.filter(function(e){return e.get("play",g.c.List()).isEmpty()||e.get("play",g.c.List()).includes(a)}))},n.getActions=function(){return[{type:"back",label:"Back To List",onClick:n.props.onCancel,actionStyle:"primary",actionSize:"xsmall"}]},n.fetchItem=function(){var e=n.state.subscription;n.props.getSubscription(e)},n.clearRevisions=function(){var e=n.state.subscription;n.props.clearRevisions(e),n.clearItemsList()},n.clearItemsList=function(){n.props.clearList()},n.removeServiceUiFlags=function(e){return e.update("services",g.c.List(),function(e){return e?e.map(function(e){return e.delete("ui_flags")}):g.c.List()})},n.renderSystemFields=function(e){var t=n.state.subscription,a=n.props.mode,i=n.getAvailablePlans().toJS(),o=n.getAvailableServices().toJS(),l=t.get("services",g.c.List())||g.c.List(),s=g.c.Set(l.map(function(e){return e.get("name","")})).join(","),c=t.get("plan","");return[r.a.createElement(Wc,{key:"plays-selector",entity:t,editable:e&&"create"===a,mandatory:!0,onChange:n.onChangePlay}),r.a.createElement(f.l,{key:"plan"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Plan ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"select",options:i,value:c,onChange:n.onChangePlan,editable:e}))),r.a.createElement(f.l,{key:"includedServices"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Included Services"),r.a.createElement(f.g,{sm:7},r.a.createElement(en,{value:n.getPlanIncludedServices(c),editable:!1}))),r.a.createElement(f.l,{key:"services"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Services"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"select",multi:!0,value:s,options:o,onChange:n.onChangeService,clearable:!1,editable:e})))]},n.renderPanelTitle=function(){var e=n.props,t=e.mode,a=e.subscription,i=X(t,"subscription",a);return r.a.createElement("div",null,i,r.a.createElement("div",{className:"pull-right"},r.a.createElement(Xe,{actions:n.getActions()})))},n.state={subscription:e.subscription,progress:!1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){g.c.is(this.props.subscription,e.subscription)||this.setState({subscription:e.subscription})}},{key:"render",value:function(){var e=this.state,t=e.progress,n=e.subscription,a=this.props,i=a.revisions,o=a.mode,l=a.allServices,s=a.subscription,c=["update","clone","closeandnew","create"].includes(o),u=n.get("services",g.c.List())||g.c.List(),p=ee(n,"from"),d=s.get("services",g.c.List())||g.c.List();return r.a.createElement("div",{className:"Subscription"},r.a.createElement(f.v,{header:this.renderPanelTitle()},r.a.createElement(Mu,{itemName:"subscription",revisions:i,item:n,mode:o,onChangeFrom:this.onChangeFrom,backToList:this.props.onCancel,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,onActionEdit:this.props.getSubscription,onActionClone:this.props.getSubscription,clearList:this.clearItemsList}),r.a.createElement("hr",null),r.a.createElement(f.j,{horizontal:!0},this.renderSystemFields(c),r.a.createElement(ap,{subscriptionServices:u,originSubscriptionServices:d,servicesOptions:l,editable:c,subscriptionFrom:p,onChangeService:this.onChangeServiceDetails,onRemoveService:this.onRemoveService,onAddService:this.onAddService}),r.a.createElement(Vu,{entityName:["subscribers","subscriber"],entity:n,onChangeField:this.updateSubscriptionField,onRemoveField:this.removeSubscriptionField,fieldsFilter:this.filterCustomFields,editable:c}))),r.a.createElement(v,{onClickCancel:this.props.onCancel,onClickSave:this.onSave,hideSave:!c,cancelLabel:c?void 0:"Back",progress:t}))}}]),t}(a.Component);rp.defaultProps={subscription:g.c.Map(),mode:"create",revisions:g.c.List(),settings:g.c.List(),allPlans:g.c.List(),allServices:g.c.List()};var ip=Object(l.connect)(function(e,t){var n=t.subscription,a=Y(["systemItems","subscription","collection"],""),r=Pe(Y(["systemItems","subscription","uniqueField"],"")).map(function(e){return n.get(e,"")}).join("_");return{revisions:e.entityList.revisions.getIn([a,r]),mode:n&&te(n,!1)?re(n):"create"}})(rp),op=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={subscription:null},n.fetchSubscription=function(e,t,a){var r=n.props.allServices,i=te(e,null);null!==i&&n.props.getSubscription(i,a).then(function(e){var t=e.update("services",g.c.List(),function(e){return e?e.map(function(e){var t="default"!==r.find(function(t){return t.get("name","")===e.get("name","")},null,g.c.Map()).get("balance_period","default"),n=g.c.Map({balance_period:t,serviceId:Mt.a.v4()});return e.set("ui_flags",n)}):g.c.List()});n.setState({subscription:t})})},n.onClickNew=function(e){n.setState({subscription:g.c.Map({aid:e})})},n.onClickCancel=function(){!0===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&n.props.clearList(),n.setState({subscription:null})},n.onClickSave=function(e,t){n.props.onSaveSubscription(e,t).then(n.afterSave)},n.afterSave=function(e){e&&n.setState({subscription:null})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.aid,n=e.settings,a=e.allPlans,i=e.allServices,o=e.defaultListFields,l=this.state.subscription;return l?r.a.createElement(ip,{subscription:l,settings:n,allPlans:a,allServices:i,clearRevisions:this.props.clearRevisions,clearList:this.props.clearList,getSubscription:this.fetchSubscription,onSave:this.onClickSave,onCancel:this.onClickCancel}):r.a.createElement(np,{settings:n,aid:t,onNew:this.onClickNew,onClickEdit:this.fetchSubscription,defaultListFields:o})}}]),t}(a.Component);op.defaultProps={settings:g.c.List(),allPlans:g.c.List(),allServices:g.c.List(),defaultListFields:[]};var lp=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onClearFilter=function(){n.setState({filter_by:[],string:""},function(){n.onClickFilterBtn()})},n.onChangeFilterString=n.onChangeFilterString.bind(Object(ki.a)(n)),n.onSelectFilterField=n.onSelectFilterField.bind(Object(ki.a)(n)),n.onClickFilterBtn=n.onClickFilterBtn.bind(Object(ki.a)(n)),n.buildQueryString=n.buildQueryString.bind(Object(ki.a)(n)),n.filterCond=n.filterCond.bind(Object(ki.a)(n)),n.state={string:"",filter_by:[]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.onClickFilterBtn()}},{key:"onChangeFilterString",value:function(e){var t=e.target.value;this.setState({string:t})}},{key:"filterCond",value:function(e,t){var n=this.props.fields.find(function(t){return t.id===e});if(!n)return{$regex:t,$options:"i"};switch(n.type){case"number":return parseInt(t);case"datetime":return t;case"text":default:return{$regex:t,$options:"i"}}}},{key:"buildQueryString",value:function(){var e=this,t=this.state,n=t.string,a=t.filter_by,r=this.props.base,i=Object.values(r).reduce(function(t,n,a){return Object.assign({},t,Object(vr.a)({},a,e.filterCond(a,n)))},{});return n.replace(/\s/gi,"")?a.reduce(function(t,a){return Object.assign({},t,Object(vr.a)({},a,e.filterCond(a,n)))},i):i}},{key:"onClickFilterBtn",value:function(){(0,this.props.onFilter)(this.buildQueryString())}},{key:"onSelectFilterField",value:function(e,t){var n=e.val(),a=this.state.filter_by,r=a.includes(n);if(!t||!r)return!t&&r?this.setState({filter_by:a.filter(function(e){return e!==n})}):this.setState({filter_by:a.concat(n)})}},{key:"render",value:function(){var e=this.props.fields,t=void 0===e?[]:e,n=this.state,a=n.filter_by,i=n.string,o=t.filter(function(e){return!1!==e.showFilter}).map(function(e,t){var n=a.includes(e.id);return{value:e.id,label:e.placeholder,selected:n}});return r.a.createElement("div",{className:"Filter row",style:{marginBottom:10}},r.a.createElement("div",{className:"filter-warp"},r.a.createElement("div",{className:"pull-left"},r.a.createElement("input",{id:"filter-string",placeholder:"Search for...",onChange:this.onChangeFilterString,value:i,className:"form-control"})),r.a.createElement("div",{className:"pull-left"},r.a.createElement(rc.a,{data:o,multiple:!0,onChange:this.onSelectFilterField,buttonWidth:"100%",nonSelectedText:"Search in fields"})),r.a.createElement("div",{className:"search-button pull-left"},r.a.createElement("button",{className:"btn btn-default search-btn",onClick:this.onClickFilterBtn,type:"submit",disabled:i&&0===a.length||!i&&0===a.length},r.a.createElement("i",{className:"fa fa-search"}))),r.a.createElement("div",{className:"search-button pull-left"},r.a.createElement("button",{className:"btn btn-default search-btn",onClick:this.onClearFilter,type:"button"},r.a.createElement("i",{className:"fa fa-eraser"})))))}}]),t}(a.Component);lp.defaultProps={base:{}};var sp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={filters:g.c.Map()},n.onChangeInput=function(e){var t=e.target,a=t.id,r=t.value;n.onChange(a,r)},n.onChangeDate=function(e,t){var a=t?t.toJSON():"";n.onChange("urt",a)},n.onChangeDateFrom=function(e,t){var a=t?t.toJSON():"",r=n.state.filters.get(e,{});r.from=a,n.onChange(e,r)},n.onChangeDateTo=function(e,t){var a=t?t.toJSON():"",r=n.state.filters.get(e,{});r.to=a,n.onChange(e,r)},n.onChange=function(e,t){var a=n.state.filters;t?n.setState({filters:a.set(e,t)}):n.setState({filters:a.delete(e)})},n.onClear=function(){var e=g.c.Map();n.setState({filters:e}),n.props.onFilter(e.toJS())},n.onApplay=function(){var e=n.state.filters;n.props.onFilter(e.toJS())},n.getFilterInput=function(e){var t=n.state.filters.get(e.id,"");switch(e.type){case"select":var a=e.options.map(function(e,t){var n,a;return e&&e.key&&e.val?(n=e.val,a=e.key):a=n=e,r.a.createElement("option",{key:t,value:a},n)});return r.a.createElement("select",{id:e.id,className:"form-control",value:t,onChange:n.onChangeInput},"[",r.a.createElement("option",{key:"select",value:""},"Select..."),", ...",a,"]");case"date":return r.a.createElement(Et.a,{className:"form-control",dateFormat:"DD/MM/YYYY",selected:t.length?S()(t):null,onChange:n.onChangeDate.bind(Object(ki.a)(n),e.id),isClearable:!0,placeholderText:"Select Date..."});case"date-range":var i=t?t.from:"";i=i?S()(i):null;var o=t?t.to:"";return o=o?S()(o):null,r.a.createElement("div",{style:{width:"100%"}},r.a.createElement("div",{className:"pull-left",style:{width:"48%"}},r.a.createElement(Et.a,{className:"form-control",dateFormat:"DD/MM/YYYY",selected:i,selectsStart:!0,startDate:i,endDate:o,onChange:n.onChangeDateFrom.bind(Object(ki.a)(n),e.id),isClearable:!0,placeholderText:"Select Start Date..."})),r.a.createElement("div",{className:"pull-right",style:{width:"48%"}},r.a.createElement(Et.a,{className:"form-control",dateFormat:"DD/MM/YYYY",selected:o,selectsEnd:!0,startDate:i,endDate:o,onChange:n.onChangeDateTo.bind(Object(ki.a)(n),e.id),isClearable:!0,placeholderText:"Select End Date..."})));default:return r.a.createElement("input",{id:e.id,onChange:n.onChangeInput,value:t,placeholder:"Search...",className:"form-control"})}},n.renderTitles=function(e,t,n){return r.a.createElement("th",{style:{width:"".concat(100/(0===n.length?1:n.length),"%")},key:t},e.title)},n.renderInputs=function(e,t,a){var i=n.getFilterInput(e),o=k()({pl0:0===t,pr0:t===a.length-1});return r.a.createElement("td",{className:o,key:t},i)},n.renderActions=function(){var e=n.props.fields;return[r.a.createElement("td",{colSpan:e.length-1,className:"pl0",key:"search"},r.a.createElement(f.c,{bsStyle:"primary",onClick:n.onApplay,className:"full-width mr10"},r.a.createElement("i",{className:"fa fa-search"}),"\xa0Search")),r.a.createElement("td",{className:"pr0",key:"reset"},r.a.createElement(f.c,{onClick:n.onClear,className:"full-width"},r.a.createElement("i",{className:"fa fa-eraser danger-red"}),"\xa0Reset"))]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.fields,t=e.map(this.renderTitles),n=e.map(this.renderInputs),a=this.renderActions();return r.a.createElement("div",{className:"AdvancedFilter"},r.a.createElement(f.z,{responsive:!0,className:"mb0"},r.a.createElement("thead",null,r.a.createElement("tr",null,t)),r.a.createElement("tbody",null,r.a.createElement("tr",null,n),r.a.createElement("tr",null,a))))}}]),t}(a.Component);sp.defaultProps={fields:[]};var cp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={page:0},n.handlePageClick=function(e){e.preventDefault();var t=n.props.pager,a=e.target.id,r=n.state.page;if("next"===a&&t.get("nextPage",!0))r+=1;else{if(!("previous"===a&&r>0))return;r-=1}n.setState({page:r}),n.props.onClick(r)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.size,n=e.count,a=e.pager,i=this.state.page,o=i*t,l="previous".concat(0===this.state.page?" disabled":""),s="next".concat(a.get("nextPage")?"":" disabled "),c=0===n?0:"".concat(o+1," to ").concat(o+n),u="Page ".concat(i+1);return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("ul",{className:"pagination"},r.a.createElement("li",{id:"previous",className:l},r.a.createElement("a",{id:"previous",onClick:this.handlePageClick},r.a.createElement("i",{id:"previous",className:"fa fa-chevron-left"}))),r.a.createElement("span",{className:"detalis",style:{padding:"0 10px"}},u,0!==c&&" | ".concat(c)),r.a.createElement("li",{id:"next",className:s},r.a.createElement("a",{id:"next",onClick:this.handlePageClick},r.a.createElement("i",{id:"next",className:"fa fa-chevron-right"}))))))}}]),t}(a.Component),up=Object(l.connect)(function(e){return{pager:e.pager}})(cp),pp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={page:0,size:10,sort:g.c.Map({sid:1}),filter:{}},n.buildQuery=function(){var e=n.state,t=e.size,a=e.page,r=e.sort,i=e.filter;return Tr(i,a,r,t)},n.fetchItems=function(){n.props.dispatch(fr("postpaid_balances",n.buildQuery()))},n.handlePageClick=function(e){n.setState({page:e},n.fetchItems)},n.onFilter=function(e){n.setState({filter:e,page:0},n.fetchItems)},n.onSort=function(e){var t=g.c.Map(e);n.setState({sort:t},n.fetchItems)},n.parseTotalCost=function(e){return e.getIn(["balance","cost"],0).toFixed(2)},n.getTableFields=function(){var e=n.props.usageTypes.map(function(e){return{id:e,placeholder:F.a.titleCase(e),showFilter:!1,parser:function(t){return t.getIn(["balance","totals",e,"usagev"],"")}}}).toJS();return[{id:"aid",placeholder:"Customer",type:"number",sort:!0,showFilter:!1,display:!1},{id:"sid",placeholder:"Subscriber",type:"number",sort:!0},{id:"plan_description",placeholder:"Plan"},{id:"balance.cost",placeholder:"Total Cost",type:"number",showFilter:!1,parser:n.parseTotalCost}].concat(Object(w.a)(e),[{id:"from",placeholder:"From",showFilter:!1,type:"datetime"},{id:"to",placeholder:"To",showFilter:!1,type:"datetime"}])},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.usageTypes.isEmpty()&&this.props.dispatch(il(["usage_types"]))}},{key:"render",value:function(){var e=this.props,t=e.items,n=e.aid,a=this.state.sort,i=this.getTableFields(),o={aid:n,connection_type:"postpaid"};return r.a.createElement("div",{className:"Postpaid-Balances"},r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(lp,{fields:i,onFilter:this.onFilter,base:o}),r.a.createElement(ec,{items:t,fields:i,onSort:this.onSort,sort:a}))),r.a.createElement(up,{onClick:this.handlePageClick,size:this.state.size,count:t.size}))}}]),t}(a.Component);pp.defaultProps={items:g.c.List(),usageTypes:g.c.List()};var dp=Object(l.connect)(function(e,t){return{items:e.list.get("postpaid_balances"),usageTypes:Dn(e,t)}})(pp),mp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={size:10,page:0,sort:g.c.Map({sid:1}),filter:{}},n.onFilter=function(e){n.setState({filter:e,page:0},n.fetchItems)},n.onSort=function(e){var t=g.c.Map(e);n.setState({sort:t},n.fetchItems)},n.fetchItems=function(){n.props.dispatch(fr("prepaid_balances",n.buildQuery()))},n.handlePageClick=function(e){n.setState({page:e},n.fetchItems)},n.buildQuery=function(){var e=n.state,t=e.size,a=e.page,r=e.sort,i=e.filter;return Sr(i,a,r,t)},n.parserUsageTypeName=function(e){return F.a.titleCase(e.get("charging_by_usaget",""))},n.parserUsageTypeValue=function(e){var t=e.get("charging_by_usaget"),n=e.get("charging_by"),a="total_cost"===t?["cost"]:["totals",t,n];return e.getIn(["balance"].concat(a),0).toFixed(2)},n.getTableFields=function(){return[{id:"aid",placeholder:"Customer",type:"number",sort:!0,showFilter:!1,display:!1},{id:"sid",placeholder:"Subscriber",type:"number",sort:!0},{id:"pp_includes_name",placeholder:"Bucket",sort:!0},{id:"charging_by_usaget",placeholder:"Usage Type Name",sort:!0,showFilter:!1,parser:n.parserUsageTypeName},{id:"usaget_type_value",placeholder:"Usage Type Value",sort:!0,showFilter:!1,parser:n.parserUsageTypeValue},{id:"from",placeholder:"From",showFilter:!1,type:"datetime"},{id:"to",placeholder:"To",showFilter:!1,type:"datetime"}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.aid,n=e.items,a=this.state.sort,i={aid:t,connection_type:"prepaid"},o=this.getTableFields();return r.a.createElement("div",{className:"Prepaid-Balances"},r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(lp,{fields:o,onFilter:this.onFilter,base:i}),r.a.createElement(ec,{items:n,fields:o,onSort:this.onSort,sort:a}))),r.a.createElement(up,{onClick:this.handlePageClick,size:this.state.size,count:n.size}))}}]),t}(a.Component);mp.defaultProps={items:g.c.List()};var gp=Object(l.connect)(function(e){return{items:e.list.get("prepaid_balances")}})(mp),fp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Hu(e)).then(n.afterItemReceived)},n.afterItemReceived=function(e){e.status||n.handleBack()},n.onChangeCustomerField=function(e){var t=e.target,a=t.value,r=t.id;n.props.dispatch(Ju(r,a))},n.onRemoveCustomerField=function(e){n.props.dispatch(Qu(e))},n.afterSaveCustomer=function(e){var t=n.props,a=t.mode,r=t.customer;if(e.status){n.props.dispatch(Pc("customers"));var i=["clone","create"].includes(a)?"created":"updated";n.props.dispatch(Wa("The customer was ".concat(i))),"create"===a&&n.handleBack();var o=X(a,"customer",r);n.props.dispatch(ro(o))}},n.onSaveCustomer=function(){var e=n.props,t=e.customer,a=e.mode;n.props.dispatch(Gu(t,a)).then(n.afterSaveCustomer)},n.onClickChangePaymentGateway=function(e){var t=e.get("aid",null),a="return_url=".concat(encodeURIComponent(n.getReturnUrl())),r="aid=".concat(encodeURIComponent(t)),i="action=".concat(encodeURIComponent("updatePaymentGateway"));window.location="".concat(Y(["env","serverApiUrl"],""),"/internalpaypage?").concat(r,"&").concat(a,"&").concat(i)},n.onSaveSubscription=function(e,t){return n.props.dispatch(Wu(e,t)).then(n.afterSaveSubscription)},n.afterSaveSubscription=function(e){if(e.status){var t=["clone","create"].includes(e.action)?"created":"updated";return n.props.dispatch(Wa("The subscription was ".concat(t))),n.clearSubscriptionRevisions(e.subscription),n.clearSubscriptions(),!0}return!1},n.clearSubscriptionRevisions=function(e){var t=e.get("sid",""),a=e.get("aid","");n.props.dispatch(xc("subscribers",[t,a]))},n.clearSubscriptions=function(){n.props.dispatch(Fc("subscribers"))},n.handleBack=function(){var e=Y(["systemItems","customer","itemsType"],"");n.props.router.push("/".concat(e))},n.getSubscription=function(e,t){return n.props.dispatch(Yu(e)).then(function(e){if(e.status){if("clone"===t)return n.props.dispatch(Ku()),n.props.subscription;var a=n.props.subscription.get("sid",""),r=n.props.subscription.get("aid","");return n.props.dispatch(Ac("subscribers",["sid","aid"],[a,r])),n.props.subscription}return null})},n.getReturnUrl=function(){var e=n.props.itemId;return"".concat(window.location.origin,"/#/customers/customer/").concat(e,"?tab=1")},n.handleSelectTab=function(e){var t=n.props.location,a=t.pathname,r=t.query;n.props.router.push({pathname:a,query:Object.assign({},r,{tab:e})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props,t=e.mode,n=e.message;if(this.props.dispatch(il(["subscribers"])),n&&this.props.dispatch(Ka(n.content,n.type)),["clone","create"].includes(t)){var a=X(t,"customer");this.props.dispatch(ro(a))}else this.props.dispatch(fr("available_gateways",{api:"paymentgateways",action:"list"})),this.props.dispatch(fr("available_plans",Dr({name:1,play:1,description:1,"include.services":1}))),this.props.dispatch(fr("available_services",Fr()))}},{key:"componentWillReceiveProps",value:function(e){var t=e.customer,n=e.mode,a=e.itemId,r=this.props,i=r.customer,o=r.itemId,l=r.mode,s=n!==l,c=te(t)!==te(i);if(s||c){var u=X(n,"customer",t);this.props.dispatch(ro(u))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"componentDidUpdate",value:function(e,t){var n=this.props.customer,a=e.customer.getIn(["payment_gateway","active"],g.c.List()),r=n.getIn(["payment_gateway","active"],g.c.List());!a.isEmpty()&&r.isEmpty()&&this.onSaveCustomer()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(bl("customer")),this.clearSubscriptions()}},{key:"render",value:function(){var e=this.props,t=e.customer,n=e.defaultSubsctiptionListFields,a=e.settings,i=e.plans,o=e.services,l=e.gateways,s=e.mode,c=e.aid,u=e.activeTab,p=1===u;if("loading"===s)return r.a.createElement(_,{onClick:this.handleBack});var d=a.getIn(["account","fields"],g.c.List()),m=a.getIn(["subscriber","fields"],g.c.List());return r.a.createElement("div",{className:"CustomerSetup"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(f.A,{defaultActiveKey:u,animation:!1,id:"CustomerEditTabs",onSelect:this.handleSelectTab},!d.isEmpty()&&r.a.createElement(f.y,{title:"Customer Details",eventKey:1,key:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(ep,{customer:t,action:s,supportedGateways:l,onChange:this.onChangeCustomerField,onRemoveField:this.onRemoveCustomerField,onChangePaymentGateway:this.onClickChangePaymentGateway}))),"create"!==s&&!m.isEmpty()&&r.a.createElement(f.y,{title:"Subscribers",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(op,{aid:c,settings:m,allPlans:i,allServices:o,onSaveSubscription:this.onSaveSubscription,defaultListFields:n,getSubscription:this.getSubscription,clearRevisions:this.clearSubscriptionRevisions,clearList:this.clearSubscriptions}))),"create"!==s&&r.a.createElement(f.y,{title:"Postpaid Counters",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(dp,{aid:c}))),"create"!==s&&r.a.createElement(f.y,{title:"Prepaid Counters",eventKey:4},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(gp,{aid:c})))))),p&&r.a.createElement(v,{onClickSave:this.onSaveCustomer,onClickCancel:this.handleBack}))}}]),t}(a.Component);fp.defaultProps={activeTab:1,customer:g.c.Map(),subscription:g.c.Map(),settings:g.c.Map(),gateways:g.c.List(),plans:g.c.List(),services:g.c.List(),defaultSubsctiptionListFields:["sid","firstname","lastname","plan","plan_activation","services","address"]};var hp=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:pi(e,t,"customer"),customer:ui(e,t,"customer"),subscription:ui(e,t,"subscription"),mode:di(e,t,"customer"),activeTab:ri(e,t),aid:e.entity.getIn(["customer","aid"])||void 0,settings:e.settings.get("subscribers")||void 0,plans:e.list.get("available_plans")||void 0,services:e.list.get("available_services")||void 0,gateways:e.list.get("available_gateways")||void 0,message:si(e,t)}})(fp)),vp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onClickImport=function(){n.props.router.push("/import/product")},n.parserUsegt=function(e){var t=e.get("rates",g.c.Map()).keySeq().first();return"undefined"!==typeof t?t:""},n.filterFields=function(){return[{id:"key",placeholder:"Key"}]},n.filterPlayField=function(e){var t=n.props.isPlaysEnabled;return"play"!==e.get("field_name","")||t},n.isImportEnabled=function(){return Y(["import","allowed_entities"],g.c.List()).includes("product")},n.getProjectFields=function(){var e=n.props,t=e.fields,a=e.defaultListFields;return t.filter(function(e){return e.get("show_in_list",!1)||a.includes(e.get("field_name",""))}).reduce(function(e,t){return e.set(t.get("field_name"),1)},g.c.Map({})).toJS()},n.getActions=function(){return[{type:"edit"}]},n.getFields=function(){var e=n.props,t=e.fields,a=e.defaultListFields;return t.filter(n.filterPlayField).filter(function(e){return e.get("show_in_list",!1)||a.includes(e.get("field_name",""))}).map(function(e){var t=e.get("field_name");switch(t){case"rates":return{id:"unit_type",parser:n.parserUsegt};case"description":return{id:t,title:"Title",sort:!0};case"key":return{id:t,title:"Key",sort:!0};default:var a=e.get("title",e.get("field_name",""));return{id:t,title:F.a.sentenceCase(a)}}}).toArray()},n.getListActions=function(){return[{type:"add"},{type:"refresh"},{type:"import",label:"Import",onClick:n.onClickImport,show:n.isImportEnabled,actionStyle:"primary",actionSize:"xsmall"}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(il("rates.fields"))}},{key:"render",value:function(){return null===this.props.fields?r.a.createElement(_,null):r.a.createElement(qc,{collection:"rates",itemType:"product",itemsType:"products",filterFields:this.filterFields(),tableFields:this.getFields(),projectFields:this.getProjectFields(),showRevisionBy:"key",actions:this.getActions(),listActions:this.getListActions()})}}]),t}(a.Component);vp.defaultProps={fields:null,isPlaysEnabled:!1,defaultListFields:["description","key","rates"]};var yp=Object(s.f)(Object(l.connect)(function(e,t){return{fields:e.settings.getIn(["rates","fields"])||void 0,isPlaysEnabled:jn(e,t)}})(vp)),bp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={fromError:"",toError:"",intervalError:"",priceError:""},n.onEditFrom=function(e){var t=n.props.index,a=e.target.value,r="";""===a?r="Required":Number.isInteger(Number(a))&&Number(a)>0?a=Number(a):r="Must be a positive integer",n.setState({fromError:r}),n.props.onProductEditRate(t,"from",a)},n.onEditTo=function(e){var t=n.props,a=t.index,r=t.productUnlimitedValue,i=t.item,o=e.target.value,l="";""===o?l="Required":r!==o&&Number.isInteger(Number(o))&&Number(o)>0?(o=Number(o))<=i.get("from",0)&&(l='Must be greater than "From"'):l="Must be a positive integer",n.setState({toError:l}),n.props.onProductEditRate(a,"to",o)},n.onEditInterval=function(e){var t=n.props.index,a=e.target.value,r="";""===a?r="Required":Number.isInteger(Number(a))&&Number(a)>0?a=Number(a):r="Must be a positive integer",n.setState({intervalError:r}),n.props.onProductEditRate(t,"interval",a)},n.onEditPrice=function(e){var t=n.props.index,a=e.target.value,r="";""===a?r="Required":R()(a)||(r="Must be number"),n.setState({priceError:r});var i=R()(a)?parseFloat(a):a;n.props.onProductEditRate(t,"price",i)},n.onRemoveItem=function(){var e=n.props.index;n.props.onProductRemoveRate(e)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props,a=n.item,r=n.mode,i=n.unit,o=r!==e.mode,l=i!==e.unit;return!g.c.is(a,e.item)||o||l}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.index,a=e.count,i=e.productUnlimitedValue,o=e.mode,l=e.unit,s=0===n,c=0===a||a-1===n,u=Number(t.get("from",0)),p=t.get("to",""),d=p===i?"Infinite":p,m="view"!==o,g=""!==l?"(".concat(l,")"):"";return r.a.createElement(f.x,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:2,xs:6,className:"col-xs-pr5"},r.a.createElement(f.l,{validationState:this.state.fromError.length>0?"error":null,style:{margin:0}},s&&r.a.createElement(f.h,null,"From ".concat(g)),r.a.createElement(en,{value:u,disabled:!0,editable:m}),this.state.fromError.length>0?r.a.createElement(f.n,null,this.state.fromError):"")),r.a.createElement(f.g,{sm:2,xs:6},r.a.createElement(f.l,{validationState:this.state.toError.length>0?"error":null,style:{margin:0}},s&&r.a.createElement(f.h,null,"To ".concat(g)),p===i?r.a.createElement(en,{value:d,disabled:!0,editable:m}):r.a.createElement(en,{value:d,onChange:this.onEditTo,fieldType:"number",min:0,editable:m}),this.state.toError.length>0?r.a.createElement(f.n,null,this.state.toError):"")),r.a.createElement(f.g,{sm:3,xs:6,className:"col-xs-pr5"},r.a.createElement(f.l,{validationState:this.state.intervalError.length>0?"error":null,style:{margin:0}},s&&r.a.createElement(f.h,null,"Interval ".concat(g)),r.a.createElement(en,{value:t.get("interval",""),onChange:this.onEditInterval,fieldType:"number",min:0,editable:m}),this.state.intervalError.length>0?r.a.createElement(f.n,null,this.state.intervalError):"")),r.a.createElement(f.g,{sm:3,xs:6},r.a.createElement(f.l,{validationState:this.state.priceError.length>0?"error":null,style:{margin:0}},s&&r.a.createElement(f.h,null,"Price Per Interval"),r.a.createElement(en,{value:t.get("price",""),onChange:this.onEditPrice,fieldType:"price",editable:m}),this.state.priceError.length>0?r.a.createElement(f.n,null,this.state.priceError):"")),r.a.createElement(f.g,{xs:2,className:"text-left actions"},n>0&&c&&m&&r.a.createElement(f.c,{onClick:this.onRemoveItem,bsSize:"small"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"})," \xa0Remove")),!c&&r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,xs:12},r.a.createElement("hr",{style:{marginTop:8,marginBottom:8}})))}}]),t}(a.Component);bp.defaultProps={productUnlimitedValue:Y("productUnlimitedValue","UNLIMITED"),mode:"create",unit:""};var Ep=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={errors:{name:""},newProductParam:!1,unit:null},n.onChangeName=function(e){var t=n.props.errorMessages.name.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=Y("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{name:i})}),n.props.onFieldUpdate(["key"],r)},n.onChangePlay=function(e){n.props.onFieldUpdate(["play"],e)},n.onChangeDescription=function(e){var t=e.target.value;n.props.onFieldUpdate(["description"],t)},n.onChangeAddToRetail=function(e){var t=e.target.value;n.props.onFieldUpdate(["add_to_retail"],t)},n.onChangeUsaget=function(e){var t=n.props.usaget;n.props.onUsagetUpdate(["rates"],t,e)},n.onChangeUnit=function(e,t){var a=n.props,r=a.product,i=a.planName,o=a.usaget,l=["rates",t||o,i,"rate"],s=r.getIn(l,g.c.List());n.setState({unit:e}),s.forEach(function(t,a){var r=[].concat(l,[a,"uom_display","range"]),i=[].concat(l,[a,"uom_display","interval"]);n.props.onFieldUpdate(r,e),n.props.onFieldUpdate(i,e)})},n.onChangePricingMethod=function(e){var t=e.target.value;n.props.onFieldUpdate(["pricing_method"],t)},n.onProductRateUpdate=function(e,t,a){var r=n.props,i=r.planName,o=r.usaget;switch(t){case"to":var l=["rates",o,i,"rate"];n.props.onToUpdate(l,e,a);break;default:var s=["rates",o,i,"rate",e,t];n.props.onFieldUpdate(s,a)}},n.onProductRateAdd=function(){var e=n.props,t=e.planName,a=["rates",e.usaget,t,"rate"];n.props.onProductRateAdd(a)},n.onProductRateRemove=function(e){var t=n.props,a=t.planName,r=["rates",t.usaget,a,"rate"];n.props.onProductRateRemove(r,e)},n.onChangeTariffCategory=function(e,t){n.isRetailRate(t)?n.setRetailRate():n.setRetailRate(!1),n.onChangeAdditionalField(e,t)},n.onChangeAdditionalField=function(e,t){n.props.onFieldUpdate(e,t)},n.onRemoveAdditionalField=function(e){n.props.onFieldRemove(e)},n.isRetailRate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=n.props.product;return"retail"===(null===e?t.get("tariff_category"):e)},n.setRetailRate=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n.onChangeAddToRetail({target:{value:e}})},n.filterCustomFields=function(e){return function(t){var n=t.get("field_name",""),a=e.includes(n);return(!n.startsWith("params.")&&"tariff_category"!==t.get("field_name","")||a)&&!1!==t.get("display",!1)&&!1!==t.get("editable",!1)}},n.filterTariffCategory=function(e){return"tariff_category"===e.get("field_name","")&&!1!==e.get("display",!1)&&!1!==e.get("editable",!1)},n.renderPrices=function(){var e=n.props,t=e.product,a=e.planName,i=e.usaget,o=e.mode,l=["rates",i,a,"rate"],s=t.getIn(l,g.c.List());return s.map(function(e,t){return r.a.createElement(bp,{mode:o,count:s.size,index:t,item:e,key:t,unit:n.getUnitLabel(),onProductEditRate:n.onProductRateUpdate,onProductRemoveRate:n.onProductRateRemove})})},n.getUnit=function(){var e=n.props,t=e.product,a=e.usaget,r=n.state.unit;return null===r?t.getIn(["rates",a,"BASE","rate",0,"uom_display","range"],""):r},n.getUnitLabel=function(){var e=n.props,t=e.propertyTypes,a=e.usageTypesData,r=e.usaget;return ye(t,a,r,n.getUnit())},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.product,n=e.planName,a=["rates",e.usaget,n,"rate"];0===t.getIn(a,g.c.List()).size&&this.props.onProductRateAdd(a)}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.product,a=t.usaget,i=t.mode,o=t.ratingParams,l=this.getUnit(),s=n.get("pricing_method",""),c="view"!==i;return r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,null,r.a.createElement(Wc,{entity:n,editable:c&&"create"===i,onChange:this.onChangePlay}),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("description",K("service"),Object(x.sentenceCase)("title")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ii,{contents:Ri.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{onChange:this.onChangeDescription,value:n.get("description",""),editable:c}))),["clone","create"].includes(i)&&r.a.createElement(f.l,{validationState:e.name.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("key",K("service"),Object(x.sentenceCase)("key")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ii,{contents:Ri.key})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{onChange:this.onChangeName,value:n.get("key",""),disabled:!["clone","create"].includes(i),editable:c}),e.name.length>0&&r.a.createElement(f.n,null,e.name))),r.a.createElement(Vu,{entityName:"rates",entity:n,onChangeField:this.onChangeTariffCategory,onRemoveField:this.onRemoveAdditionalField,fieldsFilter:this.filterTariffCategory,editable:c}),!this.isRetailRate()&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("add_to_retail",K("product"),Object(x.sentenceCase)("add to retail")),r.a.createElement(Ii,{contents:Ri.addToRetail})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"checkbox",onChange:this.onChangeAddToRetail,value:n.get("add_to_retail",!1),editable:c}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("usage_type",K("product"),"Unit Type"),r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:8,lg:9},c&&["clone","create"].includes(i)?r.a.createElement(eu,{usaget:a,unit:l,onChangeUsaget:this.onChangeUsaget,onChangeUnit:this.onChangeUnit}):r.a.createElement("div",null,r.a.createElement(f.g,{sm:3,style:{paddingTop:7}},a),r.a.createElement(f.g,{sm:4,componentClass:f.h,className:"pr0 pl0"},"Units of Measure"),r.a.createElement(f.g,{sm:5,className:"pr0"},r.a.createElement(eu,{usaget:a,unit:l,onChangeUsaget:this.onChangeUsaget,onChangeUnit:this.onChangeUnit,showSelectTypes:!1,editable:"view"!==i}))))),r.a.createElement(Vu,{entityName:"rates",entity:n,onChangeField:this.onChangeAdditionalField,onRemoveField:this.onRemoveAdditionalField,highlightPramas:o,editable:c})),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Pricing")},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:12},c?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"inline mr10"},r.a.createElement(en,{fieldType:"radio",name:"pricing-method",id:"pricing-method-tiered",value:"tiered",checked:"tiered"===s,onChange:this.onChangePricingMethod,label:"Tiered pricing",className:"inline"}),"\xa0",r.a.createElement(Ii,{contents:Ri.tieredPricing})),r.a.createElement("div",{className:"inline"},r.a.createElement(en,{fieldType:"radio",name:"pricing-method",id:"pricing-method-volume",value:"volume",checked:"volume"===s,onChange:this.onChangePricingMethod,label:"Volume pricing",className:"inline"}),"\xa0",r.a.createElement(Ii,{contents:Ri.volumePricing}))):r.a.createElement("div",{className:"non-editble-field"},"tiered"===s?"Tiered pricing":"Volume pricing"))),r.a.createElement(f.g,{sm:12},this.renderPrices()),c&&r.a.createElement(Je,{onClick:this.onProductRateAdd,label:"Add New"})))))}}]),t}(a.Component);Ep.defaultProps={usageTypesData:g.c.List(),propertyTypes:g.c.List(),ratingParams:g.c.List(),planName:"BASE",product:g.c.Map(),usaget:void 0,errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var Cp=Object(l.connect)(function(e,t){return{usageTypesData:Un(e,t),propertyTypes:Vn(e,t)}})(Ep),_p=function(){return r.a.createElement(qc,{itemsType:Y(["systemItems","tax","itemsType"],""),itemType:Y(["systemItems","tax","itemType"],""),filterFields:[{id:"description",placeholder:"Title"},{id:"key",placeholder:"Key"}],tableFields:[{id:"description",title:"Title",sort:!0},{id:"key",title:"Key",sort:!0}],projectFields:{key:1,description:1},showRevisionBy:"key",actions:[{type:"edit"}]})},Op=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={errors:{key:""}},n.onChangeKey=function(e){var t=n.props.errorMessages.key.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=Y("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{key:i})}),n.props.onFieldUpdate(["key"],r)},n.onChangeDescription=function(e){var t=e.target.value;n.props.onFieldUpdate(["description"],t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,e.item)||this.props.mode!==e.mode}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.item,a=t.mode,i="view"!==a;return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("description",K("tax"),Object(x.sentenceCase)("title")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ii,{contents:Mi.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{value:n.get("description",""),onChange:this.onChangeDescription,editable:i}))),["clone","create"].includes(a)&&r.a.createElement(f.l,{validationState:e.key.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("key",K("tax"),Object(x.sentenceCase)("key")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ii,{contents:Mi.key})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{value:n.get("key",""),onChange:this.onChangeKey,editable:i}),e.key.length>0&&r.a.createElement(f.n,null,e.key))),r.a.createElement(Vu,{entityName:"taxes",entity:n,onChangeField:this.props.onFieldUpdate,onRemoveField:this.props.onFieldRemove,editable:i}))}}]),t}(a.Component);Op.defaultProps={errorMessages:{key:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var Sp=Op,Tp=function(e){return Ol("tax",Rr("taxes",e))},kp=function(e,t){return Cl("taxes",e,t)},Ip=function(e,t){return gl("tax",e,t)},Np=function(){return yl("tax","tax")},wp=function(e){return fl("tax",e)},jp=function(){return Pc("taxes")},Rp=function(e){return Ac("taxes","key",e)},xp=function(e){return xc("taxes",e)},Fp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={progress:!1},n.initDefaultValues=function(){var e=n.props,t=e.mode,a=e.item;if("create"===t||"closeandnew"===t&&ee(a,"from").isBefore(S()())){var r=S()().add(1,"days").toISOString();n.onChangeFieldValue(["from"],r)}"clone"===t&&n.props.dispatch(Np())},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&te(t,!1)){var a=t.get("key","");n.props.dispatch(Rp(a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Tp(e)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("key","");n.props.dispatch(xp(e))},n.clearItemsList=function(){var e=Y(["systemItems","tax","itemsType"],"");n.props.dispatch(jp(e))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onRemoveFieldValue=function(e){n.props.dispatch(wp(e))},n.onChangeFieldValue=function(e,t){var a=n.props,r=a.deletePathOnEmptyValue,i=a.deletePathOnNullValue,o=Array.isArray(e)?e.join("."):e;""===t&&r.includes(o)?n.props.dispatch(wp(e)):null===t&&i.includes(o)?n.props.dispatch(wp(e)):n.props.dispatch(Ip(e,t))},n.afterSave=function(e){n.setState({progress:!1});var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Wa("The tax was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.setState({progress:!0}),n.props.dispatch(kp(t,a)).then(n.afterSave)},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Y(["systemItems","tax","itemsType"],"");e&&n.clearItemsList(),n.props.router.push("/".concat(t))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.mode;if(this.fetchItem(),"create"===e){var t=X(e,"tax");this.props.dispatch(ro(t))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=this.props,i=r.item,o=r.itemId,l=r.mode;if(n!==l||te(t)!==te(i)){var s=X(n,"tax",t);this.props.dispatch(ro(s))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"componentWillUnmount",value:function(){this.props.dispatch(bl("tax"))}},{key:"render",value:function(){var e=this.state.progress,t=this.props,n=t.item,a=t.mode,i=t.revisions;if("loading"===a)return r.a.createElement(_,{onClick:this.handleBack});var o="view"!==a;return r.a.createElement("div",{className:"tax-setup"},r.a.createElement(f.v,null,r.a.createElement(Mu,{itemName:"tax",revisions:i,item:n,mode:a,onChangeFrom:this.onChangeFieldValue,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.v,null,r.a.createElement(Sp,{item:n,mode:a,onFieldUpdate:this.onChangeFieldValue,onFieldRemove:this.onRemoveFieldValue})),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!o,cancelLabel:o?void 0:"Back",progress:e}))}}]),t}(a.Component);Fp.defaultProps={item:g.c.Map(),revisions:g.c.List(),deletePathOnEmptyValue:[],deletePathOnNullValue:[]};var Pp=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:pi(e,t,"tax"),item:ui(e,t,"tax"),mode:di(e,t,"tax"),revisions:ai(e,t,"tax")}})(Fp)),Mp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={dirty:!1,progress:!1},n.removePriorityUIFlags=function(){var e=n.props.taxMapping.withMutations(function(e){e.forEach(function(t,n){t.get("priorities",Object(g.a)()).forEach(function(t,a){t.has("uiFlag")&&e.deleteIn([n,"priorities",a,"uiFlag"])})})});n.props.dispatch(Zo("taxation",["mapping"],e))},n.setPageTitle=function(e){if(1===e.size){var a="".concat(t.pageTitle," | ").concat(Object(x.titleCase)(e.keySeq().first("Priorities")));n.props.dispatch(ro(a))}else n.props.dispatch(ro(t.pageTitle))},n.afterSave=function(e){!0===e||[1,2].includes(e.status)?n.setState(function(){return{progress:!1,dirty:!1}}):n.setState(function(){return{progress:!1}})},n.onSave=function(){n.state.dirty&&(n.setState(function(){return{progress:!0}}),n.removePriorityUIFlags(),n.props.dispatch(rl("taxation.mapping")).then(n.afterSave))},n.onCancel=function(){n.state.dirty&&(n.setState(function(){return{progress:!0,dirty:!1}}),n.props.dispatch(il("taxation.mapping")).then(n.afterSave))},n.onUpdate=function(e,t){n.setState(function(){return{dirty:!0}}),n.props.dispatch(Zo("taxation",["mapping"].concat(Object(w.a)(e)),t))},n.onAdd=function(e,t){n.setState(function(){return{dirty:!0}}),n.props.dispatch(Xo("taxation",t,["mapping"].concat(Object(w.a)(e))))},n.onRemove=function(e){n.setState(function(){return{dirty:!0}}),n.props.dispatch(el("taxation",["mapping"].concat(Object(w.a)(e))))},n.renderPriority=function(e,t){var a=n.props,i=a.type,o=a.lineKeyOptions,l=a.taxParamsKeyOptions,s=a.conditionFieldsOptions,c=a.valueWhenOptions;return r.a.createElement(Ji,{type:i,category:e,priorities:t,lineKeyOptions:o,paramsKeyOptions:l,conditionFieldsOptions:s,valueWhenOptions:c,onAdd:n.onAdd,onRemove:n.onRemove,onUpdate:n.onUpdate})},n.renderTabs=function(){var e=n.props,t=e.taxMapping,a=e.location;if(t.size<1)return r.a.createElement("p",null,"No Tax mapping categories");if(1===t.size){var i=t.keySeq().first(""),o=t.first(Object(g.b)());return n.renderPriority(i,o)}return r.a.createElement(Ei,{id:"TaxTabs",location:a},t.map(function(e,t){return r.a.createElement(f.y,{title:Object(x.titleCase)(t),eventKey:t},"this.renderPriority(category, priorities);")}).toArray())},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.taxMapping;this.props.dispatch(il(["taxation.mapping","taxes.fields","lines.fields"])),this.setPageTitle(e)}},{key:"componentDidUpdate",value:function(e){var t=this.props.taxMapping;t.size!==e.taxMapping.size&&this.setPageTitle(t)}},{key:"componentWillUnmount",value:function(){this.state.dirty&&this.props.dispatch(il("tax"))}},{key:"render",value:function(){var e=this.state,t=e.dirty,n=e.progress,a=this.renderTabs();return r.a.createElement(r.a.Fragment,null,a,r.a.createElement("hr",null),r.a.createElement(v,{onClickCancel:this.onCancel,disableCancel:!t,onClickSave:this.onSave,disableSave:!t,progress:n,disabled:!t}))}}]),t}(a.PureComponent);Mp.defaultProps={type:"tax",taxMapping:Object(g.b)(),lineKeyOptions:[],conditionFieldsOptions:[],valueWhenOptions:[]},Mp.pageTitle="Global Tax Mapping Rules";var Ap=Object(l.connect)(function(e,t){return{lineKeyOptions:ha(e,t),taxParamsKeyOptions:ma(e,t),conditionFieldsOptions:ga(e,t),valueWhenOptions:fa(e,t),taxMapping:_n(e,t)}})(Mp),Dp=function(e){var t=e.tax,n=e.disabled,i=e.itemName,o=e.typeOptions,l=e.taxRateOptions,s=e.onUpdate,c=Object(a.useCallback)(function(e){s(["custom_tax"],e)},[s]),u=Object(a.useCallback)(function(e){var n=e.target.value;"custom"===n&&""===t.get("custom_logic","")&&s(["custom_logic"],"override"),s(["taxation"],n)},[s,t]),p=Object(a.useCallback)(function(e){var t=e.target.value;s(["custom_logic"],t)},[s]),d=Object(a.useMemo)(function(){return o.map(le).toArray()},[o]),m=Object(a.useMemo)(function(){return l.map(function(e){return{label:e.get("description",""),value:e.get("key","")}}).toArray()},[l]),g=Object(a.useMemo)(function(){return Y(["systemItems",i,"itemName"],"")},[i]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("type",K(i),Object(x.sentenceCase)("type"))),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"select",value:t.get("type",""),onChange:c,options:d,disabled:n,editable:!1}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2}),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"radio",onChange:u,checked:"no"===t.get("taxation",""),value:"no",label:"".concat(Object(x.titleCase)(g)," isn't subject to taxation"),disabled:n}),r.a.createElement(en,{fieldType:"radio",onChange:u,checked:"global"===t.get("taxation",""),value:"global",label:"Use global mapping rules",disabled:n}),r.a.createElement("div",{className:"clearfix"},r.a.createElement(en,{fieldType:"radio",onChange:u,checked:"custom"===t.get("taxation",""),value:"custom",label:"".concat(Object(x.titleCase)(g)," implies a specific tax rate").concat("custom"===t.get("taxation","")||""!==t.get("custom_tax","")?": ":""),className:"pull-left mr5",disabled:n}),r.a.createElement(en,{fieldType:"select",value:t.get("custom_tax",""),onChange:c,options:m,editable:"custom"===t.get("taxation","")&&!n})),"custom"===t.get("taxation","")&&r.a.createElement(f.l,{className:"mb0"},r.a.createElement(f.g,{smOffset:2,xsOffset:1},r.a.createElement(en,{fieldType:"radio",onChange:p,checked:"override"===t.get("custom_logic",""),value:"override",label:"Override global mapping rules",disabled:n}),r.a.createElement(en,{fieldType:"radio",onChange:p,checked:"fallback"===t.get("custom_logic",""),value:"fallback",label:"Apply if tax rate not found via global mapping rules",disabled:n}))),r.a.createElement(en,{fieldType:"radio",onChange:u,checked:"default"===t.get("taxation",""),value:"default",label:"Use default tax rate",disabled:n}))))};Dp.defaultProps={tax:Object(g.b)(),disabled:!1,itemName:"",typeOptions:Object(g.a)([Object(g.b)({id:"vat",title:"Vat"})]),taxRateOptions:Object(g.a)()};var Lp=Dp,Up=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).initDefaultValues=function(){n.props.tax.isEmpty()&&n.props.onFieldUpdate(["tax"],Object(g.a)([t.defaultTax]))},n.onUpdateTax=function(e,t){n.props.onFieldUpdate(["tax",0].concat(Object(w.a)(e)),t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.loadRates(),this.initDefaultValues()}},{key:"componentWillUnmount",value:function(){this.props.clearRates()}},{key:"render",value:function(){var e=this,t=this.props,n=t.tax,a=t.mode,i=t.itemName,o=t.typeOptions,l=t.taxRateOptions,s="view"===a;return r.a.createElement(f.j,{horizontal:!0},n.map(function(t,n){return r.a.createElement(Lp,{key:n,tax:t,itemName:i,typeOptions:o,taxRateOptions:l,disabled:s,onUpdate:e.onUpdateTax})}))}}]),t}(a.PureComponent);Up.defaultProps={tax:Object(g.a)(),mode:"",itemName:"",typeOptions:Object(g.a)([Object(g.b)({id:"vat",title:"Vat"})]),taxRateOptions:Object(g.a)()},Up.defaultTax=Object(g.b)({type:"vat",taxation:"global"});var Vp=Object(l.connect)(function(e,t){return{taxRateOptions:e.list.get("available_taxRates")}},function(e){return{loadRates:function(){return e(fr("available_taxRates",xr("taxes",{key:1,description:1})))},clearRates:function(){return e(gr("available_taxRates"))}}})(Up),Bp=function(e,t){return{type:"PRODUCT_UPDATE_FIELD_VALUE",path:e,value:t}},qp=function(e){return{type:"PRODUCT_DELETE_FIELD",path:e}},zp=function(e,t,n){return{type:"PRODUCT_UPDATE_TO_VALUE",path:e,index:t,value:n}},Hp=function(e,t,n){return{type:"PRODUCT_UPDATE_USAGET_VALUE",path:e,oldUsaget:t,newUsaget:n}},Yp=function(e){return{type:"PRODUCT_ADD_RATE",path:e}},Gp=function(e,t){return{type:"PRODUCT_REMOVE_RATE",path:e,index:t}},Kp=function(){return{type:"PRODUCT_CLONE_RESET",uniquefields:["key"]}},Wp=function(e,t){return function(n,a){var r=a(),i=Un(r),o=Vn(r),l=Ce(o,i,e,!0),s=e.withMutations(function(e){l.isEmpty()||e.set("rates",l)});return n(Cl("rates",s,t))}},Jp=function(e){return function(t,n){t(Aa());var a=function(e){return Rr("rates",e)}(e);return ir(a).then(function(e){var a=e.data[0].data.details[0];a.originalValue=a.from;var r=n(),i=Un(r),o=Vn(r),l=g.c.fromJS(a),s=Ce(o,i,l,!1),c=l.withMutations(function(e){s.isEmpty()||e.set("rates",s)}).toJS();return t(function(e){return{type:"PRODUCT_GOT",product:e}}(c)),t(tr(e))}).catch(function(e){return t(nr(e,"Error retreiving product"))})}},Qp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:parseInt(n.props.activeTab)},n.initDefaultValues=function(){var e=n.props,t=e.mode;if(null===e.item.get("pricing_method",null)&&n.props.dispatch(Bp(["pricing_method"],"tiered")),"create"===t){var a=S()().add(1,"days").toISOString();n.props.dispatch(Bp(["from"],a))}"clone"===t&&n.props.dispatch(Kp())},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&t.getIn(["_id","$id"],!1)){var a=t.get("key","");n.props.dispatch(Ac("rates","key",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Jp(e)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("key","");n.props.dispatch(xc("rates",e))},n.clearItemsList=function(){n.props.dispatch(Pc("products"))},n.onFieldUpdate=function(e,t){n.props.dispatch(Bp(e,t))},n.onFieldRemove=function(e){n.props.dispatch(qp(e))},n.onToUpdate=function(e,t,a){n.props.dispatch(zp(e,t,a))},n.onUsagetUpdate=function(e,t,a){n.props.dispatch(Hp(e,t,a))},n.onProductRateAdd=function(e){n.props.dispatch(Yp(e))},n.onProductRateRemove=function(e,t){n.props.dispatch(Gp(e,t))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.afterSave=function(e){var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Wa("The product was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.props.dispatch(Wp(t,a)).then(n.afterSave)},n.handleBack=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&n.clearItemsList();var e=Y(["systemItems",t.entityName,"itemsType"],"");n.props.router.push("/".concat(e))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if(this.props.dispatch(il(["usage_types","file_types","property_types","subscribers.subscriber.fields","rates.fields"])),["clone","create"].includes(e)){var n=X(e,t.entityName);this.props.dispatch(ro(n))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var n=e.item,a=e.mode,r=e.itemId,i=this.props,o=i.item,l=i.itemId,s=i.mode;if(a!==s||te(n)!==te(o)){var c=X(a,t.entityName,n);this.props.dispatch(ro(c))}(r!==l||a!==s&&"clone"===a)&&this.fetchItem(r)}},{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,t.item)||!g.c.is(this.props.revisions,t.revisions)||this.props.activeTab!==e.activeTab||this.props.itemId!==e.itemId||this.props.mode!==e.mode}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"PRODUCT_CLEAR"})}},{key:"render",value:function(){var e=this.props,n=e.item,a=e.ratingParams,i=e.mode,o=e.revisions;if("loading"===i)return r.a.createElement(_,{onClick:this.handleBack});var l="view"!==i,s=ge(n);return r.a.createElement("div",{className:"ProductSetup"},r.a.createElement(f.v,null,r.a.createElement(Mu,{revisions:o,item:n,mode:i,onChangeFrom:this.onFieldUpdate,itemName:"product",backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.v,null,r.a.createElement(Cp,{mode:i,onFieldUpdate:this.onFieldUpdate,onFieldRemove:this.onFieldRemove,onToUpdate:this.onToUpdate,onProductRateAdd:this.onProductRateAdd,onProductRateRemove:this.onProductRateRemove,onUsagetUpdate:this.onUsagetUpdate,planName:"BASE",product:n,usaget:s,ratingParams:a}),"retail"===n.get("tariff_category","")&&r.a.createElement(f.v,{header:"Tax"},r.a.createElement(Vp,{tax:n.get("tax"),mode:i,itemName:t.entityName,onFieldUpdate:this.onFieldUpdate,onFieldRemove:this.onFieldRemove}))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!l,cancelLabel:l?void 0:"Back"}))}}]),t}(a.Component);Qp.defaultProps={item:g.c.Map(),revisions:g.c.List(),ratingParams:g.c.List(),activeTab:1},Qp.entityName="product";var $p=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:pi(e,t,Qp.entityName),item:ui(e,t,Qp.entityName),mode:di(e,t,Qp.entityName),activeTab:ri(e,t,Qp.entityName),revisions:ai(e,t,Qp.entityName),ratingParams:Cn(e,t)}})(Qp)),Zp={SIMPLE:0,GROPPED:1},Xp=function(){return{type:ml,collection:"reports",uniquefields:["key","user","creation_time"]}},ed=function(){return bl("reports")},td=function(e,t){return Cl("reports",e,t)},nd=function(e){return Sl("reports",e)},ad=function(e,t){return gl("reports",e,t)},rd=function(e){return fl("reports",e)},id=function(e){return function(t){t(Aa());var n=function(e){return Rr("reports",e)}(e);return ir(n).then(function(e){var n=e.data[0].data.details[0],a=Y(["reports","outputFormats"],g.c.List());if(n.formats){var r=n.formats.map(function(e){return a.find(function(t){return t.get("id")===e.op},null,g.c.Map()).has("valueTypes")?{field:e.field,op:e.op,value:e.value.substr(0,e.value.indexOf(" ")),type:e.value.substr(e.value.indexOf(" ")+1)}:e});n.formats=r}return t(hl("reports",n)),t(vl("reports",n)),t(tr(e))}).catch(function(e){return t(nr(e,"Error retreiving report"))})}},od=function(e){return Mc("reportData",function(e){var t=e.report,n=e.page,a=void 0===n?0:n,r=e.size,i=void 0===r?10:r;return{api:"report",params:[{action:"generateReport"},{report:JSON.stringify(t)},{page:a},{size:i}]}}(e))},ld=function(){return Pc("reportData")},sd=function(e){return jc("reportData",e)},cd=function(e){return Nc("reportData",e)},ud=function(){return fr("cycles_list",Yr())},pd=function(){return fr("available_plans",Dr())},dd=function(){return fr("available_services",Fr())},md=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();if(e.isEmpty())return fr("all_rates",Mr());var t=xe(e);return fr(t,Mr({key:1,description:1},e))},gd=function(){return function(e){return e(il("usage_types"))}},fd=function(){return fr("pp_includes",Pr())},hd=function(){return function(e){return e(il("file_types"))}},vd=function(){return function(e){return e(il("events"))}},yd=function(){return function(e){return e(il("plays"))}},bd=function(){return fr("available_taxRates",xr("taxes",{key:1,description:1}))},Ed=function(){return function(e){return ir(Ur()).then(function(t){try{return e(pr("available_groups",t.data[0].data.details)),e(dr("available_groups",t.data[1].data.details)),e(tr(t))}catch(n){throw new Error("Error retreiving list")}}).catch(function(t){return e(nr(t,"Network error - please refresh and try again"))})}},Cd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={itemToDelete:null,refreshString:""},n.parseEntityName=function(e){return Object(x.titleCase)(Y(["systemItems",e.get("entity",""),"itemName"],"entity"))},n.parseEntityType=function(e){return G("report_type_".concat(e.get("type")),"report")},n.parseUserName=function(e){return Object(x.titleCase)(e.get("user","-"))},n.getFilterFields=function(){return[{id:"key",placeholder:"Name"},{id:"user",placeholder:"User"}]},n.getTableFields=function(){return[{id:"key",title:"Name",sort:!0},{id:"entity",title:"Entity",sort:!0,parser:n.parseEntityName},{id:"type",title:"Type",sort:!0,parser:n.parseEntityType},{id:"user",title:"User",sort:!0,parser:n.parseUserName},{id:"from",title:"Modified",type:"date",cssClass:"short-date",sort:!0}]},n.getProjectFields=function(){return{key:1,entity:1,user:1,from:1,type:1}},n.onAskDelete=function(e){var t={message:'Are you sure you want to delete "'.concat(e.get("key",""),'" report ?'),onOk:n.onDeleteOk,labelOk:"Delete",type:"delete",onCancel:n.onDeleteClose};n.props.dispatch(po(t)),n.setState({itemToDelete:e})},n.onDeleteClose=function(){n.setState({itemToDelete:null})},n.onDeleteOk=function(){var e=n.state.itemToDelete;n.props.dispatch(nd(e)).then(n.afterDelete)},n.afterDelete=function(e){n.onDeleteClose(),e.status&&(n.props.dispatch(Wa("The report was deleted")),n.setState({refreshString:S()().format()}))},n.onClone=function(e){var t=te(e,""),a=Y(["systemItems","report","itemType"],""),r=Y(["systemItems","report","itemsType"],"");n.props.router.push({pathname:"".concat(r,"/").concat(a,"/").concat(t),query:{action:"clone"}})},n.getActions=function(){return[{type:"view",onClickColumn:null},{type:"edit"},{type:"clone",showIcon:!0,onClick:n.onClone,helpText:"Clone"},{type:"remove",showIcon:!0,onClick:n.onAskDelete,helpText:"Remove"}]},n.getDefaultSort=function(){return g.c.Map({creation_time:-1})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state.refreshString,t=this.getFilterFields(),n=this.getTableFields(),a=this.getActions(),i=this.getProjectFields(),o=this.getDefaultSort();return r.a.createElement(qc,{collection:"reports",itemType:"report",itemsType:"reports",api:"get",filterFields:t,tableFields:n,projectFields:i,actions:a,refreshString:e,defaultSort:o})}}]),t}(a.Component);Cd.defaultProps={};var _d=Object(s.f)(Object(l.connect)()(Cd)),Od=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeTitle=function(e){var t=e.target.value;n.props.onChangeKey(t)},n.onChangeEntity=function(e){n.props.onChangeEntity(e)},n.getEntityOptions=function(){return n.props.entities.map(function(e){return g.c.Map({value:e,label:Object(x.titleCase)(Y(["systemItems",e,"itemName"],e))})}).map(oe).toArray()},n.onChangeTypeGrouped=function(){n.props.onChangeType(Zp.GROPPED)},n.onChangeTypeSimple=function(){n.props.onChangeType(Zp.SIMPLE)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.title,a=t.entity,r=t.mode,i=t.type;return n!==e.title||a!==e.entity||r!==e.mode||i!==e.type}},{key:"render",value:function(){var e=this.props,t=e.title,n=e.entity,a=e.type,i="view"===e.mode,o=this.getEntityOptions(),l=a===Zp.GROPPED;return r.a.createElement("div",null,r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Name"),r.a.createElement(f.g,{sm:7},r.a.createElement(en,{onChange:this.onChangeTitle,value:t,disabled:i})))),r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Entity"),r.a.createElement(f.g,{sm:7},r.a.createElement(en,{fieldType:"select",options:o,value:n,onChange:this.onChangeEntity,disabled:i})))),r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Report Type"),r.a.createElement(f.g,{sm:3,key:"pricing-method-1"},r.a.createElement("div",{className:"inline"},r.a.createElement(en,{fieldType:"radio",name:"report-method",id:"report-method-simple",value:"simple",checked:!l,onChange:this.onChangeTypeSimple,label:G("report_type_".concat(Zp.SIMPLE),"report")})),"\xa0",r.a.createElement(Ii,{contents:Fi.method_simple})),r.a.createElement(f.g,{sm:3,key:"pricing-method-2"},r.a.createElement("div",{className:"inline"},r.a.createElement(en,{fieldType:"radio",name:"report-method",id:"report-method-grouped",value:"grouped",checked:l,onChange:this.onChangeTypeGrouped,label:G("report_type_".concat(Zp.GROPPED),"report")})),"\xa0",r.a.createElement(Ii,{contents:Fi.method_grouped})))))}}]),t}(a.Component);Od.defaultProps={title:"",entity:"",entities:g.c.List(),type:0,mode:"update",onChangeKey:function(){},onChangeEntity:function(){},onChangeType:function(){}};var Sd=Od,Td=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Map(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.c.Map();return e?e.filter(function(e){return!n.get("currentEntity",g.c.List()).includes(e.get("id",""))}).withMutations(function(e){t.forEach(function(t,a){var r=Object(x.sentenceCase)(Y(["systemItems",a,"itemName"],a));t.isEmpty()||t.forEach(function(t){if(!n.get(a,g.c.List()).includes(t.get("id",""))){var i="$".concat(a,".").concat(t.get("id","")),o="".concat(r,": ").concat(t.get("title",t.get("id",""))),l=t.withMutations(function(e){return e.set("id",i).set("title",o).set("entity",a)});e.push(l)}})})}):g.c.List()},kd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a="queue"===t?e:function(e){if(e)return e.map(function(e){return g.c.Map({id:e.get("field_name",""),title:e.get("title",""),type:e.get("type","string"),aggregatable:!0,searchable:e.get("searchable",!0),inputConfig:e.get("inputConfig",null)})})}(e),r=g.c.Map({searchable:!0,aggregatable:!0});return g.c.List().withMutations(function(e){a.forEach(function(t){e.push(t)}),function(e){return Y(["reports","fields",e],g.c.List())}(t).forEach(function(t){var n=e.findIndex(function(e){return e.get("id","")===t.get("id","")});-1===n?e.push(r.merge(t)):e.update(n,g.c.Map(),function(e){return e.merge(t)})}),e.forEach(function(n,a){if(!n.has("title")){var r=G(n.get("id",""),K(t)),i=r===n.get("id","")?Object(x.sentenceCase)(r):r;e.setIn([a,"title"],i)}})}).filter(function(e){return"play"!==e.get("id")||"play"===e.get("id")&&n}).sort(Me)},Id=Object(on.a)(En,Kn,Jn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.List(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.c.List();return g.c.List().withMutations(function(a){e.forEach(function(e){a.push(g.c.Map({field_name:"uf.".concat(e),title:"".concat(G(e,"lines",Object(x.sentenceCase)(e))," (User field)")}))}),n.forEach(function(e){var t=G(e,"lines",Object(x.sentenceCase)(e)),n=G("charge\u200e","lines",Object(x.sentenceCase)("charge\u200e")),r=G("product_key","lines",Object(x.sentenceCase)("product_key")),i="rates.tariff_category.".concat(e);a.push(g.c.Map({field_name:"".concat(i,".pricing.charge"),title:"".concat(t," ").concat(n),type:"number"})),a.push(g.c.Map({field_name:"".concat(i,".key"),title:"".concat(t," ").concat(r),inputConfig:g.c.Map({inputType:"select",callback:"getProductsOptions",callbackArgument:g.c.Map({tariff_category:e})})}))}),t.forEach(function(e){a.push(e)})})}),Nd=Object(on.a)(Gn,function(){return"subscribers"},jn,kd),wd=Object(on.a)(qn,function(){return"account"},function(){return!0},kd),jd=Object(on.a)(function(){return g.c.List()},function(){return"logFile"},function(){return!0},kd),Rd=Object(on.a)(function(){return g.c.List()},function(){return"event"},function(){return!0},kd),xd=Object(on.a)(Id,function(){return"usage"},function(){return!0},kd),Fd=Object(on.a)(xd,function(){return"queue"},function(){return!0},kd),Pd=Object(on.a)(function(){return g.c.List()},function(){return"bills"},function(){return!0},kd),Md=Object(on.a)(function(){return Y(["reports","entities"],g.c.List())},function(e){return e}),Ad=Object(on.a)(Nd,wd,xd,jd,Fd,Rd,Pd,function(e,t,n,a,r,i,o){var l=g.c.Map({subscription:g.c.List(["sid","aid"]),customer:g.c.List(["aid"]),currentEntity:g.c.List(["firstname","lastname"])}),s=Td(n,g.c.Map({subscription:e,customer:t}),l),c=g.c.Map({customer:g.c.List(["aid","type"]),usage:g.c.List(["firstname","lastname","sid","aid","plan"]),currentEntity:g.c.List([])}),u=Td(e,g.c.Map({customer:t,usage:n}),c),p=t,d=a,m=r,f=i,h=o;return g.c.Map({usage:s,subscription:u,customer:p,logFile:d,queue:m,event:f,bills:h})}),Dd=Object(on.a)(function(e,t){switch(t.config.getIn(["inputConfig","callback"])){case"getCyclesOptions":return Ea(e,t);case"getProductsOptions":var n=t.config.getIn(["inputConfig","callbackArgument"],g.c.Map());if(!n.isEmpty()){var a=xe(n);return Oa(e,t,a)}return _a(e,t);case"getPlansOptions":return ka(e,t);case"getServicesOptions":return Sa(e,t);case"getGroupsOptions":return Na(e,t);case"getUsageTypesOptions":return Dn(e,t);case"getBucketsOptions":return wa(e,t);case"getBucketsExternalIdsOptions":return ja(e,t);case"getFileTypeOptions":return An(e,t);case"getPlayTypeOptions":return Ia(e,t);case"getCalcNameOptions":return Ma(e,t);case"getEventCodeOptions":return Ln(e,t);case"getTaxesOptions":return Ta(e,t);default:return}},function(e){return e}),Ld=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).initFieldOptions=function(e,t){if(e.hasIn(["inputConfig","callback"])&&t.isEmpty())switch(e.getIn(["inputConfig","callback"])){case"getCyclesOptions":n.props.dispatch(ud());break;case"getPlansOptions":n.props.dispatch(pd());break;case"getProductsOptions":n.props.dispatch(md(e.getIn(["inputConfig","callbackArgument"],g.c.Map())));break;case"getServicesOptions":n.props.dispatch(dd());break;case"getGroupsOptions":n.props.dispatch(Ed());break;case"getUsageTypesOptions":n.props.dispatch(gd());break;case"getBucketsOptions":case"getBucketsExternalIdsOptions":n.props.dispatch(fd());break;case"getFileTypeOptions":n.props.dispatch(hd());break;case"getPlayTypeOptions":n.props.dispatch(yd());break;case"getEventCodeOptions":n.props.dispatch(vd());break;case"getTaxesOptions":n.props.dispatch(bd());break;default:console.log("unsuported select options callback")}},n.onChangeText=function(e){var t=e.target.value;n.props.onChange(t)},n.onChangeSelect=function(e){n.props.onChange(e)},n.onChangeBoolean=function(e){var t=""===e?"":[1,"1","true",!0,"yes","on"].includes(e);n.props.onChange(t)},n.onChangeNumber=function(e){var t=e.target.value,a=Number(t);isNaN(a)?n.props.onChange(t):n.props.onChange(a)},n.onChangeMultiValues=function(e){Array.isArray(e)?n.props.onChange(e.join(",")):n.props.onChange("")},n.onChangeDate=function(e){if(S.a.isMoment(e)&&e.isValid()){var t=Y("apiDateTimeFormat","YYYY-MM-DD");n.props.onChange(e.format(t))}else n.props.onChange(null)},n.onChangeDateTime=function(e){if(S.a.isMoment(e)&&e.isValid()){var t=Y("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");n.props.onChange(e.format(t))}else n.props.onChange(null)},n.getOptionsValues=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return n.props.operator.get("options",e).map(oe).toArray()},n.formatValueTagDateTime=function(e){return S()(e).format(Y("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"))},n.formatValueTagDate=function(e){return S()(e).format(Y("dateFormat","DD/MM/YYYY"))},n.renderCustomInputDate=function(e){var t=e.addTag,n=e.disabled,a=Y("apiDateTimeFormat","YYYY-MM-DD");return r.a.createElement("span",{className:"custom-field-input"},r.a.createElement(en,{fieldType:"date",value:null,onChange:function(e){t(e.format(a))},disabled:n}))},n.renderCustomInputDateTime=function(e){var t=e.addTag,n=e.disabled,a=Y("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");return r.a.createElement("span",{className:"custom-field-input"},r.a.createElement(en,{fieldType:"datetime",value:null,onChange:function(e){t(e.format(a))},disabled:n}))},n.renderCustomInputNumber=function(e){e.addTag;var t=e.onChange,n=e.value,a=Object(pt.a)(e,["addTag","onChange","value"]);return r.a.createElement("input",Object.assign({type:"number",onChange:t,value:n},a))},n.renderInputBoolean=function(){var e=n.props,t=e.field,a=e.disabled,i="";!0===t.get("value",!1)?i="yes":!1===t.get("value",!0)&&(i="no");var o=n.getOptionsValues(g.c.List(["yes","no"]));return r.a.createElement(en,{fieldType:"select",clearable:!1,options:o,value:i,onChange:n.onChangeBoolean,disabled:a})},n.renderInputSelect=function(){var e=n.props,t=e.field,a=e.disabled,i=e.config,o=e.selectOptions,l=e.operator,s=g.c.List().withMutations(function(e){i.hasIn(["inputConfig","callback"])&&o.forEach(function(t){e.push(t)}),i.hasIn(["inputConfig","options"])&&i.getIn(["inputConfig","options"],g.c.List()).forEach(function(t){e.push(t)}),l.has("options")&&l.get("options",g.c.List()).forEach(function(t){e.push(t)})}).map(oe).toArray(),c=["nin","in"].includes(t.get("op",""));return r.a.createElement(en,{fieldType:"select",clearable:!1,multi:c,options:s,value:t.get("value",""),onChange:n.onChangeSelect,disabled:a})},n.renderInputNumber=function(){var e=n.props,t=e.field,a=e.disabled;if(["nin","in"].includes(t.get("op",""))){var i=t.get("value","").split(",").filter(function(e){return""!==e});return r.a.createElement(en,{fieldType:"tags",value:i,onChange:n.onChangeMultiValues,disabled:a,renderInput:n.renderCustomInputNumber})}return r.a.createElement(en,{fieldType:"number",value:t.get("value",""),onChange:n.onChangeNumber,disabled:a})},n.renderInputDate=function(){var e=n.props,t=e.field,a=e.disabled;if(["nin","in"].includes(t.get("op",""))){var i=t.get("value","").split(",").filter(function(e){return""!==e});return r.a.createElement(en,{fieldType:"tags",value:i,onChange:n.onChangeMultiValues,disabled:a,renderInput:n.renderCustomInputDate,getTagDisplayValue:n.formatValueTagDate})}var o=S()(t.get("value",null));return r.a.createElement(en,{fieldType:"date",value:o,onChange:n.onChangeDateTime,disabled:a})},n.renderInputDateTime=function(){var e=n.props,t=e.field,a=e.disabled;if(["nin","in"].includes(t.get("op",""))){var i=t.get("value","").split(",").filter(function(e){return""!==e});return r.a.createElement(en,{fieldType:"tags",value:i,onChange:n.onChangeMultiValues,disabled:a,renderInput:n.renderCustomInputDateTime,getTagDisplayValue:n.formatValueTagDateTime})}var o=S()(t.get("value",null)).utc();return r.a.createElement(en,{fieldType:"datetime",value:o,onChange:n.onChangeDateTime,disabled:a})},n.renderInputString=function(){var e=n.props,t=e.field,a=e.disabled;if(["nin","in"].includes(t.get("op",""))){var i=t.get("value","").split(",").filter(function(e){return""!==e});return r.a.createElement(en,{fieldType:"tags",value:i,onChange:n.onChangeMultiValues,disabled:a})}return r.a.createElement(en,{value:t.get("value",""),onChange:n.onChangeText,disabled:a})},n.renderInput=function(){var e=n.props,t=e.field,a=e.config,r=e.operator;return[a.get("type",""),r.get("type","")].includes("boolean")?n.renderInputBoolean():[a.get("type","string"),r.get("type","")].includes("string")&&("select"===a.getIn(["inputConfig","inputType"])||r.has("options"))&&["eq","ne","nin","in"].includes(t.get("op",""))?n.renderInputSelect():[a.get("type",""),r.get("type","")].includes("number")?n.renderInputNumber():[a.get("type",""),r.get("type","")].includes("date")?n.renderInputDate():[a.get("type",""),r.get("type","")].includes("datetime")?n.renderInputDateTime():n.renderInputString()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.config,n=e.selectOptions;this.initFieldOptions(t,n)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.config;g.c.is(t,e.config)||this.initFieldOptions(e.config,e.selectOptions)}},{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.field,a=t.config,r=t.operator,i=t.selectOptions,o=t.disabled;return!g.c.is(n,e.field)||!g.c.is(a,e.config)||!g.c.is(i,e.selectOptions)||!g.c.is(r,e.operator)||o!==e.disabled}},{key:"render",value:function(){var e=this.props.operator,t=this.renderInput();return e.has("prefix")?r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,e.get("prefix","")),t):e.has("suffix")?r.a.createElement(f.o,null,t,r.a.createElement(f.o.Addon,null,e.get("suffix",""))):t}}]),t}(a.Component);Ld.defaultProps={field:g.c.Map(),config:g.c.Map(),operator:g.c.Map(),selectOptions:g.c.List(),disabled:!1,onChange:function(){}};var Ud=Object(l.connect)(function(e,t){return{selectOptions:Dd(e,t)}})(Ld),Vd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeField=function(e){var t=n.props.index;n.props.onChangeField(t,e)},n.onChangeOperator=function(e){var t=n.props.index;n.props.onChangeOperator(t,e)},n.onChangeValue=function(e){var t=n.props.index;n.props.onChangeValue(t,e)},n.onRemove=function(e){var t=n.props.index;n.props.onRemove(t,e)},n.getConfig=function(){var e=n.props,t=e.item;return e.fieldsConfig.find(function(e){return e.get("id","")===t.get("field","")},null,g.c.Map())},n.getOperator=function(){var e=n.props,t=e.item;return e.operators.find(function(e){return e.get("id","")===t.get("op","")},null,g.c.Map())},n.getFieldOptions=function(){return n.props.fieldsConfig.filter(function(e){return e.get("filter",!0)}).map(le).toArray()},n.isInBlackList=function(e,t){var n=e.get("exclude",g.c.List()),a="fieldid:".concat(t.get("id","")),r=t.get("type","string");return n.includes(a)||n.includes(r)},n.isInWhiteList=function(e,t){var n=e.get("include",g.c.List()),a="fieldid:".concat(t.get("id","")),r=t.get("type","string");return n.includes(r)||n.includes(a)},n.getOpOptions=function(){var e=n.props.operators,t=n.getConfig();return e.filter(function(e){return!n.isInBlackList(e,t)&&n.isInWhiteList(e,t)}).map(le).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.item,a=t.index,r=t.disabled,i=t.fieldsConfig,o=t.operators;return!g.c.is(n,e.item)||!g.c.is(i,e.fieldsConfig)||!g.c.is(o,e.operators)||a!==e.index||r!==e.disabled}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,a=n.item,r=n.index,i=this.getOpOptions()||[];1===i.length&&""===a.get("op","")&&this.props.onChangeOperator(r,i[0].value)}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.disabled,a=this.getConfig(),i=this.getOperator(),o=this.getFieldOptions(),l=this.getOpOptions(),s=n||""===t.get("field",""),c=n||""===t.get("op","")||s;return r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:4,className:"pl0"},r.a.createElement(en,{fieldType:"select",clearable:!1,options:o,value:t.get("field",""),onChange:this.onChangeField,disabled:n})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"operator_field"},"Operator")),r.a.createElement(f.g,{sm:3},r.a.createElement(en,{fieldType:"select",clearable:!1,options:l,value:t.get("op",""),onChange:this.onChangeOperator,disabled:s})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"value_field"},"Value")),r.a.createElement(f.g,{sm:4},r.a.createElement(Ud,{field:t,config:a,operator:i,disabled:c,onChange:this.onChangeValue})),r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(f.c,{onClick:this.onRemove,bsSize:"small",className:"pull-left",disabled:n},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))}}]),t}(a.Component);Vd.defaultProps={item:g.c.Map(),index:0,disabled:!1,fieldsConfig:g.c.List(),operators:g.c.List(),onChangeField:function(){},onChangeOperator:function(){},onChangeValue:function(){},onRemove:function(){}};var Bd=Vd,qd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).renderRow=function(e,t){var a=n.props,i=a.mode,o=a.operators,l=a.fieldsOptions,s="view"===i;return r.a.createElement(Bd,{key:t,item:e,index:t,fieldsConfig:l,operators:o,disabled:s,onChangeField:n.props.onChangeField,onChangeOperator:n.props.onChangeOperator,onChangeValue:n.props.onChangeValue,onRemove:n.props.onRemove})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.conditions,a=t.fieldsOptions,r=t.mode,i=t.operators;return!g.c.is(n,e.conditions)||!g.c.is(a,e.fieldsOptions)||!g.c.is(i,e.operators)||r!==e.mode}},{key:"render",value:function(){var e=this.props,t=e.conditions,n=e.mode,a=e.fieldsOptions,i=t.map(this.renderRow),o=a.isEmpty(),l=o?Fi.add_conditions_disabled_no_entity:"";return r.a.createElement("div",{className:"report-editor-conditions"},r.a.createElement(f.g,{sm:12},i.isEmpty()?r.a.createElement(f.n,null,Fi.block_conditions):r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"operator_field"},"Operator")),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"value_field"},"Value")))),r.a.createElement(f.g,{sm:12},i),"view"!==n&&r.a.createElement(f.g,{sm:12,className:"pl0 pr0"},r.a.createElement(Je,{onClick:this.props.onAdd,label:"Add Condition",disabled:o,title:l})))}}]),t}(a.Component);qd.defaultProps={conditions:g.c.List(),fieldsOptions:g.c.List(),operators:g.c.List(),mode:"update",onChangeField:function(){},onChangeOperator:function(){},onChangeValue:function(){},onAdd:function(){},onRemove:function(){}};var zd=qd,Hd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeLabel=function(e){var t=e.target.value,a=n.props.idx;n.props.onChangeLabel(a,t)},n.onChangeField=function(e){var t=n.props.idx;n.props.onChangeField(t,e)},n.onChangeOperator=function(e){var t=n.props.idx;n.props.onChangeOperator(t,e)},n.onRemove=function(){var e=n.props.idx;n.props.onRemove(e)},n.getConfig=function(){var e=n.props,t=e.item;return e.fieldsConfig.find(function(e){return e.get("id","")===t.get("field_name","")},null,g.c.Map())},n.isInBlackList=function(e,t){var n=e.get("exclude",g.c.List()),a="fieldid:".concat(t.get("id","")),r=t.get("type","string");return n.includes(a)||n.includes(r)},n.isInWhiteList=function(e,t){var n=e.get("include",g.c.List()),a="fieldid:".concat(t.get("id","")),r=t.get("type","string");return n.includes(r)||n.includes(a)},n.getoperators=function(){var e=n.props.operators,t=n.getConfig();return e.filter(function(e){return!n.isInBlackList(e,t)&&n.isInWhiteList(e,t)}).map(le).toArray()},n.getfieldsConfig=function(){return n.props.fieldsConfig.filter(function(e){return e.get("columnable",!0)}).map(le).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.item,a=t.idx,r=t.disabled,i=t.fieldsConfig,o=t.operators,l=t.type;return!g.c.is(n,e.item)||!g.c.is(i,e.fieldsConfig)||!g.c.is(o,e.operators)||a!==e.idx||r!==e.disabled||l!==e.type}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.disabled,a=e.type,i=e.isCountColumn,o=this.getfieldsConfig(),l=this.getoperators(),s=n||i,c=n||""===t.get("field_name",""),u=n||""===t.get("field_name","");return r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:1,className:"text-center"},r.a.createElement(rt,null)),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:4},!i&&r.a.createElement(en,{fieldType:"select",clearable:!1,options:o,value:t.get("field_name",""),onChange:this.onChangeField,disabled:s,allowCreate:!0})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},a!==Zp.SIMPLE&&r.a.createElement("label",{htmlFor:"operator_field"},"Function")),r.a.createElement(f.g,{sm:3},a!==Zp.SIMPLE&&r.a.createElement(en,{fieldType:"select",clearable:!1,options:l,value:t.get("op",""),onChange:this.onChangeOperator,disabled:c})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"label_field"},"Label")),r.a.createElement(f.g,{sm:3},r.a.createElement(en,{value:t.get("label",""),onChange:this.onChangeLabel,disabled:u})),r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(f.c,{onClick:this.onRemove,bsSize:"small",className:"pull-left",disabled:n},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))}}]),t}(a.Component);Hd.defaultProps={item:g.c.Map(),idx:0,disabled:!1,isCountColumn:!1,type:Zp.SIMPLE,fieldsConfig:g.c.List(),operators:g.c.List(),onChangeField:function(){},onChangeOperator:function(){},onChangeLabel:function(){},onRemove:function(){}};var Yd=Object(et.SortableElement)(Hd),Gd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onMoveEnd=function(e){var t=e.oldIndex,a=e.newIndex;n.props.onMove(t,a)},n.getFieldsOptions=function(e){return e.filter(function(e){return e.get("aggregatable",!0)})},n.getColumnFieldsOptions=function(){var e=n.getCountColumnKey();return g.c.Map({aggregatable:!0,searchable:!0,id:e,title:G(e,"report")})},n.isCountColumn=function(e){return e.get("key","")===n.getCountColumnKey()},n.getCountColumnKey=function(){return"count_group"},n.isCountColumnExist=function(e){return e.findIndex(function(e){return e.get("key","")===n.getCountColumnKey()})>-1},n.onAddCount=function(){var e=n.getCountColumnKey(),t=g.c.Map({key:e,field_name:e,label:G(e,"report"),op:"count"});n.props.onAdd(t)},n.onAdd=function(e){n.props.onAdd()},n.renderRows=function(){var e=n.props,t=e.mode,a=e.columns,i=e.fieldsConfig,o=e.aggregateOperators,l=e.type,s="view"===t,c=n.getFieldsOptions(i);return a.map(function(e,t){var a=n.isCountColumn(e),i=a?c.push(n.getColumnFieldsOptions()):c;return r.a.createElement(Yd,{key:e.get("key",t),item:e,idx:t,index:t,disabled:s,type:l,isCountColumn:a,fieldsConfig:i,operators:o,onChangeField:n.props.onChangeField,onChangeOperator:n.props.onChangeOperator,onChangeLabel:n.props.onChangeLabel,onRemove:n.props.onRemove})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.mode,a=t.columns,r=t.fieldsConfig,i=t.aggregateOperators,o=t.type;return!g.c.is(a,e.columns)||!g.c.is(r,e.fieldsConfig)||!g.c.is(i,e.aggregateOperators)||n!==e.mode||o!==e.type}},{key:"render",value:function(){var e=this.props,t=e.mode,n=e.type,a=e.fieldsConfig,i=e.columns,o=this.renderRows(),l=a.isEmpty(),s=n===Zp.GROPPED?Fi.block_columns_grouped:Fi.block_columns_simple,c=l?Fi.add_columns_disabled_no_entity:"";return r.a.createElement(f.x,null,r.a.createElement(f.g,{sm:12},o.isEmpty()?r.a.createElement(f.n,null,s):r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:1,xsHidden:!0},"\xa0"),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"operator_field"},n!==Zp.SIMPLE&&"Function")),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"value_field"},"Label")))),r.a.createElement(f.g,{sm:12},r.a.createElement(nt,{lockAxis:"y",helperClass:"draggable-row",useDragHandle:!0,items:o.toArray(),onSortEnd:this.onMoveEnd})),"view"!==t&&r.a.createElement(f.g,{sm:12},r.a.createElement(Je,{onClick:this.onAdd,label:"Add Column",disabled:l,title:c}),n!==Zp.SIMPLE&&r.a.createElement("span",{style:{marginLeft:10}},r.a.createElement(Je,{onClick:this.onAddCount,label:"Add Count Column",disabled:this.isCountColumnExist(i),title:"Add Column to gount grpup fields"}))))}}]),t}(a.Component);Gd.defaultProps={columns:g.c.List(),fieldsConfig:g.c.List(),aggregateOperators:g.c.List(),mode:"update",type:0,onChangeField:function(){},onChangeOperator:function(){},onChangeLabel:function(){},onAdd:function(){},onRemove:function(){},onMove:function(){},onAddCount:function(){}};var Kd=Gd,Wd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onRemove=function(e){var t=n.props.idx;n.props.onRemove(t,e)},n.onChangeField=function(e){var t=n.props.idx;n.props.onChangeField(t,e)},n.onChangeOperator=function(e){var t=n.props.idx;n.props.onChangeOperator(t,e)},n.getFieldOptions=function(){return n.props.options.map(oe).toArray()},n.getOpOptions=function(){return n.props.sortOperators.map(oe).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.item,a=t.idx,r=t.disabled,i=t.options,o=t.sortOperators;return!g.c.is(n,e.item)||!g.c.is(i,e.options)||!g.c.is(o,e.sortOperators)||a!==e.idx||r!==e.disabled}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.disabled,a=this.getFieldOptions(),i=this.getOpOptions(),o=n||""===t.get("field","");return r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:1,className:"text-center"},r.a.createElement(rt,null)),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",clearable:!1,options:a,value:t.get("field",""),onChange:this.onChangeField,disabled:n})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"order_field"},"Order")),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",clearable:!1,options:i,value:t.get("op",""),onChange:this.onChangeOperator,disabled:o})),r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(f.c,{onClick:this.onRemove,bsSize:"small",className:"pull-left",disabled:n},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))}}]),t}(a.Component);Wd.defaultProps={item:g.c.Map(),idx:0,disabled:!1,options:g.c.List(),sortOperators:g.c.List(),onChangeField:function(){},onChangeOperator:function(){},onRemove:function(){}};var Jd=Object(et.SortableElement)(Wd),Qd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).getUsedOptions=function(){return n.props.sorts.filter(function(e){return""!==e.get("field","")}).map(function(e){return e.get("field","")})},n.renderSortRow=function(e,t){var a=n.props,i=a.options,o=a.mode,l=a.sortOperators,s="view"===o,c=n.getUsedOptions(),u=i.filter(function(t){return!c.includes(t.get("key",""))||e.get("field","")===t.get("key","")}).map(function(e){return g.c.Map({value:e.get("key",""),label:e.get("label","")})});return r.a.createElement(Jd,{key:t,item:e,index:t,idx:t,disabled:s,options:u,sortOperators:l,onChangeField:n.props.onChangeField,onChangeOperator:n.props.onChangeOperator,onRemove:n.props.onRemove})},n.onMoveEnd=function(e){var t=e.oldIndex,a=e.newIndex;n.props.onMove(t,a)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.sorts,a=t.options,r=t.mode,i=t.sortOperators;return!g.c.is(n,e.sorts)||!g.c.is(a,e.options)||!g.c.is(i,e.sortOperators)||r!==e.mode}},{key:"render",value:function(){var e=this.props,t=e.sorts,n=e.options,a=e.mode,i="view"===a||n.isEmpty(),o=i&&n.isEmpty()?Fi.add_sort_disabled_no_fields:"",l=t.map(this.renderSortRow);return r.a.createElement(f.x,null,r.a.createElement(f.g,{sm:12},l.isEmpty()?r.a.createElement(f.n,null,Fi.block_sort):r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:1,xsHidden:!0},"\xa0"),r.a.createElement(f.g,{sm:5,xsHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:5,xsHidden:!0},r.a.createElement("label",{htmlFor:"order_field"},"Order")))),r.a.createElement(f.g,{sm:12},r.a.createElement(nt,{lockAxis:"y",helperClass:"draggable-row",useDragHandle:!0,items:l.toArray(),onSortEnd:this.onMoveEnd})),"view"!==a&&r.a.createElement(f.g,{sm:12},r.a.createElement(Je,{onClick:this.props.onAdd,label:"Add Sort",disabled:i,title:o})))}}]),t}(a.Component);Qd.defaultProps={sorts:g.c.List(),options:g.c.List(),sortOperators:g.c.List(),mode:"update",onChangeField:function(){},onChangeOperator:function(){},onMove:function(){},onRemove:function(){},onAdd:function(){}};var $d=Qd,Zd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeText=function(e){var t=e.target.value;n.props.onChange(t)},n.onChangeSelect=function(e){n.props.onChange(e)},n.onSelectOptionType=function(e){n.props.onChangeValueType(e)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.field;if(e.config.has("options","")&&""===t.get("value","")){var n=e.config.get("options",g.c.List()).map(oe).first().value||"";this.props.onChange(n)}}},{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.field,a=t.config,r=t.disabled;return!g.c.is(n,e.field)||!g.c.is(a,e.config)||r!==e.disabled}},{key:"render",value:function(){var e=this,t=this.props,n=t.field,a=t.disabled,i=t.config,o=a||i.isEmpty();if(i.has("valueTypes")){var l=i.get("valueTypes",g.c.List()).find(function(e){return e.get("value","")===n.get("type","")},null,g.c.Map({})).get("label","Select unit..."),s=i.get("valueTypes",g.c.List()).map(function(t){return r.a.createElement(f.q,{eventKey:t.get("value","-"),key:t.get("value","-"),onSelect:e.onSelectOptionType},t.get("label","-"))}).toArray();return r.a.createElement(f.o,null,r.a.createElement(en,{fieldType:i.get("type","text"),value:n.get("value",""),onChange:this.onChangeText,disabled:o}),r.a.createElement(f.i,{id:"balance-period-unit",componentClass:f.o.Button,title:l,disabled:o},s))}if(i.has("options")){if(!1===i.get("options",""))return null;var c=i.get("options",g.c.List()).map(oe).toArray();return r.a.createElement(en,{fieldType:"select",clearable:!1,options:c,value:n.get("value",""),onChange:this.onChangeSelect,disabled:o,allowCreate:i.get("addOption",!1)})}return r.a.createElement(en,{value:n.get("value",""),onChange:this.onChangeText,disabled:o})}}]),t}(a.Component);Zd.defaultProps={field:g.c.Map(),config:g.c.Map(),disabled:!1,onChange:function(){},onChangeValueType:function(){}};var Xd=Zd,em=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onRemove=function(e){var t=n.props.idx;n.props.onRemove(t,e)},n.onChangeField=function(e){var t=n.props.idx;n.props.onChangeField(t,e)},n.onChangeOperator=function(e){var t=n.props.idx;n.props.onChangeOperator(t,e)},n.onChangeValue=function(e){var t=n.props.idx;n.props.onChangeValue(t,e)},n.onChangeValueType=function(e){var t=n.props.idx;n.props.onChangeValueType(t,e)},n.getFieldOptions=function(){return n.props.options.map(function(e){return{value:e.get("key",""),label:e.get("label","")}}).toArray()},n.getOpOptions=function(){return n.props.operators.map(le).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.item,a=t.idx,r=t.disabled,i=t.options,o=t.operators;return!g.c.is(n,e.item)||!g.c.is(i,e.options)||!g.c.is(o,e.operators)||a!==e.idx||r!==e.disabled}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.disabled,a=e.operators,i=this.getFieldOptions(),o=this.getOpOptions(),l=n||""===t.get("field",""),s=a.find(function(e){return e.get("id","")===t.get("op","")});return r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:1,className:"text-center"},r.a.createElement(rt,null)),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{fieldType:"select",clearable:!1,options:i,value:t.get("field",""),onChange:this.onChangeField,disabled:n})),r.a.createElement(f.g,{sm:3},r.a.createElement(en,{fieldType:"select",clearable:!1,options:o,value:t.get("op",""),onChange:this.onChangeOperator,disabled:l})),r.a.createElement(f.g,{sm:3},r.a.createElement(Xd,{onChange:this.onChangeValue,onChangeValueType:this.onChangeValueType,field:t,config:s})),r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(f.c,{onClick:this.onRemove,bsSize:"small",className:"pull-left",disabled:n},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))}}]),t}(a.Component);em.defaultProps={item:g.c.Map(),idx:0,disabled:!1,options:g.c.List(),operators:g.c.List(),onChangeField:function(){},onChangeOperator:function(){},onChangeValue:function(){},onChangeValueType:function(){},onRemove:function(){}};var tm=Object(et.SortableElement)(em),nm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).getUsedOptions=function(){return n.props.formats},n.renderformaterRow=function(e,t){var a=n.props,i=a.options,o=a.mode,l=a.formatOperators,s="view"===o,c=n.getUsedOptions(),u=i.filter(function(t){return!c.includes(t.get("key",""))||e.get("field","")===t.get("key","")});return r.a.createElement(tm,{key:t,item:e,index:t,idx:t,disabled:s,options:u,operators:l,onChangeField:n.props.onChangeField,onChangeOperator:n.props.onChangeOperator,onChangeValue:n.props.onChangeValue,onChangeValueType:n.props.onChangeValueType,onRemove:n.props.onRemove})},n.onMoveEnd=function(e){var t=e.oldIndex,a=e.newIndex;n.props.onMove(t,a)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.formats,a=t.options,r=t.mode,i=t.formatOperators;return!g.c.is(n,e.formats)||!g.c.is(a,e.options)||!g.c.is(i,e.formatOperators)||r!==e.mode}},{key:"render",value:function(){var e=this.props,t=e.formats,n=e.options,a=e.mode,i="view"===a||n.isEmpty(),o=i&&n.isEmpty()?Fi.add_formatter_disabled_no_fields:"",l=t.map(this.renderformaterRow),s=t.findIndex(function(e){return"date_override"===e.get("op","")})>-1;return r.a.createElement(f.x,null,r.a.createElement(f.g,{sm:12},l.isEmpty()?r.a.createElement(f.n,null,Fi.block_formatter):r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:1},"\xa0"),r.a.createElement(f.g,{sm:4},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:3},r.a.createElement("label",{htmlFor:"operator_field"},"Type / Operator")),r.a.createElement(f.g,{sm:3},r.a.createElement("label",{htmlFor:"value_field"},"Format / Value")))),r.a.createElement(f.g,{sm:12},r.a.createElement(nt,{lockAxis:"y",helperClass:"draggable-row",useDragHandle:!0,items:l.toArray(),onSortEnd:this.onMoveEnd})),"view"!==a&&r.a.createElement(f.g,{sm:12},r.a.createElement(Je,{onClick:this.props.onAdd,label:"Add Formatting Style",disabled:i,title:o})),s&&r.a.createElement(f.g,{sm:12},r.a.createElement(f.p,{bsStyle:"warning"},"* Subtract / Add time styling should be applied before other format")))}}]),t}(a.Component);nm.defaultProps={formats:g.c.List(),options:g.c.List(),formatOperators:g.c.List(),mode:"update",onChangeField:function(){},onChangeOperator:function(){},onChangeValue:function(){},onChangeValueType:function(){},onMove:function(){},onRemove:function(){},onAdd:function(){}};var am=nm,rm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onPreview=function(){n.props.onFilter()},n.updateReport=function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];n.props.onUpdate(e,t,a)},n.onChangeReportEntity=function(e){n.updateReport("entity",e),n.updateReport("conditions",g.c.List()),n.updateReport("columns",g.c.List()),n.updateReport("sorts",g.c.List())},n.onChangeReportType=function(e){n.updateReport("type",e),n.updateColumnsByReportType(e),n.updateSortByReportType(e)},n.onChangeReportKey=function(e){n.updateReport("key",e)},n.onChangeConditionField=function(e,t){var a=n.props.report,r=n.getEntityFields().find(function(e){return e.get("id","")===t},null,g.c.Map()),i=g.c.Map({field:t,op:"",value:"",type:r.get("type","string"),entity:r.get("entity",a.get("entity",""))}),o=a.get("conditions",g.c.List()).set(e,i);n.updateReport("conditions",o)},n.onChangeConditionOperator=function(e,t){var a=n.props,r=a.report,i=a.conditionsOperators,o=r.getIn(["conditions",e,"op"],""),l=i.find(function(e){return e.get("id","")===o},null,g.c.Map()),s=i.find(function(e){return e.get("id","")===t},null,g.c.Map()),c=r.get("conditions",g.c.List()).update(e,g.c.Map(),function(e){return l.get("type","")===s.get("type","")&&g.c.is(l.get("options",g.c.List()),s.get("options",g.c.List()))?e.set("op",t):e.set("op",t).set("value","")});n.updateReport("conditions",c)},n.onChangeConditionValue=function(e,t){var a=n.props.report.get("conditions",g.c.List()).setIn([e,"value"],t);n.updateReport("conditions",a)},n.onRemoveCondition=function(e){var t=n.props.report.get("conditions",g.c.List()).delete(e);n.updateReport("conditions",t)},n.onAddCondition=function(){var e=n.props.report.get("conditions",g.c.List()).push(g.c.Map({field:"",op:"",value:""}));n.updateReport("conditions",e)},n.onChangeSortOperator=function(e,t){var a=n.props.report.get("sorts",g.c.List()).setIn([e,"op"],t);n.updateReport("sorts",a)},n.onChangeSortField=function(e,t){var a=n.props.report.get("sorts",g.c.List()).setIn([e,"field"],t).setIn([e,"op"],"");n.updateReport("sorts",a)},n.onMoveSort=function(e,t){var a=n.props.report,r=a.getIn(["sorts",e]),i=a.get("sorts",g.c.List()).delete(e).insert(t,r);n.updateReport("sorts",i)},n.onRemoveSort=function(e){var t=n.props.report.get("sorts",g.c.List()).delete(e);n.updateReport("sorts",t)},n.onRemoveSortByKey=function(e){var t=n.props.report.get("sorts",g.c.List()),a=t.findIndex(function(t){return t.get("field","")===e});a>-1&&n.updateReport("sorts",t.delete(a))},n.onAddSort=function(){var e=n.props.report.get("sorts",g.c.List()).push(g.c.Map({field:"",op:""}));n.updateReport("sorts",e)},n.onChangeFormatField=function(e,t){var a=n.props.report.get("formats",g.c.List()).setIn([e,"field"],t).setIn([e,"op"],"").setIn([e,"value"],"");n.updateReport("formats",a)},n.onChangeFormatOperator=function(e,t){var a=n.props.report.get("formats",g.c.List()).setIn([e,"op"],t).setIn([e,"value"],"");n.updateReport("formats",a)},n.onChangeFormatValue=function(e,t){var a=n.props.report.get("formats",g.c.List()).setIn([e,"value"],t);n.updateReport("formats",a)},n.onChangeFormatValueType=function(e,t){var a=n.props.report.get("formats",g.c.List()).setIn([e,"type"],t);n.updateReport("formats",a)},n.onRemoveFormat=function(e){var t=n.props.report.get("formats",g.c.List()).delete(e);n.updateReport("formats",t)},n.onRemoveFormatByKey=function(e){var t=n.props.report.get("formats",g.c.List()),a=t.filter(function(t){return t.get("field","")!==e});g.c.is(a,t)||n.updateReport("formats",a)},n.onAddFormat=function(){var e=n.props.report.get("formats",g.c.List()).push(g.c.Map({field:"",op:"",value:""}));n.updateReport("formats",e)},n.onMoveFormat=function(e,t){var a=n.props.report,r=a.getIn(["formats",e]),i=a.get("formats",g.c.List()).delete(e).insert(t,r);n.updateReport("formats",i)},n.onChangeColumnField=function(e,t){var a=n.props.report,r=n.getEntityFields().find(function(e){return e.get("id","")===t},null,g.c.Map()),i=a.get("columns",g.c.List()).update(e,g.c.Map(),function(e){var i=e.get("label",""),o=e.get("field_name",""),l=e.get("op",""),s=n.getColumnNewLabel(i,o,l,t,l);return e.withMutations(function(e){return e.set("field_name",t).set("label",s).set("entity",r.get("entity",a.get("entity","")))})});n.updateReport("columns",i)},n.onChangeColumnOperator=function(e,t){var a=n.props.report.get("columns",g.c.List()).update(e,g.c.Map(),function(e){var a=e.get("label",""),r=e.get("field_name",""),i=e.get("op",""),o=n.getColumnNewLabel(a,r,i,r,t);return e.withMutations(function(e){return e.set("op",t).set("label",o)})});n.updateReport("columns",a)},n.onChangeColumnLabel=function(e,t){var a=n.props.report.get("columns",g.c.List()).setIn([e,"label"],t);n.updateReport("columns",a,!1)},n.updateColumnsByReportType=function(e){var t=n.props.report.get("columns",g.c.List()).map(function(t){var a=t.get("label",""),r=t.get("field_name",""),i=t.get("op",""),o=e===Zp.GROPPED?"":i,l=e===Zp.GROPPED?i:"",s=n.getColumnNewLabel(a,r,o,r,l);return t.set("label",s)}).update(function(t){return e===Zp.SIMPLE?t.filter(function(e){return"count_group"!==e.get("key","")}):t});n.updateReport("columns",t)},n.updateSortByReportType=function(e){var t=n.props.report.get("sorts",g.c.List()).update(function(t){return e===Zp.SIMPLE?t.filter(function(e){return"count_group"!==e.get("field","")}):t});n.updateReport("sorts",t)},n.onMoveColumn=function(e,t){var a=n.props.report,r=a.getIn(["columns",e]),i=a.get("columns",g.c.List()).delete(e).insert(t,r);n.updateReport("columns",i)},n.onAddColumn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=n.props.report,a=e||g.c.Map({key:Mt.a.v4(),field_name:"",label:"",op:""}),r=t.get("columns",g.c.List()).push(a);n.updateReport("columns",r)},n.onRemoveColumn=function(e){var t=n.props.report,a=t.getIn(["columns",e,"key"],"");n.onRemoveSortByKey(a),n.onRemoveFormatByKey(a);var r=t.get("columns",g.c.List()).delete(e);n.updateReport("columns",r,!1)},n.getColumnNewLabel=function(e,t,a,r,i){var o=n.props.aggregateOperators,l=n.getEntityFields();return ue(e,l,o,t,a,r,i)},n.getEntityFields=function(){var e=n.props,t=e.report;return e.reportFileds.get(t.get("entity",""),g.c.List())},n.getOutputFormats=function(){var e=n.props,t=e.taxType,a=e.outputFormats;return"vat"===t?a:a.filter(function(e){return"vat_format"!==e.get("id","")})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.mode,n=e.report,a=e.aggregateOperators,i=e.conditionsOperators,o=e.sortOperators,l=e.entities,s=e.progress,c=this.getEntityFields(),u=n.get("columns",g.c.List()),p=r.a.createElement("span",{className:"danger-red"}," *"),d=this.getOutputFormats(),m=k()("fa",{"fa-search":!s,"fa-spinner fa-pulse":s});return r.a.createElement("div",{className:"ReportEditor"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:r.a.createElement("span",null,"Basic Details"),collapsible:"update"===t,className:"collapsible"},r.a.createElement(Sd,{mode:t,title:n.get("key",""),entity:n.get("entity",""),entities:l,type:n.get("type",Zp.SIMPLE),onChangeKey:this.onChangeReportKey,onChangeEntity:this.onChangeReportEntity,onChangeType:this.onChangeReportType})),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Columns ",p)},r.a.createElement(Kd,{mode:t,columns:u,fieldsConfig:c,type:n.get("type",Zp.SIMPLE),aggregateOperators:a,onChangeField:this.onChangeColumnField,onChangeOperator:this.onChangeColumnOperator,onChangeLabel:this.onChangeColumnLabel,onAdd:this.onAddColumn,onRemove:this.onRemoveColumn,onMove:this.onMoveColumn})),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Conditions"),collapsible:!0,className:"collapsible"},r.a.createElement(zd,{mode:t,conditions:n.get("conditions",g.c.List()),fieldsOptions:c,operators:i,onRemove:this.onRemoveCondition,onAdd:this.onAddCondition,onChangeField:this.onChangeConditionField,onChangeOperator:this.onChangeConditionOperator,onChangeValue:this.onChangeConditionValue})),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Sort"),collapsible:!0,className:"collapsible"},r.a.createElement($d,{mode:t,sorts:n.get("sorts",g.c.List()),options:u,sortOperators:o,onChangeField:this.onChangeSortField,onChangeOperator:this.onChangeSortOperator,onRemove:this.onRemoveSort,onAdd:this.onAddSort,onMove:this.onMoveSort})),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Formatting Style"),collapsible:!0,className:"collapsible"},r.a.createElement(am,{mode:t,formats:n.get("formats",g.c.List()),options:u,formatOperators:d,onChangeField:this.onChangeFormatField,onChangeOperator:this.onChangeFormatOperator,onChangeValue:this.onChangeFormatValue,onChangeValueType:this.onChangeFormatValueType,onRemove:this.onRemoveFormat,onAdd:this.onAddFormat,onMove:this.onMoveFormat}))),r.a.createElement(f.x,null,r.a.createElement(f.g,{sm:12},r.a.createElement(f.c,{bsStyle:"primary",onClick:this.onPreview,block:!0,disabled:s},r.a.createElement("i",{className:m}),"\xa0Preview")),r.a.createElement(f.g,{sm:12},"\xa0")))}}]),t}(a.Component);rm.defaultProps={report:g.c.Map(),mode:"update",taxType:"vat",progress:!1,reportFileds:g.c.Map(),aggregateOperators:Y(["reports","aggregateOperators"],g.c.List()),conditionsOperators:Y(["reports","conditionsOperators"],g.c.List()),entities:g.c.List(),sortOperators:g.c.List([g.c.Map({value:1,label:"Ascending"}),g.c.Map({value:-1,label:"Descending"})]),outputFormats:Y(["reports","outputFormats"],g.c.List()),onFilter:function(){},onUpdate:function(){}};var im=rm,om=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.items,a=t.fields,r=t.page,i=t.nextPage,o=t.size,l=t.onlyHeaders;return!g.c.is(n,e.items)||!g.c.is(a,e.fields)||o!==e.size||r!==e.page||i!==e.nextPage||l!==e.onlyHeaders}},{key:"render",value:function(){var e=this.props,t=e.items,n=e.size,a=e.page,i=e.nextPage,o=e.fields,l=e.onlyHeaders;return r.a.createElement("div",{className:"report-list"},r.a.createElement(ec,{items:l?null:t,fields:o.toJS()}),!l&&r.a.createElement(nc,{page:a,size:n,count:t.size,nextPage:i,onChangePage:this.props.onChangePage,onChangeSize:this.props.onChangeSize}),l&&r.a.createElement(f.n,null,Fi.block_preview))}}]),t}(a.Component);om.defaultProps={items:g.c.List(),fields:g.c.List(),size:Y("listDefaultItems",10),page:0,nextPage:!1,onlyHeaders:!1,onChangePage:function(){},onChangeSize:function(){}};var lm=om,sm=Object(on.a)(function(e,t,n){return e.entityList.items.get(n)},function(e){return e}),cm=Object(on.a)(function(e,t,n){return e.entityList.page.get(n)},function(e){return e}),um=Object(on.a)(function(e,t,n){return e.entityList.nextPage.get(n)},function(e){return e}),pm=Object(on.a)(function(e,t,n){return e.entityList.size.get(n)},function(e){return e}),dm=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).initDefaultValues=function(){var e=n.props,t=e.mode,a=e.userName,r=S()().toISOString();"create"===t&&n.onChangeReportValue(["type"],Zp.SIMPLE),"clone"===t&&n.props.dispatch(Xp()),n.onChangeReportValue(["user"],a),n.onChangeReportValue(["from"],r)},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&(n.setState({progress:!0}),n.props.dispatch(id(e)).then(n.afterItemReceived))},n.afterItemReceived=function(e){var t=n.props.mode;n.setState({progress:!1}),e.status?(n.initDefaultValues(),"view"===t&&n.getReportData()):n.handleBack()},n.getReportData=function(){var e=n.props,t=e.item,a=e.size,r=e.page,i=n.preperReport(t);n.setState({progress:!0}),n.props.dispatch(od({report:i,page:r,size:a})).then(n.afterReportDataReceived)},n.afterReportDataReceived=function(){n.setState({progress:!1})},n.onChangeReportValue=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(n.props.dispatch(sd(0)),n.props.dispatch(ld()),n.setState({showPreview:!1}));var a=Array.isArray(e)?e.join("."):e;""===t&&[].includes(a)?n.props.dispatch(rd(e)):null===t&&[].includes(a)?n.props.dispatch(rd(e)):n.props.dispatch(ad(e,t))},n.handleDelete=function(){var e=n.props.item;n.setState({progress:!0}),n.props.dispatch(nd(e)).then(n.afterDelete)},n.afterDelete=function(e){if(n.setState({progress:!1}),e.status){var t=Y(["systemItems","report","itemsType"],"");n.props.dispatch(Wa("The report was deleted")),n.props.dispatch(Pc(t)),n.handleBack()}},n.afterSave=function(e){var t=n.props,a=t.item,r=t.mode;if(n.setState({progress:!1}),e.status){var i=["clone","create"].includes(r)?"created":"updated",o=Y(["systemItems","report","itemsType"],"");if(n.props.dispatch(Wa("The report was ".concat(i))),n.props.dispatch(Pc(o)),"update"===r){var l=a.getIn(["_id","$id"]),s=Y(["systemItems","report","itemType"],"");n.fetchItem(),n.props.router.push("".concat(o,"/").concat(s,"/").concat(l))}else n.handleBack()}},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;if(n.validate()){n.setState({progress:!0});var r=n.preperReport(t);n.props.dispatch(td(r,a)).then(n.afterSave)}},n.handleEdit=function(){var e=n.props.location,t=e.pathname,a=e.query;n.props.router.push({pathname:t,query:Object.assign({},a,{action:"update"})})},n.handleClone=function(){var e=n.props.location,t=e.pathname,a=e.query;n.props.router.push({pathname:t,query:Object.assign({},a,{action:"clone"})})},n.handleBack=function(){var e=Y(["systemItems","report","itemsType"],"");n.props.router.push("/".concat(e))},n.validateEmptyAggregateOp=function(e){return""!==e.get("field_name","")&&""===e.get("op","")},n.validate=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=n.props.item;return e||""!==t.get("key","")?""===t.get("entity","")?(n.props.dispatch(Qa("Please select entity")),!1):t.get("columns",g.c.List()).filter(n.filterColumnsEmptyRows).isEmpty()?(n.props.dispatch(Qa("Please select at least one column")),!1):t.get("type",Zp.SIMPLE)!==Zp.GROPPED||!t.get("columns",g.c.List()).some(n.validateEmptyAggregateOp)||(n.props.dispatch(Qa("Please select column function")),!1):(n.props.dispatch(Qa("Please enter name")),!1)},n.preperReport=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.withMutations(function(t){t.set("conditions",e.get("conditions",g.c.List()).filter(n.filterConditionsEmptyRows)).set("columns",e.get("columns",g.c.List()).filter(n.filterColumnsEmptyRows).update(function(t){return e.get("type",Zp.SIMPLE)===Zp.SIMPLE?t.map(function(e){return e.set("op","")}):t})).set("sorts",e.get("sorts",g.c.List()).filter(n.filterSortEmptyRows)).set("formats",e.get("formats",g.c.List()).filter(n.filterFormatsEmptyRows).map(function(e){return e.has("type")?g.c.Map({field:e.get("field"),op:e.get("op"),value:"".concat(e.get("value")," ").concat(e.get("type"))}):e}))})},n.filterConditionsEmptyRows=function(e){return[e.get("field",""),e.get("op",""),e.get("value","")].every(function(e){return""!==e})},n.filterSortEmptyRows=function(e){return[e.get("op",""),e.get("field","")].every(function(e){return""!==e})},n.filterFormatsEmptyRows=function(e){return[e.get("field",""),e.get("op",""),e.get("value","")].every(function(e){return""!==e})},n.filterColumnsEmptyRows=function(e){return[e.get("field_name","")].every(function(e){return""!==e})},n.applyFilter=function(){n.validate(!0)&&(n.setState({showPreview:!0}),n.getReportData())},n.isExportEnable=function(){var e=n.props,t=e.itemId,a=e.item,r=e.itemSource;return!(!t||""===t)&&g.c.is(a.delete("from").delete("user"),r.delete("from").delete("user"))},n.getExportReportHelpText=function(){return n.isExportEnable()?"Export Report to CSV":"Reports was changed, please save report before export."},n.onClickExportCSV=function(){var e=n.props.item,t=Jr(e.get("key",""));window.open(ar(t))},n.onPageChange=function(e){n.props.dispatch(sd(e))},n.onSizeChange=function(e){n.props.dispatch(sd(0)),n.props.dispatch(cd(e))},n.onAskDelete=function(){var e=n.props.item,t={message:'Are you sure you want to delete "'.concat(e.get("key",""),'" report ?'),onOk:n.onDeleteOk,labelOk:"Delete",type:"delete"};n.props.dispatch(po(t))},n.onDeleteOk=function(){n.handleDelete()},n.onAskReset=function(){var e=n.props.mode,t={message:"Are you sure you want to ".concat("create"===e?"reset report":"revert report changes"," ?"),onOk:n.onResetOk,labelOk:"Yes"};n.props.dispatch(po(t))},n.onResetOk=function(){"create"===n.props.mode?(n.props.dispatch(ed()),n.initDefaultValues()):n.fetchItem()},n.getTableFields=function(){return g.c.List().withMutations(function(e){n.props.item.get("columns",g.c.List()).filter(n.filterColumnsEmptyRows).forEach(function(t){e.push(g.c.Map({id:t.get("key",""),title:t.get("label","")}))})})},n.getListActions=function(){return[{type:"export_csv",label:"Export",helpText:"Export Report to CSV",showIcon:!0,onClick:n.onClickExportCSV,actionStyle:"primary",actionSize:"xsmall"},{type:"remove",label:"Delete",helpText:"Delete Report",showIcon:!0,onClick:n.onAskDelete,actionStyle:"danger",actionSize:"xsmall"},{type:"clone",label:"Clone",helpText:"Clone Report",showIcon:!0,onClick:n.handleClone,actionStyle:"primary",actionSize:"xsmall"},{type:"edit",label:"Edit",helpText:"Edit Report",showIcon:!0,onClick:n.handleEdit,actionStyle:"primary",actionSize:"xsmall"}]},n.getEditActions=function(){var e=n.props.mode;return[{type:"export_csv",label:"Export",helpText:n.getExportReportHelpText,showIcon:!0,onClick:n.onClickExportCSV,actionStyle:"primary",actionSize:"xsmall",enable:n.isExportEnable},{type:"reset",label:"create"===e?"Reset":"Revert Changes",actionStyle:"primary",showIcon:!1,onClick:n.onAskReset,actionSize:"xsmall"}]},n.renderPanelHeader=function(){var e=n.state,t=e.listActions,a=e.editActions,i=n.props.mode;return r.a.createElement("div",null,"\xa0",r.a.createElement("div",{className:"pull-right"},r.a.createElement(Xe,{actions:"view"===i?t:a})))},n.state={showPreview:!1,progress:!1,listActions:n.getListActions(),editActions:n.getEditActions()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem(),this.props.dispatch(il(["file_types","subscribers.subscriber","subscribers.account","taxation.tax_type","lines","rates.fields"]))}},{key:"componentDidMount",value:function(){var e=this.props.mode;if("create"===e){var t=X(e,"report");this.props.dispatch(ro(t))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=this.props,i=r.item,o=r.itemId,l=r.mode;if(n!==l||te(t)!==te(i)){var s=X(n,"report",t);this.props.dispatch(ro(s))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.page,a=t.size,r=t.mode,i=e.page,o=e.size,l=e.mode;(n!==i||a!==o||r!==l&&"view"===r)&&this.getReportData()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(ed())}},{key:"render",value:function(){var e=this.state,t=e.progress,n=e.showPreview,a=this.props,i=a.item,o=a.mode,l=a.reportFileds,s=a.reportEntities,c=a.reportData,u=a.size,p=a.page,d=a.nextPage,m=a.taxType;if("loading"===o)return r.a.createElement(_,{onClick:this.handleBack});var g="view"!==o,h=this.getTableFields(),y=g&&(!n||h.isEmpty());return r.a.createElement("div",{className:"report-setup"},r.a.createElement(f.v,{header:this.renderPanelHeader()},g&&r.a.createElement(im,{report:i,reportFileds:l,entities:s,mode:o,taxType:m,onUpdate:this.onChangeReportValue,onFilter:this.applyFilter,progress:t}),r.a.createElement(lm,{items:c,fields:h,page:p,size:u,onlyHeaders:y,nextPage:d,onChangePage:this.onPageChange,onChangeSize:this.onSizeChange}),r.a.createElement("div",{className:"clearfix"}),r.a.createElement("hr",{className:"mb0"}),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!g,progress:t,disableCancel:t})))}}]),t}(a.Component);dm.defaultProps={item:g.c.Map(),itemSource:g.c.Map(),reportFileds:g.c.Map(),reportData:g.c.List(),reportEntities:g.c.List(),userName:"Unknown",mode:"loading",page:0,size:Y("listDefaultItems",10),taxType:"vat",nextPage:!1};var mm=Object(s.f)(Object(l.connect)(function(e,t){return{userName:e.user.get("name"),itemId:pi(e,t,"reports"),item:ui(e,t,"reports"),itemSource:ci(e,t,"reports"),mode:gi(e,t,"reports"),reportFileds:Ad(e,t),reportEntities:Md(e,t),reportData:sm(e,t,"reportData"),page:cm(e,t,"reportData"),nextPage:um(e,t,"reportData"),size:pm(e,t,"reportData"),taxType:Tn(e,t)}})(dm)),gm=function(e){var t=[{id:"description",title:"Title",sort:!0},{id:"name",title:"Key",sort:!0},{title:"Trial",parser:function(e){return e.getIn(["price",0,"trial"])?"".concat(e.getIn(["price",0,"to"])," ").concat(e.getIn(["recurrence","periodicity"])):""}},{id:"recurrence_charges",title:"Recurring Charges",parser:function(e){var t=e.getIn(["price",0,"trial"])?1:0,n=e.get("price",g.c.List()).size-t;return"".concat(n," cycles")}},{id:"recurrence_frequency",title:"Billing Frequency",parser:function(e){var t=e.getIn(["recurrence","periodicity"],"");return t?"".concat(F.a.upperCaseFirst(t),"ly"):""}},{id:"charging_mode",title:"Charging Mode",parser:function(e){return e.get("upfront")?"Upfront":"Arrears"}},{id:"connection_type",display:!1,showFilter:!1},{id:"play",title:"Play",display:e.isPlaysEnabled,parser:function(e){return e.get("play",g.c.List()).join(", ")}}];return r.a.createElement(qc,{itemType:"plan",itemsType:"plans",filterFields:[{id:"name",placeholder:"Key"},{id:"description",placeholder:"Title"}],baseFilter:{connection_type:{$regex:"^postpaid$"}},tableFields:t,projectFields:{recurrence_frequency:1,recurrence_charges:1,connection_type:1,charging_mode:1,description:1,recurrence:1,upfront:1,price:1,play:1,name:1},showRevisionBy:"key",actions:[{type:"edit"}]})};gm.defaultProps={isPlaysEnabled:!1};var fm=Object(l.connect)(function(e,t){return{isPlaysEnabled:jn(e,t)}})(gm),hm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={cycleError:"",priceError:""},n.onCycleUpdateValue=function(e){var t=n.props.index,a="",r=e;"undefined"===typeof e||null===e||""===e?(a="Cycle is required",r=0):!isNaN(e)&&Math.sign(e)>0||(a="Value must be positive number",r=0),n.props.onPlanCycleUpdate(t,r),n.setState({cycleError:a})},n.onCycleUpdateEvent=function(e){n.onCycleUpdateValue(e.target.value)},n.onPlanPriceUpdate=function(e){var t=n.props.index,a=e.target.value,r="";"undefined"===typeof a||null===a||""===a?r="Price is required":!isNaN(a)&&Math.sign(a)>=0||(r="Value must be positive number"),n.setState({priceError:r}),n.props.onPlanPriceUpdate(t,a)},n.onPlanTariffRemove=function(){var e=n.props.index;n.props.onPlanTariffRemove(e)},n.getCycleDisplayValue=function(){var e=n.props,t=e.item,a=e.planCycleUnlimitedValue,r=t.get("to",""),i=t.get("from","");switch(r){case a:return"Infinite";case"":return"";default:return r-i}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props,a=n.count,r=n.index,i=n.mode,o=this.state,l=o.cycleError,s=o.priceError,c=a<e.count&&r===a-1,u=a>e.count&&r===a-2,p=t.cycleError!==l||t.priceError!==s;return!g.c.is(this.props.item,e.item)||r!==e.index||i!==e.mode||c||u||p}},{key:"render",value:function(){var e=this.state,t=e.cycleError,n=e.priceError,a=this.props,i=a.item,o=a.index,l=a.count,s=a.isTrialExist,c=a.planCycleUnlimitedValue,u=a.mode,p=i.get("price",""),d=i.get("trial",!1),m=i.get("to",""),g=this.getCycleDisplayValue(),h=0===o||s&&1===o,v=d||(0===l||l-1===o),y="view"!==u;return r.a.createElement(f.g,{sm:12,className:"form-inner-edit-row mb0"},r.a.createElement(f.g,{sm:2,className:"text-center"},h&&r.a.createElement(f.h,{className:"mb5"},"Period"),r.a.createElement("p",{className:"non-editable-field mb0"},o+1)),r.a.createElement(f.g,{sm:3,className:"pr0"},r.a.createElement(f.l,{validationState:t.length?"error":null,className:"ml0 mr0"},h&&r.a.createElement(f.h,{className:"mb5"},"Cycles"),m===c?r.a.createElement(en,{value:g,disabled:!0,editable:y}):r.a.createElement(en,{value:g,onChange:this.onCycleUpdateEvent,fieldType:"number",min:0,editable:y}),t.length>0&&r.a.createElement(f.n,null,t,"."))),r.a.createElement(f.g,{sm:3,className:"pr0"},r.a.createElement(f.l,{validationState:n.length?"error":null,className:"ml0 mr0"},h&&r.a.createElement(f.h,{className:"mb5"},"Price"),r.a.createElement(en,{onChange:this.onPlanPriceUpdate,value:p,editable:y}),n.length>0&&r.a.createElement(f.n,null,n,"."))),r.a.createElement(f.g,{sm:4},v&&y&&r.a.createElement(f.l,{className:"actions ml0 mr0"},h&&r.a.createElement(f.h,{className:"mb5"},"\xa0"),r.a.createElement("div",{className:"text-left"},r.a.createElement(f.c,{onClick:this.onPlanTariffRemove,bsSize:"small"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))))}}]),t}(a.Component);hm.defaultProps={planCycleUnlimitedValue:Y("planCycleUnlimitedValue","UNLIMITED"),mode:"create"};var vm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={errors:{name:""}},n.onPlanTrailTariffInit=function(e){n.props.onPlanTariffAdd(!0)},n.onPlanTariffInit=function(e){n.props.onPlanTariffAdd()},n.onChangePlanName=function(e){var t=n.props.errorMessages.name.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=Y("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{name:i})}),n.props.onChangeFieldValue(["name"],r)},n.onChangeProrated=function(e){var t=e.target.value;n.props.onChangeFieldValue(["prorated"],t)},n.onChangePlanDescription=function(e){var t=e.target.value;n.props.onChangeFieldValue(["description"],t)},n.onChangePlays=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=""===e?[]:e.split(",");n.props.onChangeFieldValue(["play"],g.c.List(a)),t&&(n.props.onChangeFieldValue(["rates"],g.c.Map()),n.props.onChangeFieldValue(["include","groups"],g.c.Map()),n.props.onChangeFieldValue(["include","services"],g.c.List()))},n.onChangePlanEach=function(e){var t=parseInt(e.target.value);t=isNaN(t)?"":t,n.props.onChangeFieldValue(["recurrence","unit"],t)},n.onChangePeriodicity=function(e){n.props.onChangeFieldValue(["recurrence","periodicity"],e)},n.onPlanPriceUpdate=function(e,t){var a=R()(t)?parseFloat(t):t;n.props.onChangeFieldValue(["price",e,"price"],a)},n.onChangeUpfront=function(e){"TRUE"===e.toUpperCase()?e=!0:"FALSE"===e.toUpperCase()&&(e=!1),n.props.onChangeFieldValue(["upfront"],e)},n.onChangeAdditionalField=function(e,t){n.props.onChangeFieldValue(e,t)},n.onRemoveAdditionalField=function(e){n.props.onRemoveField(e)},n.getAddPriceButton=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?n.onPlanTrailTariffInit:n.onPlanTariffInit;return r.a.createElement(Je,{onClick:e,label:"Add New"})},n.getTrialPrice=function(){var e=n.props,t=e.plan,a=e.mode,i="view"!==a,o=!0===t.getIn(["price",0,"trial"])?t.getIn(["price",0]):null;return o?r.a.createElement(hm,{index:0,count:t.get("price",g.c.List()).size,item:o,mode:a,isTrialExist:!0,onPlanPriceUpdate:n.onPlanPriceUpdate,onPlanCycleUpdate:n.props.onPlanCycleUpdate,onPlanTariffAdd:n.props.onPlanTariffAdd,onPlanTariffRemove:n.props.onPlanTariffRemove}):i?n.getAddPriceButton(!0):null},n.getPrices=function(){var e=n.props,t=e.plan,a=e.mode,i=!0===t.getIn(["price",0,"trial"])||"true"===t.getIn(["price",0,"trial"]),o=t.get("price",g.c.List()).size,l=[];return t.get("price",g.c.List()).forEach(function(e,t){!0!==e.get("trial")&&l.push(r.a.createElement(hm,{key:t,index:t,count:o,item:e,mode:a,isTrialExist:i,onPlanPriceUpdate:n.onPlanPriceUpdate,onPlanCycleUpdate:n.props.onPlanCycleUpdate,onPlanTariffRemove:n.props.onPlanTariffRemove}))}),l},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){0===this.props.plan.get("price",g.c.List()).size&&this.props.onPlanTariffAdd()}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.plan,a=t.mode,i=t.periodicityOptions,o=t.chargingModeOptions,l=n.getIn(["recurrence","periodicity"])||"",s="boolean"!==typeof n.get("upfront")?"":n.get("upfront","").toString(),c="view"!==a;return r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,null,r.a.createElement(Wc,{entity:n,editable:c&&"create"===a,multi:!0,onChange:this.onChangePlays}),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("description",K("service"),Object(x.sentenceCase)("title")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ii,{contents:Ni.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{value:n.get("description",""),onChange:this.onChangePlanDescription,editable:c}))),["clone","create"].includes(a)&&r.a.createElement(f.l,{validationState:e.name.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("name",K("service"),Object(x.sentenceCase)("key")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ii,{contents:Ni.name})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{id:"PlanName",onChange:this.onChangePlanName,value:n.get("name",""),required:!0,editable:c}),e.name.length>0&&r.a.createElement(f.n,null,e.name))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Billing Frequency",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{fieldType:"select",options:i,onChange:this.onChangePeriodicity,value:l,editable:c}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Charging Mode",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{fieldType:"select",options:o,onChange:this.onChangeUpfront,value:s,editable:c}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Prorated?"),r.a.createElement(f.g,{sm:4,style:c?{padding:"10px 15px"}:{paddingTop:5}},r.a.createElement(en,{value:n.get("prorated",""),onChange:this.onChangeProrated,fieldType:"checkbox",editable:c}))),r.a.createElement(Vu,{entityName:"plans",entity:n,onChangeField:this.onChangeAdditionalField,onRemoveField:this.onRemoveAdditionalField,editable:c})),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Trial Period")},this.getTrialPrice()),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Recurring Charges")},this.getPrices(),r.a.createElement("br",null),c&&this.getAddPriceButton(!1)))))}}]),t}(a.Component);vm.defaultProps={periodicityOptions:[{value:"month",label:"Monthly"},{value:"year",label:"Yearly"}],chargingModeOptions:[{value:"true",label:"Upfront"},{value:"false",label:"Arrears"}],errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var ym=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).addDefaultPriceIfNoPrice=function(e,t,a,r){var i=null!==r;if(0===a.size&&!i){var o=["rates",e.get("key",""),t,"rate"];n.props.onProductInitRate(e,o)}},n.onProductEditRate=function(e,t,a){var r=n.props,i=r.item,o=r.usaget,l=i.get("key");switch(t){case"to":var s=["rates",l,o,"rate"];n.props.onProductEditRateTo(s,e,a);break;default:var c=["rates",l,o,"rate",e,t];n.props.onProductEditRate(c,a)}},n.onProductAddRate=function(){var e=n.props,t=e.item,a=e.usaget,r=["rates",t.get("key"),a,"rate"];n.props.onProductAddRate(r)},n.onProductRemoveRate=function(e){var t=n.props,a=t.item,r=t.usaget,i=["rates",a.get("key"),r,"rate"];n.props.onProductRemoveRate(i,e)},n.onProductRemove=function(){var e=n.props.item.get("key");n.props.onProductRemove(["rates"],e)},n.onProductRestore=function(){var e=n.props,t=e.item,a=e.usaget,r=["rates",t.get("key",""),a,"rate"];n.props.onProductRestore(t,r)},n.onChangeOverrideType=function(e){var t=n.props,a=t.item,r=t.usaget,i=a.get("key");if("percentage"===e.target.value){var o=g.c.Map(Object(vr.a)({},r,g.c.Map({percentage:100}))),l=["rates",i];n.props.onProductEditRate(l,o)}else{var s=g.c.Map(Object(vr.a)({},r,g.c.Map({rate:g.c.List()}))),c=["rates",i];n.props.onProductEditRate(c,s)}},n.onChangePercentage=function(e){var t=e.target.value,a=n.props,r=a.item,i=a.usaget,o=R()(t)?parseFloat(t):t,l=["rates",r.get("key"),i,"percentage"];n.props.onProductEditRate(l,o)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.item,n=e.usaget,a=e.prices,r=e.percentage;this.addDefaultPriceIfNoPrice(t,n,a,r)}},{key:"shouldComponentUpdate",value:function(e,t){var n=this.props,a=n.prices,r=n.mode,i=n.usageTypes,o=n.propertyTypes,l=n.percentage;return!g.c.is(a,e.prices)||r!==e.mode||l!==e.percentage||!g.c.is(a,e.prices)||!g.c.is(i,e.usageTypes)||!g.c.is(o,e.propertyTypes)}},{key:"componentWillUpdate",value:function(e,t){var n=e.item,a=e.usaget,r=e.prices,i=e.percentage;this.addDefaultPriceIfNoPrice(n,a,r,i)}},{key:"render",value:function(){var e=this,t=this.props,n=t.item,a=t.prices,i=t.usaget,o=t.mode,l=t.propertyTypes,s=t.usageTypes,c=t.percentage,u=a.getIn([0,"uom_display","range"],""),p="view"!==o,d=a.size,m=null!==c,g="volume"===n.get("pricing_method","Tiered")?"Volume":"Tiered",h=r.a.createElement("h3",null,"".concat(n.get("key")," (").concat(i,") ")," ",r.a.createElement("i",null,n.get("code","")),r.a.createElement(Ii,{contents:n.get("description","")}),p&&r.a.createElement(f.c,{onClick:this.onProductRemove,bsSize:"xsmall",className:"pull-right",style:{minWidth:80}},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0Remove"),p&&r.a.createElement(f.c,{onClick:this.onProductRestore,bsSize:"xsmall",className:"pull-right",style:{marginRight:10,minWidth:80}},r.a.createElement("i",{className:"fa fa-undo fa-lg"})," \xa0Undo Changes "));return r.a.createElement(f.v,{header:h},p&&r.a.createElement(f.l,{className:"mb0"},r.a.createElement("span",{className:"inline mr10"},r.a.createElement(en,{fieldType:"radio",value:"no",onChange:this.onChangeOverrideType,name:"".concat(n.get("key"),"-override-type"),label:"Override with specific prices",checked:!m})),r.a.createElement("span",{className:"inline"},r.a.createElement(en,{className:"inline mr10",fieldType:"radio",value:"percentage",onChange:this.onChangeOverrideType,name:"".concat(n.get("key"),"-override-type"),label:"Override by percentage of the original price",checked:m}),m&&r.a.createElement(en,{style:{display:"inline-block",width:115,verticalAlign:"middle"},fieldType:"number",onChange:this.onChangePercentage,value:c,editable:p,suffix:"%",max:100,min:0,step:1}))),m&&!p&&r.a.createElement(f.l,{className:"mb0"},r.a.createElement("span",null,"Original price overridden by: "),r.a.createElement(en,{style:{display:"inline-block",width:115,verticalAlign:"middle"},fieldType:"number",value:c,editable:!1,suffix:"%"})),!m&&r.a.createElement(f.l,{style:{margin:3}},r.a.createElement(f.h,null,"".concat(g," Pricing"))),!m&&a.map(function(t,a){return r.a.createElement(f.g,{sm:12},r.a.createElement(bp,{key:"".concat(n.get("key"),"_").concat(a),item:t,index:a,mode:o,count:d,unit:ye(l,s,i,u),onProductEditRate:e.onProductEditRate,onProductRemoveRate:e.onProductRemoveRate}))}),!m&&p&&r.a.createElement(f.l,{style:{margin:0}},r.a.createElement(Je,{onClick:this.onProductAddRate,label:"Add New",buttonStyle:{marginTop:0}})))}}]),t}(a.Component);ym.defaultProps={item:g.c.Map(),prices:g.c.List(),usageTypes:g.c.List(),propertyTypes:g.c.List(),mode:"create",percentage:null};var bm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onProductUndoRemove=function(){var e=n.props.item.get("key");n.props.onProductUndoRemove(e)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.usaget,a=r.a.createElement("h3",{className:"product-removed"},t.get("key","")," (",n,") ",r.a.createElement("i",null,t.get("code","")),r.a.createElement(Ii,{contents:t.get("description","")}),r.a.createElement(f.c,{onClick:this.onProductUndoRemove,bsSize:"xsmall",className:"pull-right",style:{minWidth:80}},r.a.createElement("i",{className:"fa fa-mail-reply"}),"\xa0Undo"));return r.a.createElement(f.v,{header:a})}}]),t}(a.Component);bm.defaultProps={item:g.c.Map()};var Em=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={val:"",rates:[]},n.onSelectProduct=function(e){e&&n.props.onSelectProduct(e),n.setState({val:""})},n.getProducts=function(){return ir(n.props.searchFunction).then(function(e){var t=e.data[0].data.details.map(function(e){return{value:e.key,label:"".concat(e.key," (").concat(e.description,")"),play:e.play}});n.setState({rates:t})}).catch(function(){n.setState({options:[]})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.getProducts()}},{key:"render",value:function(){var e=this.state,t=e.val,n=e.rates.filter(this.props.filterFunction);return r.a.createElement(en,{fieldType:"select",value:t,options:n,onChange:this.onSelectProduct,placeholder:"Search by product key or title...",noResultsText:"No products found, please try another key"})}}]),t}(a.Component);Em.defaultProps={searchFunction:Mr({key:1,description:1}),filterFunction:function(){return!0}};var Cm=function(e,t,n){return{type:"".concat(e.toUpperCase(),"_PRODUCTS_REMOVE"),path:t,name:n}},_m=function(e,t,n){return{type:"".concat(e.toUpperCase(),"_PRODUCTS_RATE_INIT"),product:t,path:n}},Om=function(e,t){return{type:"".concat(e.toUpperCase(),"_PRODUCTS_RATE_ADD"),path:t}},Sm=function(e,t,n){return{type:"".concat(e.toUpperCase(),"_PRODUCTS_RATE_REMOVE"),path:t,index:n}},Tm=function(e,t,n){return{type:"".concat(e.toUpperCase(),"_PRODUCTS_RATE_UPDATE"),path:t,value:n}},km=function(e,t,n,a){return{type:"".concat(e.toUpperCase(),"_PRODUCTS_RATE_UPDATE_TO"),path:t,index:n,value:a}},Im=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).addNewProductToPlan=function(e){var t=n.props,a=t.products,r=t.propertyTypes,i=t.usageTypesData,o=t.itemName;e.forEach(function(e){var t=a.find(function(t){return t.get("key","")===e.key});if(t){var l=t.get("rates",g.c.Map()).keySeq().first(),s=["rates",t.get("key",""),l,"rate"],c=Ce(r,i,t,!1),u=c.isEmpty()?t:t.set("rates",c);n.props.dispatch(_m(o,u,s))}})},n.onSelectProduct=function(e){n.props.planRates.has(e)?n.props.dispatch(Ja("Price of product ".concat(e," already overridden"))):n.props.dispatch(hr("plan_products",Vr(e))).then(function(e){e.status&&n.addNewProductToPlan(e.data)})},n.onProductRestore=function(e,t){var a=n.props,r=a.originalRates,i=a.itemName,o=e.get("key");if(r.keySeq().includes(o)){var l=r.get(o,g.c.Map());n.props.onChangeFieldValue(["rates",o],l),n.props.dispatch($a("Product ".concat(o," prices for this plan restored to origin state")))}else n.props.dispatch(_m(i,e,t)),n.props.dispatch($a("Product ".concat(o," prices for this plan restored to BASE state")))},n.onProductRemove=function(e,t){var a=n.props.itemName;n.props.dispatch(Cm(a,e,t))},n.onProductUndoRemove=function(e){var t=n.props.originalRates.get(e,g.c.Map());n.props.onChangeFieldValue(["rates",e],t),n.props.dispatch(Wa("Product ".concat(e," prices restored")))},n.onProductRemoveRate=function(e,t){var a=n.props.itemName;n.props.dispatch(Sm(a,e,t))},n.onProductEditRate=function(e,t){var a=n.props.itemName;n.props.dispatch(Tm(a,e,t))},n.onProductEditRateTo=function(e,t,a){var r=n.props.itemName;n.props.dispatch(km(r,e,t,a))},n.onProductAddRate=function(e){var t=n.props.itemName;n.props.dispatch(Om(t,e))},n.onProductInitRate=function(e,t){var a=n.props.itemName;n.props.dispatch(_m(a,e,t))},n.renderNoItems=function(){return r.a.createElement(f.g,{lg:12}," No overridden prices for this plan ")},n.getRemovedProductKeys=function(){var e=n.props,t=e.planRates,a=e.originalRates,r=t.map(function(e,t){return t});return a.reduce(function(e,t,n){return r.includes(n)?e:e.push(n)},g.c.List())},n.renderRemovedItems=function(){var e=n.props,t=e.products,a=e.originalRates;return n.getRemovedProductKeys().map(function(e){var i=t.find(function(t){return t.get("key","")===e},null,g.c.Map({key:e})),o=a.get(e).keySeq().first();return r.a.createElement(bm,{key:i.getIn(["_id","$id"],i.get("key",e)),usaget:o,item:i,onProductUndoRemove:n.onProductUndoRemove})})},n.renderItems=function(){var e=n.props,t=e.products,a=e.planRates,i=e.usageTypesData,o=e.propertyTypes,l=e.mode;return a.reverse().map(function(e,a){var s=e.keySeq().first(),c=e.getIn([s,"rate"],g.c.List()),u=e.getIn([s,"percentage"],null),p=t.find(function(e){return e.get("key","")===a},null,g.c.Map({key:a}));return r.a.createElement(ym,{key:p.getIn(["_id","$id"],p.get("key")),item:p,prices:c,percentage:u,usaget:s,mode:l,onProductInitRate:n.onProductInitRate,onProductRemoveRate:n.onProductRemoveRate,onProductAddRate:n.onProductAddRate,onProductEditRate:n.onProductEditRate,onProductEditRateTo:n.onProductEditRateTo,onProductRemove:n.onProductRemove,onProductRestore:n.onProductRestore,usageTypes:i,propertyTypes:o})}).toList().toArray()},n.filterByPlay=function(e){var t=n.props.plays;return""===t||!e.play||t.split(",").includes(e.play)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.planRates;if(!e.isEmpty()){var t=e.keySeq();this.props.dispatch(fr("plan_products",zr(t.toArray())))}}},{key:"componentWillReceiveProps",value:function(e){var t=e.planRates,n=e.products,a=this.props.planRates;if(!g.c.is(t,a)){var r=t.keySeq().filter(function(e){return-1===n.findIndex(function(t){return t.get("key","")===e})});r.isEmpty()||this.props.dispatch(hr("plan_products",zr(r.toArray())))}}},{key:"componentWillUnmount",value:function(){this.props.dispatch(gr("plan_products"))}},{key:"render",value:function(){var e=this.props,t=e.planRates,n="view"!==e.mode,a=r.a.createElement("h3",null,"Select Products to Override Price ",r.a.createElement(Ii,{contents:Ni.add_product}));return r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,null,n&&r.a.createElement(f.v,{header:a},r.a.createElement(Em,{onSelectProduct:this.onSelectProduct,searchFunction:Mr({key:1,description:1,play:1}),filterFunction:this.filterByPlay})),this.renderRemovedItems(),this.renderItems(),t.isEmpty()&&this.renderNoItems())))}}]),t}(a.Component);Im.defaultProps={planRates:g.c.Map(),usageTypesData:g.c.List(),propertyTypes:g.c.List(),plays:"",mode:"create",originalRates:g.c.Map(),products:g.c.List()};var Nm=Object(l.connect)(function(e,t){return{originalRates:yi(e,t,t.itemName),products:e.list.get("plan_products"),usageTypesData:Un(e,t),propertyTypes:Vn(e,t)}})(Im),wm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={options:[]},n.onChangeGroupRates=function(e){var t=e.length?e.split(","):[];n.props.onChangeGroupRates(g.c.List(t))},n.loadOptions=function(){var e=n.props,t=e.usages,a=e.existingProducts,r=e.plays,i=a.toArray(),o=yr(t.toArray(),i,r);return ir(o).then(function(e){var t=Object(w.a)(new Set(e.data[0].data.details.map(function(e){return e.key}))).map(function(e){return{value:e,label:e}});n.setState({options:t})}).catch(function(){n.setState({options:[]})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.loadOptions()}},{key:"render",value:function(){var e=this.props,t=e.disabled,n=e.usages,a=e.products,i=this.state.options;return"undefined"===typeof n?null:r.a.createElement(en,{fieldType:"select",multi:!0,value:a.join(","),options:i,onChange:this.onChangeGroupRates,disabled:t,placeholder:"Add product...",noResultsText:"No products found.",searchPromptText:"Type product key to search"})}}]),t}(a.Component);wm.defaultProps={disabled:!1,existingProducts:g.c.List(),products:g.c.List(),usages:g.c.List(),plays:""};var jm=function(e){return Y("keyUppercaseRegex",/./).test(e)},Rm=function(e){return"UNLIMITED"===e||function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?/^[+]?\d+$/.test(e):/^[+-]?\d+$/.test(e)}(e,!0)},xm=function(e){return function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?/^[+]?\d+(\.\d+)?$/.test(e):/^[+-]?\d+(\.\d+)?$/.test(e)}(e,!0)},Fm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={isEditMode:!1,showConfirm:!1,errorInclude:"",errorUoM:"",unit:""},n.errors={include:{required:"Include is required",allowedCharacters:"Include must be positive number or Unlimited",allowedCharactersMonetary:"Include must be positive number"},products:{required:"Products is required"},uom:{required:"Units are required"}},n.isMonetaryBased=function(){return"cost"===n.props.usages.get(0,"")},n.onChangeInclud=function(e){var t=n.props.name,a="";""===e?a=n.errors.include.required:n.isMonetaryBased()&&!xm(e)?a=n.errors.include.allowedCharactersMonetary:n.isMonetaryBased()||Rm(e)||(a=n.errors.include.allowedCharacters);var r=n.isMonetaryBased()?"cost":"value",i=R()(e)?parseFloat(e):e;n.props.onChangeFieldValue(["include","groups",t,r],i),n.setState({errorInclude:a})},n.onChangeIncludeMonetaryBased=function(e){var t=e.target.value;n.onChangeInclud(t)},n.onChangeShared=function(e){var t=e.target.checked,a=n.props.name;n.props.onChangeFieldValue(["include","groups",a,"account_shared"],t),t||(n.props.onChangeFieldValue(["include","groups",a,"account_pool"],!1),n.props.onChangeFieldValue(["include","groups",a,"quantity_affected"],!1))},n.onChangePooled=function(e){var t=e.target.checked,a=n.props.name;n.props.onChangeFieldValue(["include","groups",a,"account_pool"],t),t||n.props.onChangeFieldValue(["include","groups",a,"quantity_affected"],!1)},n.onChangeQuantityAffected=function(e){var t=e.target.checked,a=n.props.name;n.props.onChangeFieldValue(["include","groups",a,"quantity_affected"],t)},n.onChangeGroupRates=function(e){var t=n.props.name;n.props.onChangeGroupProducts(t,e)},n.onChangeUnit=function(e){var t=n.props,a=t.name,r=t.usageTypes,i=""===e?n.errors.uom.required:"";n.setState({unit:e,errorUoM:i}),r.forEach(function(t){return n.props.onChangeFieldValue(["include","groups",a,"usage_types",t,"unit"],e)})},n.onGroupRemoveAsk=function(){n.setState({showConfirm:!0})},n.onGroupRemoveOk=function(){var e=n.props,t=e.name,a=e.products;n.props.onGroupRemove(t,a),n.setState({showConfirm:!1})},n.onGroupRemoveCancel=function(){n.setState({showConfirm:!1})},n.toggleBoby=function(){var e=n.state,t=e.errorInclude,a=e.errorUoM;""===t&&""===a&&n.setState({isEditMode:!n.state.isEditMode})},n.getListActions=function(){var e="view"!==n.props.mode;return[{type:"edit",helpText:"Edit group",onClick:n.toggleBoby,enable:e,actionClass:"pl0 pr0"},{type:"remove",helpText:"Remove Group",onClick:n.onGroupRemoveAsk,enable:e,actionClass:"pl0 pr0"}]},n.renderProductsTooltip=function(e){return r.a.createElement(f.B,{id:e},e)},n.renderEdit=function(){var e=n.props,t=e.name,a=e.value,i=e.usages,o=e.shared,l=e.pooled,s=e.quantityAffected,c=e.products,u=e.usedProducts,p=e.usaget,d=e.unit,m=e.type,g=e.plays,h=n.state,v=h.isEditMode,y=h.errorInclude,b=h.errorUoM;return r.a.createElement(f.r,{show:v,bsSize:"large"},r.a.createElement(f.r.Header,{closeButton:!1},r.a.createElement(f.r.Title,null,"Edit ",t," ",r.a.createElement("i",null,i.join(", ")))),r.a.createElement(f.r.Body,null,r.a.createElement(f.j,{horizontal:!0,className:"mb0"},r.a.createElement(f.l,{validationState:y.length>0||b.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:2},"Include"),r.a.createElement(f.g,{sm:5},n.isMonetaryBased()?r.a.createElement(en,{onChange:n.onChangeIncludeMonetaryBased,value:a,fieldType:"text"}):r.a.createElement(en,{onChange:n.onChangeInclud,value:a,fieldType:"unlimited"}),y.length>0&&r.a.createElement(f.n,null,y)),!n.isMonetaryBased()&&r.a.createElement(f.g,{sm:3},r.a.createElement(eu,{showSelectTypes:!1,showUnits:!0,enabled:!0,usaget:p,onChangeUnit:n.onChangeUnit,unit:d}),b.length>0&&r.a.createElement(f.n,null,b))),r.a.createElement(f.l,null,r.a.createElement(f.g,{smOffset:2,sm:9},r.a.createElement(f.f,{checked:o,onChange:n.onChangeShared},"Share with all account's subscribers",r.a.createElement(Ii,{contents:ji.shared_desc})))),r.a.createElement(f.l,null,r.a.createElement(f.g,{smOffset:2,sm:9},r.a.createElement(f.f,{disabled:!o,checked:l,onChange:n.onChangePooled},"Includes is pooled?",r.a.createElement(Ii,{contents:ji.pooled_desc})))),"service"===m&&r.a.createElement(f.l,null,r.a.createElement(f.g,{smOffset:2,sm:9},r.a.createElement(f.f,{checked:s,onChange:n.onChangeQuantityAffected},"Multiply by Service Quantity",r.a.createElement(Ii,{contents:ji.quantityAffected_desc})))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:2},"Products"),r.a.createElement(f.g,{sm:9},r.a.createElement("div",{style:{marginTop:10,minWidth:250,width:"100%",minHeight:42}},r.a.createElement(wm,{products:c,usages:i,existingProducts:u.toList(),onChangeGroupRates:n.onChangeGroupRates,plays:g})))))),r.a.createElement(f.r.Footer,null,r.a.createElement(f.c,{onClick:n.toggleBoby,bsStyle:"primary",bsSize:"small",style:{minWidth:90}},"OK")))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.value,a=e.usages,i=e.shared,o=e.pooled,l=e.quantityAffected,s=e.products,c=e.unit,u=this.state.showConfirm,p="Are you sure you want to remove ".concat(t," group?"),d=i?"Yes":"No",m=o?"Yes":"No",g=l?"Yes":"No",h=s.join(", "),v=F.a.titleCase(n),y=this.renderProductsTooltip(h),b=this.getListActions();return r.a.createElement("tr",{className:"List"},r.a.createElement("td",{className:"td-ellipsis"},t),r.a.createElement("td",{className:"td-ellipsis"},a.join(", ")),r.a.createElement("td",{className:"td-ellipsis"},v),r.a.createElement("td",{className:"td-ellipsis"},c),r.a.createElement("td",{className:"td-ellipsis"},r.a.createElement(f.t,{placement:"left",overlay:y},r.a.createElement("span",null,h))),r.a.createElement("td",{className:"td-ellipsis text-center"},d),r.a.createElement("td",{className:"td-ellipsis text-center"},m),r.a.createElement("td",{className:"td-ellipsis text-center"},g),r.a.createElement("td",{className:"text-right row pr0 pl0"},r.a.createElement(Xe,{actions:b}),r.a.createElement(Ke,{onOk:this.onGroupRemoveOk,onCancel:this.onGroupRemoveCancel,show:u,message:p,labelOk:"Yes"}),this.renderEdit()))}}]),t}(a.Component);Fm.defaultProps={products:g.c.List(),usedProducts:g.c.List(),shared:!1,pooled:!1,quantityAffected:!1,mode:"create",plays:"",unit:"",usaget:"",usageTypes:g.c.List(),type:""};var Pm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state=Object.assign({},t.defaultState),n.errors={name:{required:"Group name is required",exist:"Group name already exists",allowedCharacters:"Group name contains illegal characters, name should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"},usage:{required:"Usage type is required",exist:"Group with same name and usage type already exists"},unit:{required:"Unit is required"},include:{required:"Include is required",allowedCharacters:"Include must be positive number or Unlimited",allowedCharactersMonetary:"Include must be positive number"},products:{required:"Products is required",exist:"Product(s) already exist in another group : "}},n.validateStep=function(e){var t=n.state.steps;switch(e){case t.get("SetNameAndType",{index:-1}).index:var a=n.props.existinGrousNames,r=n.errors.name,i=n.state.name;return""===i?(n.setState({error:r.required}),!1):a.includes(i)?(n.setState({error:r.exist}),!1):!!jm(i)||(n.setState({error:r.allowedCharacters}),!1);case t.get("SetUsageType",{index:-1}).index:var o=n.errors,l=o.usage,s=o.unit,c=n.state,u=c.usages,p=c.unit;return u.includes("")?(n.setState({error:l.required}),!1):""!==p||(n.setState({error:s.required}),!1);case t.get("SetIncludes",{index:-1}).index:var d=n.errors.include,m=n.state.include;return""===m?(n.setState({error:d.required}),!1):!!Rm(m)||(n.setState({error:d.allowedCharacters}),!1);case t.get("SetProducts",{index:-1}).index:var g=n.props.usedProducts,f=n.errors.products,h=n.state.products;if(h.size<1)return n.setState({error:f.required}),!1;var v=h.filter(function(e){return g.includes(e)});return!v.size||(n.setState({error:f.exist+v.join(", ")}),!1);default:return!0}},n.onChangeGroupName=function(e){var t=e.target.value.toUpperCase(),a=t.length&&!jm(t)?n.errors.name.allowedCharacters:"";n.setState({name:t,error:a})},n.onChangeShared=function(e){var t=e.target.checked;t?n.setState({shared:t}):n.setState({shared:t,pooled:!1})},n.onChangePooled=function(e){var t=e.target.checked;n.setState({pooled:t})},n.onChangeQuantityAffected=function(e){var t=e.target.checked;n.setState({quantityAffected:t})},n.onChangeUnit=function(e){n.setState({unit:e,error:""})},n.onChangeInclud=function(e){var t=Rm(e)?"":n.errors.include.allowedCharacters,a=R()(e)?parseFloat(e):e;n.setState({include:a,error:t})},n.onChangeIncludeMonetaryBased=function(e){var t=e.target.value,a=xm(t)?"":n.errors.include.allowedCharactersMonetary,r=R()(t)?parseFloat(t):t;n.setState({include:r,error:a})},n.onChangeGroupRates=function(e){n.setState({products:g.c.List(e),error:""})},n.handlePrev=function(){var e=n.state.stepIndex;e>0&&n.setState({stepIndex:e-1,error:""})},n.handleNext=function(){var e=n.state.stepIndex;n.validateStep(e)&&n.setState({stepIndex:e+1})},n.resetState=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n.setState(Object.assign({},t.defaultState,{open:e}))},n.handleCancel=function(){n.resetState(!1)},n.handleFinish=function(){var e=n.state,t=e.stepIndex,a=e.name,r=e.usages,i=e.unit,o=e.include,l=e.products,s=e.shared,c=e.pooled,u=e.quantityAffected;n.validateStep(t)&&(n.props.addGroup(a,r,i,o,s,c,u,l),n.resetState(!1))},n.handleReset=function(){n.resetState()},n.handleToggleBoby=function(){n.setState({open:!n.state.open})},n.noMoreOptions=function(){var e=n.state,t=e.usagesPropertyType,a=e.usages,r=n.props.usageTypesData.filter(function(e){return t===e.get("property_type","")});return a.size>=r.size},n.onChangeBasedOn=function(e){var t,a=n.props.usageTypesData,r="monetary"===e.target.value,i="";r?(i="cost",t=g.c.Map({SetNameAndType:{index:0,label:"Set Name & Type"},SetIncludes:{index:1,label:"Set Includes"},SetProducts:{index:2,label:"Set Products"}})):t=g.c.Map({SetNameAndType:{index:0,label:"Set Name & Type"},SetUsageType:{index:1,label:"Set Usage Type"},SetIncludes:{index:2,label:"Set Includes"},SetProducts:{index:3,label:"Set Products"}}),n.setState({monetaryBased:r,steps:t,usages:g.c.List([i]),usagesPropertyType:ve(a,i),unit:"",products:g.c.List(),error:""})},n.onClickAddUnitType=function(){var e=n.state.usages;n.setState({usages:e.push("")})},n.onRemoveUnitType=function(e){return function(){var t=n.state.usages;n.setState({usages:t.delete(e)})}},n.onChangeUnitType=function(e){return function(t){var a=n.props.usageTypesData,r=n.state.usages;if(0===e){var i=ve(a,t);n.setState({usages:g.c.List([t]),usagesPropertyType:i,unit:"",products:g.c.List(),error:""})}else n.setState({usages:r.set(e,t),error:""})}},n.filterUsageTypes=function(e){return function(t){var a=n.state,r=a.usages,i=a.usagesPropertyType;return[-1,e].includes(r.findIndex(function(e){return e===t.get("usage_type","")}))&&(""===i||t.get("property_type","")===i)}},n.getUsagesLabel=function(){return n.state.usages.map(function(e){return F.a.sentenceCase(e)}).join(", ")},n.getStepContent=function(e){var t=n.props,a=t.usedProducts,i=t.currency,o=t.propertyTypes,l=t.usageTypesData,s=t.type,c=t.plays,u=n.state,p=u.name,d=u.products,m=u.include,g=u.usages,h=u.unit,v=u.shared,y=u.pooled,b=u.quantityAffected,E=u.error,C=u.monetaryBased,_=u.steps,O=a.push.apply(a,Object(w.a)(d)),S=C?"Total ".concat(Nu()(i)," included"):r.a.createElement(r.a.Fragment,null,ye(o,l,g.get(0,""),h)," includes",r.a.createElement("br",null)," (",n.getUsagesLabel(),")");switch(e){case _.get("SetNameAndType",{index:-1}).index:return[r.a.createElement(f.l,{key:"group_name",validationState:E.length>0?"error":null,className:"mb10"},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Name",r.a.createElement(Ii,{contents:ji.name})),r.a.createElement(f.g,{sm:8},r.a.createElement(f.k,{type:"text",placeholder:"Enter Group Name..",value:p,onChange:n.onChangeGroupName}),E.length>0&&r.a.createElement(f.n,null,E))),r.a.createElement(f.l,{key:"group_type",validationState:E.length>0?"error":null,style:{marginBottom:8}},r.a.createElement(f.g,{smOffset:3,sm:8},r.a.createElement(en,{fieldType:"radio",name:"based-on",id:"usage-based",value:"usage",onChange:n.onChangeBasedOn,checked:!C,label:"\xa0Usage based"}),r.a.createElement(en,{fieldType:"radio",name:"based-on",id:"monetary-based",value:"monetary",checked:C,onChange:n.onChangeBasedOn,label:"\xa0Monetary based"})))];case _.get("SetUsageType",{index:-1}).index:return r.a.createElement("div",null,g.map(function(e,t){return r.a.createElement(f.l,{validationState:E.length>0?"error":null,key:"usages_".concat(e,"_").concat(t)},r.a.createElement(f.g,{componentClass:f.h,sm:3},0===t?"Unit Type/s":""),r.a.createElement(f.g,{sm:8},r.a.createElement(eu,{usaget:e,unit:h,onChangeUsaget:n.onChangeUnitType(t),onChangeUnit:n.onChangeUnit,showUnits:0===t,showAddButton:0===t,usagetFilter:n.filterUsageTypes(t)})),0!==t&&r.a.createElement(f.g,{sm:1,className:"pr0 pl0"},r.a.createElement(f.c,{onClick:n.onRemoveUnitType(t),bsStyle:"link",className:"pl0"},r.a.createElement("i",{className:"fa fa-fw danger-red fa-trash-o"}))))}),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3}),r.a.createElement(f.g,{sm:8},r.a.createElement(Je,{onClick:n.onClickAddUnitType,label:"Additional",disabled:""===g.get(0,"")||n.noMoreOptions()}))));case _.get("SetIncludes",{index:-1}).index:return[r.a.createElement(f.l,{validationState:E.length>0?"error":null,key:"".concat(g.get(0,""),"_includes"),className:"mb10"},r.a.createElement(f.g,{componentClass:f.h,sm:3},S),r.a.createElement(f.g,{sm:7},C?r.a.createElement(en,{onChange:n.onChangeIncludeMonetaryBased,value:m,fieldType:"text"}):r.a.createElement(en,{onChange:n.onChangeInclud,value:m,fieldType:"unlimited"}),E.length>0&&r.a.createElement(f.n,null,E))),r.a.createElement(f.l,{key:"".concat(g.get(0,""),"_shared"),className:"mb10"},r.a.createElement(f.g,{smOffset:3,sm:8},r.a.createElement(f.f,{checked:v,onChange:n.onChangeShared},"Share with all account's subscribers",r.a.createElement(Ii,{contents:ji.shared_desc}))),r.a.createElement(f.g,{smOffset:3,sm:8},r.a.createElement(f.f,{disabled:!v,checked:y,onChange:n.onChangePooled},"Includes is pooled?",r.a.createElement(Ii,{contents:ji.pooled_desc}))),"service"===s&&r.a.createElement(f.g,{smOffset:3,sm:8},r.a.createElement(f.f,{checked:b,onChange:n.onChangeQuantityAffected},"Multiply by Service Quantity",r.a.createElement(Ii,{contents:ji.quantityAffected_desc}))))];case _.get("SetProducts",{index:-1}).index:return r.a.createElement(f.l,{validationState:E.length>0?"error":null},C?r.a.createElement(f.g,{componentClass:f.h,sm:3},"Products"):r.a.createElement(f.g,{componentClass:f.h,sm:3,style:{paddingTop:2}},"Products of type/s ",r.a.createElement(Ii,{contents:ji.products}),r.a.createElement("br",null),"(",n.getUsagesLabel(),")"),r.a.createElement(f.g,{sm:8},r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(wm,{products:d,usages:g,onChangeGroupRates:n.onChangeGroupRates,existingProducts:O,plays:c})),E.length>0&&r.a.createElement(f.n,null,E)));default:return"..."}},n.getSteps=function(){return n.state.steps.sort(function(e){return e.index}).map(function(e){return{title:e.label}}).toList().toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.stepIndex,n=e.open,a=e.name,i=e.steps,o=this.props.modalTitle;return a.length&&(o+=" - ".concat(a)),r.a.createElement("div",null,r.a.createElement(Je,{onClick:this.handleToggleBoby,type:"Group",label:"Create New"}),r.a.createElement(f.r,{show:n,keyboard:!1,bsSize:"large"},r.a.createElement(f.r.Header,{closeButton:!0,onHide:this.handleCancel},r.a.createElement(f.r.Title,null,o)),r.a.createElement(f.r.Body,{style:{minHeight:235}},r.a.createElement(Si,{activeIndex:t,steps:this.getSteps()}),r.a.createElement("hr",{style:{margin:"20px -20px 35px -20px"}}),r.a.createElement(f.j,{horizontal:!0,className:"mb0"},this.getStepContent(t))),r.a.createElement(f.r.Footer,null,r.a.createElement(f.c,{bsSize:"small",onClick:this.handlePrev,style:{marginRight:9,minWidth:90}},r.a.createElement("i",{className:"fa fa-angle-left"}),"\xa0Back"),t===i.count()-1?r.a.createElement(f.c,{bsSize:"small",onClick:this.handleFinish,style:{minWidth:90},bsStyle:"primary"},"Add"):r.a.createElement(f.c,{bsSize:"small",onClick:this.handleNext,style:{minWidth:90}},"Next\xa0",r.a.createElement("i",{className:"fa fa-angle-right"})))))}}]),t}(a.Component);Pm.defaultProps={usedProducts:g.c.List(),modalTitle:"Create New Group",allGroupsProductsKeys:g.c.List(),existinGrousNames:g.c.List(),currency:"USD",usageTypesData:g.c.List(),propertyTypes:g.c.List(),type:"",plays:""},Pm.defaultState={name:"",usages:g.c.List([""]),usagesPropertyType:"",unit:"",include:"",products:g.c.List(),shared:!1,pooled:!1,quantityAffected:!1,error:"",stepIndex:0,open:!1,monetaryBased:!1,steps:g.c.Map({SetNameAndType:{index:0,label:"Set Name & Type"},SetUsageType:{index:1,label:"Set Usage Type"},SetIncludes:{index:2,label:"Set Includes"},SetProducts:{index:3,label:"Set Products"}})};var Mm=Object(l.connect)(function(e,t){return{currency:Mn(e,t),usageTypesData:Un(e,t),propertyTypes:Vn(e,t)}})(Pm),Am=function(e){return{type:"PLAN_GOT",plan:e}},Dm=function(e){return{type:"REMOVE_GROUP_PLAN",groupName:e}},Lm=function(e,t,n,a,r,i,o,l){return{type:"ADD_GROUP_PLAN",groupName:e,usages:t,unit:n,value:a,shared:r,pooled:i,quantityAffected:o,products:l}},Um=function(e,t){return{type:"PLAN_UPDATE_FIELD_VALUE",path:e,value:t}},Vm=function(e){return{type:"PLAN_REMOVE_FIELD",path:e}},Bm=function(e,t){return{type:"PLAN_UPDATE_PLAN_CYCLE",index:e,value:t}},qm=function(){return{type:"PLAN_ADD_TARIFF",trial:arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},zm=function(e){return{type:"PLAN_REMOVE_TARIFF",index:e}},Hm=function(){return{type:"PLAN_CLONE_RESET",uniquefields:["name"]}},Ym=function(e,t,n){return{type:"ADD_USAGET_INCLUDE",ppIncludesName:e,ppIncludesExternalId:t,unitLabel:n}},Gm=function(e,t,n){var a="prepaid"===t.get("connection_type",""),r=e(),i=Un(r),o=Vn(r),l=r.list.get("pp_includes",g.c.List()),s=_e(o,i,t,n),c=a?function(e,t,n,a){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=a.get("pp_threshold",g.c.Map()).withMutations(function(a){a.forEach(function(i,o){var l=n.find(function(e){return e.get("external_id","")===parseInt(o)})||g.c.Map(),s=l.get("charging_by_usaget_unit",!1);if(s){var c=l.get("charging_by_usaget",""),u=be(e,t,c,s,i,r);a.set(o,parseFloat(u))}})});return i.isEmpty()?g.c.Map():i}(o,i,l,t,n):null,u=a?function(e,t,n,a){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=a.get("notifications_threshold",g.c.Map()).withMutations(function(a){a.forEach(function(i,o){var l=n.find(function(e){return e.get("external_id","")===parseInt(o)})||g.c.Map(),s=l.get("charging_by_usaget_unit",!1);if(s){var c=l.get("charging_by_usaget","");i.forEach(function(n,i){var l=n.get("value",""),u=be(e,t,c,s,l,r);a.setIn([o,i,"value"],parseFloat(u))})}})});return i.isEmpty()?g.c.Map():i}(o,i,l,t,n):null,p=a?null:we(o,i,t,n);return t.withMutations(function(e){e.set("rates",s),a?(c.isEmpty()||e.set("pp_threshold",c),u.isEmpty()||e.set("notifications_threshold",u)):p.isEmpty()||e.set("include",p)})},Km=function(e,t,n){var a=e(),r=Un(a),i=function(e,t,n,a){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=a.get("include",g.c.Map()).withMutations(function(a){a.forEach(function(i,o){var l=i.get("pp_includes_external_id",""),s=n.find(function(e){return e.get("external_id","")===parseInt(l)})||g.c.Map(),c=s.get("charging_by_usaget_unit",!1);if(c){var u=s.get("charging_by_usaget",""),p=i.get("usagev"),d=be(e,t,u,c,p,r);a.setIn([o,"usagev"],parseFloat(d))}})});return i.isEmpty()?g.c.Map():i}(Vn(a),r,a.list.get("pp_includes",g.c.List()),t,n);return t.withMutations(function(e){i.isEmpty()||e.set("include",i)})},Wm=function(e,t){return function(n,a){var r=Gm(a,e,!0);return n(Cl("plans",r,t))}},Jm=function(e,t){return function(n,a){var r=Km(a,e,!0);return n(Cl("prepaidgroups",r,t))}},Qm=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n,a){n(Aa());var r=function(e){return Rr("plans",e)}(e);return ir(r).then(function(e){var r=e.data[0].data.details[0];r.originalValue=r.from;var i=g.c.fromJS(r),o=Gm(a,i,!1).toJS();return n(Am(o)),t&&n(vl("plan",o)),n(tr(e))}).catch(function(e){return n(nr(e,"Error retreiving plan"))})}},$m=function(e){return function(t,n){t(Aa());var a=function(e){return Rr("prepaidgroups",e)}(e);return ir(a).then(function(e){var a=e.data[0].data.details[0];a.originalValue=a.from;var r=g.c.fromJS(a),i=Km(n,r,!1).toJS();return t(Am(i)),t(tr(e))}).catch(function(e){return t(nr(e,"Error retreiving prepaid group"))})}},Zm=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onGroupAdd=function(e,t,a,r,i,o,l,s){var c=n.state,u=c.usedProducts,p=c.existingGroups;n.setState({usedProducts:u.push.apply(u,Object(w.a)(s)),existingGroups:p.push(e)}),n.props.onGroupAdd(e,t,a,r,i,o,l,s)},n.onGroupRemove=function(e,t){var a=n.state,r=a.usedProducts,i=a.existingGroups;n.setState({usedProducts:r.filter(function(e){return!t.includes(e)}),existingGroups:i.filter(function(t){return t!==e})}),n.props.onGroupRemove(e)},n.onChangeGroupProducts=function(e,t){var a=n.state.usedProducts;n.setState({usedProducts:a.push.apply(a,Object(w.a)(t))});var r=["include","groups",e,"rates"];n.props.onChangeFieldValue(r,t)},n.renderGroups=function(){var e=n.state.usedProducts,t=n.props,a=t.includeGroups,i=t.mode,o=t.usageTypesData,l=t.propertyTypes;return a.isEmpty()?r.a.createElement("tr",null,r.a.createElement("td",{colSpan:"10",className:"text-center"},"No Groups")):a.map(function(t,a){var s=n.props.plays,c=t.get("account_shared",!1),u=t.get("account_pool",!1),p=t.get("quantity_affected",!1),d=t.get("rates",g.c.List()),m=Ie(t),f=ye(l,o,Oe(t),Ne(t)),h=ke(t),v=Se(t),y=Oe(t);return r.a.createElement(Fm,{key:a,mode:i,name:a,value:h,usages:m,unit:f,shared:c,pooled:u,quantityAffected:p,products:d,usedProducts:e.toList(),onChangeFieldValue:n.props.onChangeFieldValue,onGroupRemove:n.onGroupRemove,onChangeGroupProducts:n.onChangeGroupProducts,usaget:y,usageTypes:v,type:n.props.type,plays:s})}).toList().toArray()},n.renderHeader=function(){return r.a.createElement("tr",null,r.a.createElement("th",{style:{width:150}},"Name"),r.a.createElement("th",{style:{width:100}},"Unit Type/s"),r.a.createElement("th",{style:{width:100}},"Include"),r.a.createElement("th",{style:{width:100}},"Unit"),r.a.createElement("th",null,"Products"),r.a.createElement("th",{className:"text-center",style:{width:80}},"Shared"),r.a.createElement("th",{className:"text-center",style:{width:80}},"Pooled"),r.a.createElement("th",{className:"text-center",style:{width:80}},"Quantitative"),r.a.createElement("th",{style:{width:60}}))};var a=g.c.Set().withMutations(function(t){e.includeGroups.forEach(function(e){t.union(e.get("rates",g.c.List()))})}).toList();return n.state={existingGroups:g.c.List(),usedProducts:a},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.usageTypes.isEmpty()&&this.props.dispatch(il("usage_types")),ir(Ur()).then(function(t){var n=g.c.Set().withMutations(function(e){t.data.forEach(function(t){t.data.details.forEach(function(t){t.include&&t.include.groups&&e.union(Object.keys(t.include.groups))})})}).toList();e.setState({existingGroups:n})})}},{key:"render",value:function(){var e=this.props,t=e.mode,n=e.plays,a=this.state,i=a.existingGroups,o=a.usedProducts,l="view"!==t;return r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Groups ",r.a.createElement(Ii,{contents:Ni.include_groups}))},r.a.createElement(f.z,{style:{tableLayout:"fixed"}},r.a.createElement("thead",null,this.renderHeader()),r.a.createElement("tbody",null,this.renderGroups()))),l&&r.a.createElement(Mm,{existinGrousNames:i,usedProducts:o,addGroup:this.onGroupAdd,type:this.props.type,plays:n})))}}]),t}(a.Component);Zm.defaultProps={includeGroups:g.c.Map(),usageTypes:g.c.List(),usageTypesData:g.c.List(),propertyTypes:g.c.List(),mode:"create",type:"",plays:""};var Xm=Object(l.connect)(function(e,t){return{includeGroups:t.includeGroups||void 0,usageTypes:Dn(e,t),propertyTypes:Vn(e,t),usageTypesData:Un(e,t)}})(Zm),eg=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeServices=function(e){var t=e.length?e.split(","):[];n.props.onChangeFieldValue(["include","services"],Object(g.a)(t))},n.filterByPlay=function(e){var t=n.props.plays,a=e.get("play",Object(g.a)());return!(t&&!t.isEmpty()&&!a.isEmpty())||!t.filter(function(e){return a.includes(e)}).isEmpty()},n.getServicesOptions=function(){return n.props.services.filter(n.filterByPlay).map(function(e){return{value:e.get("name",""),label:e.get("name","")}}).toArray()},n.renderEditableServices=function(){var e=n.props.includedServices,t=r.a.createElement("h3",null,"Select included services ",r.a.createElement(Ii,{contents:Ni.included_services}));return r.a.createElement(f.v,{header:t},r.a.createElement(en,{fieldType:"select",multi:!0,value:e.join(","),onChange:n.onChangeServices,options:n.getServicesOptions()}))},n.renderNonEditableServices=function(){var e=n.props.includedServices,t=r.a.createElement("h3",null,"Services ",r.a.createElement(Ii,{contents:Ni.included_services}));return r.a.createElement(f.v,{header:t},r.a.createElement("div",null,e.size?e.join(", "):"No included services"))},n.renderServices=function(){return"view"!==n.props.mode?n.renderEditableServices():n.renderNonEditableServices()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(fr("services_keys",xr("services",{name:1,play:1},{quantitative:{$ne:!0},balance_period:{$exists:!1}})))}},{key:"render",value:function(){return r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,null,this.renderServices())))}}]),t}(a.Component);eg.defaultProps={includedServices:Object(g.a)(),mode:"create",services:Object(g.a)(),plays:Object(g.a)()};var tg=Object(l.connect)(function(e){return{services:e.list.get("services_keys")}})(eg),ng=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:parseInt(n.props.activeTab),progress:!1},n.initDefaultValues=function(){var e=n.props,t=e.mode,a=e.item;if("create"===t){var r=S()().add(1,"days").toISOString();n.props.dispatch(Um(["from"],r)),n.props.dispatch(Um(["connection_type"],"postpaid"))}"clone"===t&&(n.props.dispatch(Hm()),n.handleSelectTab(1)),null===a.get("prorated",null)&&n.props.dispatch(Um(["prorated"],!0))},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&te(t,!1)){var a=t.get("name","");n.props.dispatch(Ac("plans","name",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Qm(e,!0)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("name","");n.props.dispatch(xc("plans",e))},n.clearItemsList=function(){n.props.dispatch(Pc("plans"))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onChangeFieldValue=function(e,t){n.props.dispatch(Um(e,t))},n.onRemoveFieldValue=function(e){n.props.dispatch(Vm(e))},n.onDeleteField=function(e,t){n.props.dispatch(Um(e,t))},n.onPlanCycleUpdate=function(e,t){n.props.dispatch(Bm(e,t))},n.onPlanTariffAdd=function(e){n.props.dispatch(qm(e))},n.onPlanTariffRemove=function(e){n.props.dispatch(zm(e))},n.onGroupAdd=function(e,t,a,r,i,o,l,s){n.props.dispatch(Lm(e,t,a,r,i,o,l,s))},n.onGroupRemove=function(e){n.props.dispatch(Dm(e))},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.setState({progress:!0}),n.props.dispatch(Wm(t,a)).then(n.afterSave)},n.afterSave=function(e){var t=n.props.mode;if(n.setState({progress:!1}),e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Wa("The plan was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleBack=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&n.clearItemsList();var e=Y(["systemItems",t.entityName,"itemsType"],"");n.props.router.push("/".concat(e))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if(["clone","create"].includes(e)){var n=X(e,t.entityName);this.props.dispatch(ro(n))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var n=e.item,a=e.itemId,r=e.mode,i=this.props,o=i.item,l=i.itemId,s=i.mode;if(r!==s||te(n)!==te(o)){var c=X(r,t.entityName,n);this.props.dispatch(ro(c))}(a!==l||r!==s&&"clone"===r)&&this.fetchItem(a)}},{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,t.item)||!g.c.is(this.props.revisions,t.revisions)||this.props.activeTab!==e.activeTab||this.props.itemId!==e.itemId||this.props.mode!==e.mode}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"PLAN_CLEAR"})}},{key:"render",value:function(){var e=this.state,n=e.progress,a=e.activeTab,i=this.props,o=i.item,l=i.mode,s=i.revisions;if("loading"===l)return r.a.createElement(_,{onClick:this.handleBack});var c="view"!==l,u=o.get("rates",g.c.Map()),p=o.getIn(["include","services"],g.c.List()),d=o.getIn(["include","groups"],g.c.Map()),m=o.get("play",g.c.List());return r.a.createElement("div",{className:"PlanSetup"},r.a.createElement(f.v,null,r.a.createElement(Mu,{itemName:"plan",revisions:s,item:o,mode:l,onChangeFrom:this.onChangeFieldValue,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.A,{activeKey:a,animation:!1,id:"PlanTab",onSelect:this.handleSelectTab},r.a.createElement(f.y,{title:"Details",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(vm,{mode:l,plan:o,onChangeFieldValue:this.onChangeFieldValue,onRemoveField:this.onRemoveFieldValue,onPlanCycleUpdate:this.onPlanCycleUpdate,onPlanTariffAdd:this.onPlanTariffAdd,onPlanTariffRemove:this.onPlanTariffRemove}))),r.a.createElement(f.y,{title:"Override Product Price",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Nm,{itemName:"plan",mode:l,planRates:u,onChangeFieldValue:this.onChangeFieldValue,plays:m.join(",")}))),r.a.createElement(f.y,{title:"Included Products",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Xm,{mode:l,plays:m.join(","),includeGroups:d,onChangeFieldValue:this.onChangeFieldValue,onGroupAdd:this.onGroupAdd,onGroupRemove:this.onGroupRemove}))),r.a.createElement(f.y,{title:"Included Services",eventKey:4},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(tg,{mode:l,plays:m,includedServices:p,onChangeFieldValue:this.onChangeFieldValue}))),r.a.createElement(f.y,{title:"Tax",eventKey:5},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Vp,{tax:o.get("tax"),mode:l,itemName:t.entityName,onFieldUpdate:this.onChangeFieldValue,onFieldRemove:this.onRemoveFieldValue})))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!c,cancelLabel:c?void 0:"Back",progress:n}))}}]),t}(a.Component);ng.defaultProps={item:g.c.Map(),revisions:g.c.List(),activeTab:1},ng.entityName="plan";var ag=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:pi(e,t,ng.entityName),item:ui(e,t,ng.entityName),mode:di(e,t,ng.entityName),activeTab:ri(e,t,ng.entityName),revisions:ai(e,t,ng.entityName)}})(ng)),rg=function(){return r.a.createElement(qc,{itemsType:"discounts",itemType:"discount",filterFields:[{id:"description",placeholder:"Title"},{id:"key",placeholder:"Key"}],tableFields:[{id:"description",title:"Title",sort:!0},{id:"key",title:"Key",sort:!0},{id:"discount_type",title:"Type",sort:!0}],projectFields:{key:1,description:1,discount_type:1},showRevisionBy:"key",actions:[{type:"edit"}]})},ig=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showAdvancedEdit:!1},n.isOldStructure=function(){var e=n.props,t=e.name,a=e.discount.getIn(["discount_subject","service",t],g.c.Map());return!g.c.Map.isMap(a)},n.onChangeValue=function(e){var t=n.props,a=t.name,r=t.discount;if(null!==e){var i=R()(e)?parseFloat(e):e,o=r.getIn(["discount_subject","service",a],g.c.Map()),l=n.isOldStructure()?g.c.Map({value:i}):o.set("value",i);n.props.onChange(a,l)}else n.props.onChange(a,null)},n.onChangeAmount=function(e){var t=n.props,a=t.discount,r=t.name,i=a.getIn(["discount_subject","service",r],"");if(null!==e&&""!==e){var o=R()(e)?parseFloat(e):e;o=Number.isInteger(o)?o:"";var l=g.c.Map({name:"quantity",value:o}),s=g.c.Map({name:"recurring_by_quantity",params:g.c.List([l])}),c=g.c.Map({value:"",operations:g.c.List([s])});if(n.isOldStructure())n.props.onChange(r,c.set("value",i));else{var u=i.get("operations",g.c.List()),p=u.findIndex(function(e){return"recurring_by_quantity"===e.get("name")});if(-1!==p){var d=u.getIn([p,"params"],g.c.List()).findIndex(function(e){return"quantity"===e.get("name","")});if(-1!==d){var m=i.updateIn(["operations",p,"params",d],g.c.Map(),function(e){return e.set("value",o)});n.props.onChange(r,m)}else{var f=i.updateIn(["operations",p,"params"],g.c.List(),function(e){return e.push(l)});n.props.onChange(r,f)}}else{var h=i.updateIn(["operations"],g.c.List(),function(e){return e.push(s)});n.props.onChange(r,h)}}}else n.props.onChange(r,n.removeQuantity(i))},n.onCloseModal=function(){n.setState({showAdvancedEdit:!1})},n.onOpenModal=function(){n.setState({showAdvancedEdit:!0})},n.removeQuantity=function(e){var t=["operations"],n=e.getIn(t,g.c.List()).findIndex(function(e){return"recurring_by_quantity"===e.get("name","")}),a=[].concat(t,[n,"params"]),r=-1===n?-1:e.getIn(a).findIndex(function(e){return"quantity"===e.get("name","")}),i=[].concat(Object(w.a)(a),[r]),o=-1!==r?e.deleteIn(i):e,l=o.getIn(a,g.c.Map()).isEmpty(),s=-1!==n&&l?o.deleteIn(a):o,c=s.getIn(a,g.c.Map()).size,u=-1!==n&&c<2?s.deleteIn([].concat(t,[n])):s;return u.getIn(t,g.c.Map()).isEmpty()?u.deleteIn(t):u},n.getDiscountValue=function(){var e=n.props,t=e.name,a=e.discount;return n.isOldStructure()?a.getIn(["discount_subject","service",t],""):a.getIn(["discount_subject","service",t,"value"],"")},n.getDiscountAmount=function(){var e=n.props,t=e.discount,a=e.name;return t.getIn(["discount_subject","service",a,"operations"],g.c.List()).find(function(e){return"recurring_by_quantity"===e.get("name")},null,g.c.Map()).get("params",g.c.List()).find(function(e){return"quantity"===e.get("name","")},null,g.c.Map()).get("value","")},n.renderAdvancedEdit=function(){var e=n.state.showAdvancedEdit,t=n.props,a=t.label,i=t.mode,o=t.isQuantitative;if(!e)return null;var l="Edit ".concat(a," service value options"),s="view"!==i;return r.a.createElement(Ye,{show:!0,onOk:n.onCloseModal,title:l},r.a.createElement(f.j,{horizontal:!0},o&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:11,smOffset:1},r.a.createElement(en,{fieldType:"toggeledInput",value:n.getDiscountAmount(),disabledDisplayValue:"",disabledValue:"",onChange:n.onChangeAmount,label:"Apply discount value ".concat(n.getDiscountValue()," for every"),editable:s,suffix:"units",style:{width:300},inputProps:{fieldType:"number",style:{width:85},min:1}})))))},n.renderQuantitativeDescription=function(){var e=n.getDiscountAmount(),t=n.getDiscountValue();return["",null].includes(e)&&t?r.a.createElement(f.n,null,"Amount will be multiplied by the subscriber's service quantity"):t?r.a.createElement(f.n,null,"Apply discount value ",t," for every ",e," units"):null},n.renderSuffix=function(){var e=n.props,t=e.discount,a=e.currency;return"percentage"===t.get("discount_type","")?"%":Nu()(a)},n.getActions=function(){var e=n.props,t=e.mode,a=e.isQuantitative,r=n.getDiscountValue();return[{type:"settings",onClick:n.onOpenModal,show:"view"!==t&&a,actionSize:"small",enable:![null,""].includes(r),helpText:"Advanced Options"}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.label,a=e.mode,i=e.discount,o=e.isQuantitative;if(""===t)return null;var l="view"!==a,s=this.getDiscountValue();if(!l&&null===s)return null;var c=this.getActions(),u=c.reduce(function(e,t){return!1!==t.show||e},!1);return r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},n),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(f.o,{style:{width:"100%"}},r.a.createElement(en,{value:s,onChange:this.onChangeValue,label:"Discount by",fieldType:"toggeledInput",editable:l,suffix:this.renderSuffix(),inputProps:{fieldType:"number"}}),u&&r.a.createElement(f.o.Addon,{style:{padind:0}},r.a.createElement(Xe,{actions:c,data:i}))),o&&this.renderQuantitativeDescription(),this.renderAdvancedEdit()))}}]),t}(a.Component);ig.defaultProps={name:"",label:"",discount:g.c.Map(),isQuantitative:!1,currency:""};var og=ig,lg=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={errors:{name:""},newProductParam:!1},n.onChangeName=function(e){var t=n.props.errorMessages.name.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=Y("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{name:i})}),n.props.onFieldUpdate(["key"],r)},n.onChangeDescription=function(e){var t=e.target.value;n.props.onFieldUpdate(["description"],t)},n.onChangeCycles=function(e){var t=R()(e)?parseFloat(e):e;n.props.onFieldUpdate(["cycles"],t)},n.onChangeProrated=function(e){var t=e.target.value;n.props.onFieldUpdate(["prorated"],t)},n.onChangeLimit=function(e){var t=R()(e)?parseFloat(e):e;n.props.onFieldUpdate(["limit"],t)},n.onChangeAdditionalField=function(e,t){n.props.onFieldUpdate(e,t)},n.onRemoveAdditionalField=function(e){n.props.onFieldRemove(e)},n.onChangeDiscountType=function(e){var t=e.target.value;n.props.onFieldUpdate(["discount_type"],t)},n.onChangePlan=function(e){n.props.onFieldUpdate(["params","plan"],e),n.props.onFieldUpdate(["discount_subject","plan"],null)},n.onChangeService=function(e){var t=n.props.discount,a=g.c.List(e.length?e.split(","):[]);if(a.isEmpty())n.props.onFieldUpdate(["params","service"],null),n.props.onFieldUpdate(["discount_subject","service"],null);else{n.props.onFieldUpdate(["params","service"],a);var r=t.getIn(["discount_subject","service"],g.c.Map()),i=r.isEmpty()?null:r.filter(function(e,t){return a.includes(t)});n.props.onFieldUpdate(["discount_subject","service"],i)}},n.onChangeServiceDiscountValue=function(e,t){n.onChangeDiscountValue(e,t,"service")},n.onChangePlanDiscountValue=function(e,t){n.onChangeDiscountValue(e,t,"plan")},n.onChangeDiscountValue=function(e,t,a){var r=n.props.discount.getIn(["discount_subject",a],g.c.Map());if(null===t)r=r.filter(function(t,n){return n!==e});else{var i=R()(t)?parseFloat(t):t;r=r.set(e,i)}n.props.onFieldUpdate(["discount_subject",a],r)},n.createPlansOptions=function(){return n.props.availablePlans.map(n.createOption).toArray()},n.createServicesOptions=function(){var e=n.props,t=e.discount,a=e.availableServices,r="percentage"===t.get("discount_type","");return a.filter(function(e){return!(r&&e.get("quantitative",!1))}).map(n.createOption).toArray()},n.createOption=function(e){return{value:e.get("name"),label:e.get("description")}},n.renderServivesDiscountValues=function(){var e=n.props,t=e.discount,a=e.availableServices,i=e.mode,o=e.currency;return t.getIn(["params","service"],g.c.List()).map(function(e){var l=n.getLabel(a,e),s=n.isServiceQuantitative(e);return r.a.createElement(og,{key:"".concat(Object(x.paramCase)(e),"-discount-value"),mode:i,discount:t,name:e,label:l,isQuantitative:s,currency:o,onChange:n.onChangeServiceDiscountValue})})},n.getLabel=function(e,t){return e.find(function(e){return e.get("name")===t},null,g.c.Map()).get("description",t)},n.renderPlanDiscountValue=function(){var e=n.props,t=e.discount,a=e.availablePlans,i=e.mode,o=e.currency,l=t.getIn(["params","plan"],"");if(""===l)return null;var s="view"!==i,c=t.getIn(["discount_subject","plan",l],null);if(!s&&null===c)return null;var u=n.getLabel(a,l),p="percentage"===t.get("discount_type","")?r.a.createElement("i",{className:"fa fa-percent"}):Nu()(o);return r.a.createElement(f.l,{key:"".concat(Object(x.paramCase)(l),"-discount-value")},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},u),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{value:c,onChange:function(e){n.onChangePlanDiscountValue(l,e)},label:"Discount by",fieldType:"toggeledInput",editable:s,suffix:p,inputProps:{fieldType:"number"}})))},n.isServiceQuantitative=function(e){return-1!==n.props.availableServices.findIndex(function(t){return t.get("name","")===e&&!0===t.get("quantitative",!1)})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.state.errors,n=this.props,a=n.discount,i=n.mode,o=n.currency,l="view"!==i,s="percentage"===a.get("discount_type",""),c=this.createPlansOptions(),u=this.createServicesOptions(),p=a.getIn(["params","service"],g.c.List()).join(","),d=a.get("prorated",!0),m=a.getIn(["params","service"],g.c.List()).reduce(function(t,n){return!!e.isServiceQuantitative(n)||t},!1),h=m?r.a.createElement("span",null,"Percentage\xa0",r.a.createElement(f.p,{bsStyle:"warning"},"not compatible with quantitative service type.")):"Percentage";return r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,null,r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("Title","discounts"),r.a.createElement(Ii,{contents:xi.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{onChange:this.onChangeDescription,value:a.get("description",""),editable:l}))),["clone","create"].includes(i)&&r.a.createElement(f.l,{validationState:t.name.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("Key","discounts"),r.a.createElement(Ii,{contents:xi.key})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{onChange:this.onChangeName,value:a.get("key",""),disabled:!["clone","create"].includes(i),editable:l}),t.name.length>0&&r.a.createElement(f.n,null,t.name))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("Type","discounts")),r.a.createElement(f.g,{sm:8,lg:9},l?r.a.createElement("span",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(en,{fieldType:"radio",onChange:this.onChangeDiscountType,name:"discount_type",value:"monetary",label:"Monetary",checked:!s})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(en,{fieldType:"radio",onChange:this.onChangeDiscountType,name:"discount_type",value:"percentage",label:h,checked:s,disabled:m}))):r.a.createElement("div",{className:"non-editable-field"},Object(x.titleCase)(a.get("discount_type",""))))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("Cycles","discounts")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{value:a.get("cycles",""),onChange:this.onChangeCycles,fieldType:"unlimited",unlimitedValue:"",unlimitedLabel:"Infinite",editable:l})))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Prorated?"),r.a.createElement(f.g,{sm:8,lg:9,style:{paddingTop:7}},r.a.createElement(en,{value:d,onChange:this.onChangeProrated,fieldType:"checkbox",editable:l}))),r.a.createElement(Vu,{entityName:"discounts",entity:a,onChangeField:this.onChangeAdditionalField,onRemoveField:this.onRemoveAdditionalField,editable:l}),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Discount Conditions")},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("Plan","discounts")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"select",options:c,value:a.getIn(["params","plan"],""),onChange:this.onChangePlan,editable:l}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("Services","discounts")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"select",multi:!0,value:p,options:u,onChange:this.onChangeService,editable:l})))),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Discount Values")},this.renderPlanDiscountValue(),a.getIn(["params","plan"],"").length>0&&r.a.createElement("hr",null),this.renderServivesDiscountValues(),!a.getIn(["params","service"],g.c.List()).isEmpty()&&r.a.createElement("hr",null),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("Discount Overall Limit","discounts")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{suffix:Nu()(o),value:a.get("limit",""),onChange:this.onChangeLimit,fieldType:"unlimited",unlimitedValue:"",editable:l})))))))}}]),t}(a.Component);lg.defaultProps={discount:g.c.Map(),currency:"",availablePlans:g.c.List(),availableServices:g.c.List(),errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var sg=function(){return yl("discount","discount")},cg=function(e,t){return function(n){if("percentage"===e.get("discount_type","")){var a=e.withMutations(function(e){e.get("discount_subject",g.c.Map()).forEach(function(t,n){t.forEach(function(t,a){if(g.c.Map.isMap(e.getIn(["discount_subject",n,a],""))){var r=e.getIn(["discount_subject",n,a,"value"],"");r&&!isNaN(r)&&e.setIn(["discount_subject",n,a,"value"],r/100)}else t&&!isNaN(t)&&e.setIn(["discount_subject",n,a],t/100)})})});return n(Cl("discounts",a,t))}return n(Cl("discounts",e,t))}},ug=function(e,t){return gl("discount",e,t)},pg=function(e){return fl("discount",e)},dg=function(e){return function(t){t(Aa());var n=function(e){return Rr("discounts",e)}(e);return ir(n).then(function(e){var n=e.data[0].data.details[0];return n.originalValue=n.from,"percentage"===n.discount_type&&n.discount_subject&&Object.keys(n.discount_subject).forEach(function(e){Object.keys(n.discount_subject[e]).forEach(function(t){if(isNaN(n.discount_subject[e][t])){if(!isNaN(n.discount_subject[e][t].value)){var a=100*Number(n.discount_subject[e][t].value);n.discount_subject[e][t].value=parseFloat(a.toFixed(2))}}else{var r=100*Number(n.discount_subject[e][t]);n.discount_subject[e][t]=parseFloat(r.toFixed(2))}})}),t(hl("discount",n)),t(tr(e))}).catch(function(e){return t(nr(e,"Error retreiving discount"))})}},mg=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={progress:!1},n.initDefaultValues=function(){var e=n.props,t=e.mode,a=e.item;if("create"===t||"closeandnew"===t&&ee(a,"from").isBefore(S()())){var r=S()().add(1,"days").toISOString();n.onChangeFieldValue(["from"],r)}null===a.get("discount_type",null)&&n.onChangeFieldValue(["discount_type"],"monetary"),null===a.get("prorated",null)&&n.onChangeFieldValue(["prorated"],!0),"clone"===t&&n.props.dispatch(sg())},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&te(t,!1)){var a=t.get("key","");n.props.dispatch(Ac("discounts","key",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(dg(e)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("key","");n.props.dispatch(xc("discounts",e))},n.clearItemsList=function(){var e=Y(["systemItems","discount","itemsType"],"");n.props.dispatch(Pc(e))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onRemoveFieldValue=function(e){n.props.dispatch(pg(e))},n.onChangeFieldValue=function(e,t){var a=Array.isArray(e)?e.join("."):e;""===t&&["limit","cycles","params.plan"].includes(a)?n.props.dispatch(pg(e)):null===t&&["discount_subject.plan","discount_subject.service","params.service"].includes(a)?n.props.dispatch(pg(e)):n.props.dispatch(ug(e,t))},n.afterSave=function(e){n.setState({progress:!1});var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Wa("The discount was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.validate()&&(n.setState({progress:!0}),n.props.dispatch(cg(t,a)).then(n.afterSave))},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Y(["systemItems","discount","itemsType"],"");e&&n.clearItemsList(),n.props.router.push("/".concat(t))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n.validate=function(){var e=n.props.item;if(e.getIn(["params","service"],g.c.List()).isEmpty()&&0===e.getIn(["params","plan"],"").lenght)return n.props.dispatch(Qa("Please select discount conditions")),!1;var t=e.getIn(["discount_subject","service"],g.c.Map()).some(function(e){return null!==e&&""!==e}),a=e.getIn(["discount_subject","plan"],g.c.Map()).some(function(e){return null!==e&&""!==e});return!(!t&&!a)||(n.props.dispatch(Qa("Please set discount value")),!1)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if("create"===e){var t=X(e,"discount");this.props.dispatch(ro(t))}this.initDefaultValues(),this.props.dispatch(fr("available_plans",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:1};return xr("plans",e)}({name:1,description:1}))),this.props.dispatch(fr("available_services",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:1};return xr("services",e)}({name:1,description:1,quantitative:1})))}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=this.props,i=r.item,o=r.itemId,l=r.mode;if(n!==l||te(t)!==te(i)){var s=X(n,"discount",t);this.props.dispatch(ro(s))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"componentWillUnmount",value:function(){this.props.dispatch(bl("discount")),this.props.dispatch(gr("available_plans")),this.props.dispatch(gr("available_services"))}},{key:"render",value:function(){var e=this.state.progress,t=this.props,n=t.item,a=t.mode,i=t.revisions,o=t.availablePlans,l=t.availableServices,s=t.currency;if("loading"===a)return r.a.createElement(_,{onClick:this.handleBack});var c="view"!==a;return r.a.createElement("div",{className:"discount-setup"},r.a.createElement(f.v,null,r.a.createElement(Mu,{itemName:"discount",revisions:i,item:n,mode:a,onChangeFrom:this.onChangeFieldValue,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.v,null,r.a.createElement(lg,{discount:n,mode:a,currency:s,onFieldUpdate:this.onChangeFieldValue,onFieldRemove:this.onRemoveFieldValue,availablePlans:o,availableServices:l})),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!c,cancelLabel:c?void 0:"Back",progress:e}))}}]),t}(a.Component);mg.defaultProps={item:g.c.Map(),currency:"",revisions:g.c.List(),availablePlans:g.c.List(),availableServices:g.c.List()};var gg=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:pi(e,t,"discount"),item:ui(e,t,"discount"),mode:di(e,t,"discount"),revisions:ai(e,t,"discount"),availablePlans:e.list.get("available_plans")||void 0,availableServices:e.list.get("available_services")||void 0,currency:Mn(e,t)||void 0}})(mg)),fg=n(93),hg=n.n(fg),vg=function(e){var t=[{id:"description",title:"Title",sort:!0},{id:"name",title:"Key",sort:!0},{title:"Price",parser:function(e){return e.getIn(["price",0,"price"],"")},sort:!0},{title:"Quantitative",parser:function(e){return e.get("quantitative",!1)?"Yes":"No"},sort:!0},{title:"Period",parser:function(e){var t=je(e);if("default"===t.type){var n=Y("serviceCycleUnlimitedValue","UNLIMITED"),a=e.getIn(["price",0,"to"],"");return a===n?"Infinite":"".concat(a," ").concat(Object(x.titleCase)(hg()("cycle",Number(a))))}return"".concat(t.value," ").concat(Object(x.titleCase)(hg()(t.unit,Number(t.value))))},sort:!0},{id:"play",title:"Play",display:e.isPlaysEnabled,parser:function(e){return e.get("play",g.c.List()).join(", ")}}];return r.a.createElement(qc,{itemsType:"services",itemType:"service",filterFields:[{id:"description",placeholder:"Title"},{id:"name",placeholder:"Key"}],tableFields:t,projectFields:{description:1,price:1,name:1,balance_period:1,quantitative:1,play:1},showRevisionBy:"name",actions:[{type:"edit"}]})};vg.defaultProps={isPlaysEnabled:!1};var yg=Object(l.connect)(function(e,t){return{isPlaysEnabled:jn(e,t)}})(vg),bg=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={errors:{name:""}},n.onChangeName=function(e){var t=n.props.errorMessages.name.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=Y("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{name:i})}),n.props.updateItem(["name"],r)},n.onChangePrice=function(e){var t=e.target.value,a=R()(t)?parseFloat(t):t;n.props.updateItem(["price",0,"price"],a)},n.onChangeCycle=function(e){var t=R()(e)?parseFloat(e):e;n.props.updateItem(["price",0,"to"],t)},n.onChangeProrated=function(e){var t=e.target.value;n.props.updateItem(["prorated"],t)},n.onChangeQuantitative=function(e){var t=e.target.value;n.props.updateItem(["quantitative"],t)},n.onChangePlays=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=""===e?[]:e.split(",");n.props.updateItem(["play"],g.c.List(a)),t&&(n.props.updateItem(["rates"],g.c.Map()),n.props.updateItem(["include","groups"],g.c.Map()))},n.onChangeDescription=function(e){var t=e.target.value;n.props.updateItem(["description"],t)},n.onChangeAdditionalField=function(e,t){n.props.updateItem(e,t)},n.onRemoveAdditionalField=function(e){n.props.onFieldRemove(e)},n.onChangeServicePeriodType=function(e){var t=e.target.value;n.props.updateItem(["balance_period","type"],t)},n.onSelectPeriodUnit=function(e){n.props.updateItem(["balance_period","unit"],e)},n.onChangeBalancePeriod=function(e){var t=e.target.value,a=R()(t)?parseFloat(t):t;n.props.updateItem(["balance_period","value"],a)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,e.item)||this.props.mode!==e.mode}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.item,a=t.mode,i=Y("serviceCycleUnlimitedValue","UNLIMITED"),o="view"!==a,l=n.getIn(["balance_period","unit"],""),s=""===l?"Select unit...":Object(x.titleCase)(hg()(l,Number(n.getIn(["balance_period","value"],2)))),c="default"===n.getIn(["balance_period","type"],"default");return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(Wc,{entity:n,editable:o&&"create"===a,multi:!0,onChange:this.onChangePlays}),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("description",K("service"),Object(x.sentenceCase)("title")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ii,{contents:wi.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{value:n.get("description",""),onChange:this.onChangeDescription,editable:o}))),["clone","create"].includes(a)&&r.a.createElement(f.l,{validationState:e.name.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("name",K("service"),Object(x.sentenceCase)("key")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ii,{contents:wi.name})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{value:n.get("name",""),onChange:this.onChangeName,editable:o}),e.name.length>0&&r.a.createElement(f.n,null,e.name))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("price",K("service"),Object(x.sentenceCase)("price")),r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{value:n.getIn(["price",0,"price"],""),onChange:this.onChangePrice,fieldType:"price",editable:o}))),["clone","create"].includes(a)&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G("period_type",K("service"),"Eligibility Period"),r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("span",{className:"inline mr10"},r.a.createElement(en,{fieldType:"radio",onChange:this.onChangeServicePeriodType,name:"service_period_type",value:"default",label:r.a.createElement("span",null,"No. of Cycles",r.a.createElement(Ii,{contents:wi.service_period_type_cycle})),checked:c})),r.a.createElement("span",{className:"inline"},r.a.createElement(en,{fieldType:"radio",onChange:this.onChangeServicePeriodType,name:"service_period_type",value:"custom_period",label:r.a.createElement("span",null,G("custom_period_type",K("service"),"Custom"),r.a.createElement(Ii,{contents:wi.service_period_type_custom_period})),checked:!c})))),!c&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},!["clone","create"].includes(a)&&"Custom Period"),r.a.createElement(f.g,{sm:4},r.a.createElement(f.o,null,r.a.createElement(en,{disabled:c,fieldType:"number",min:"1",step:"1",value:n.getIn(["balance_period","value"],""),onChange:this.onChangeBalancePeriod,editable:o,suffix:o?null:" ".concat(s)}),o&&r.a.createElement(f.i,{id:"balance-period-unit",componentClass:f.o.Button,title:s,disabled:c},r.a.createElement(f.q,{eventKey:"days",onSelect:this.onSelectPeriodUnit},"Days"),r.a.createElement(f.q,{eventKey:"weeks",onSelect:this.onSelectPeriodUnit},"Weeks"),r.a.createElement(f.q,{eventKey:"months",onSelect:this.onSelectPeriodUnit},"Months"),r.a.createElement(f.q,{eventKey:"years",onSelect:this.onSelectPeriodUnit},"Years"))))),c&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},!["clone","create"].includes(a)&&"No. of Cycles"),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{disabled:!c,value:n.getIn(["price",0,"to"],""),onChange:this.onChangeCycle,fieldType:"unlimited",unlimitedValue:i,unlimitedLabel:"Infinite",editable:o}))),(["clone","create"].includes(a)||!["clone","create"].includes(a)&&c)&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Prorated?"),r.a.createElement(f.g,{sm:4,style:o?{padding:"10px 15px"}:{paddingTop:5}},r.a.createElement(en,{fieldType:"checkbox",value:!!c&&n.get("prorated",""),onChange:this.onChangeProrated,editable:o,disabled:!c}))),(["clone","create"].includes(a)||!["clone","create"].includes(a)&&c)&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Quantitative?"),r.a.createElement(f.g,{sm:4,style:["clone","create"].includes(a)?{padding:"10px 15px"}:{paddingTop:5}},r.a.createElement(en,{fieldType:"checkbox",value:!!c&&n.get("quantitative",""),onChange:this.onChangeQuantitative,editable:["clone","create"].includes(a),disabled:!c}))),r.a.createElement(Vu,{entityName:"services",entity:n,onChangeField:this.onChangeAdditionalField,onRemoveField:this.onRemoveAdditionalField,editable:o}))}}]),t}(a.Component);bg.defaultProps={errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var Eg=function(e,t){return{type:"UPDATE_SERVICE",path:e,value:t}},Cg=function(e){return{type:"DELETE_SERVICE_FIELD",path:e}},_g=function(e,t,n,a,r,i,o,l){return{type:"ADD_GROUP_SERVICE",groupName:e,usages:t,unit:n,value:a,shared:r,pooled:i,quantityAffected:o,products:l}},Og=function(e){return{type:"REMOVE_GROUP_SERVICE",groupName:e}},Sg=function(){return{type:"CLONE_RESET_SERVICE",uniquefields:["name"]}},Tg=function(e,t,n,a){var r=e(),i=Un(r),o=Vn(r),l=we(o,i,t,n);return t.withMutations(function(e){if(l.isEmpty()||e.set("include",l),a){"custom_period"===e.getIn(["balance_period","type"],"")&&(e.setIn(["price",0,"to"],1),e.set("quantitative",!1),e.set("prorated",!1));var n=function(e){if(["","default"].includes(e.getIn(["balance_period","type"],"default")))return"default";var t=e.getIn(["balance_period","unit"],""),n=e.getIn(["balance_period","value"],1);return"days"===t?"tomorrow +".concat(n-1," days"):"+".concat(n," ").concat(t)}(e);["","default"].includes(n)?e.delete("balance_period"):e.set("balance_period",n)}else{var r=je(e);e.set("balance_period",r)}var s=_e(o,i,t,a);s.isEmpty()||e.set("rates",s)})},kg=function(e,t){return function(n,a){var r=Tg(a,e,!0,!0);return n(Cl("services",r,t))}},Ig=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n,a){n(Aa());var r=function(e){return Rr("services",e)}(e);return ir(r).then(function(e){var r=e.data[0].data.details[0];"undefined"!==typeof r.price&&Array.isArray(r.price)||(r.price=[{from:0,to:Y("serviceCycleUnlimitedValue","UNLIMITED"),price:"undefined"===typeof r.price?"":r.price}]),r.originalValue=r.from;var i=g.c.fromJS(r),o=Tg(a,i,!1,!1).toJS();return n(function(e){return{type:"GOT_SERVICE",item:e}}(o)),t&&n(vl("service",o)),n(tr(e))}).catch(function(e){return n(nr(e,"Error retreiving Entity"))})}},Ng=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:parseInt(n.props.activeTab),progress:!1},n.initDefaultValues=function(){var e=n.props,t=e.mode,a=e.item;if("create"===t){var r=S()().add(1,"days").toISOString();n.props.dispatch(Eg(["from"],r))}"clone"===t&&(n.props.dispatch(Sg()),n.handleSelectTab(1)),null===a.get("prorated",null)&&n.props.dispatch(Eg(["prorated"],!0))},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&te(t,!1)){var a=t.get("name","");n.props.dispatch(Ac("services","name",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Ig(e,!0)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("name","");n.props.dispatch(xc("services",e))},n.clearItemsList=function(){n.props.dispatch(Pc("services"))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onGroupAdd=function(e,t,a,r,i,o,l,s){n.props.dispatch(_g(e,t,a,r,i,o,l,s))},n.onGroupRemove=function(e){n.props.dispatch(Og(e))},n.onUpdateItem=function(e,t){n.props.dispatch(Eg(e,t))},n.onRemoveFieldValue=function(e){n.props.dispatch(Cg(e))},n.afterSave=function(e){var t=n.props.mode;if(n.setState({progress:!1}),e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Wa("The service was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleSelectTab=function(e){n.setState({activeTab:e})},n.handleBack=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&n.clearItemsList();var e=Y(["systemItems",t.entityName,"itemsType"],"");n.props.router.push("/".concat(e))},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.setState({progress:!0}),n.props.dispatch(kg(t,a)).then(n.afterSave)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if(["clone","create"].includes(e)){var t=X(e,"service");this.props.dispatch(ro(t))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=this.props,i=r.item,o=r.itemId,l=r.mode;if(n!==l||te(t)!==te(i)){var s=X(n,"service",t);this.props.dispatch(ro(s))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,t.item)||!g.c.is(this.props.revisions,t.revisions)||this.props.activeTab!==e.activeTab||this.props.itemId!==e.itemId||this.props.mode!==e.mode}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"CLEAR_SERVICE"})}},{key:"render",value:function(){var e=this.state,n=e.progress,a=e.activeTab,i=this.props,o=i.item,l=i.mode,s=i.revisions;if("loading"===l)return r.a.createElement(_,{onClick:this.handleBack});var c="view"!==l,u=o.getIn(["include","groups"],g.c.Map()),p=o.get("rates",g.c.Map()),d=o.get("play",g.c.List());return r.a.createElement("div",{className:"ServiceSetup"},r.a.createElement(f.v,null,r.a.createElement(Mu,{itemName:t.entityName,revisions:s,item:o,mode:l,onChangeFrom:this.onUpdateItem,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.A,{activeKey:a,animation:!1,id:"ServiceTab",onSelect:this.handleSelectTab},r.a.createElement(f.y,{title:"Details",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(bg,{item:o,mode:l,updateItem:this.onUpdateItem,onFieldRemove:this.onRemoveFieldValue}))),r.a.createElement(f.y,{title:"Override Product Price",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Nm,{itemName:t.entityName,mode:l,planRates:p,onChangeFieldValue:this.onUpdateItem,plays:d.join(",")}))),r.a.createElement(f.y,{title:"Service Includes",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Xm,{includeGroups:u,onChangeFieldValue:this.onUpdateItem,onGroupAdd:this.onGroupAdd,onGroupRemove:this.onGroupRemove,mode:l,type:t.entityName,plays:d.join(",")}))),r.a.createElement(f.y,{title:"Tax",eventKey:4},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Vp,{tax:o.get("tax"),mode:l,itemName:t.entityName,onFieldUpdate:this.onUpdateItem,onFieldRemove:this.onRemoveFieldValue})))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!c,cancelLabel:c?void 0:"Back",progress:n}))}}]),t}(a.Component);Ng.defaultProps={item:g.c.Map(),revisions:g.c.List(),activeTab:1},Ng.entityName="service";var wg=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:pi(e,t,"service"),item:ui(e,t,"service"),mode:di(e,t,"service"),activeTab:ri(e,t,"service"),revisions:ai(e,t,"service")}})(Ng)),jg=n(268),Rg=n.n(jg),xg="SET_NAME",Fg="SET_DELIMITER_TYPE",Pg="UPDATE_INPUT_PROCESSOR_FIELD",Mg="SET_DELIMITER",Ag="SET_HEADERS",Dg="SET_FIELD_MAPPING",Lg="ADD_CSV_FIELD",Ug="ADD_USAGET_MAPPING",Vg="ADD_RATE_CATEGORY",Bg="REMOVE_RATE_CATEGORY",qg="SET_RATING_FIELD",zg="ADD_RATING_FIELD",Hg="ADD_RATING_PRIORITY",Yg="REMOVE_RATING_PRIORITY",Gg="REMOVE_RATING_FIELD",Kg="SET_CUSETOMER_MAPPING",Wg="SET_PRICING_MAPPING",Jg="ADD_CUSTOMER_MAPPING",Qg="REMOVE_CUSTOMER_MAPPING",$g="SET_RECEIVER_FIELD",Zg="CANCEL_KEY_AUTH",Xg="GOT_PROCESSOR_SETTINGS",ef="SET_FIELD_WIDTH",tf="CLEAR_INPUT_PROCESSOR",nf="MAP_USAGET",af="REMOVE_CSV_FIELD",rf="REMOVE_USAGET_MAPPING",of="SET_USAGET_TYPE",lf="SET_LINE_KEY",sf="SET_COMPUTED_LINE_KEY",cf="UNSET_COMPUTED_LINE_KEY",uf="REMOVE_ALL_CSV_FIELDS",pf="CHECK_ALL_FIELDS",df="SET_STATIC_USAGET",mf="SET_INPUT_PROCESSOR_TEMPLATE",gf="MOVE_CSV_FIELD_UP",ff="MOVE_CSV_FIELD_DOWN",hf="CHANGE_CSV_FIELD",vf="UNSET_FIELD",yf="SET_PARSER_SETTING",bf="SET_PROCESSOR_TYPE",Ef="SET_REALTIME_FIELD",Cf="SET_REALTIME_DEFAULT_FIELD",_f="SET_CHECKED_FIELD",Of="REMOVE_RECEIVER",Sf="ADD_RECEIVER";function Tf(e){return e.conditions.map(function(e){return function(e){var t=e.op,n=e.pattern,a=e;return"$in"!==t&&"$nin"!==t||"object"!==typeof n||(a.pattern=n.join()),a}(e)})}function kf(e){return e.get("conditions").map(function(e){return function(e){var t=e.get("op",!1),n=e.get("pattern",!1),a=e;return"$in"!==t&&"$nin"!==t||"string"!==typeof n||(a=e.set("pattern",n.split(","))),a}(e)})}var If=function(e){var t=e.parser,n=void 0===t?{}:t,a=e.processor,r=void 0===a?{}:a,i=e.customer_identification_fields,o=void 0===i?{}:i,l=e.rate_calculators,s=void 0===l?{}:l,c=e.pricing,u=void 0===c?{}:c,p=e.receiver,d=void 0===p?{}:p,m=e.realtime,f=void 0===m?{}:m,h=e.response,v=void 0===h?{}:h,y=e.unify,b=void 0===y?{}:y,E=e.enabled,C=void 0===E||E,_=e.filters,O=void 0===_?[]:_,S=d&&d.connections?d.connections:[],T="fixed"===n.type&&n.structure?n.structure.map(function(e){return e.width}):[],k=!Rg()(r,"usaget_mapping")||r.usaget_mapping.length<1?"static":"dynamic",I={file_type:e.file_type,delimiter_type:n.type,delimiter:n.separator,csv_has_header:n.csv_has_header,csv_has_footer:n.csv_has_footer,usaget_type:k,type:e.type,unfiltered_fields:n.structure?g.c.List(n.structure).map(function(e){return g.c.Map({name:e.name,checked:"undefined"===typeof e.checked||e.checked})}):g.c.List(),field_widths:T,line_types:n.line_types,customer_identification_fields:o,rate_calculators:s,pricing:u,unify:b,enabled:C,filters:O};if(I.fields=g.c.List(I.unfiltered_fields.filter(function(e){return!0===e.get("checked")}).map(function(e){return e.get("name")})),"realtime"!==e.type?I.receiver=S:(I.realtime=f,I.response=v),r){var N;for(var w in N="dynamic"===k?r.usaget_mapping.map(function(e){return{src_field:e.src_field,conditions:void 0!==e.conditions?Tf(e):[{src_field:e.src_field,pattern:e.pattern}],usaget:e.usaget,pattern:e.pattern,unit:e.unit,volume_type:e.volume_type,volume_src:e.volume_src}}):[],I.processor=Object.assign({},r,{usaget_mapping:N,src_field:"dynamic"===k?r.usaget_mapping[0].src_field:""}),s||(I.rate_calculators="dynamic"===k?r.usaget_mapping.reduce(function(e,t){return e.retail[t.usaget]=[],e},{}):{retail:Object(vr.a)({},r.default_usaget,[])}),o||(I.customer_identification_fields="dynamic"===k?r.usaget_mapping.reduce(function(e,t){return e[t.usaget]=[],e},{}):Object(vr.a)({},r.default_usaget,[])),u||(I.pricing="dynamic"===k?r.usaget_mapping.reduce(function(e,t){return e[t.usaget]={},e},{}):Object(vr.a)({},r.default_usaget,{})),I.pricing){0===I.pricing[w].length&&(I.pricing[w]={})}if(O)for(var j in I.filters){var R=I.filters[j];if("undefined"!==typeof R.conditions)for(var x in R.conditions)"undefined"!==typeof(x=R.conditions[x]).value.regex&&(x.value=new RegExp("".concat(x.value.regex)).toString())}}else I.processor={usaget_mapping:[]};return I};function Nf(e){var t={api:"settings",params:[{category:"file_types"},{data:JSON.stringify({file_type:e})}]};return function(e){e(Aa()),ir(t).then(function(t){var n;e(Da()),e((n=If(t.data[0].data.details),{type:Xg,settings:n}))}).catch(function(t){console.log(t),e(Da()),e(Qa("Error loading input processor"))})}}function wf(e){return{type:xg,file_type:e}}function jf(e){return{type:Fg,delimiter_type:e}}function Rf(e){return{type:Ag,fields:e}}function xf(e,t,n){return{type:$g,field:e,mapping:t,index:n}}var Ff=function(e){return function(t){var n=Cr(e,"unset");return t(Aa()),ir(n).then(function(e){return t(tr(e))}).catch(function(e){return t(nr(e,"Error occured while trying to delete input processor"))})}},Pf=function(e,t){return function(n){var a=t?"enable":"disable",r=Cr(e,a);return n(Aa()),ir(r).then(function(e){return n(tr(e))}).catch(function(e){return n(nr(e,"Error occured while trying to ".concat(a," input processor")))})}};var Mf=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onClickRemove=function(e){n.setState({showConfirmRemove:!0,inputProcessor:e})},n.onClickRemoveCancel=function(){n.setState({showConfirmRemove:!1,inputProcessor:null})},n.onClickRemoveOk=function(){var e=n.state.inputProcessor;n.setState({showConfirmRemove:!1,inputProcessor:null});var t=e.get("file_type","");n.props.dispatch(Ff(t)).then(function(e){e.status&&n.props.dispatch(fr("input_processors",n.buildQuery()))})},n.onClickEnabled=function(e){n.setState({showConfirmEnable:!0,inputProcessor:e})},n.onClickEnableCancel=function(){n.setState({showConfirmEnable:!1,inputProcessor:null})},n.onClickEnableOk=function(){var e=n.state.inputProcessor;n.setState({showConfirmEnable:!1,inputProcessor:null}),n.updateEnabled(e,!0)},n.onClickDisabled=function(e){n.setState({showConfirmDisable:!0,inputProcessor:e})},n.onClickDisableCancel=function(){n.setState({showConfirmDisable:!1,inputProcessor:null})},n.onClickDisableOk=function(){var e=n.state.inputProcessor;n.setState({showConfirmDisable:!1,inputProcessor:null}),n.updateEnabled(e,!1)},n.updateEnabled=function(e,t){var a=e.get("file_type","");n.props.dispatch(Pf(a,t)).then(function(e){e.status&&n.props.dispatch(fr("input_processors",n.buildQuery()))})},n.parseShowEnable=function(e){return!e.get("enabled",!0)},n.parseShowDisable=function(e){return!n.parseShowEnable(e)},n.getListActions=function(){return[{type:"edit",showIcon:!0,helpText:"Edit",onClick:n.onClickInputProcessor,show:!0,onClickColumn:"file_type"},{type:"enable",showIcon:!0,helpText:"Enable",onClick:n.onClickEnabled,show:n.parseShowEnable},{type:"disable",showIcon:!0,helpText:"Disable",onClick:n.onClickDisabled,show:n.parseShowDisable},{type:"remove",showIcon:!0,helpText:"Remove",onClick:n.onClickRemove,show:!0}]},n.parseInputProcessorStatus=function(e){return e.get("enabled",!0)?"Enabled":"Disabled"},n.onClickInputProcessor=n.onClickInputProcessor.bind(Object(ki.a)(n)),n.onClickNew=n.onClickNew.bind(Object(ki.a)(n)),n.onSort=n.onSort.bind(Object(ki.a)(n)),n.buildQuery=n.buildQuery.bind(Object(ki.a)(n)),n.state={sort:"",showConfirmRemove:!1,showConfirmEnable:!1,showConfirmDisable:!1,inputProcessor:null},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(fr("input_processors",this.buildQuery()))}},{key:"componentWillUnmount",value:function(){this.props.dispatch(gr("input_processors"))}},{key:"buildQuery",value:function(){return{api:"settings",params:[{category:"file_types"},{sort:this.state.sort},{data:JSON.stringify({})}]}}},{key:"onClickInputProcessor",value:function(e){var t={file_type:e.get("file_type"),action:"update"};e.get("type")&&(t.type="api",t.format=e.get("type")),this.context.router.push({pathname:"input_processor",query:t})}},{key:"onClickNew",value:function(){this.context.router.push({pathname:"select_input_processor_template",query:{action:"new"}})}},{key:"onSort",value:function(e){var t=this;this.setState({sort:e},function(){t.props.dispatch(fr("input_processors",t.buildQuery()))})}},{key:"render",value:function(){var e=this.props.inputProcessors,t=this.state,n=t.showConfirmRemove,a=t.showConfirmEnable,i=t.showConfirmDisable,o=t.inputProcessor,l=o?o.get("file_type"):"",s='Are you sure you want to remove input processor "'.concat(l,'"?'),c='Are you sure you want to enable input processor "'.concat(l,'"?'),u='Are you sure you want to disable input processor "'.concat(l,'"?'),p=[{id:"file_type",title:"Name"},{id:"enabled",title:"Status",parser:this.parseInputProcessorStatus,cssClass:"list-status-col"}],d=this.getListActions();return r.a.createElement("div",{className:"InputProcessorsList"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},"All available input processors",r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:this.onClickNew},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0Add New"))),r.a.createElement("div",{className:"panel-body"},r.a.createElement(ec,{items:e,fields:p,onSort:this.onSort,actions:d}),r.a.createElement(Ke,{onOk:this.onClickRemoveOk,onCancel:this.onClickRemoveCancel,show:n,message:s,labelOk:"Yes"}),r.a.createElement(Ke,{onOk:this.onClickEnableOk,onCancel:this.onClickEnableCancel,show:a,message:c,labelOk:"Yes"}),r.a.createElement(Ke,{onOk:this.onClickDisableOk,onCancel:this.onClickDisableCancel,show:i,message:u,labelOk:"Yes"}))))))}}]),t}(a.Component);Mf.contextTypes={router:pc.a.object.isRequired};var Af=Object(l.connect)(function(e,t){return{inputProcessors:e.list.get("input_processors")||[]}})(Mf),Df="SET_GENERATOR_NAME",Lf="SELECT_INPUT_PROCESSOR",Uf="SET_SEGMENTATION",Vf="ADD_SEGMENTATION",Bf="DELETE_SEGMENTATION",qf="CLEAR_EXPORT_GENERATOR",zf="SET_FTP_FIELD",Hf="GOT_EXPORT_GENERATOR";function Yf(e){var t={api:"settings",params:[{category:"export_generators"},{action:"get"},{data:JSON.stringify({name:e})}]};return function(n){n(Aa()),ir(t).then(function(e){var t;n(Da()),n((t=e.data[0].data.details,{type:Hf,generator:t}))}).catch(function(t){n(Da()),n(nr(t,"Error loading export generator ".concat(e)))})}}function Gf(e){return{type:Df,name:e}}function Kf(e){return{type:Lf,inputProcessor:e}}function Wf(e,t,n){return{type:Uf,index:e,key:t,value:n}}function Jf(){return{type:Vf}}function Qf(e){return{type:Bf,index:e}}function $f(){return{type:qf}}function Zf(e,t){return{type:zf,field:e,value:t}}function Xf(){return function(e,t){return e(function(e){var t={api:"settings",params:[{category:"export_generators"},{action:"set"},{data:JSON.stringify(e.remove("inputProcess").toJS())}]};return function(e){e(Aa()),ir(t).then(function(t){e(Wa("Export generator saved successfully")),e(Da())},function(t){e(nr("Error")),e(Da())}).catch(function(t){e(nr(t))})}}(t().exportGenerator))}}var eh=[{title:"Choose Input"},{title:"Segmentation"},{title:"FTP Details"}],th=function(e){var t=e.stepIndex;return r.a.createElement("div",{className:"br-stepper"},r.a.createElement(Si,{activeIndex:t,steps:eh}))};var nh=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onNameChange=n.onNameChange.bind(Object(ki.a)(n)),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"onNameChange",value:function(e){this.props.setGeneratorName(e.target.value)}},{key:"render",value:function(){return r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"name"},"Generator Name")),r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("input",{id:"name",name:"name",className:"form-control",onChange:this.onNameChange,value:this.props.name})))}}]),t}(a.Component),ah=Object(l.connect)(function(e,t){return{name:e.exportGenerator.get("name")}},function(e){return Object(fu.b)({setGeneratorName:Gf},e)})(nh),rh=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onSort=n.onSort.bind(Object(ki.a)(n)),n.buildQuery=n.buildQuery.bind(Object(ki.a)(n)),n.onInputProcessChange=n.onInputProcessChange.bind(Object(ki.a)(n)),n.state={sort:"name"},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.getList("input_processors",this.buildQuery())}},{key:"buildQuery",value:function(){return{api:"settings",params:[{category:"file_types"},{sort:"name"},{data:JSON.stringify({})}]}}},{key:"onSort",value:function(e){var t=this;this.setState({sort:e},function(){t.props.dispatch(fr("input_processors",t.buildQuery()))})}},{key:"onInputProcessChange",value:function(e){var t=this.props.inputProcessors.filter(function(t){return t.get("file_type","")===e}).first();this.props.selectInputProcessor(t)}},{key:"render",value:function(){var e=this.props,t=e.inputProcessors,n=e.settings,a=e.selectedProcess,i=[],o=void 0===a?"":a.get("file_type","");return g.a.isList(t)&&t.map(function(e){return i.push({value:e.get("file_type",""),label:e.get("file_type","")})}),r.a.createElement("div",null,r.a.createElement("form",{className:"InputProcessor form-horizontal"},r.a.createElement("h3",{style:{marginBottom:"35px"}},"Choose Input Processor"),r.a.createElement(ah,{name:n.get("name","")}),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"file_type"},"Please select Input Processor")),r.a.createElement("div",{className:"col-lg-6"},r.a.createElement(en,{fieldType:"select",value:o,options:i,onChange:this.onInputProcessChange,clearable:!1})))))}}]),t}(a.Component);var ih=Object(l.connect)(function(e,t){return{inputProcessors:e.list.get("input_processors",[])||[],selectedProcess:e.exportGenerator.get("inputProcess")}},function(e){return Object(fu.b)({getList:fr,selectInputProcessor:Kf},e)})(rh),oh=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onFieldChange=n.onFieldChange.bind(Object(ki.a)(n)),n.onValueChange=n.onValueChange.bind(Object(ki.a)(n)),n.onDeleteLine=n.onDeleteLine.bind(Object(ki.a)(n)),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"onFieldChange",value:function(e){this.props.onSelectField(this.props.index,"field",e)}},{key:"onValueChange",value:function(e){this.props.onSelectField(this.props.index,e.target.name,e.target.value)}},{key:"onDeleteLine",value:function(){this.props.onDelete(this.props.index)}},{key:"render",value:function(){var e=this.props,t=e.segment,n=e.options,a=void 0===t.getIn(["field","name"])?"":t.getIn(["field","name"]);return r.a.createElement("div",{className:"form-group row form-inner-edit-row mr0 ml0"},r.a.createElement("div",{className:"col-sm-6"},r.a.createElement(en,{fieldType:"select",value:a,options:n,onChange:this.onFieldChange,clearable:!1})),r.a.createElement("div",{className:"col-sm-2"},r.a.createElement("input",{name:"from",className:"form-control",onChange:this.onValueChange,value:null===t.get("from")?"":t.get("from"),disabled:!a})),r.a.createElement("div",{className:"col-sm-2"},r.a.createElement("input",{name:"to",className:"form-control",onChange:this.onValueChange,value:null===t.get("to")?"":t.get("to"),disabled:!a})),r.a.createElement("div",{className:"col-sm-2 actions"},r.a.createElement(f.c,{onClick:this.onDeleteLine,bsSize:"small"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0Remove")))}}]),t}(a.Component),lh=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onSelectField=n.onSelectField.bind(Object(ki.a)(n)),n.onDelete=n.onDelete.bind(Object(ki.a)(n)),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"onSelectField",value:function(e,t,n){this.props.setSegmentation(e,t,n)}},{key:"onDelete",value:function(e){this.props.deleteSegmentation(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.fields,a=t.segments,i=n.map(function(e){return{value:e,label:e.get("name")}}).toJS();return r.a.createElement("div",{className:"Segmentation"},"Please add segments filters for Export generator.",r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Segments ",r.a.createElement(Ii,{contents:"Each Segment should have a field and ranges value"}))},r.a.createElement("div",{className:"form-group row form-inner-edit-row mr0 ml0"},r.a.createElement("div",{className:"col-sm-6"},r.a.createElement("label",{htmlFor:"date_field"},"Field")),r.a.createElement("div",{className:"col-sm-2"},r.a.createElement("label",{htmlFor:"date_field"},"From")),r.a.createElement("div",{className:"col-sm-2"},r.a.createElement("label",{htmlFor:"date_field"},"To"))),a.map(function(t,n){return r.a.createElement(oh,{options:i,index:n,segment:t,onSelectField:e.onSelectField,onDelete:e.onDelete,key:n})}),r.a.createElement(Je,{onClick:this.props.addSegmentation,label:"Add Segment"})))}}]),t}(a.Component);var sh=Object(l.connect)(function(e,t){return{fields:e.exportGenerator.getIn(["inputProcess","parser","structure"],g.c.List()),segments:e.exportGenerator.get("segments",g.c.List())}},function(e){return Object(fu.b)({setSegmentation:Wf,addSegmentation:Jf,deleteSegmentation:Qf},e)})(lh),ch=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.settings,n=e.onChangeField,a=e.onChangeCheckboxField,i=[{min:1,label:"1 Minute"},{min:15,label:"15 Minutes"},{min:30,label:"30 Minutes"},{min:60,label:"1 Hour"},{min:360,label:"6 Hours"},{min:720,label:"12 Hours"},{min:1440,label:"24 Hours"}].map(function(e,t){return r.a.createElement("option",{value:e.min,key:t},e.label)});return r.a.createElement("div",{className:"FTPDetails"},r.a.createElement("h4",null,"FTP"),r.a.createElement("form",{className:"form-horizontal"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"name",className:"col-xs-2 control-label"},"Name"),r.a.createElement("div",{className:"col-xs-4"},r.a.createElement(en,{id:"name",onChange:n,value:t.get("name","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"host",className:"col-xs-2 control-label"},"Host"),r.a.createElement("div",{className:"col-xs-4"},r.a.createElement(en,{id:"host",onChange:n,value:t.get("host","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"user",className:"col-xs-2 control-label"},"User"),r.a.createElement("div",{className:"col-xs-4"},r.a.createElement(en,{id:"user",onChange:n,value:t.get("user","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"password",className:"col-xs-2 control-label"},"Password"),r.a.createElement("div",{className:"col-xs-4"},r.a.createElement(en,{id:"password",onChange:n,value:t.get("password","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"remote_directory",className:"col-xs-2 control-label"},"Directory"),r.a.createElement("div",{className:"col-xs-4"},r.a.createElement(en,{id:"remote_directory",onChange:n,value:t.get("remote_directory","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"filename_regex",className:"col-xs-2 control-label"},"Regex"),r.a.createElement("div",{className:"col-xs-4"},r.a.createElement(en,{id:"filename_regex",onChange:n,value:t.get("filename_regex","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"period",className:"col-xs-2 control-label"},"Period"),r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("select",{className:"form-control",id:"period",onChange:n,value:t.get("period","")},i))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"passive",className:"col-xs-2 control-label"},"Passive"),r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("input",{type:"checkbox",id:"passive",onChange:a,checked:t.get("passive",!1),value:"1",style:{marginTop:10}})))))}}]),t}(a.Component),uh=Object(l.connect)()(ch),ph=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChangeFTPField=function(e){var t=e.target,a=t.id,r=t.value;n.props.dispatch(Zf(a,r))},n.onChangeCheckboxField=function(e){var t=e.target,a=t.id,r=t.checked;n.props.dispatch(Zf(a,r))},n.state={stepIndex:0,finished:0,steps:["select_input","segmentation","ftpDetails"]},n.handleNext=n.handleNext.bind(Object(ki.a)(n)),n.handlePrev=n.handlePrev.bind(Object(ki.a)(n)),n.handleCancel=n.handleCancel.bind(Object(ki.a)(n)),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.dispatch,t=this.props.location.query,n=t.name,a=t.action;e(il(["export_generators"])),"new"!==a&&e(function(e){return function(t){return t(Yf(e))}}(n))}},{key:"goBack",value:function(){this.context.router.push({pathname:"export_generators"})}},{key:"handleNext",value:function(){var e=this,t=(this.state||0).stepIndex,n=this.state.steps.length-1;this.validateSteps(function(a){if(!a){var r=t+1===n;e.setState({stepIndex:t+1,finished:r})}})}},{key:"handlePrev",value:function(){var e=this.state.stepIndex;if(e>0)return this.setState({stepIndex:e-1,finished:0});window.confirm("are you sure you want to stop editing Export Generator?")&&(this.props.dispatch($f()),this.goBack())}},{key:"handleCancel",value:function(){var e=window.confirm("are you sure you want to stop editing Export Generator?"),t=this.props,n=t.dispatch,a=t.fileType,r=t.settings;if(e)if(!0!==a)n($f()),this.goBack();else{n($f(r.get("file_type","")))}}},{key:"validateSteps",value:function(e){var t=this.state||0,n=t.stepIndex,a=t.finished,r=this.props.settings,i=[];if(a)this.props.dispatch(Xf());else{switch(n){case 0:0===r.get("name","").length&&i.push("Export Process name is mandatory."),0===r.get("inputProcess",0).size&&i.push("Please select Input Processor.");break;case 1:if(0===r.get("segments",0).size)i.push("Please select at least one segment");else{var o=r.get("segments").first();(!o.get("field")||!o.get("from")&&o.get("to"))&&i.push("Generator should have at least one valid segment")}}if(i.length>0)return this.props.dispatch(Qa(i.join("\n\n"))),void e(!0);e(!1)}}},{key:"render",value:function(){var e=this,t=this.state.stepIndex,n=this.props.settings,a=[r.a.createElement(ih,{onNext:this.handleNext.bind(this),settings:n}),r.a.createElement(sh,{onNext:this.handleNext.bind(this),settings:n}),r.a.createElement(uh,{onNext:this.handleNext.bind(this),settings:n.get("receiver",Object(g.b)()),onChangeField:this.onChangeFTPField,onChangeCheckboxField:this.onChangeCheckboxField})];return r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(th,{stepIndex:t})))),r.a.createElement("div",{className:"panel-body"},r.a.createElement("div",{className:"contents bordered-container",style:{minHeight:"250px"}},a[t])),r.a.createElement("div",{style:{marginTop:12},className:"pull-left"},r.a.createElement("button",{className:"btn btn-default",onClick:this.handleCancel,style:{marginRight:12}},"Cancel")),r.a.createElement("div",{style:{marginTop:12},className:"pull-right"},function(){if(t>0)return r.a.createElement("button",{className:"btn btn-default",onClick:e.handlePrev,style:{marginRight:12}},"Back")}(),r.a.createElement("button",{className:"btn btn-primary",onClick:this.handleNext},t===a.length-1?"Finish":"Next"))))))}}]),t}(a.Component);ph.contextTypes={router:pc.a.object.isRequired};var dh=Object(l.connect)(function(e,t){return{settings:e.exportGenerator}})(ph),mh=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onClickExportGenerator=n.onClickExportGenerator.bind(Object(ki.a)(n)),n.onClickNew=n.onClickNew.bind(Object(ki.a)(n)),n.onSort=n.onSort.bind(Object(ki.a)(n)),n.buildQuery=n.buildQuery.bind(Object(ki.a)(n)),n.state={sort:""},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(il("export_generators",this.buildQuery()))}},{key:"buildQuery",value:function(){return{api:"settings",params:[{category:"export_generators"},{sort:this.state.sort},{data:JSON.stringify({})}]}}},{key:"onClickExportGenerator",value:function(e){this.context.router.push({pathname:"export_generator",query:{name:e.get("name"),action:"update"}})}},{key:"onClickNew",value:function(){this.context.router.push({pathname:"export_generator",query:{action:"new"}})}},{key:"onSort",value:function(e){var t=this;this.setState({sort:e},function(){t.props.dispatch(il("export_generators",t.buildQuery()))})}},{key:"render",value:function(){var e=this.props.exportGenerators;return r.a.createElement("div",{className:"ExportGeneratorsList"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},r.a.createElement("span",null,"All available Export Generators"),r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:this.onClickNew},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0Add New"))),r.a.createElement("div",{className:"panel-body"},r.a.createElement(ec,{items:e||g.c.List(),fields:[{id:"name",title:"Name"}],edit:!0,onClickEdit:this.onClickExportGenerator,onSort:this.onSort}))))))}}]),t}(a.Component);mh.contextTypes={router:pc.a.object.isRequired};var gh=Object(l.connect)(function(e,t){return{exportGenerators:e.settings.get("export_generators",g.c.List())}})(mh),fh=n(269),hh=n.n(fh),vh={Asterisk_CDR:{file_type:"Asterisk_CDR",parser:{type:"separator",separator:"|",structure:[{name:"accountcode"},{name:"src"},{name:"dst"},{name:"dcontext"},{name:"clid"},{name:"channel"},{name:"dstchannel"},{name:"lastapp"},{name:"lastdata"},{name:"start"},{name:"answer"},{name:"end"},{name:"duration"},{name:"billsec"},{name:"disposition"},{name:"amaflags"},{name:"userfield"},{name:"uniqueid"}],custom_keys:["accountcode","src","dst","dcontext","clid","channel","dstchannel","lastapp","lastdata","start","answer","end","duration","billsec","disposition","amaflags","userfield","uniqueid"],line_types:{H:"/^none$/",D:"//",T:"/^none$/"}},processor:{type:"Usage",date_field:"answer",default_volume_type:"field",default_volume_src:["duration"],default_usaget:"call",orphan_files_time:"6 hours"},customer_identification_fields:{call:[{target_key:"sid",clear_regex:"//",src_key:"src"}]},rate_calculators:{retail:{call:[[{type:"longestPrefix",rate_key:"params.prefix",line_key:"dst"}]]}},pricing:{call:{}}},UK_Standard_CDR_v3:{file_type:"UK_Standard_CDR_v3",parser:{type:"separator",separator:",",structure:[{name:"call_type"},{name:"call_cause"},{name:"customer_identifier"},{name:"telephone_number_dialled"},{name:"call_date"},{name:"call_time"},{name:"duration"},{name:"bytes_transmitted"},{name:"bytes_received"},{name:"description"},{name:"chargecode"},{name:"time_band"},{name:"salesprice"},{name:"salesprice__pre_bundle_"},{name:"extension"},{name:"ddi"},{name:"grouping_id"},{name:"call_class"},{name:"carrier"},{name:"recording"},{name:"vat"},{name:"country_of_origin"},{name:"network"},{name:"retail_tariff_code"},{name:"remote_network"},{name:"apn"},{name:"diverted_number"},{name:"ring_time"},{name:"recordid"},{name:"currency"},{name:"presentation_number"},{name:"network_access_reference"},{name:"ngcs_access_charge"},{name:"ngcs_service_charge"},{name:"total_bytes_transferred"},{name:"user_id"},{name:"onward_billing_reference"},{name:"contract_name"},{name:"bundle_name"},{name:"bundle_allowance"},{name:"discount_reference"},{name:"routing_code"}],custom_keys:["call_type","call_cause","customer_identifier","telephone_number_dialled","call_date","call_time","duration","bytes_transmitted","bytes_received","description","chargecode","time_band","salesprice","salesprice__pre_bundle_","extension","ddi","grouping_id","call_class","carrier","recording","vat","country_of_origin","network","retail_tariff_code","remote_network","apn","diverted_number","ring_time","recordid","currency","presentation_number","network_access_reference","ngcs_access_charge","ngcs_service_charge","total_bytes_transferred","user_id","onward_billing_reference","contract_name","bundle_name","bundle_allowance","discount_reference","routing_code"],line_types:{H:"/^none$/",D:"//",T:"/^none$/"}},processor:{type:"Usage",date_field:"call_date",usaget_mapping:[{src_field:"call_type",pattern:"/^G$/",usaget:"GPRS_Data",volume_type:"field",volume_src:["duration"]}],orphan_files_time:"6 hours"},customer_identification_fields:{GPRS_Data:[{target_key:"sid",clear_regex:"//",src_key:"customer_identifier"}]},rate_calculators:{retail:{GPRS_Data:[[{type:"match",rate_key:"key",line_key:"apn"}]]}},pricing:{GPRS_Data:{}}},FreeSWITCH_CDR:{file_type:"FreeSWITCH_CDR",parser:{type:"separator",separator:",",structure:[{name:"caller_id_name"},{name:"caller_id_number"},{name:"destination_number"},{name:"context"},{name:"start_stamp"},{name:"answer_stamp"},{name:"end_stamp"},{name:"duration"},{name:"billsec"},{name:"hangup_cause"},{name:"uuid"},{name:"bleg_uuid"},{name:"accountcode"},{name:"read_codec"},{name:"write_codec"}],custom_keys:["caller_id_name","caller_id_number","destination_number","context","start_stamp","answer_stamp","end_stamp","duration","billsec","hangup_cause","uuid","bleg_uuid","accountcode","read_codec","write_codec"],line_types:{H:"/^none$/",D:"//",T:"/^none$/"}},processor:{type:"Usage",date_field:"answer_stamp",default_volume_type:"field",default_volume_src:["billsec"],default_usaget:"call",orphan_files_time:"6 hours"},customer_identification_fields:{call:[{target_key:"sid",clear_regex:"//",src_key:"caller_id_number"}]},rate_calculators:{retail:{call:[[{type:"longestPrefix",rate_key:"params.prefix",line_key:"caller_id_number"}]]}},pricing:{call:{}}},Cisco_CDR:{file_type:"Cisco_CDR",parser:{type:"separator",separator:",",structure:[{name:"cdrrecordtype"},{name:"globalcallid_callmanagerid"},{name:"globalcallid_callid"},{name:"origlegcallidentifier"},{name:"datetimeorigination"},{name:"orignodeid"},{name:"origspan"},{name:"origipaddr"},{name:"callingpartynumber"},{name:"callingpartyunicodeloginuserid"},{name:"origcause_location"},{name:"origcause_value"},{name:"origprecedencelevel"},{name:"origmediatransportaddress_ip"},{name:"origmediatransportaddress_port"},{name:"origmediacap_payloadcapability"},{name:"origmediacap_maxframesperpacket"},{name:"origmediacap_g723bitrate"},{name:"origvideocap_codec"},{name:"origvideocap_bandwidth"},{name:"origvideocap_resolution"},{name:"origvideotransportaddress_ip"},{name:"origvideotransportaddress_port"},{name:"origrsvpaudiostat"},{name:"origrsvpvideostat"},{name:"destlegcallidentifier"},{name:"destnodeid"},{name:"destspan"},{name:"destipaddr"},{name:"originalcalledpartynumber"},{name:"finalcalledpartynumber"},{name:"finalcalledpartyunicodeloginuserid"},{name:"destcause_location"},{name:"destcause_value"},{name:"destprecedencelevel"},{name:"destmediatransportaddress_ip"},{name:"destmediatransportaddress_port"},{name:"destmediacap_payloadcapability"},{name:"destmediacap_maxframesperpacket"},{name:"destmediacap_g723bitrate"},{name:"destvideocap_codec"},{name:"destvideocap_bandwidth"},{name:"destvideocap_resolution"},{name:"destvideotransportaddress_ip"},{name:"destvideotransportaddress_port"},{name:"destrsvpaudiostat"},{name:"destrsvpvideostat"},{name:"datetimeconnect"},{name:"datetimedisconnect"},{name:"lastredirectdn"},{name:"pkid"},{name:"originalcalledpartynumberpartition"},{name:"callingpartynumberpartition"},{name:"finalcalledpartynumberpartition"},{name:"lastredirectdnpartition"},{name:"duration"},{name:"origdevicename"},{name:"destdevicename"},{name:"origcallterminationonbehalfof"},{name:"destcallterminationonbehalfof"},{name:"origcalledpartyredirectonbehalfof"},{name:"lastredirectredirectonbehalfof"},{name:"origcalledpartyredirectreason"},{name:"lastredirectredirectreason"},{name:"destconversationid"},{name:"globalcallid_clusterid"},{name:"joinonbehalfof"},{name:"comment"},{name:"authcodedescription"},{name:"authorizationlevel"},{name:"clientmattercode"},{name:"origdtmfmethod"},{name:"destdtmfmethod"},{name:"callsecuredstatus"},{name:"origconversationid"},{name:"origmediacap_bandwidth"},{name:"destmediacap_bandwidth"},{name:"authorizationcodevalue"},{name:"outpulsedcallingpartynumber"},{name:"outpulsedcalledpartynumber"},{name:"origipv4v6addr"},{name:"destipv4v6addr"},{name:"origvideocap_codec_channel2"},{name:"origvideocap_bandwidth_channel2"},{name:"origvideocap_resolution_channel2"},{name:"origvideotransportaddress_ip_channel2"},{name:"origvideotransportaddress_port_channel2"},{name:"origvideochannel_role_channel2"},{name:"destvideocap_codec_channel2"},{name:"destvideocap_bandwidth_channel2"},{name:"destvideocap_resolution_channel2"},{name:"destvideotransportaddress_ip_channel2"},{name:"destvideotransportaddress_port_channel2"},{name:"destvideochannel_role_channel2"},{name:"incomingprotocolid"},{name:"incomingprotocolcallref"},{name:"outgoingprotocolid"},{name:"outgoingprotocolcallref"},{name:"currentroutingreason"},{name:"origroutingreason"},{name:"lastredirectingroutingreason"},{name:"huntpilotdn"},{name:"huntpilotpartition"},{name:"calledpartypatternusage"}],custom_keys:["cdrrecordtype","globalcallid_callmanagerid","globalcallid_callid","origlegcallidentifier","datetimeorigination","orignodeid","origspan","origipaddr","callingpartynumber","callingpartyunicodeloginuserid","origcause_location","origcause_value","origprecedencelevel","origmediatransportaddress_ip","origmediatransportaddress_port","origmediacap_payloadcapability","origmediacap_maxframesperpacket","origmediacap_g723bitrate","origvideocap_codec","origvideocap_bandwidth","origvideocap_resolution","origvideotransportaddress_ip","origvideotransportaddress_port","origrsvpaudiostat","origrsvpvideostat","destlegcallidentifier","destnodeid","destspan","destipaddr","originalcalledpartynumber","finalcalledpartynumber","finalcalledpartyunicodeloginuserid","destcause_location","destcause_value","destprecedencelevel","destmediatransportaddress_ip","destmediatransportaddress_port","destmediacap_payloadcapability","destmediacap_maxframesperpacket","destmediacap_g723bitrate","destvideocap_codec","destvideocap_bandwidth","destvideocap_resolution","destvideotransportaddress_ip","destvideotransportaddress_port","destrsvpaudiostat","destrsvpvideostat","datetimeconnect","datetimedisconnect","lastredirectdn","pkid","originalcalledpartynumberpartition","callingpartynumberpartition","finalcalledpartynumberpartition","lastredirectdnpartition","duration","origdevicename","destdevicename","origcallterminationonbehalfof","destcallterminationonbehalfof","origcalledpartyredirectonbehalfof","lastredirectredirectonbehalfof","origcalledpartyredirectreason","lastredirectredirectreason","destconversationid","globalcallid_clusterid","joinonbehalfof","comment","authcodedescription","authorizationlevel","clientmattercode","origdtmfmethod","destdtmfmethod","callsecuredstatus","origconversationid","origmediacap_bandwidth","destmediacap_bandwidth","authorizationcodevalue","outpulsedcallingpartynumber","outpulsedcalledpartynumber","origipv4v6addr","destipv4v6addr","origvideocap_codec_channel2","origvideocap_bandwidth_channel2","origvideocap_resolution_channel2","origvideotransportaddress_ip_channel2","origvideotransportaddress_port_channel2","origvideochannel_role_channel2","destvideocap_codec_channel2","destvideocap_bandwidth_channel2","destvideocap_resolution_channel2","destvideotransportaddress_ip_channel2","destvideotransportaddress_port_channel2","destvideochannel_role_channel2","incomingprotocolid","incomingprotocolcallref","outgoingprotocolid","outgoingprotocolcallref","currentroutingreason","origroutingreason","lastredirectingroutingreason","huntpilotdn","huntpilotpartition","calledpartypatternusage"],line_types:{H:"/^none$/",D:"//",T:"/^none$/"}},processor:{type:"Usage",date_field:"datetimeconnect",usaget_mapping:[{src_field:"calledpartypatternusage",pattern:"/^NA$/",usaget:"NA",volume_type:"field",volume_src:["duration"]}],orphan_files_time:"6 hours"},customer_identification_fields:{NA:[{target_key:"sid",clear_regex:"//",src_key:"callingpartynumber"}]},rate_calculators:{retail:{NA:[[{type:"longestPrefix",rate_key:"params.prefix",line_key:"originalcalledpartynumber"}]]}},pricing:{retail:{}}},Voip_Ms_CDR:{file_type:"Voip_Ms_CDR",parser:{type:"separator",separator:",",structure:[{name:"Date"},{name:"CallerID"},{name:"Originator"},{name:"Destination"},{name:"CallType"},{name:"Duration"},{name:"PricePerMinute"},{name:"FinalCharge"}],csv_has_header:!1,csv_has_footer:!1,custom_keys:["Date","CallerID","Originator","Destination","CallType","Duration","PricePerMinute","FinalCharge"],line_types:{H:"/^none$/",D:"//",T:"/^none$/"}},processor:{type:"Usage",date_field:"Date",usaget_mapping:[{src_field:"CallType",pattern:"/^Inbound*/",usaget:"inbound_call",unit:"seconds",volume_type:"field",volume_src:["Duration"]},{src_field:"CallType",pattern:"/^(?!Inbound).*$/",usaget:"outbound_call",unit:"seconds",volume_type:"field",volume_src:["Duration"]}],date_format:"m/d/Y H:i",orphan_files_time:"6 hours"},customer_identification_fields:{inbound_call:[{target_key:"phone",src_key:"Destination",conditions:[{field:"usaget",regex:"/.*/"}],clear_regex:"//"}],outbound_call:[{target_key:"phone",src_key:"Originator",conditions:[{field:"usaget",regex:"/.*/"}],clear_regex:"/.*<|\\D/"}]},rate_calculators:{retail:{inbound_call:[[{type:"longestPrefix",rate_key:"prefix",line_key:"computed"}]],outbound_call:[[{type:"longestPrefix",rate_key:"params.prefix",line_key:"Destination"}]]}},pricing:{inbound_call:{},outbound_call:{}}},Bandwidth_CDR:{file_type:"Bandwidth_CDR",parser:{type:"separator",separator:"|",structure:[{name:"AccountNumber"},{name:"CallStartDateTime"},{name:"CallEndDateTime"},{name:"CallType"},{name:"CallSource"},{name:"CallDestination"},{name:"Duration"},{name:"PerMinRate"},{name:"Amount"},{name:"TierType"},{name:"SourceCountry"},{name:"SourceState"},{name:"SourceLATA"},{name:"SourceRateCenter"},{name:"DestinationCountry"},{name:"DestinationState"},{name:"DestinationLATA"},{name:"DesinationRateCenter"},{name:"CallID"},{name:"BdrID"},{name:"SourceIP"},{name:"DestinationIP"},{name:"RateAttempts"},{name:"LRN"},{name:"LocationID"},{name:"SubAccountID"},{name:"LocationName"},{name:"SubAccountName____"}],csv_has_header:!0,csv_has_footer:!1,custom_keys:["AccountNumber","CallStartDateTime","CallEndDateTime","CallType","CallSource","CallDestination","Duration","PerMinRate","Amount","TierType","SourceCountry","SourceState","SourceLATA","SourceRateCenter","DestinationCountry","DestinationState","DestinationLATA","DesinationRateCenter","CallID","BdrID","SourceIP","DestinationIP","RateAttempts","LRN","LocationID","SubAccountID","LocationName","SubAccountName____"],line_types:{H:"/^none$/",D:"//",T:"/^none$/"}},processor:{type:"Usage",date_field:"CallStartDateTime",usaget_mapping:[{src_field:"CallType",pattern:"WVO",usaget:"inbound_call",unit:"seconds",volume_type:"field",volume_src:["Duration"]},{src_field:"CallType",pattern:"/^(?!WVO).*$/",usaget:"outbound_call",unit:"seconds",volume_type:"field",volume_src:["Duration"]}],date_format:"m/d/Y H:i:s A",orphan_files_time:"6 hours"},customer_identification_fields:{inbound_call:[{target_key:"phone",src_key:"CallDestination",conditions:[{field:"usaget",regex:"/.*/"}],clear_regex:"//"}],outbound_call:[{target_key:"phone",src_key:"CallSource",conditions:[{field:"usaget",regex:"/.*/"}],clear_regex:"//"}]},rate_calculators:{retail:{inbound_call:[[{type:"longestPrefix",rate_key:"params.prefix",line_key:"CallSource"}]],outbound_call:[[{type:"longestPrefix",rate_key:"params.prefix",line_key:"CallDestination"}]]}},pricing:{inbound_call:{aprice_field:"Amount"},outbound_call:{aprice_field:"Amount"}}}},yh=function(e){var t=e.settings,n=e.onSetDelimiterType,a=e.delimiterOptions,i=e.onChangeDelimiter;return r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"delimiter"},"Delimiter")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-addon"},r.a.createElement("input",{type:"radio",name:"delimiter-type",style:{verticalAlign:"middle"},value:"separator",disabled:!t.get("file_type",!1),onChange:n,checked:"separator"===t.get("delimiter_type","")}),r.a.createElement("small",null,"\xa0By delimiter")),r.a.createElement(en,{fieldType:"select",className:"delimiter-select",allowCreate:!0,disabled:!t.get("file_type","")||"separator"!==t.get("delimiter_type",""),onChange:function(e){i({target:{value:e}})},options:a,value:t.get("delimiter",""),placeholder:"Select or type...",addLabelText:"{label}"}))),r.a.createElement("div",{className:"col-lg-3",style:{marginTop:10}},r.a.createElement("input",{type:"radio",name:"delimiter-type",style:{verticalAlign:"middle"},value:"fixed",disabled:!t.get("file_type",!1),onChange:n,checked:"fixed"===t.get("delimiter_type","")}),r.a.createElement("label",{htmlFor:"delimiter-type"},"\xa0Fixed width"))))};yh.defaultProps={settings:Object(g.b)(),delimiterOptions:[{value:"\t",label:"Tab"},{value:" ",label:"Space"},{value:",",label:"Comma"}]};var bh=yh,Eh=Object(on.a)(function(e){return e.inputProcessor.get("fields",g.c.List())},function(e){return e.inputProcessor.get("unfiltered_fields",g.c.List())},function(e,t){return e.size===t.size}),Ch=Object(on.a)(function(e,t){return t.settings.getIn(["customer_identification_fields",t.usaget],g.c.List())},Yn,function(e,t){return e.map(function(e){return t.find(function(t){return t.get("field_name","")===e.get("target_key","")},null,g.c.Map()).get("plays",g.c.List())}).reduce(function(e,t){return e.union(t)},g.c.Set())}),_h=Object(l.connect)()(function(e){var t=e.settings,n=e.onSelectSampleCSV;return r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"sample_csv"},"Select Sample CSV"),r.a.createElement("p",{className:"help-block"},"Notice: Spaces will be convereted to underscores")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("input",{type:"file",id:"sample_csv",accept:".csv",onClick:function(e){e.target.value=null},onChange:n,disabled:!t.get("file_type")||!t.get("delimiter_type")||"separator"!==t.get("delimiter_type")||""===t.get("delimiter")}))))}),Oh=Object(l.connect)()(function(e){return r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"sample_csv"},"Select Sample JSON")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("input",{type:"file",id:"sample_csv",onChange:e.onSelectJSON,disabled:!e.settings.get("file_type")}))))}),Sh=function(e){var t=e.index,n=e.field,a=e.fixed,i=e.width,o=e.allowMoveUp,l=e.allowMoveDown,s=e.onCheckedField,c=e.isChecked,u=e.errorMessages.name.allowedCharacters,p=Y("keyRegex","").test(n)?"":u,d=r.a.createElement(f.B,{id:"tooltip"},"Only checked fields will be available in next stages");return r.a.createElement(f.g,{lg:12,md:12},r.a.createElement(f.l,{className:"mb0",validationState:p.length>0?"error":null},r.a.createElement(f.g,{lg:4,md:4},r.a.createElement(f.o,null,r.a.createElement(f.t,{placement:"top",overlay:d},r.a.createElement(f.o.Addon,null,r.a.createElement("input",{type:"checkbox",checked:c,"aria-label":t,onChange:function(e){var a=e.target.checked;s(t,a,n)}}))),r.a.createElement(f.k,{type:"text",onChange:function(n){var a=n.target.value;e.onChange(t,a)},value:n}))),r.a.createElement(f.g,{lg:1,md:1},a&&r.a.createElement("input",{type:"number",className:"form-control","data-field":t,disabled:!a,min:"0",onChange:e.onSetFieldWidth,value:i})),r.a.createElement(f.g,{lg:5,md:5},r.a.createElement(f.c,{bsSize:"small",disabled:!o,onClick:function(){e.onMoveFieldUp(t)}},r.a.createElement("i",{className:"fa fa-arrow-up"})," Move up"),r.a.createElement(f.c,{bsSize:"small",className:"ml10",disabled:!l,onClick:function(){e.onMoveFieldDown(t)}},r.a.createElement("i",{className:"fa fa-arrow-down"})," Move down"),r.a.createElement(f.c,{bsSize:"small",className:"ml10",onClick:function(){e.onRemoveField(t,n)}},r.a.createElement("i",{className:"fa fa-trash-o danger-red"})," Remove")),p.length>0&&r.a.createElement(f.g,{lg:10,md:10},r.a.createElement(f.n,null,p))))};Sh.defaultProps={field:"",index:0,fixed:!1,allowMoveUp:!0,allowMoveDown:!0,width:"",isChecked:!0,errorMessages:{name:{allowedCharacters:"Field name contains illegal characters, name should contain only alphabets, numbers and underscores (A-Z, a-z, 0-9, _)"}},onChange:function(){},onRemoveField:function(){},onMoveFieldUp:function(){},onSetFieldWidth:function(){},onMoveFieldDown:function(){},onCheckedField:function(){}};var Th=Object(l.connect)()(Sh),kh=function(e){var t=e.settings,n="fixed"===t.get("delimiter_type",""),a=t.get("unfiltered_fields",g.c.List()).map(function(a,i){return r.a.createElement("div",{key:i},r.a.createElement("div",{className:"form-group"},r.a.createElement(Th,{index:i,onRemoveField:e.onRemoveField,field:a.get("name",""),onSetFieldWidth:e.onSetFieldWidth,fixed:n,isChecked:a.get("checked",!0),allowMoveUp:0!==i,allowMoveDown:i!==t.get("unfiltered_fields",g.c.List()).size-1,onMoveFieldDown:e.onMoveFieldDown,onMoveFieldUp:e.onMoveFieldUp,onChange:e.onChangeCSVField,width:t.getIn(["field_widths",i],""),onCheckedField:e.onCheckedField})),r.a.createElement("div",{className:"separator"}))});return r.a.createElement("div",null,a)};kh.defaultProps={settings:g.c.Map(),onRemoveField:function(){},onSetFieldWidth:function(){},onMoveFieldUp:function(){},onMoveFieldDown:function(){},onChangeCSVField:function(){},onCheckedField:function(){}};var Ih=Object(l.connect)()(kh),Nh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).initDefaultValues=function(){var e=n.props,t=e.type,a=e.settings;"api"!==t&&(null===a.get("csv_has_footer",null)&&n.props.onChangeInputProcessorField(["csv_has_footer"],!1),null===a.get("csv_has_header",null)&&n.props.onChangeInputProcessorField(["csv_has_header"],!1))},n.removeAllFields=function(){window.confirm("Are you sure you want to remove all fields?")&&n.props.onRemoveAllFields.call(Object(ki.a)(n))},n.toggleCheckAllFields=function(e){var t=e.target.checked,a=n.props.allChecked,r={message:"Are you sure you want to ".concat(a?"uncheck":"check"," all fields?"),onOk:function(){return n.props.checkAllFields(t)},type:"confirm"};n.props.dispatch(po(r))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.initDefaultValues()}},{key:"render",value:function(){var e=this,t=this.props,n=t.settings,a=t.type,i=t.action,o=t.errors,l=t.onChangeName,s=t.onSetDelimiterType,c=t.onChangeDelimiter,u=t.onSelectSampleCSV,p=t.onSelectJSON,d=t.onSetFieldWidth,m=t.onRemoveField,g=t.onMoveFieldUp,h=t.onMoveFieldDown,v=t.onChangeCSVField,y=t.onAddField,b=t.onCheckedField,E=t.allChecked,C=r.a.createElement(Ih,{onMoveFieldUp:g,onMoveFieldDown:h,onChangeCSVField:v,onRemoveField:m,settings:n,onSetFieldWidth:d,onCheckedField:b}),_=E?"Uncheck All":"Check All",O=r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},"CDR Fields"),r.a.createElement("div",{className:"panel-body"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("label",null,"\xa0\xa0Field name - Only checked fields will be saved in the system"))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("label",{title:_,className:"btn btn-default btn-sm",style:{borderRadius:3,backgroundColor:"#eeeeee"}},r.a.createElement("input",{type:"checkbox",disabled:n.get("unfiltered_fields",[]).size<1,className:"btn btn-default btn-xs",onChange:this.toggleCheckAllFields,checked:"Uncheck All"===_}))),"fixed"===n.get("delimiter_type")&&r.a.createElement("div",{className:"col-lg-2",style:{marginLeft:35}},r.a.createElement("label",null,"Width")),r.a.createElement("div",{className:"col-lg-3",style:{marginLeft:30}},r.a.createElement("button",{type:"button",disabled:n.get("unfiltered_fields",[]).size<1,className:"btn btn-default btn-sm",onClick:this.removeAllFields},r.a.createElement("i",{className:"fa fa-trash-o danger-red"})," Remove All"))),C,r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-2"},r.a.createElement(Je,{onClick:y,label:"Add Field"}))))),S="api"===a?r.a.createElement("div",null,r.a.createElement(Oh,{onSelectJSON:p,settings:n})):r.a.createElement("div",null,r.a.createElement(_h,{onSelectSampleCSV:u,settings:n}));return r.a.createElement("form",{className:"InputProcessor form-horizontal"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"file_type"},"Name")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-7".concat(o.get("name","").length>0?" has-error":"")},r.a.createElement(en,{id:"file_type",onChange:l,value:n.get("file_type",""),disabled:"new"!==i}),o.get("name","").length>0&&r.a.createElement(f.n,null,o.get("name",""))))),"api"!==a&&r.a.createElement(bh,{settings:n,onSetDelimiterType:s,onChangeDelimiter:c}),"api"!==a&&r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"file_type"},"Skip CSV header?")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-7",style:{marginTop:8}},r.a.createElement(en,{id:"csvHeader",value:n.get("csv_has_header",!1),onChange:function(t){var n=t.target.value;e.props.onChangeInputProcessorField(["csv_has_header"],n)},fieldType:"checkbox"})))),"api"!==a&&r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"file_type"},"Skip CSV footer?")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-7",style:{marginTop:8}},r.a.createElement(en,{id:"csvFooter",value:n.get("csv_has_footer",!1),onChange:function(t){var n=t.target.value;e.props.onChangeInputProcessorField(["csv_has_footer"],n)},fieldType:"checkbox"})))),S,O)}}]),t}(a.Component);Nh.defaultProps={type:"",errors:g.c.Map(),allChecked:!1};var wh=Object(l.connect)(function(e,t){return{allChecked:Eh(e,t)}})(Nh),jh=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChangeStaticUom=function(e){var t={target:{id:"default_unit",value:e}};n.props.onSetFieldMapping(t)},n.onChangeStaticUsagetVolumeType=function(e){var t={target:{id:"default_volume_type",value:e.target.value}};n.onChangeStaticUsagetVolumeField(""),n.props.onSetFieldMapping(t)},n.onChangeStaticUsagetHardCodedVolume=function(e){n.props.onSetFieldMapping(e)},n.onChangeStaticUsagetVolumeField=function(e){var t={target:{id:"default_volume_src",value:e.length?e.split(","):[]}};n.props.onSetFieldMapping(t)},n.onChangeUom=function(e){n.setState({unit:e})},n.onChangeFieldName=function(e,t){var a=n.state.conditions,r=t.target.value;a[e].src_field=r,n.setState({fieldName:r,conditions:a})},n.onChangeOperator=function(e,t,a){var r,i=n.state.conditions,o=a.target.value;t.forEach(function(e){e.value===o&&(r=e.label)}),i[e].op=o,i[e].op_label=r,n.setState({op:o,conditions:i,pattern:""})},n.onChangeSeparateTime=function(e){e.target.checked||(n.props.unsetField(["processor","time_field"]),n.onChangeTimeFormatExists()),n.setState({separateTime:!n.state.separateTime})},n.onChangeSeparateTimeZone=function(e){e.target.checked||(n.props.unsetField(["processor","timezone_field"]),n.onChangeTimeZoneExists()),n.setState({separateTimeZone:!n.state.separateTimeZone})},n.onChangeDynamicUsagetVolumeType=function(e){var t=e.target.value;n.setState({volumeType:t,volumeHardCodedValue:"",volumeFields:[]})},n.onChangeDynamicUsagetHardCodedVolume=function(e){var t=e.target.value;n.setState({volumeHardCodedValue:t})},n.onChangeDynamicUsagetVolumeField=function(e){var t=e.length?e.split(","):[];n.setState({volumeFields:t})},n.onChangeDateFormat=function(e){n.props.onSetFieldMapping(e)},n.onChangeDateFormatExists=function(){var e={target:{value:void 0,id:"date_format"}};n.onChangeDateFormat(e)},n.onChangeTimeFormat=function(e){n.props.onSetFieldMapping(e)},n.onChangeTimeZoneFormat=function(e){n.props.onSetFieldMapping(e)},n.onChangeTimeFormatExists=function(){var e={target:{value:void 0,id:"time_format"}};n.onChangeTimeFormat(e)},n.onChangeTimeZoneExists=function(){var e={target:{value:void 0,id:"timezone_field"}};n.onChangeTimeZoneFormat(e)},n.getVolumeOptions=function(){return n.props.settings.get("fields",g.c.List()).sortBy(function(e){return e}).map(function(e){return{label:e,value:e}}).toArray()},n.onRemoveCondition=function(e){var t=n.state.conditions;t.splice(e,1),n.setState({conditions:t})},n.onChangeMultiValues=function(e,t){Array.isArray(t)?n.onChangeTagValue(e,t.join(",")):n.onChangeTagValue(e,"")},n.onChangeTagValue=function(e,t){var a=n.state.conditions;a[e].pattern=t,n.setState({pattern:t,conditions:a})},n.onChangePattern=n.onChangePattern.bind(Object(ki.a)(n)),n.onChangeUsaget=n.onChangeUsaget.bind(Object(ki.a)(n)),n.addUsagetMapping=n.addUsagetMapping.bind(Object(ki.a)(n)),n.onChangeUsaget=n.onChangeUsaget.bind(Object(ki.a)(n)),n.onSetType=n.onSetType.bind(Object(ki.a)(n)),n.onChangeStaticUsaget=n.onChangeStaticUsaget.bind(Object(ki.a)(n)),n.addFieldCondition=n.addFieldCondition.bind(Object(ki.a)(n)),n.onChangeFieldName=n.onChangeFieldName.bind(Object(ki.a)(n)),n.onRemoveCondition=n.onRemoveCondition.bind(Object(ki.a)(n)),n.onChangeOperator=n.onChangeOperator.bind(Object(ki.a)(n)),n.onChangeMultiValues=n.onChangeMultiValues.bind(Object(ki.a)(n)),n.state={fieldName:"",op:"",opLabel:"",pattern:"",usaget:"",unit:"",separateTime:!1,separateTimeZone:!1,volumeType:"field",volumeFields:[],volumeHardCodedValue:"",conditions:[]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.settings.getIn(["processor","time_field"])&&this.setState({separateTime:!0});var e=this.props.settings.getIn(["processor","timezone_field"]);this.props.settings.get("fields").includes(e)&&this.setState({separateTimeZone:!0})}},{key:"onChangePattern",value:function(e,t){var n=this.state.conditions,a=t.target.value;n[e].pattern=a,this.setState({pattern:a,conditions:n})}},{key:"changeUsaget",value:function(e,t){this.setState({usaget:e}),t&&this.props.onSetStaticUsaget(e)}},{key:"onChangeUsaget",value:function(e){this.changeUsaget(e,!1)}},{key:"onChangeStaticUsaget",value:function(e){this.changeUsaget(e,!0)}},{key:"addUsagetMapping",value:function(e){var t=this.state,n=t.usaget,a=t.pattern,r=t.unit,i=t.volumeType,o=t.volumeFields,l=t.volumeHardCodedValue,s=t.fieldName,c=t.op,u=t.conditions,p="field"===i?o:l,d=this.props.onError;if(s)if(n&&a&&r&&i&&p&&c){0===u.length&&u.push({src_field:s,pattern:a,op:c});var m={usaget:n,pattern:a,unit:r,volumeType:i,volumeSrc:p,fieldName:s,op:c,conditions:u};this.props.onAddUsagetMapping.call(this,m),this.setState({pattern:"",usaget:"",unit:"",volumeType:"field",volumeFields:[],volumeHardCodedValue:"",fieldName:"",conditions:[],op:""})}else d("Please input a value, usage type, unit and volume field/value");else d("Please select usage type field")}},{key:"addFieldCondition",value:function(e){var t=this.state,n=t.fieldName,a=t.pattern,r=t.conditions,i=t.op,o=this.props.onError;a&&n&&i?(r.push({src_field:"",pattern:"",op:""}),this.setState({conditions:r})):o("Please input a field name, operator and a value")}},{key:"removeUsagetMapping",value:function(e,t){this.props.onRemoveUsagetMapping.call(this,e)}},{key:"onSetType",value:function(e){var t=e.target.value;this.props.setUsagetType(t)}},{key:"render",value:function(){var e=this,t=this.state,n=t.separateTime,a=t.separateTimeZone,i=t.usaget,o=t.unit,l=t.volumeType,s=t.volumeFields,c=t.volumeHardCodedValue,u=t.conditions,p=t.fieldName,d=t.pattern,m=t.op,h=this.props,v=h.settings,y=h.usageTypesData,b=h.propertyTypes,E=h.onSetFieldMapping,C=[r.a.createElement("option",{disabled:!0,value:"",key:-1},"Select Field...")].concat(Object(w.a)(v.get("fields",g.c.List()).sortBy(function(e){return e}).map(function(e,t){return r.a.createElement("option",{value:e,key:t},e)}))),_="static"!==v.get("usaget_type","")?"":v.getIn(["processor","default_usaget"],""),O="static"!==v.get("usaget_type","")?"":v.getIn(["processor","default_unit"],""),S="static"!==v.get("usaget_type","")?"":v.getIn(["processor","default_volume_type"],"field"),T="static"!==v.get("usaget_type","")?"":v.getIn(["processor","default_volume_src"],[]),k=this.getVolumeOptions(),I=[{value:"$eq",label:"Equals"},{value:"$ne",label:"Not Equals"},{value:"$in",label:"In"},{value:"$nin",label:"Not In"},{value:"$regex",label:"Regex"}],N=[r.a.createElement("option",{disabled:!0,value:"",key:-1},"Select Field...")].concat(Object(w.a)(I.map(function(e,t){return r.a.createElement("option",{value:e.value,key:t},e.label)}))),j=v.getIn(["processor","date_format"])||"",R={fieldType:"text",id:"date_format",onChange:this.onChangeDateFormat},x=v.getIn(["processor","time_format"])||"",F={fieldType:"text",id:"time_format",onChange:this.onChangeTimeFormat};return 0===u.length&&u.push({src_field:p,pattern:d,op:m}),r.a.createElement("form",{className:"form-horizontal FieldsMapping"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"date_field"},"Date Time"),r.a.createElement("p",{className:"help-block"},"Date and time of record creation",r.a.createElement("br",null),r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"http://php.net/manual/en/function.date.php#refsect1-function.date-parameters"},"Formatting info"))),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-4 form-inner-edit-row"},r.a.createElement("select",{id:"date_field",className:"form-control",onChange:E,value:v.getIn(["processor","date_field"],"")},C)),r.a.createElement("div",{className:"col-lg-5 form-inner-edit-row"},r.a.createElement(en,{fieldType:"toggeledInput",value:j,disabledValue:"",disabled:null===j||void 0===j,onChange:this.onChangeDateFormatExists,label:!0===this.state.separateTime?"Date format":"Date and time format",inputProps:R})),r.a.createElement("div",{className:"col-lg-1"},r.a.createElement(Ii,{contents:"Check to force a custom format. If not checked, default format is mm/dd/yy"}))),r.a.createElement("div",{className:"col-lg-offset-3 col-lg-9"},r.a.createElement("div",{className:"col-lg-offset-1 col-lg-4"},r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-addon"},r.a.createElement("input",{type:"checkbox",checked:n,onChange:this.onChangeSeparateTime}),r.a.createElement("small",{style:{verticalAlign:"bottom"}},"\xa0Time in a separate field")),r.a.createElement("select",{id:"time_field",className:"form-control",onChange:E,disabled:!n,value:v.getIn(["processor","time_field"],"")},C))),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement(en,{fieldType:"toggeledInput",value:x,disabledValue:"",disabled:!this.state.separateTime||""===j,onChange:this.onChangeTimeFormatExists,label:"Time format",inputProps:F})),r.a.createElement("div",{className:"col-lg-1"},r.a.createElement(Ii,{contents:"To enable, enter date format. For formatting info please check the link on the left"}))),r.a.createElement("div",{className:"col-lg-offset-3 col-lg-9",style:{marginTop:30}},r.a.createElement("div",{className:"col-lg-offset-1 col-lg-4"},r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-addon"},r.a.createElement("input",{type:"checkbox",checked:a,onChange:this.onChangeSeparateTimeZone}),r.a.createElement("small",null,"\xa0Timezone in a separate field")),r.a.createElement("select",{id:"timezone_field",className:"form-control",onChange:E,disabled:!a,value:v.getIn(["processor","timezone_field"],"")},C))))),r.a.createElement("div",{className:"separator"}),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",null,"Usage types / volumes")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-4 form-inner-edit-row",style:{marginTop:8}},r.a.createElement("label",{htmlFor:"static"},r.a.createElement("input",{type:"radio",style:{verticalAlign:"top"},name:"usage_types_type",value:"static",checked:"static"===v.get("usaget_type",""),onChange:this.onSetType}),"\xa0Static")),r.a.createElement("div",{className:"col-lg-4 form-inner-edit-row",style:{marginTop:8}},r.a.createElement("label",{htmlFor:"dynamic"},r.a.createElement("input",{type:"radio",style:{verticalAlign:"top"},name:"usage_types_type",value:"dynamic",checked:"dynamic"===v.get("usaget_type",""),onChange:this.onSetType}),"\xa0Dynamic"))),"static"===v.get("usaget_type","")&&r.a.createElement(f.g,{sm:12},r.a.createElement(f.x,{className:"form-inner-edit-row"},r.a.createElement("div",{className:"col-lg-7"},r.a.createElement("div",{className:"col-lg-7"},r.a.createElement("strong",null,"Usage Type")),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("strong",null,"Unit"))),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("strong",null,"Volume field / value"))),r.a.createElement(f.x,null,r.a.createElement("div",{className:"col-lg-7"},r.a.createElement(eu,{usaget:_,unit:O,onChangeUsaget:this.onChangeStaticUsaget,onChangeUnit:this.onChangeStaticUom,enabled:"static"===v.get("usaget_type",""),showDisplayUnits:!0})),r.a.createElement("div",{className:"col-lg-1"},r.a.createElement(en,{fieldType:"radio",name:"static-usaget-volume-type",id:"static-usaget-volume-type-field",value:"field",checked:"field"===S,onChange:this.onChangeStaticUsagetVolumeType,label:"By field"}),r.a.createElement(en,{fieldType:"radio",name:"static-usaget-volume-type",id:"static-usaget-volume-type-value",value:"value",checked:"value"===S,onChange:this.onChangeStaticUsagetVolumeType,label:"By value"})),r.a.createElement("div",{className:"col-lg-3"},"field"===S?r.a.createElement(en,{fieldType:"select",multi:!0,value:T.join(","),options:k,onChange:this.onChangeStaticUsagetVolumeField}):r.a.createElement(en,{fieldType:"number",id:"default_volume_src",value:T,onChange:this.onChangeStaticUsagetHardCodedVolume})))),"dynamic"===v.get("usaget_type","")&&r.a.createElement("div",{className:"col-lg-12 form-inner-edit-row"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("strong",null,"Field Name")),r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("strong",null,"Op")),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("strong",null,"Input Value"))),r.a.createElement("div",{className:"col-lg-7"},r.a.createElement("div",{className:"col-lg-6 pl0 pr0"},r.a.createElement("div",{className:"col-lg-7"},r.a.createElement("strong",null,"Usage Type")),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("strong",null,"Unit"))),r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("strong",null,"Volume field / value")))),v.getIn(["processor","usaget_mapping"],g.c.List()).map(function(t,n){return r.a.createElement("div",{className:"form-group",key:n,style:{marginRight:60}},r.a.createElement("div",{className:"col-lg-6"},v.getIn(["processor","usaget_mapping",n,"conditions"],g.c.List()).map(function(e,t){return r.a.createElement("div",{className:"row-lg-12",key:"condition-".concat(t)},r.a.createElement("div",{className:"col-lg-4",style:{marginLeft:-4}},e.get("src_field")),r.a.createElement("div",{className:"col-lg-4",style:{marginLeft:18}},e.get("op_label")),r.a.createElement("div",{className:"col-lg-4",style:{marginLeft:-75}},e.get("pattern")))})),r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("div",{className:"col-lg-6 pl0 pr0"},r.a.createElement("div",{className:"col-lg-7",style:{marginLeft:-92}},t.get("usaget","")),r.a.createElement("div",{className:"col-lg-5",style:{marginLeft:50}}," ",ye(b,y,t.get("usaget",""),t.get("unit","")))),r.a.createElement("div",{className:"col-lg-3",style:{marginLeft:-8}},"field"===t.get("volume_type","field")?t.get("volume_src",[]).join(", "):t.get("volume_src","")),r.a.createElement("div",{className:"col-lg-1"},r.a.createElement("button",{type:"button",className:"btn btn-default btn-sm",disabled:"dynamic"!==v.get("usaget_type",""),onClick:e.removeUsagetMapping.bind(e,n)},r.a.createElement("i",{className:"fa fa-trash-o danger-red"})," Remove"))),r.a.createElement("div",{className:"col-lg-offset-1 col-lg-10",style:{padding:16}},r.a.createElement("div",{className:"separator"})))}),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-5"},u.map(function(t,n){return r.a.createElement("div",{className:"row-lg-12 form-inner-edit-row row",key:n},r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("select",{id:"src_field",className:"form-control",onChange:e.onChangeFieldName.bind(e,n),value:""===t.src_field?"":t.src_field,disabled:"dynamic"!==v.get("usaget_type","")},C)),r.a.createElement("div",{className:"col-lg-2"},r.a.createElement("select",{id:"op",className:"form-control",onChange:e.onChangeOperator.bind(e,n,I),value:""===t.op?"":t.op,disabled:"dynamic"!==v.get("usaget_type","")},N)),r.a.createElement("div",{className:"col-lg-4"},"$in"!==t.op&&"$nin"!==t.op&&r.a.createElement("input",{className:"form-control",onChange:e.onChangePattern.bind(e,n),disabled:"dynamic"!==v.get("usaget_type",""),value:""===t.pattern?"":t.pattern}),("$in"===t.op||"$nin"===t.op)&&r.a.createElement(en,{fieldType:"tags",id:"cond-value-".concat(n),onChange:e.onChangeMultiValues.bind(e,n),value:t.pattern.split(",").filter(function(e){return""!==e})})),r.a.createElement("div",{className:"col-lg-1"},u.length>1&&r.a.createElement("button",{type:"button",className:"btn btn-link","data-dismiss":"alert","aria-label":"Close",onClick:e.onRemoveCondition.bind(e,n)},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))})),r.a.createElement("div",{className:"col-lg-7"},r.a.createElement("div",{className:"col-lg-5"},r.a.createElement(eu,{usaget:i,unit:o,onChangeUsaget:this.onChangeUsaget,onChangeUnit:this.onChangeUom,enabled:"dynamic"===v.get("usaget_type",""),showDisplayUnits:!0})),r.a.createElement("div",{className:"col-lg-2"},r.a.createElement(en,{fieldType:"radio",name:"dynamic-usaget-volume-type",id:"dynamic-usaget-volume-type-field",value:"field",checked:"field"===l,onChange:this.onChangeDynamicUsagetVolumeType,label:"By field"}),r.a.createElement(en,{fieldType:"radio",name:"dynamic-usaget-volume-type",id:"dynamic-usaget-volume-type-value",value:"value",checked:"value"===l,onChange:this.onChangeDynamicUsagetVolumeType,label:"By value"})),r.a.createElement("div",{className:"col-lg-3"},"field"===l?r.a.createElement(en,{fieldType:"select",multi:!0,value:s.join(","),options:k,onChange:this.onChangeDynamicUsagetVolumeField}):r.a.createElement(en,{fieldType:"number",value:c,onChange:this.onChangeDynamicUsagetHardCodedVolume})))),r.a.createElement("div",{className:"col-lg-1"},r.a.createElement("button",{type:"button",className:"btn btn-primary btn-sm",onClick:this.addFieldCondition},r.a.createElement("i",{className:"fa fa-plus"})," Add Condition"))),"dynamic"===v.get("usaget_type","")&&r.a.createElement("div",{className:"form-group",style:{marginRight:60}},r.a.createElement("div",{className:"col-lg-offset-1 col-lg-10",style:{padding:16}},r.a.createElement("div",{className:"separator"}))),"dynamic"===v.get("usaget_type","")&&r.a.createElement("div",{className:"col-lg-offset-10 col-lg-1",style:{marginLeft:600}},r.a.createElement("button",{type:"button",className:"btn btn-primary btn-sm",onClick:this.addUsagetMapping},r.a.createElement("i",{className:"fa fa-plus"})," Add Mapping"))))}}]),t}(a.Component);jh.defaultProps={settings:g.c.Map(),usageTypes:g.c.List(),usageTypesData:g.c.List(),propertyTypes:g.c.List(),onSetStaticUsaget:function(){},onSetFieldMapping:function(){}};var Rh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onSetCustomerMapping=function(e){var t=n.props,a=t.usaget,r=t.priority,i=e.target,o=i.value,l=i.id;n.props.onSetCustomerMapping(l,o,a,r)},n.onSetCustomerMappingTarget=function(e){var t=e.target,a=t.value,r=t.id,i=n.props.subscriberFields,o={target:{id:r,value:a}};if(i.find(function(e){return e.get("field_name","")===a},null,g.c.Map()).get("unique",!1))return n.onSetCustomerMapping(o);var l={message:"You selected a non-unique field for subscriber matching. Continue?",onOk:function(){n.onSetCustomerMapping(o)},type:"delete",labelOk:"Continue"};return n.props.dispatch(po(l))},n.onChangeClearRegex=function(e){var t=n.props,a=t.usaget,r=t.priority;n.props.onSetCustomerMapping("clear_regex",e,a,r)},n.getCustomerIdentificationFields=function(){return Re(n.props.settings).map(function(e,t){return r.a.createElement("option",{value:e.get("value",""),key:t},e.get("label",""))}).toArray()},n.getAvailableTargetFields=function(){var e=n.props.subscriberFields.sort(function(e){return e.get("unique",!1)?-1:1}).map(function(e,t){var n=e.get("field_name",""),a=G(n,"customerIdentification",e.get("title","")),i=k()({"label-text":e.get("unique",!1),disabled:!e.get("unique",!1)});return r.a.createElement("option",{value:n,key:"target-field-".concat(t),className:i},a)});return[r.a.createElement("option",{disabled:!0,value:"-1",key:"target-field-empty"},"Select...")].concat(Object(w.a)(e.toArray()))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.mapping,t=e.getIn(["target_key"],"sid"),n=e.getIn(["src_key"],""),a=e.getIn(["clear_regex"],""),i=this.getCustomerIdentificationFields(),o=this.getAvailableTargetFields();return r.a.createElement("div",null,r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("select",{id:"src_key",className:"form-control",onChange:this.onSetCustomerMapping,value:n},i)),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement(en,{value:a,id:"clear_regex",disabledValue:"//",onChange:this.onChangeClearRegex,label:"Regex",fieldType:"toggeledInput"})),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("select",{id:"target_key",className:"form-control",onChange:this.onSetCustomerMappingTarget,value:t},o)))}}]),t}(a.Component);Rh.defaultProps={settings:g.c.Map(),subscriberFields:g.c.List()};var xh=Object(l.connect)(null)(Rh),Fh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onAddCustomerMapping=function(e){return function(){n.props.dispatch(function(e){return{type:Jg,usaget:e}}(e))}},n.onRemoveCustomerMapping=function(e,t){return function(){n.props.dispatch(function(e,t){return{type:Qg,usaget:e,priority:t}}(e,t))}},n.renderAddCustomerMappingButton=function(e){return r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:n.onAddCustomerMapping(e)},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0Add")},n.renderRemoveCustomerMappingButton=function(e,t){return r.a.createElement(f.c,{bsStyle:"link",bsSize:"xsmall",onClick:n.onRemoveCustomerMapping(e,t)},r.a.createElement("i",{className:"fa fa-fw fa-trash-o danger-red"}))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.settings,a=t.subscriberFields,i=n.get("customer_identification_fields",g.c.Map());return r.a.createElement(f.j,{horizontal:!0,className:"customerMappings"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("h4",null,"Customer identification",r.a.createElement("small",null," | Map customer identification field in record to BillRun field")))),i.map(function(t,i){return r.a.createElement("div",{key:"customer-mapping-".concat(i)},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:i},i)),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),t.map(function(t,o){var l=k()("form-inner-edit-row","col-lg-9",{"col-lg-offset-1":o>0});return r.a.createElement("div",{className:l,key:"customer-mapping-".concat(i,"-").concat(o)},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-11"},r.a.createElement(xh,{usaget:i,mapping:t,priority:o,onSetCustomerMapping:e.props.onSetCustomerMapping,subscriberFields:a,settings:n})),r.a.createElement("div",{className:"col-lg-1"},o>0&&e.renderRemoveCustomerMappingButton(i,o))))}).toList().toArray(),r.a.createElement("div",{className:"col-lg-9 col-lg-offset-1"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-11"},r.a.createElement("div",{className:"col-lg-4"},e.renderAddCustomerMappingButton(i))))))))}).toList().toArray())}}]),t}(a.Component);Fh.defaultProps={settings:g.c.Map(),subscriberFields:g.c.List()};var Ph=Object(l.connect)()(Fh),Mh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).getConditionResultProjectOptions=function(){return["condition_result","hard_coded"].map(oe)},n.getRateConditions=function(){return Y(["rates","conditions"],g.c.List()).map(le).toArray()},n.onChangeComputedLineKeyHardCodedKey=function(e){var t=e.target.value;n.props.onChangeComputedLineKey(["line_keys",1,"key"])(t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(il(["lines"]))}},{key:"render",value:function(){var e=this.props,t=e.computedLineKey,n=e.settings,a=e.foreignFields;if(!t)return null;var i="In case you want to run a regular expression on the computed field before calculating the rate",o=a.filter(function(e){return"rate"===e.get("available_from","")}).map(function(e){var t=e.get("field_name",""),n=e.get("title",Object(x.titleCase)(t));return{value:t,label:"".concat(n," (foreign field)")}}).push({value:"type",label:"Type"}).push({value:"usaget",label:"Usage Type"}).push({value:"file",label:"File name"}).toArray(),l=Re(n,o).toJS(),s="regex"===t.get("type","regex"),c="$exists"===t.get("operator","")||"$existsFalse"===t.get("operator",""),u=this.getConditionResultProjectOptions().concat(l);return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:2},"Computation Type"),r.a.createElement(f.g,{sm:10},r.a.createElement("span",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(en,{fieldType:"radio",name:"computed-type",id:"computed-type-regex",value:"regex",checked:s,onChange:this.props.onChangeComputedLineKeyType,label:"Regex"})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(en,{fieldType:"radio",name:"computed-type",id:"computed-type-condition",value:"condition",checked:!s,onChange:this.props.onChangeComputedLineKeyType,label:"Condition"}))))),r.a.createElement("div",{className:"separator"}),r.a.createElement(f.l,{key:"computed-field-1"},r.a.createElement(f.g,{sm:2,componentClass:f.h},s?"Field":"First Field"),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",onChange:this.props.onChangeComputedLineKey(["line_keys",0,"key"]),value:t.getIn(["line_keys",0,"key"],""),options:l,allowCreate:!0})),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{value:t.getIn(["line_keys",0,"regex"],""),disabledValue:"",onChange:this.props.onChangeComputedLineKey(["line_keys",0,"regex"]),disabled:""===t.getIn(["line_keys",0,"key"],"")||c,label:r.a.createElement("span",null,"Regex",r.a.createElement(Ii,{contents:i})),fieldType:"toggeledInput"}))),!s&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.l,{key:"computed-operator"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Operator"),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",onChange:this.props.onChangeComputedLineKey(["operator"]),value:t.get("operator",""),options:this.getRateConditions()}))),r.a.createElement(f.l,{key:"computed-field-2"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Second Field"),r.a.createElement(f.g,{sm:5},"$regex"===t.get("operator","")&&r.a.createElement(en,{value:t.getIn(["line_keys",1,"key"],""),onChange:this.onChangeComputedLineKeyHardCodedKey}),"$regex"!==t.get("operator","")&&r.a.createElement(en,{fieldType:"select",onChange:this.props.onChangeComputedLineKey(["line_keys",1,"key"]),value:t.getIn(["line_keys",1,"key"],""),options:l,disabled:c})),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{value:t.getIn(["line_keys",1,"regex"],""),disabledValue:"",onChange:this.props.onChangeComputedLineKey(["line_keys",1,"regex"]),disabled:""===t.getIn(["line_keys",1,"key"],"")||"$regex"===t.get("operator",""),label:r.a.createElement("span",null,"Regex",r.a.createElement(Ii,{contents:i})),fieldType:"toggeledInput"}))),r.a.createElement(f.l,{key:"computed-must-met"},r.a.createElement(f.g,{componentClass:f.h,sm:2},"Must met?",r.a.createElement(Ii,{contents:"This means than in case the condition is not met - a rate will not be found"})),r.a.createElement(f.g,{sm:5,style:{marginTop:10}},r.a.createElement("div",{className:"inline"},r.a.createElement(en,{fieldType:"checkbox",id:"computed-must-met",value:t.get("must_met",!1),onChange:this.props.onChangeComputedMustMet})))),r.a.createElement(f.l,{key:"computed-cond-project-true"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Value when True"),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",onChange:this.props.onChangeComputedLineKey(["projection","on_true","key"]),value:t.getIn(["projection","on_true","key"],"condition_result"),options:u})),["hard_coded"].includes(t.getIn(["projection","on_true","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(en,{value:t.getIn(["projection","on_true","value"],""),onChange:this.props.onChangeHardCodedValue(["projection","on_true","value"])})),!["","hard_coded","condition_result"].includes(t.getIn(["projection","on_true","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(en,{value:t.getIn(["projection","on_true","regex"],""),disabledValue:"",onChange:this.props.onChangeComputedLineKey(["projection","on_true","regex"]),disabled:""===t.getIn(["projection","on_true","key"],""),label:"Regex",fieldType:"toggeledInput"}))),r.a.createElement(f.l,{key:"computed-cond-project-false"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Value when False"),r.a.createElement(f.g,{sm:5},r.a.createElement(en,{fieldType:"select",onChange:this.props.onChangeComputedLineKey(["projection","on_false","key"]),value:t.getIn(["projection","on_false","key"],"condition_result"),options:u,disabled:t.get("must_met",!1)})),["hard_coded"].includes(t.getIn(["projection","on_false","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(en,{value:t.getIn(["projection","on_false","value"],""),onChange:this.props.onChangeHardCodedValue(["projection","on_false","value"])})),!["","hard_coded","condition_result"].includes(t.getIn(["projection","on_false","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(en,{value:t.getIn(["projection","on_false","regex"],""),disabledValue:"",onChange:this.props.onChangeComputedLineKey(["projection","on_false","regex"]),disabled:""===t.getIn(["projection","on_false","key"],""),label:"Regex",fieldType:"toggeledInput"})))))}}]),t}(a.Component);Mh.defaultProps={computedLineKey:g.c.Map(),settings:g.c.Map(),foreignFields:g.c.List(),onChangeComputedLineKeyType:function(){},onChangeComputedLineKey:function(){},onChangeComputedMustMet:function(){},onChangeHardCodedValue:function(){}};var Ah=Object(l.connect)(function(e,t){return{foreignFields:Kn(e,t)}})(Mh),Dh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={computedLineKey:null,openRateCalculators:[0]},n.componentDidMount=function(){var e=n.props,t=e.settings,a=e.rateCategory;t.getIn(["rate_calculators",a],g.c.Map()).keySeq().map(function(e){return e}).forEach(function(e){0===t.getIn(["rate_calculators",a,e],g.c.List()).size&&n.onAddRating({target:{dataset:{ratecategory:a,usaget:e}}})})},n.sortFiledByPlay=function(e){return e.get("plays",g.c.List()).isEmpty()?1:-1},n.filterFiledByPlay=function(e){var t=n.props.plays,a=e.get("plays",g.c.List());return!!a.isEmpty()||t.intersect(g.c.Set(a)).size>0},n.getCustomRatingFields=function(){return n.props.customRatingFields.filter(function(e){return e.get("field_name","").startsWith("params.")}).filter(n.filterFiledByPlay).sort(n.sortFiledByPlay).map(function(e){return{value:e.get("field_name",""),label:e.get("title","")}}).toJS()},n.getRatingTypes=function(){return[{value:"match",label:"Equals"},{value:"equalFalse",label:"Does Not Equal"},{value:"longestPrefix",label:"Longest Prefix"}]},n.onChangeAdditionalParamRating=function(e,t,a,r,i){return function(o){var l={target:{dataset:{rate_key:o,ratecategory:e,usaget:t,priority:a,index:r},value:i,custom:!0}};n.onSetRating(l)}},n.onChangeAdditionalParamRatingType=function(e,t,a,r,i){return function(o){n.onChangeAdditionalParamRating(t,a,r,i,o)(e)}},n.getRateCalculatorFields=function(){return Re(n.props.settings,[{value:"type",label:"Type"},{value:"usaget",label:"Usage Type"},{value:"usagev",label:"Activity Volume"},{value:"file",label:"File name"},{value:"computed",label:"Computed"}]).map(function(e,t){return r.a.createElement("option",{value:e.get("value",""),key:t},e.get("label",""))})},n.addNewRatingCustomField=function(e,t,a){var r=n.props.customRatingFields;return n.props.dispatch(Zo("rates",["fields"],r.push(g.c.Map({field_name:e,title:t,multiple:"longestPrefix"===a,display:!0,editable:!0})))),n.props.dispatch(rl("rates"))},n.onSetRating=function(e){var t=n.props.customRatingFields,a=e.target,r=a.dataset,i=r.ratecategory,o=r.usaget,l=r.priority,s=r.index,c=a.value,u=a.custom,p=e.target.dataset.rate_key,d=F.a.snakeCase(p);if(d=(d=d.replace("params.","")).replace("params_",""),d="params.".concat(d),u&&""!==p&&!t.find(function(e){return e.get("field_name","")===d}))n.addNewRatingCustomField(d,p,c),p=d;else{var m=t.find(function(e){return e.get("field_name","")===d});m&&u&&""!==p&&p!==m.title&&p!==d&&(n.props.dispatch(Ja("Product param ".concat(p," already exists as custom field ").concat(d))),p=m.title)}var g=parseInt(s);n.props.dispatch(function(e,t,n,a,r,i){return{type:qg,rateCategory:e,usaget:t,priority:n,index:a,rate_key:r,value:i}}(i,o,l,g,p,c))},n.onAddRating=function(e){var t=e.target.dataset,a=t.ratecategory,r=t.usaget,i=t.priority;n.props.dispatch(function(e,t,n){return{type:zg,rateCategory:e,usaget:t,priority:n}}(a,r,i))},n.onRemoveRating=function(e){var t=e.target.dataset,a=t.ratecategory,r=t.usaget,i=t.priority,o=t.index;n.props.dispatch(function(e,t,n,a){return{type:Gg,rateCategory:e,usaget:t,priority:n,index:a}}(a,r,i,o))},n.onRemoveRatingPriority=function(e,t,a){return function(){n.props.dispatch(function(e,t,n){return{type:Yg,rateCategory:e,usaget:t,priority:n}}(e,t,a))}},n.onSetLineKey=function(e){var t=e.target,a=t.dataset,r=a.ratecategory,i=a.usaget,o=a.index,l=a.priority,s=t.value;n.props.dispatch(function(e,t,n,a,r){return{type:lf,rateCategory:e,usaget:t,priority:n,index:a,value:r}}(r,i,l,o,s))},n.onSetComputedLineKey=function(e,t){n.props.dispatch(function(e,t){return{type:sf,paths:e,values:t}}(e,t))},n.onUnsetComputedLineKey=function(e,t,a,r){n.props.dispatch(function(e,t,n,a){return{type:cf,rateCategory:e,usaget:t,priority:n,index:a}}(e,t,a,r))},n.getComputedLineKeyObject=function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:g.c.Map();return g.c.Map({rateCategory:e,usaget:t,priority:n,index:a,type:r.getIn(["computed","type"],"regex"),line_keys:r.getIn(["computed","line_keys"],g.c.List()),operator:r.getIn(["computed","operator"],""),must_met:r.getIn(["computed","must_met"],!1),projection:g.c.Map({on_true:g.c.Map({key:r.getIn(["computed","projection","on_true","key"],"condition_result"),regex:r.getIn(["computed","projection","on_true","regex"],""),value:r.getIn(["computed","projection","on_true","value"],"")}),on_false:g.c.Map({key:r.getIn(["computed","projection","on_false","key"],"condition_result"),regex:r.getIn(["computed","projection","on_false","regex"],""),value:r.getIn(["computed","projection","on_false","value"],"")})})})},n.onChangeLineKey=function(e){var t=e.target,a=t.dataset,r=a.ratecategory,i=a.usaget,o=a.index,l=a.priority;"computed"===t.value?n.setState({computedLineKey:n.getComputedLineKeyObject(r,i,l,o)}):(n.setState({computedLineKey:null}),n.onUnsetComputedLineKey(r,i,l,o)),n.onSetLineKey(e)},n.onEditComputedLineKey=function(e,t,a,r,i){return function(){n.setState({computedLineKey:n.getComputedLineKeyObject(t,a,r,i,e)})}},n.onSaveComputedLineKey=function(){var e=n.state.computedLineKey,t=[e.get("rateCategory"),e.get("usaget"),e.get("priority"),e.get("index"),"computed"],a=[[].concat(t,["line_keys"]),[].concat(t,["operator"]),[].concat(t,["type"]),[].concat(t,["must_met"]),[].concat(t,["projection"])],r=[e.get("line_keys",g.c.List()),e.get("operator",""),e.get("type",""),e.get("must_met",!1),e.get("projection",g.c.Map())];n.onSetComputedLineKey(a,r),n.setState({computedLineKey:null})},n.onChangeComputedMustMet=function(e){var t=e.target.value,a=n.state.computedLineKey.withMutations(function(e){e.set("must_met",t),t&&e.setIn(["projection","on_false"],g.c.Map())});n.setState({computedLineKey:a})},n.onChangeHardCodedValue=function(e){return function(t){var a=t.target.value;n.onChangeComputedLineKey(e)(a)}},n.onChangeComputedLineKey=function(e){return function(t){var a=n.state.computedLineKey,r=a.withMutations(function(n){n.setIn(e,t);var r=e[1];if("operator"===e[0]){var i="$regex"===a.get("operator","")&&"$regex"!==t,o="$regex"!==a.get("operator","")&&"$regex"===t;(i||o||("$exists"===t||"$existsFalse"===t))&&(n.deleteIn(["line_keys",1]),n.deleteIn(["line_keys",0,"regex"]))}"hard_coded"===t?n.deleteIn(["projection",r,"value"]):"condition_result"===t&&(n.deleteIn(["projection",r,"value"]),n.deleteIn(["projection",r,"regex"]))});n.setState({computedLineKey:r})}},n.onChangeComputedLineKeyType=function(e){var t=e.target.value,a=n.state.computedLineKey.withMutations(function(e){e.set("type",t),"regex"===t&&(e.deleteIn(["line_keys",1]),e.delete("operator"),e.delete("must_met"),e.delete("projection"))});n.setState({computedLineKey:a})},n.onHideComputedLineKey=function(){n.setState({computedLineKey:null})},n.renderComputedLineKeyDesc=function(e,t,a,i,o){if("computed"!==e.get("line_key",""))return null;var l=e.getIn(["computed","operator"],""),s=Y(["rates","conditions"],g.c.Map()).find(function(e){return e.get("id","")===l},null,g.c.Map()).get("title","");return r.a.createElement("h4",null,r.a.createElement("small",null,"".concat(e.getIn(["computed","line_keys",0,"key"],"")," ").concat(s," ").concat(e.getIn(["computed","line_keys",1,"key"],"")),r.a.createElement(f.c,{onClick:n.onEditComputedLineKey(e,t,a,i,o),bsStyle:"link"},r.a.createElement("i",{className:"fa fa-fw fa-pencil"}))))},n.openRateCalculator=function(e){return function(){var t=n.state.openRateCalculators;t.push(e),n.setState({openRateCalculators:t})}},n.closeRateCalculator=function(e){return function(){var t=n.state.openRateCalculators;t.splice(t.indexOf(e),1),n.setState({openRateCalculators:t})}},n.onAddRatingPriority=function(e,t){return function(){var a=n.props.rateCalculators;n.openRateCalculator(a.size)(),n.props.dispatch(function(e,t){return{type:Hg,rateCategory:e,usaget:t}}(e,t))}},n.getRateCalculatorsForPriority=function(e,t,a,i){var o=n.getRateCalculatorFields();return i.map(function(i,l){var s=3;return"key"===i.get("rate_key","")?s=1:"usaget"===i.get("rate_key","")&&(s=2),r.a.createElement("div",{key:"rate-calc-".concat(e,"-").concat(a,"-").concat(l)},r.a.createElement(f.x,{key:"rate-calc-row-".concat(e,"-").concat(a,"-").concat(l)},r.a.createElement(f.g,{sm:3,style:{paddingRight:0}},r.a.createElement(f.l,{style:{margin:0}},r.a.createElement("select",{className:"form-control",id:t,onChange:n.onChangeLineKey,"data-ratecategory":e,"data-usaget":t,"data-index":l,"data-priority":a,value:i.get("line_key","")},o),n.renderComputedLineKeyDesc(i,e,t,a,l))),r.a.createElement(f.g,{sm:7,style:{paddingRight:0}},r.a.createElement(f.l,{style:{margin:0,paddingLeft:13}},r.a.createElement("input",{type:"radio",name:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-type"),id:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-by-rate-key"),value:"match","data-ratecategory":e,"data-usaget":t,"data-rate_key":"key","data-index":l,"data-priority":a,checked:1===s,onChange:n.onSetRating}),"\xa0",r.a.createElement("label",{htmlFor:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-by-rate-key"),style:{verticalAlign:"middle"}},"By product key")),r.a.createElement(f.l,{style:{margin:0,paddingLeft:13}},r.a.createElement("input",{type:"radio",name:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-type"),id:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-by-rate-usaget"),value:"match","data-ratecategory":e,"data-usaget":t,"data-rate_key":"usaget","data-index":l,"data-priority":a,checked:2===s,onChange:n.onSetRating}),"\xa0",r.a.createElement("label",{htmlFor:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-by-rate-usaget"),style:{verticalAlign:"middle"}},"By product unit type")),r.a.createElement(f.l,{style:{margin:0}},r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-addon"},r.a.createElement("input",{type:"radio",name:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-type"),id:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-by-param"),value:"match","data-ratecategory":e,"data-usaget":t,checked:3===s,"data-rate_key":"","data-index":l,"data-priority":a,onChange:n.onSetRating}),"\xa0",r.a.createElement("label",{htmlFor:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-by-param"),style:{verticalAlign:"middle"}},"By product param"),r.a.createElement(Ii,{contents:"This field needs to be configured in the 'Additional Parameters' of a Product"})),r.a.createElement(en,{fieldType:"select",onChange:n.onChangeAdditionalParamRating(e,t,a,l,i.get("type","")),value:3!==s?"":i.get("rate_key",""),disabled:3!==s,options:n.getCustomRatingFields(),allowCreate:!0}),r.a.createElement(en,{fieldType:"select",onChange:n.onChangeAdditionalParamRatingType(i.get("rate_key",""),e,t,a,l),disabled:3!==s,value:3!==s?"":i.get("type",""),options:n.getRatingTypes()})))),r.a.createElement(f.g,{xs:2},l>0&&r.a.createElement(f.l,{style:{margin:0}},r.a.createElement("div",{style:{width:"100%",height:39}},r.a.createElement(f.c,{onClick:n.onRemoveRating,"data-ratecategory":e,"data-usaget":t,"data-index":l,"data-priority":a,bsSize:"small",className:"pull-left"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0Remove"))))),r.a.createElement("hr",null))}).toArray()},n.getAddRatingButton=function(e,t,a){return r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary","data-ratecategory":e,"data-usaget":t,"data-priority":a,onClick:n.onAddRating},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0Add")},n.getAddRatingPriorityButton=function(e,t){return r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:n.onAddRatingPriority(e,t)},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0Add Next Priority")},n.getRemoveRatingPriorityButton=function(e,t,a){return r.a.createElement(f.c,{bsStyle:"link",bsSize:"xsmall",onClick:n.onRemoveRatingPriority(e,t,a)},r.a.createElement("i",{className:"fa fa-fw fa-trash-o danger-red"}))},n.renderComputedRatePopup=function(){var e=n.props.settings,t=n.state.computedLineKey;if(!t)return null;return r.a.createElement(Ye,{title:"Computed Rate Key",show:!0,onOk:n.onSaveComputedLineKey,onHide:n.onHideComputedLineKey,labelOk:"OK",modalSize:"large"},r.a.createElement(Ah,{computedLineKey:t,settings:e,onChangeComputedLineKeyType:n.onChangeComputedLineKeyType,onChangeComputedLineKey:n.onChangeComputedLineKey,onChangeComputedMustMet:n.onChangeComputedMustMet,onChangeHardCodedValue:n.onChangeHardCodedValue}))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.rateCategory,a=t.usaget,i=t.rateCalculators,o=this.state.openRateCalculators,l={paddingLeft:45};return r.a.createElement("div",null,this.renderComputedRatePopup(),i.map(function(t,i){var s=i>0,c=s?{}:l;return r.a.createElement("div",{key:"rate-calculator-".concat(a,"-").concat(i)},r.a.createElement(f.x,null,r.a.createElement(f.g,{sm:10},"Priority ".concat(i+1)),r.a.createElement(f.g,{sm:2,style:c},s&&e.getRemoveRatingPriorityButton(n,a,i),o.includes(i)?r.a.createElement(f.c,{onClick:e.closeRateCalculator(i),bsStyle:"link"},r.a.createElement("i",{className:"fa fa-fw fa-minus"})):r.a.createElement(f.c,{onClick:e.openRateCalculator(i),bsStyle:"link"},r.a.createElement("i",{className:"fa fa-fw fa-plus"})))),r.a.createElement(f.v,{collapsible:!0,expanded:e.state.openRateCalculators.includes(i)},e.getRateCalculatorsForPriority(n,a,i,t),e.getAddRatingButton(n,a,i)))}),this.getAddRatingPriorityButton(n,a))}}]),t}(a.Component);Dh.defaultProps={settings:g.c.Map(),customRatingFields:g.c.List(),rateCalculators:g.c.List(),plays:g.c.Set()};var Lh=Object(l.connect)(function(e,t){return{plays:Ch(e,t),rateCalculators:t.settings.getIn(["rate_calculators",t.rateCategory,t.usaget])}})(Dh),Uh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={newCategory:"",categoryToRemove:""},n.getRateCategoriesInUse=function(){return g.c.List(n.props.settings.get("rate_calculators",g.c.Map()).keySeq().map(function(e){return e}))},n.getAvailableRateCategories=function(){var e=n.props.rateCategories,t=n.getRateCategoriesInUse();return e.filter(function(e){return!t.includes(e)}).map(oe).toArray()},n.onChangeNewRateCategory=function(e){n.setState({newCategory:e})},n.onAddNewRateCategory=function(){var e=n.state.newCategory;void 0===e||""===e?n.props.dispatch(Qa("Please choose rate category")):n.props.dispatch({type:Vg,rateCategory:e}),n.setState({newCategory:""})},n.onRemoveRateCategory=function(e){return function(){n.props.dispatch(function(e){return{type:Bg,rateCategory:e}}(e)),n.onClickCloseConfirm()}},n.onClickCloseConfirm=function(){n.setState({categoryToRemove:""})},n.onClickRateCategoryRemove=function(e){return function(){n.setState({categoryToRemove:e})}},n.renderRateCategoriesSelector=function(){var e=n.getAvailableRateCategories(),t=n.state.newCategory;return r.a.createElement(f.x,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Add new rate category"),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{fieldType:"select",onChange:n.onChangeNewRateCategory,value:t,options:e})),r.a.createElement(f.g,{sm:1,style:{marginTop:5}},r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:n.onAddNewRateCategory},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0Add")))},n.renderTabTitle=function(e){return r.a.createElement("div",null,F.a.sentenceCase(e),n.getRateCategoriesInUse().size>1&&r.a.createElement(f.c,{bsSize:"xsmall",bsStyle:"link",onClick:n.onClickRateCategoryRemove(e),className:"close"},r.a.createElement("i",{className:"fa fa-times",style:{color:"#222222",fontSize:16,marginTop:-5,marginRight:-5}})))},n.renderRateCategory=function(e,t){var a=n.props,i=a.settings,o=a.customRatingFields,l=i.getIn(["rate_calculators",e],g.c.Map()).keySeq().map(function(e){return e});return r.a.createElement(f.y,{eventKey:t,title:n.renderTabTitle(e),key:"rate-category-".concat(t)},l.map(function(t,n){return r.a.createElement("div",{key:n,style:{minWidth:150}},r.a.createElement("div",{className:"form-group",style:{marginTop:20}},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:t},t)),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-11"},r.a.createElement(Lh,{rateCategory:e,usaget:t,customRatingFields:o,settings:i})))),n<l.size-1&&r.a.createElement("div",{className:"separator"}))}).toArray())},n.renderRemoveCategoryConfirm=function(){var e=n.state.categoryToRemove,t='Are you sure you want to remove rate category "'.concat(F.a.sentenceCase(e),'"?');return r.a.createElement(Ke,{type:"delete",onOk:n.onRemoveRateCategory(e),onCancel:n.onClickCloseConfirm,show:""!==e,message:t,labelOk:"Yes"})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.getRateCategoriesInUse();return r.a.createElement(f.j,{horizontal:!0,className:"rateMappings"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("h4",null,"Rate by")),this.renderRateCategoriesSelector()),r.a.createElement(f.A,{id:"rate-mapping"},e.map(this.renderRateCategory)),this.renderRemoveCategoryConfirm())}}]),t}(a.Component);Uh.defaultProps={settings:g.c.Map(),customRatingFields:g.c.List(),rateCategories:g.c.List()};var Vh=Object(l.connect)(function(e,t){return{rateCategories:Jn(e,t)}})(Uh),Bh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onSetPricingMapping=function(e){var t=n.props.usaget,a=e.target,r=a.value,i=a.id;n.props.onSetPricingMapping(i,r,t)},n.getVolumeOptions=function(){return n.props.settings.get("fields",g.c.List()).sortBy(function(e){return e}).map(function(e){return{label:e,value:e}}).toArray()},n.onChangeApriceField=function(e){var t={target:{value:e,id:"aprice_field"}};n.onSetPricingMapping(t)},n.onChangeApriceExists=function(){n.onChangeApriceField(void 0),n.onChangeApriceMultExists(),n.onChangeTaxIncluded({target:{value:void 0}})},n.onChangeTaxIncluded=function(e){var t={target:{value:e.target.value,id:"tax_included"}};n.onSetPricingMapping(t)},n.onChangeApriceMult=function(e){n.onSetPricingMapping(e)},n.onChangeApriceMultExists=function(){var e={target:{value:void 0,id:"aprice_mult"}};n.onChangeApriceMult(e)},n.renderPrice=function(){var e=n.props.mapping,t=e.getIn(["aprice_field"],null),a=e.get("tax_included",!1)&&null!==t,i={fieldType:"select",placeholder:"Select price field...",options:n.getVolumeOptions(),onChange:n.onChangeApriceField},o=e.getIn(["aprice_mult"])||"",l={fieldType:"number",id:"aprice_mult",onChange:n.onChangeApriceMult};return r.a.createElement("div",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-11"},r.a.createElement("div",{className:"col-lg-10 form-inner-edit-row"},r.a.createElement(en,{fieldType:"toggeledInput",value:t,onChange:n.onChangeApriceExists,label:"Pre priced",inputProps:i})),r.a.createElement("div",{className:"col-lg-10 col-lg form-inner-edit-row"},r.a.createElement(en,{fieldType:"toggeledInput",value:o,disabledValue:"",disabled:null===t||void 0===t,onChange:n.onChangeApriceMultExists,label:"Multiply by constant",inputProps:l})),r.a.createElement("div",{className:"col-lg-1"},r.a.createElement(Ii,{contents:"When checked, the price taken will be multiplied by the constant entered"})),r.a.createElement("div",{className:"col-lg-10 col-lg form-inner-edit-row"},r.a.createElement(en,{fieldType:"checkbox",value:a,label:"Tax is included",disabled:!t,onChange:n.onChangeTaxIncluded})))))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{className:"col-lg-12"},this.renderPrice()))}}]),t}(a.Component);Bh.defaultProps={settings:g.c.Map()};var qh=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props.settings,n=t.get("pricing",g.c.Map());return r.a.createElement(f.j,{horizontal:!0,className:"pricingMappings"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("h4",null,"Pre-Pricing",r.a.createElement("p",{className:"help-block"},"When Pre priced is checked, the price will be taken directly from the record instead of being calculated")))),n.map(function(n,a){return r.a.createElement("div",{key:"pricing-mapping-".concat(a)},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:a},a)),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-10"},r.a.createElement(Bh,{usaget:a,mapping:n,onSetPricingMapping:e.props.onSetPricingMapping,settings:t}))))))}).toArray())}}]),t}(a.Component);qh.defaultProps={settings:g.c.Map()};var zh=Object(l.connect)()(qh),Hh=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).initDefaultValues=function(e,t){if(null===e.get("receiver_type",null)){var a={target:{value:"ftp",id:"receiver_type-".concat(t)}};n.props.onSetReceiverField(a,t)}if(null===e.get("passive",null)){var r={target:{checked:!1,id:"passive-".concat(t)}};n.props.onSetReceiverCheckboxField(r,t)}if(null===e.get("delete_received",null)){var i={target:{checked:!1,id:"delete_received-".concat(t)}};n.props.onSetReceiverCheckboxField(i,t)}},n.onRemoveReceiver=function(){var e=n.props.index;n.props.dispatch(function(e){return{type:Of,index:e}}(e))},n.toggleShowDetails=function(){var e=n.state.isReceiverOpen;n.setState(function(){return{isReceiverOpen:!e}})},n.afterUpload=function(e,t){var a=n.props.index;"success"===e.desc?(n.props.dispatch(Wa(e.details.message)),n.props.onSetReceiverField({target:{value:e.details.path,id:"key-".concat(a)}},a),n.props.onSetReceiverField({target:{value:t,id:"key_label-".concat(a)}},a),n.props.OnChangeUploadingFile()):n.props.dispatch(Qa(e.details.message))},n.onChangeFileSelect=function(e){var t=e.target.files,a=n.props.fileType,r=t[0];if(r.size>=1048576)n.props.dispatch(Qa("Please choose file smaller than 1MB"));else{var i=new FormData;i.append("file",r,r.name),i.append("category","key"),i.append("file_type",a);var o=new XMLHttpRequest,l=ar({api:"uploadedfile"});n.props.OnChangeUploadingFile(),o.open("POST",l,!0),o.withCredentials=!0,o.addEventListener("load",function(){var e=JSON.parse(o.responseText);n.afterUpload(e,r.name)}),o.send(i)}},n.onClickFileSelect=function(e){e.target.value=null},n.onCancelKeyAuth=function(){var e=n.props.index;n.props.onCancelKeyAuth(e),n.props.dispatch(Wa("Key was removed successfuly"))},n.onChangeReceiverType=function(e){var t=e.target.value,a=n.props.index;n.props.onSetReceiverField({target:{value:t,id:"receiver_type-".concat(a)}},a)},n.renderReceiverType=function(e,t){var a=n.props,i=a.index,o=a.receiver;return r.a.createElement(f.g,{sm:3,key:t},r.a.createElement(en,{fieldType:"radio",onChange:n.onChangeReceiverType,name:"receiver_type-".concat(i),value:t,label:e,checked:o.get("receiver_type","")===t}))},n.renderReceiverTypes=function(){return n.props.receiverTypes.map(n.renderReceiverType).toList().toArray()},n.renderPanelHeader=function(){var e=n.props,t=e.receiver,a=e.fileType,i=t.get("key_label",a);return r.a.createElement("div",{style:{fontSize:12,fontWeight:"bold"}},i,r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.c,{onClick:n.onCancelKeyAuth,bsSize:"small",bsStyle:"link",style:{padding:0}},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))},n.onChangeReceiverField=function(e){var t=n.props.index;n.props.onSetReceiverField(e,t)},n.onSetReceiverCheckboxField=function(e){var t=n.props.index;n.props.onSetReceiverCheckboxField(e,t)},n.renderReceiver=function(){var e=n.props,t=e.index,a=e.receiver,i=[{min:1,label:"1 Minute"},{min:15,label:"15 Minutes"},{min:30,label:"30 Minutes"},{min:60,label:"1 Hour"},{min:360,label:"6 Hours"},{min:720,label:"12 Hours"},{min:1440,label:"24 Hours"}].map(function(e,t){return r.a.createElement("option",{value:e.min,key:t},e.label)});return r.a.createElement("div",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"name",className:"col-xs-3 control-label"},"Receiver Type"),r.a.createElement("div",{className:"col-xs-6"},n.renderReceiverTypes())),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"name",className:"col-xs-3 control-label"},"Name"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{className:"form-control",id:"name-".concat(t),onChange:n.onChangeReceiverField,value:a.get("name","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"host",className:"col-xs-3 control-label"},"Host"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{className:"form-control",id:"host-".concat(t),onChange:n.onChangeReceiverField,value:a.get("host","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"user",className:"col-xs-3 control-label"},"User"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{className:"form-control",id:"user-".concat(t),onChange:n.onChangeReceiverField,value:a.get("user","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"password",className:"col-xs-3 control-label"},"Password"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{type:"password",className:"form-control",id:"password-".concat(t),onChange:n.onChangeReceiverField,value:a.get("password","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"remote_directory",className:"col-xs-3 control-label"},"Directory"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{className:"form-control",id:"remote_directory-".concat(t),onChange:n.onChangeReceiverField,value:a.get("remote_directory","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"filename_regex",className:"col-xs-3 control-label"},"Regex"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{className:"form-control",id:"filename_regex-".concat(t),onChange:n.onChangeReceiverField,value:a.get("filename_regex","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"period",className:"col-xs-3 control-label"},"Period"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("select",{className:"form-control",id:"period-".concat(t),onChange:n.onChangeReceiverField,value:a.get("period","")},i))),"ftp"!==a.get("receiver_type","")&&r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"uploadFile",className:"col-xs-3 control-label"},"Key"),r.a.createElement("div",{className:"col-xs-6"},!1===a.get("key",!1)&&r.a.createElement("input",{name:"file",type:"file",onClick:n.onClickFileSelect,onChange:n.onChangeFileSelect}),!1!==a.get("key",!1)&&r.a.createElement(f.v,{header:n.renderPanelHeader(),className:"mb0"}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"delete_received",className:"col-xs-3 control-label"},"Delete received files from remote"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{type:"checkbox",id:"delete_received-".concat(t),style:{marginTop:12},onChange:n.onSetReceiverCheckboxField,checked:a.get("delete_received",!1),value:"1"}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"passive",className:"col-xs-3 control-label"},"Passive mode"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{type:"checkbox",id:"passive-".concat(t),style:{marginTop:12},onChange:n.onSetReceiverCheckboxField,checked:a.get("passive",!1),value:"1",disabled:"ftp"!==a.get("receiver_type","")}))))},n.getReceiverActions=function(){var e=n.props.index,t=n.state.isReceiverOpen,a=0!==e;return[{type:"edit",onClick:n.toggleShowDetails,show:!t},{type:"collapse",onClick:n.toggleShowDetails,show:t},{type:"remove",onClick:n.onRemoveReceiver,enable:a}]},n.state={isReceiverOpen:0===e.index},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.receiver,n=e.index;this.initDefaultValues(t,n)}},{key:"render",value:function(){var e=this.props.index,t=this.state.isReceiverOpen;return r.a.createElement(f.l,{key:"connection_".concat(e),className:"mb0"},r.a.createElement(f.g,{sm:12},r.a.createElement("div",{style:{paddingRight:100,display:"inline-block"}},"Receiver ".concat(e+1)),r.a.createElement("span",{style:{marginLeft:-100,paddingRight:15},className:"pull-right List row"},r.a.createElement(Xe,{actions:this.getReceiverActions()}))),r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{collapsible:!0,expanded:t},this.renderReceiver())))}}]),t}(a.Component);Hh.defaultProps={settings:g.c.Map(),receiverTypes:g.c.Map({ftp:"FTP",ssh:"SFTP"})};var Yh=Object(l.connect)(null)(Hh),Gh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onSetReceiverField=function(e,t){var a=e.target,r=a.id,i=a.value,o=r.split("-")[0];n.props.onSetReceiverField(o,i,t)},n.onSetReceiverCheckboxField=function(e,t){var a=e.target,r=a.id,i=a.checked,o=r.split("-")[0];n.props.onSetReceiverCheckboxField(o,i,t)},n.onAddReceiver=function(){n.props.dispatch({type:Sf})},n.renderReceivers=function(){var e=n.props,t=e.settings,a=e.fileType;return t.get("receiver",g.c.List()).map(function(e,i){return r.a.createElement(Yh,{key:"receiver_".concat(i),receiver:e,index:i,settings:t,onSetReceiverField:n.onSetReceiverField,onSetReceiverCheckboxField:n.onSetReceiverCheckboxField,onCancelKeyAuth:n.props.onCancelKeyAuth,fileType:a,OnChangeUploadingFile:n.props.OnChangeUploadingFile})}).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(f.j,{horizontal:!0,className:"Receiver"},this.renderReceivers(),r.a.createElement(Je,{onClick:this.onAddReceiver,label:"Add Receiver"}))}}]),t}(a.Component);Gh.defaultProps={settings:g.c.Map()};var Kh=Object(l.connect)()(Gh),Wh=Object(l.connect)()(function(e){var t=e.onChange,n=e.onChangeDefault,a=e.settings,i=[r.a.createElement("option",{disabled:!0,value:"",key:-1},"Select Field...")].concat(Object(w.a)(a.get("fields",[]).sortBy(function(e){return e}).map(function(e,t){return r.a.createElement("option",{value:e,key:t},e)}))),o=a.get("fields",[]).sortBy(function(e){return e}).map(function(e){return{label:e,value:e}}).toJS(),l=function(e){t({target:{id:"postpay_charge",value:"true"===e.target.value}})};return r.a.createElement("div",{className:"RealtimeMapping"},r.a.createElement("form",{className:"form-horizontal CalculatorMapping"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("input",{type:"radio",name:"postpay_charge",id:"postpay_charge_false",value:"false",onChange:l,checked:!a.getIn(["realtime","postpay_charge"],!1)}),r.a.createElement("label",{htmlFor:"postpay_charge"},"\xa0Allocation based requests")),r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("input",{type:"radio",name:"postpay_charge",id:"postpay_charge_true",value:"true",onChange:l,checked:a.getIn(["realtime","postpay_charge"],!1)}),r.a.createElement("label",{htmlFor:"postpay_charge"},"\xa0One time charge requests"))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"request_type_field"},"Request type field"),r.a.createElement("p",{className:"help-block"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("select",{id:"request_type_field",className:"form-control",onChange:t,disabled:a.getIn(["realtime","postpay_charge"],!1),value:a.getIn(["realtime","request_type_field"],"")},i))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"pretend_field"},"Request type pretend field"),r.a.createElement("p",{className:"help-block"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("select",{id:"pretend_field",className:"form-control",onChange:t,value:a.getIn(["realtime","pretend_field"],"")},i,">"))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"used_usagev_field"},"Rebalance fields"),r.a.createElement("p",{className:"help-block"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement(en,{fieldType:"select",options:o,onChange:function(e){var n={target:{id:"used_usagev_field",value:e.split(",")}};t(n)},disabled:a.getIn(["realtime","postpay_charge"],!1),multi:!0,value:a.getIn(["realtime","used_usagev_field"],Object(g.a)()).join(",")}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"used_usagev_field"},"Cumulative volume"),r.a.createElement("p",{className:"help-block"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement(en,{id:"used_usagev_accumulative",value:a.getIn(["realtime","used_usagev_accumulative"],!1),disabled:a.getIn(["realtime","postpay_charge"],!1),onChange:t,fieldType:"checkbox"}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"used_usagev_field"},"Rebalance on last request only?"),r.a.createElement("p",{className:"help-block"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement(en,{id:"rebalance_on_final",value:a.getIn(["realtime","rebalance_on_final"],!1),disabled:a.getIn(["realtime","postpay_charge"],!1),onChange:t,fieldType:"checkbox"}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:""},"Group requests fields"),r.a.createElement("p",{className:"help-block"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement(en,{fieldType:"select",options:o,onChange:function(e){var n={target:{id:"session_id_fields",value:e.split(",")}};t(n)},disabled:a.getIn(["realtime","postpay_charge"],!1),multi:!0,value:a.getIn(["realtime","session_id_fields"],Object(g.a)()).join(",")}))))),r.a.createElement("hr",null),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"initial_request"},"Initial request"),r.a.createElement("p",{className:"help-block"},"Optional")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("input",{id:"initial_request",type:"number",className:"form-control",onChange:n,disabled:a.getIn(["realtime","postpay_charge"],!1),value:a.getIn(["realtime","default_values","initial_request"],10)}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"update_request"},"Update request"),r.a.createElement("p",{className:"help-block"},"Optional")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("input",{id:"update_request",type:"number",className:"form-control",onChange:n,disabled:a.getIn(["realtime","postpay_charge"],!1),value:a.getIn(["realtime","default_values","update_request"],10)}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"final_request"},"Final request"),r.a.createElement("p",{className:"help-block"},"Optional")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("input",{id:"final_request",type:"number",className:"form-control",onChange:n,disabled:a.getIn(["realtime","postpay_charge"],!1),value:a.getIn(["realtime","default_values","final_request"],0)}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"default"},"Default"),r.a.createElement("p",{className:"help-block"},"Optional")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("input",{id:"default",type:"number",className:"form-control",onChange:n,disabled:a.getIn(["realtime","postpay_charge"],!1),value:a.getIn(["realtime","default_values","default"],15)})))))))}),Jh=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).buildGetAllQuery=function(){return{api:"settings",params:[{category:"file_types"},{data:JSON.stringify({})}]}},n.onChangeName=function(e){var t=n.props.inputProcessorsExitNames,a=n.state.errors,r=e.target.value;t.includes(r)?n.setState({errors:a.setIn(["sampleCSV","name"],"Name ".concat(r," already exists"))}):n.setState({errors:a.deleteIn(["sampleCSV","name"])}),n.props.dispatch(wf(e.target.value))},n.onSetDelimiterType=function(e){n.props.dispatch(jf(e.target.value))},n.onChangeInputProcessorField=function(e,t){n.props.dispatch(function(e,t){return{type:Pg,fieldPath:e,value:t}}(e,t))},n.onChangeDelimiter=function(e){var t;n.props.dispatch((t=e.target.value,{type:Mg,delimiter:t}))},n.onSelectJSON=function(e){var t=e.target.files[0],a=new FileReader;a.onloadend=function(e){if(e.target.readyState===FileReader.DONE)try{var t=JSON.parse(e.target.result),a=Object.keys(t).map(function(e){return n.buildJSONFields(e,t)});n.props.dispatch(Rf(hh()(a)))}catch(r){n.props.dispatch(Qa("Not a valid JSON"))}};var r=t.slice(0,t.size-1);a.readAsText(r)},n.onSelectSampleCSV=function(e){var t=n.props.settings,a=e.target.files,r=t.get("delimiter",",");Hc.a.parse(a[0],{dynamicTyping:!1,skipEmptyLines:!0,delimiter:r,header:!0,complete:n.onParseScvComplete,error:n.onParseScvError})},n.onParseScvError=function(e,t){n.props.dispatch(Qa("Error in CSV file"))},n.onParseScvComplete=function(e){if(e.meta&&e.meta.fields&&e.meta.fields.length>0){n.props.dispatch(Rf([]));var t=new RegExp("[^A-Za-z0-9_]","g"),a=e.meta.fields.map(function(e){return e.replace(t,"_")}).map(function(e){return{name:e,checked:!0}});n.props.dispatch(Rf(a))}else n.props.dispatch(Qa("Error in CSV file, no headers found."))},n.onAddField=function(e,t){n.props.dispatch({type:Lg,field:""})},n.onRemoveField=function(e,t){n.props.dispatch(function(e,t){return{type:af,index:e,field:t}}(e))},n.onRemoveAllFields=function(){n.props.dispatch({type:uf})},n.onCheckAllFields=function(e){n.props.dispatch(function(e){return{type:pf,checked:e}}(e))},n.onSetFieldMapping=function(e){var t=e.target,a=t.value,r=t.id;n.props.dispatch(function(e,t){return{type:Dg,field:e,mapping:t}}(r,a))},n.onSetFieldWidth=function(e){var t=e.target,a=t.value,r=t.dataset.field;n.props.dispatch({type:ef,index:r,width:a})},n.onAddUsagetMapping=function(e){n.props.dispatch({type:nf,mapping:e})},n.onSetStaticUsaget=function(e){n.props.dispatch({type:df,usaget:e})},n.onRemoveUsagetMapping=function(e,t){n.props.dispatch(function(e){return{type:rf,index:e}}(e))},n.onSetCustomerMapping=function(e,t,a,r){n.props.dispatch(function(e,t,n,a){return{type:Kg,field:e,mapping:t,usaget:n,index:a}}(e,t,a,r))},n.onSetPricingMapping=function(e,t,a){n.props.dispatch(function(e,t,n){return{type:Wg,field:e,mapping:t,usaget:n}}(e,t,a))},n.onSetReceiverField=function(e,t,a){n.props.dispatch(xf(e,t,a))},n.onCancelKeyAuth=function(e){n.props.dispatch(function(e,t){return{type:Zg,field:e,index:t}}("key",e))},n.onSetReceiverCheckboxField=function(e,t,a){n.props.dispatch(xf(e,t,a))},n.onMoveFieldUp=function(e){n.props.dispatch(function(e,t){return{type:gf,index:e,field:t}}(e))},n.onMoveFieldDown=function(e){n.props.dispatch(function(e,t){return{type:ff,index:e,field:t}}(e))},n.onChangeCSVField=function(e,t){n.props.dispatch(function(e,t){return{type:hf,index:e,value:t}}(e,t))},n.onChangeRealtimeField=function(e){var t=e.target,a=t.id,r=t.value;n.props.dispatch(function(e,t){return{type:Ef,name:e,value:t}}(a,r))},n.onChangeRealtimeDefaultField=function(e){var t=e.target,a=t.id,r=t.value;n.props.dispatch(function(e,t){return{type:Cf,name:e,value:t}}(a,r))},n.onError=function(e){n.props.dispatch(Qa(e))},n.onCheckedField=function(e,t,a){n.props.dispatch(function(e,t,n){return{type:_f,index:e,checked:t,field:n}}(e,t,a))},n.setUsagetType=function(e){n.props.dispatch({type:of,usaget_type:e})},n.unsetField=function(e){n.props.dispatch(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Array.isArray(e)?e:[e];return{type:vf,path:t}}(e))},n.buildJSONFields=function(e,t){return"object"!==typeof t[e]||Array.isArray(t[e])?e:Object.keys(t[e]).map(function(a){return n.buildJSONFields(a,t[e])}).map(function(t){return"".concat(e,".").concat(t)})},n.goBack=function(){n.props.router.push("/input_processors")},n.handleNext=function(){var e=n.state,t=e.stepIndex,a=e.steps,r=t===a.size-1,i=r?[]:a.get(a.findKey(function(e){return e.idx===t}),{}).parts;n.props.dispatch(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=0===t.length?"set":"validate",a=e.get("processor"),r=e.get("customer_identification_fields"),i=e.get("unify",g.c.Map()),o=e.get("rate_calculators"),l=e.get("pricing"),s=e.get("receiver"),c=e.get("realtime",g.c.Map()),u=e.get("response",g.c.Map()),p=e.get("enabled"),d=e.get("filters"),m={file_type:e.get("file_type"),type:e.get("type"),parser:{type:e.get("delimiter_type"),line_types:e.get("line_types"),separator:e.get("delimiter"),structure:e.get("unfiltered_fields").reduce(function(t,n,a){var r="fixed"===e.get("delimiter_type")?g.c.Map({name:n.get("name"),checked:n.get("checked"),width:e.getIn(["field_widths",a],"")}):g.c.Map({name:n.get("name"),checked:n.get("checked")});return t.push(r)},g.c.List())}};if("json"!==e.get("delimiter")&&(m.parser.csv_has_header=e.get("csv_has_header",!1),m.parser.csv_has_footer=e.get("csv_has_footer",!1)),a){var f="static"===e.get("usaget_type")?{default_usaget:a.get("default_usaget"),default_unit:a.get("default_unit"),default_volume_type:a.get("default_volume_type"),default_volume_src:a.get("default_volume_src")}:{usaget_mapping:a.get("usaget_mapping").map(function(e){return{src_field:e.get("src_field"),conditions:kf(e),pattern:e.get("pattern"),usaget:e.get("usaget"),unit:e.get("unit"),volume_type:e.get("volume_type"),volume_src:e.get("volume_src")}}).toJS()};m.processor=Object(Fo.a)({type:"realtime"===m.type?"Realtime":"Usage",date_field:a.get("date_field"),volume_field:a.get("volume_field"),aprice_field:a.get("aprice_field"),aprice_mult:a.get("aprice_mult")},f),a.get("time_field",!1)&&(m.processor.time_field=a.get("time_field")),a.get("date_format",!1)&&(m.processor.date_format=a.get("date_format")),a.get("time_format",!1)&&(m.processor.time_format=a.get("time_format")),a.get("timezone_field",!1)&&(m.processor.timezone_field=a.get("timezone_field"))}if(r&&(m.customer_identification_fields=r.toJS()),o&&(m.rate_calculators=o.toJS()),l&&(m.pricing=l.toJS()),i&&(m.unify=i.toJS()),m.enabled=void 0===p||p,d&&(m.filters=d.toJS()),"realtime"!==e.get("type")&&s){var h=s.get("receiver_type","ftp");m.receiver={type:h,connections:s}}"realtime"===e.get("type")&&(m.realtime=c.toJS(),m.response=u.size>0?u.toJS():{encode:"json",fields:[{response_field_name:"requestNum",row_field_name:"request_num"},{response_field_name:"requestType",row_field_name:"request_type"},{response_field_name:"sessionId",row_field_name:"session_id"},{response_field_name:"returnCode",row_field_name:"granted_return_code"},{response_field_name:"sid",row_field_name:"sid"},{response_field_name:"grantedVolume",row_field_name:"usagev"}]});var v={};return"set"===n?v=m:t.forEach(function(e){v[e]=m[e]}),function(e){e(Aa());var t=Er(v,n);return ir(t).then(function(t){return e(Da()),t}).catch(function(t){return e(Da()),e(nr(t,"Error saving input processor")),!1})}}(n.props.settings,i)).then(function(e){return!1===e||r?!(!1===e||!r)&&e:(n.setState({stepIndex:t+1}),!1)}).then(function(e){!1!==e&&(n.props.dispatch(Wa("Input processor saved successfully!")),n.goBack())})},n.handlePrev=function(){var e=n.state.stepIndex;e>0?n.setState({stepIndex:e-1}):n.handleCancel()},n.handleCancel=function(){window.confirm("Are you sure you want to stop editing input processor ?")&&n.goBack()},n.isValidForm=function(){return!n.state.errors.reduce(function(e,t){return e||!t.isEmpty()},!1)},n.changeUploadingFile=function(){var e=n.state.uploadingFile;n.setState({uploadingFile:!e})},n.getStepContent=function(){var e=n.props,t=e.settings,a=e.usageTypes,i=e.usageTypesData,o=e.propertyTypes,l=e.subscriberFields,s=e.customRatingFields,c=e.action,u=e.type,p=e.format,d=e.fileType,m=n.state,f=m.stepIndex,h=m.errors,v=m.steps;switch(f){case v.get("parser",{}).idx:return r.a.createElement(wh,{settings:t,type:u,action:c,format:p,errors:h.get("sampleCSV",g.c.Map()),onAddField:n.onAddField,onSelectJSON:n.onSelectJSON,onChangeName:n.onChangeName,onRemoveField:n.onRemoveField,onMoveFieldUp:n.onMoveFieldUp,onSetFieldWidth:n.onSetFieldWidth,onMoveFieldDown:n.onMoveFieldDown,onChangeCSVField:n.onChangeCSVField,onChangeDelimiter:n.onChangeDelimiter,onSelectSampleCSV:n.onSelectSampleCSV,onRemoveAllFields:n.onRemoveAllFields,onSetDelimiterType:n.onSetDelimiterType,onChangeInputProcessorField:n.onChangeInputProcessorField,onCheckedField:n.onCheckedField,checkAllFields:n.onCheckAllFields});case v.get("processor",{}).idx:return r.a.createElement(jh,{settings:t,usageTypes:a,usageTypesData:i,propertyTypes:o,onError:n.onError,unsetField:n.unsetField,setUsagetType:n.setUsagetType,onSetStaticUsaget:n.onSetStaticUsaget,onSetFieldMapping:n.onSetFieldMapping,onAddUsagetMapping:n.onAddUsagetMapping,onRemoveUsagetMapping:n.onRemoveUsagetMapping});case v.get("customer_identification_fields",{}).idx:return r.a.createElement(Ph,{settings:t,subscriberFields:l,onSetCustomerMapping:n.onSetCustomerMapping});case v.get("rate_calculators",{}).idx:return r.a.createElement(Vh,{settings:t,customRatingFields:s});case v.get("pricing",{}).idx:return r.a.createElement(zh,{settings:t,onSetPricingMapping:n.onSetPricingMapping});case v.get("realtimeMapping",{}).idx:return r.a.createElement(Wh,{settings:t,onChange:n.onChangeRealtimeField,onChangeDefault:n.onChangeRealtimeDefaultField});case v.get("receiver",{}).idx:return r.a.createElement(Kh,{settings:t,onSetReceiverField:n.onSetReceiverField,onSetReceiverCheckboxField:n.onSetReceiverCheckboxField,onCancelKeyAuth:n.onCancelKeyAuth,fileType:d,OnChangeUploadingFile:n.changeUploadingFile});default:return null}},n.renderStepper=function(){var e=n.state,t=e.stepIndex,a=e.steps.sortBy(function(e){return e.idx}).map(function(e){return{title:e.label}}).toList().toArray();return r.a.createElement(Si,{activeIndex:t,steps:a})};var a=g.c.Map({sampleCSV:g.c.Map(),fieldsMapping:g.c.Map(),calculatorMapping:g.c.Map(),realtimeMapping:g.c.Map(),receiver:g.c.Map()}),i=g.c.Map({parser:{idx:0,label:"CDR Fields",parts:["file_type","parser","filters"]},processor:{idx:1,label:"Field Mapping",parts:["file_type","parser","processor","filters"]},customer_identification_fields:{idx:2,label:"Customer Mapping",parts:["file_type","parser","processor","customer_identification_fields","filters"]},rate_calculators:{idx:3,label:"Rate Mapping",parts:["file_type","parser","processor","customer_identification_fields","rate_calculators","filters"]},pricing:{idx:4,label:"Pricing",parts:["file_type","parser","processor","customer_identification_fields","rate_calculators","pricing","filters"]}});return i="api"===e.type?i.set("realtimeMapping",{idx:5,label:"Realtime Mapping",parts:["file_type","parser","processor","customer_identification_fields","rate_calculators","pricing","realtime","response","unify","filters"]}):i.set("receiver",{idx:5,label:"Receiver",parts:["file_type","parser","processor","customer_identification_fields","rate_calculators","pricing","receiver","unify","filters"]}),n.state={stepIndex:0,errors:a,steps:i,uploadingFile:!1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e,t=this.props,n=t.fileType,a=t.action,r=t.template,i=t.type,o=t.format,l="";"new"===a?(r?(this.props.dispatch(function(e){var t=If(e);return{type:mf,template:t}}(vh[r])),this.props.dispatch(wf("")),l="Create New Input Processor - ".concat(r)):l="Create New Input Processor","api"===i&&"json"===o&&(this.props.dispatch({type:yf,name:"type",value:"realtime"}),this.props.dispatch(jf("json")),this.props.dispatch({type:bf,processor_type:"realtime"})),this.props.dispatch(fr("all_input_processors",this.buildGetAllQuery()))):(this.props.dispatch((e=n,function(t){return t(Nf(e))})),l="Edit Input Processor"),this.props.dispatch(il(["usage_types","property_types","subscribers.subscriber.fields","rates.fields"])),this.props.dispatch(ro(l))}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.settings,a=t.action,r=n.get("file_type",""),i=e.settings.get("file_type","");"new"!==a&&i!==r&&this.props.dispatch(ro("Edit Input Processor - ".concat(i)))}},{key:"componentWillUpdate",value:function(e,t){var n=this.props,a=n.settings,r=n.action,i=n.template,o=this.state.stepIndex,l=a.get("file_type",""),s=e.settings.get("file_type","");if("new"===r&&(s!==l&&o>=1||t.stepIndex>=1&&0===o)){var c=i?" - ".concat(i):"",u=s.length>0?" - ".concat(s):"";this.props.dispatch(ro("Create New Input Processor".concat(c).concat(u)))}}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:tf}),this.props.dispatch(gr("all_input_processors"))}},{key:"render",value:function(){var e=this.state,t=e.stepIndex,n=e.steps,a=e.uploadingFile,i=this.isValidForm();return r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},this.renderStepper()),r.a.createElement("div",{className:"panel-body"},r.a.createElement("div",{className:"contents bordered-container"},this.getStepContent())),r.a.createElement("div",{style:{marginTop:12,float:"right"}},r.a.createElement("button",{className:"btn btn-default",onClick:this.handleCancel,style:{marginRight:12}}," Cancel "),t>0&&r.a.createElement("button",{className:"btn btn-default",onClick:this.handlePrev,style:{marginRight:12}}," Back "),r.a.createElement("button",{disabled:!i||a,className:"btn btn-primary",onClick:this.handleNext}," ",t===n.size-1?"Finish":"Next"))))))}}]),t}(a.Component);Jh.defaultProps={settings:g.c.Map(),subscriberFields:g.c.List(),customRatingFields:g.c.List(),inputProcessorsExitNames:g.c.List(),usageTypes:g.c.List(),propertyTypes:g.c.List(),usageTypesData:g.c.List(),fileType:"",action:"new",template:null,type:null,format:null};var Qh=Object(l.connect)(function(e,t){var n=t.location.query,a=n.file_type,r=n.action,i=n.template,o=n.type,l=n.format;return{inputProcessorsExitNames:e.list.get("all_input_processors",g.c.List()).map(function(e){return e.get("file_type","")}),settings:e.inputProcessor,usageTypes:Dn(e,t),propertyTypes:Vn(e,t),usageTypesData:Un(e,t),subscriberFields:Gn(e,t),customRatingFields:Wn(e,t),fileType:a,action:r,template:i,type:o,format:l}})(Object(s.f)(Jh)),$h=function(e){var t=e.line,n=e.onClickCancel,a=e.hiddenFields,i=e.cancelLabel,o=e.enableRemove,l=e.onClickRemove,s=e.removeLabel,c=function(e,t){var n=[];return e.forEach(function(e,i){var o=e;"billrunFields"===t&&("connection_type"===i?o=F.a.upperCaseFirst(e):"urt"!==i&&"process_time"!==i&&"rebalance"!==i||(o=S.a.unix(e.get("sec")).format(Y("datetimeLongFormat","DD/MM/YYYY HH:mm:ss")))),a.includes(i)||n.push(r.a.createElement(f.l,{key:i},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},G(i,"lines")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("input",{disabled:!0,className:"form-control",value:null===o?"":o}))))}),n};return r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:r.a.createElement("div",null,t.get("type",""),r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.c,{bsSize:"xsmall",onClick:n},i)))},o&&r.a.createElement(f.v,{className:"panel-no-border"},r.a.createElement(f.c,{onClick:l,bsSize:"xsmall",className:"pull-right"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0",s)),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"BillRun fields")},c(t,"billrunFields")),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"User fields")},c(t.get("uf",g.c.Map()),"userFields")),r.a.createElement(f.c,{onClick:n},i)))))};$h.defaultProps={line:g.c.Map(),hiddenFields:["_id","in_plan","over_plan","interconnect_aprice","out_plan","uf"],onClickCancel:function(){},cancelLabel:"Back",enableRemove:!1,onClickRemove:function(){},removeLabel:"Remove"};var Zh=$h,Xh=function(e){return function(t){t(Aa());var n=function(e){return{action:"delete",entity:"lines",params:[{query:JSON.stringify({_id:e})}]}}(e);return ir(n).then(function(e){return t(tr(e,"Line deleted successfully!"))}).catch(function(e){return t(nr(e,"Error deleting Line"))})}},ev=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={line:null,viewing:!1,page:0,size:10,sort:g.c.Map(),filter:{},showRemoveConfirm:!1},n.buildQuery=function(){var e=n.state,t=e.page,a=e.size,r=e.sort,i=e.filter;return _r(i,t,r,a)},n.onFilter=function(e){n.setState({filter:e,page:0},n.fetchItems)},n.handlePageClick=function(e){n.setState({page:e},n.fetchItems)},n.onSort=function(e){var t=g.c.Map(e);n.setState({sort:t},n.fetchItems)},n.onClickLine=function(e){n.setState({line:e,viewing:!0})},n.onCancelView=function(){n.setState({line:null,viewing:!1})},n.fetchItems=function(){n.props.dispatch(fr("usages",n.buildQuery()))},n.getTableFields=function(){var e=n.props.baseFilter;return[{id:"type",placeholder:"Type",showFilter:!Object.prototype.hasOwnProperty.call(e,"type")},{id:"aid",placeholder:"Customer ID",type:"number",sort:!0,showFilter:!Object.prototype.hasOwnProperty.call(e,"aid")},{id:"sid",placeholder:"Subscriber ID",type:"number",sort:!0,showFilter:!Object.prototype.hasOwnProperty.call(e,"sid")},{id:"plan",placeholder:"Plan",showFilter:!Object.prototype.hasOwnProperty.call(e,"plan")},{id:"urt",placeholder:"Time",type:"fullDate",cssClass:"long-date",showFilter:!1,sort:!0}]},n.renderMainPanelTitle=function(){return r.a.createElement("div",null,r.a.createElement("span",null,"List of all usages"),r.a.createElement("div",{className:"pull-right"},r.a.createElement(s.b,{to:"/queue",className:"btn btn-default btn-xs"},"Go to Queue")))},n.showRemoveConfirmDialog=function(){n.setState({showRemoveConfirm:!0})},n.onRemoveOk=function(){var e=n.state.line.getIn(["_id","$id"],"undefined");n.props.dispatch(Xh(e)).then(function(e){e.status&&(n.setState({showRemoveConfirm:!1}),n.onCancelView(),n.fetchItems())})},n.onRemoveCancel=function(){n.setState({showRemoveConfirm:!1})},n.renderUsage=function(){var e=n.state,t=e.line,a=e.viewing,i=e.showRemoveConfirm,o=t&&"credit"===t.get("type","");return a?o?r.a.createElement("div",null,r.a.createElement(Zh,{line:t,onClickCancel:n.onCancelView,enableRemove:o,onClickRemove:n.showRemoveConfirmDialog}),r.a.createElement(Ke,{onOk:n.onRemoveOk,onCancel:n.onRemoveCancel,show:i,message:"Are you sure you want to remove this line?",labelOk:"Yes"})):r.a.createElement(Zh,{line:t,onClickCancel:n.onCancelView}):null},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.viewing,n=e.sort,a=this.props,i=a.items,o=a.baseFilter,l=this.getTableFields();return r.a.createElement("div",{className:"UsageList"},this.renderUsage(),r.a.createElement("div",{style:{display:t?"none":"block"}},r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:this.renderMainPanelTitle()},r.a.createElement(lp,{fields:l,onFilter:this.onFilter,base:o}),r.a.createElement(ec,{items:i,fields:l,edit:!0,onClickEdit:this.onClickLine,editText:"view",onSort:this.onSort,sort:n})))),r.a.createElement(up,{onClick:this.handlePageClick,size:this.state.size,count:i.size})))}}]),t}(a.Component);ev.defaultProps={items:g.c.List(),baseFilter:{}};var tv=Object(l.connect)(function(e,t){return{items:e.list.get("usages"),baseFilter:t.location.query.base?JSON.parse(t.location.query.base):{}}})(ev),nv=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(a){a(Aa());var r=function(e,t,n){return{api:"billrun",action:"completecycle",params:[{stamp:e},{rerun:t},{generate_pdf:n}]}}(e,t,n);return ir(r).then(function(e){return a(tr(e,"Cycle started successfully!"))}).catch(function(e){return a(nr(e,"Error running cycle"))})}},av=function(e){return function(t){t(Aa());var n=function(e){return{api:"billrun",action:"resetcycle",params:[{stamp:e}]}}(e);return ir(n).then(function(e){return t(tr(e,"Cycle reseted successfully!"))}).catch(function(e){return t(nr(e,"Error resetting cycle"))})}},rv=function(e,t){return function(n){n(Aa());var a=function(e,t){return{api:"billrun",action:"confirmCycle",params:[{stamp:e},{invoices:t}]}}(e,t);return ir(a).then(function(e){return n(tr(e,"Confirming invoice..."))}).catch(function(e){return n(nr(e,"Error confirming invoice"))})}},iv=function(e){return function(t){t(Aa());var n=function(e){return{api:"billrun",action:"confirmCycle",params:[{stamp:e}]}}(e);return ir(n).then(function(e){return t(tr(e,"Confirming cycle..."))}).catch(function(e){return t(nr(e,"Error confirming cycle"))})}},ov=function(){return function(e){return e(Aa()),ir({api:"billrun",action:"chargeaccount"}).then(function(t){return e(tr(t,"Charged all success!"))}).catch(function(t){return e(nr(t,"Error charging all"))})}},lv=function(){return function(e){return e(Aa()),ir({api:"operations",params:[{action:"confirm_cycle"},{filtration:"all"}]}).then(function(t){return e(tr(t))}).catch(function(t){return e(nr(t,"Cannot get cycle confirmation status"))})}},sv=function(e){return function(t){t(Aa());var n=[];return e.forEach(function(e){return n.push(function(e){return{api:"operations",params:[{action:"confirm_cycle"},{filtration:e}]}}(e))}),ir(n).then(function(e){return t(Da()),{status:1,data:e.data}}).catch(function(e){return t(nr(e,"Cannot get invoice confirmation status"))})}},cv=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={confirmationModalData:{show:!1,title:"",message:"",warningMessage:"This action is irreversible",onClick:function(){},refreshString:""},confirmingInvoices:Object(g.a)(),confirmingAll:!1},n.updateInvoicesNum=function(e){n.props.dispatch(fr("billrunInvoices",Kr(e)))},n.parseCycleDataFirstName=function(e){return e.getIn(["attributes","firstname"],"")},n.parseCycleDataLastName=function(e){return e.getIn(["attributes","lastname"],"")},n.parseCycleDataInvoiceTotal=function(e){return e.getIn(["totals","after_vat_rounded"],"")},n.parseCycleDataSubscriptionNum=function(e){return e.get("subs",Object(g.a)()).filter(function(e){return!["0",0].includes(e.get("sid",0))}).size},n.parseCycleDataInvoiceId=function(e){return e.get("invoice_id")},n.downloadURL=function(e,t,n){return"".concat(Y(["env","serverApiUrl"],""),"/api/accountinvoices?action=download&aid=").concat(e,"&billrun_key=").concat(t,"&iid=").concat(n)},n.parseCycleDataDownload=function(e){var t=n.downloadURL(e.get("aid"),e.get("billrun_key"),e.get("invoice_id"));return e.get("invoice_file",!1)&&r.a.createElement("form",{method:"post",action:t,target:"_blank"},r.a.createElement("button",{className:"btn btn-link",type:"submit"},r.a.createElement("i",{className:"fa fa-download"})," Download"))},n.autoRefreshConfirmationStatus=function(){clearTimeout(n.autoRefreshConfirmationStatusHandler);var e=n.state,t=e.confirmingAll,a=e.confirmingInvoices;t?n.autoRefreshConfirmationAllStatus():a.size&&n.autoRefreshConfirmationInvoicesStatus(a)},n.autoRefreshConfirmationAllStatus=function(){n.props.dispatch(lv()).then(function(e){e.status&&(e.data[0].start_date?n.autoRefreshConfirmationStatusHandler=setTimeout(n.autoRefreshConfirmationStatus,1e4):n.setState({confirmingAll:!1}))})},n.autoRefreshConfirmationInvoicesStatus=function(e){n.props.dispatch(sv(e)).then(function(t){if(t.status){var a=Object(g.a)();e.forEach(function(e,n){t.data[n].data.details[0].start_date&&(a=a.push(e))}),n.setState({confirmingInvoices:a}),a.size>0&&(n.autoRefreshConfirmationStatusHandler=setTimeout(n.autoRefreshConfirmationStatus,1e4))}})},n.onClickInvoiceConfirm=function(e){var t=n.props.billrunKey,a=n.state.confirmingInvoices;n.props.dispatch(rv(t,e.get("invoice_id",""))).then(function(t){t.status&&(n.closeConfirmationModal(),n.setState({refreshString:S()().format(),confirmingInvoices:a.push(e.get("invoice_id"))}),setTimeout(n.props.reloadCycleData,1e3),setTimeout(n.autoRefreshConfirmationStatus,1e3))})},n.onClickConfirmAll=function(){var e=n.props,t=e.selectedCycle,a=e.invoicesNum,r=n.state.confirmationModalData;r.show=!0,r.title="Confirm all invoices",r.message="Are you sure you want to confirm all the invoices for the cycle of\n      ".concat(ln(t,"start_date")," - ").concat(ln(t,"end_date"),"?\n      ").concat(a," invoices will be confirmed after this action"),r.onClick=n.onClickConfirmAllConfirm,n.setState({confirmationModalData:r})},n.onClickConfirmAllConfirm=function(){var e=n.props.billrunKey;n.props.dispatch(iv(e)).then(function(e){e.status&&(n.closeConfirmationModal(),n.setState({refreshString:S()().format(),confirmingInvoices:Object(g.a)(),confirmingAll:!0}),setTimeout(n.props.reloadCycleData,1e3),setTimeout(n.autoRefreshConfirmationStatus,1e3))})},n.parseCycleDataConfirm=function(e){var t=n.state,a=t.confirmingInvoices,i=t.confirmingAll,o=function(){n.onClickInvoiceConfirm(e)};return e.get("billed",!1)?r.a.createElement(f.p,{bsStyle:"success",className:"non-editable-field"},"CONFIRMED"):i||a.includes(e.get("invoice_id"))?r.a.createElement(f.p,{bsStyle:"info",className:"non-editable-field"},"CONFIRMING..."):r.a.createElement(f.c,{onClick:function(){var t=n.state.confirmationModalData,a=n.props.currency;t.show=!0,t.title="Confirm Invoice",t.message="Are you sure you want to confirm invoice #".concat(e.get("invoice_id")," for\n        customer #").concat(e.get("aid")," (").concat(n.parseCycleDataFirstName(e)," ").concat(n.parseCycleDataLastName(e),")\n        with a total due of ").concat(n.parseCycleDataInvoiceTotal(e)).concat(Nu()(a),"?"),t.onClick=o,n.setState({confirmationModalData:t})}},"confirm")},n.parseCycleDataEmailSent=function(e){var t=e.getIn(["email_sent","sec"],!1);return t?S.a.unix(t).format(Y("datetimeFormat","DD/MM/YYYY HH:mm")):"Not Sent"},n.downloadTaxURL=function(e){return"".concat(Y(["env","serverApiUrl"],""),'/api/report?action=taxationReport&report={"billrun_key":"').concat(e,'"}&type=csv')},n.parseTaxDownload=function(e){var t=n.props.billrunKey,a=n.downloadTaxURL(t);return r.a.createElement("form",{method:"post",action:a,target:"_blank"},r.a.createElement(f.c,{className:e.actionClass,bsStyle:e.actionStyle,bsSize:e.actionSize,type:"submit"},e.label))},n.getListActions=function(){var e=n.props,t=e.showConfirmAllButton,a=e.isCycleConfirmed;return[{label:"Confirm All",actionStyle:"primary",show:t,showIcon:!1,onClick:n.onClickConfirmAll,actionSize:"xsmall"},{label:"Download Taxation compliance report",actionStyle:"primary",show:a,showIcon:!1,renderFunc:n.parseTaxDownload,actionSize:"xsmall"}]},n.onCloseConfirmationModal=function(){n.closeConfirmationModal()},n.closeConfirmationModal=function(){var e=n.state.confirmationModalData;e.show=!1,e.title="",e.message="",e.onClick=function(){},n.setState({confirmationModalData:e})},n.renderConfirmationModal=function(){var e=n.state.confirmationModalData;return r.a.createElement(Ke,{onOk:e.onClick,onCancel:n.onCloseConfirmationModal,show:e.show,message:e.title,labelOk:"Yes"},r.a.createElement(f.l,{validationState:"error"},e.message,r.a.createElement(f.n,null,e.warningMessage)))},n.autoRefreshConfirmationStatusHandler=null,n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.billrunKey;this.updateInvoicesNum(e)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.billrunKey;e.billrunKey!==t&&this.updateInvoicesNum(e.billrunKey)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.autoRefreshConfirmationStatusHandler)}},{key:"render",value:function(){var e=this.props,t=e.baseFilter,n=e.settings,a=this.state.refreshString,i=n.get("billrun",Object(g.b)()).get("email_after_confirmation",!1),o=[{id:"aid",title:"Customer Number",sort:!0},{id:"attributes.firstname",title:"Customer First Name",sort:!0,parser:this.parseCycleDataFirstName},{id:"attributes.lastname",title:"Customer Last Name",sort:!0,parser:this.parseCycleDataLastName},{id:"totals.after_vat_rounded",title:"Invoice Total",sort:!0,parser:this.parseCycleDataInvoiceTotal},{id:"subss",title:"# of Subscribers",parser:this.parseCycleDataSubscriptionNum},{id:"invoice_id",title:"Invoice ID",sort:!0,parser:this.parseCycleDataInvoiceId},{id:"download",title:"Invoice",parser:this.parseCycleDataDownload},{id:"confirm",title:"Confirm",parser:this.parseCycleDataConfirm},{id:"email_sent",title:"Email Sent",sort:!0,parser:this.parseCycleDataEmailSent,display:i}];return r.a.createElement("div",null,r.a.createElement(qc,{collection:"billrun",api:"get",itemType:"billrun",itemsType:"billruns",filterFields:[{id:"aid",placeholder:"Customer Number",type:"number"},{id:"attributes.firstname",placeholder:"Customer First Name"},{id:"attributes.lastname",placeholder:"Customer Last Name"}],baseFilter:t,tableFields:o,showAddButton:!1,listActions:this.getListActions(),refreshString:a}),this.renderConfirmationModal())}}]),t}(a.Component);cv.defaultProps={settings:Object(g.b)(),reloadCycleData:function(){},baseFilter:{},showConfirmAllButton:!0,isCycleConfirmed:!1,currency:"",invoicesNum:0};var uv=Object(l.connect)(function(e,t){return{settings:e.settings,currency:Mn(e,t),invoicesNum:e.list.get("billrunInvoices",Object(g.a)()).size}})(cv),pv=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={selectedCycle:Object(g.b)(),selectedCycleName:"",showRerunConfirm:!1,showResetConfirm:!1,showChargeAllConfirm:!1,autoRefreshRunning:!1,autoRefreshStep:0,autoRefreshIterations:0,showRefreshButton:!1,ChargedAllClicked:!1,generatePdf:null},n.initAutoRefresh=function(){n.unsetAutoRefresh(),n.setState({autoRefreshRunning:!0,autoRefreshIterations:0,autoRefreshStep:0}),n.autoRefresh=setTimeout(n.runAutoRefresh,n.refreshSteps[0].timeout)},n.initAutoRefreshChargingStatus=function(){n.setState({ChargedAllClicked:!0}),clearTimeout(n.autoRefreshChargingStatus),n.autoRefreshChargingStatus=setTimeout(function(){return n.runAutoRefreshChargingStatus(!0)},1e4)},n.clearData=function(){n.props.dispatch(gr("cycles_list")),n.props.dispatch(gr("cycle_data")),n.props.dispatch(gr("charge_status")),n.props.dispatch(gr("charge_status_refresh")),n.props.dispatch(gr("billrunInvoices"))},n.runAutoRefreshChargingStatus=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=n.props.chargeStatusRefreshed;clearTimeout(n.autoRefreshChargingStatus),e||null!==t.get("start_date",null)?(n.props.dispatch(fr("charge_status_refresh",Wr())),n.autoRefreshChargingStatus=setTimeout(n.runAutoRefreshChargingStatus,1e4)):n.setState({ChargedAllClicked:!1})},n.refreshSteps=[{timeout:1e4,iterations:6},{timeout:6e4,iterations:60}],n.unsetAutoRefresh=function(){clearTimeout(n.autoRefresh)},n.runAutoRefresh=function(){var e=n.props.cycleAdditionalData;if(n.props.dispatch(Pc("billruns")),"running"===e.get("cycle_status","")){n.reloadCycleData();var t=n.state,a=t.autoRefreshIterations,r=t.autoRefreshStep,i=n.refreshSteps[r];if(n.unsetAutoRefresh(),a<i.iterations-1)n.setState({autoRefreshIterations:a+1}),n.autoRefresh=setTimeout(n.runAutoRefresh,i.timeout);else{var o=r+1;if(o>=n.refreshSteps.length)return void n.setState({showRefreshButton:!0,autoRefreshRunning:!1});var l=n.refreshSteps[o];n.autoRefresh=setTimeout(n.runAutoRefresh,l.timeout),n.setState({autoRefreshStep:o,autoRefreshIterations:0})}}else if(n.unsetAutoRefresh(),n.setState({autoRefreshRunning:!1}),"finished"===e.get("cycle_status","")){var s=n.state.selectedCycleName;n.onChangeSelectedCycle(s)}},n.getSelectedCycleStatus=function(){var e=n.props.cycleAdditionalData,t=n.state.selectedCycle;return e.get("cycle_status",t.get("cycle_status",""))},n.runCycle=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n.props.dispatch(Pc("billruns"));var t=n.state,a=t.selectedCycle,r=t.generatePdf;n.props.dispatch(nv(a.get("billrun_key",""),e,r)).then(function(e){e.status&&(n.refreshAfterRun=setTimeout(n.reloadCycleData,1e3))})},n.resetCycle=function(){n.props.dispatch(Pc("billruns"));var e=n.state.selectedCycle;n.props.dispatch(av(e.get("billrun_key",""))).then(function(e){e.status&&(n.refreshAfterRun=setTimeout(n.reloadCycleData,1e3))})},n.onClickRun=function(){n.runCycle()},n.onClickRerun=function(){n.setState({showRerunConfirm:!0})},n.onClickReset=function(){n.setState({showResetConfirm:!0})},n.onClickChargeAll=function(){n.setState({showChargeAllConfirm:!0})},n.chargeAll=function(){n.initAutoRefreshChargingStatus(),n.props.dispatch(ov())},n.onClickRefresh=function(){n.reloadCycleData()},n.renderRefreshButton=function(){return n.state.showRefreshButton&&"running"===n.getSelectedCycleStatus()&&r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:n.onClickRefresh},r.a.createElement("i",{className:"fa fa-refresh"}),"\xa0Refresh"))},n.renderPanelHeader=function(){return r.a.createElement("div",null,"Run a billing cycle",n.renderRefreshButton())},n.clearCycleData=function(){n.props.dispatch(gr("cycle_data"))},n.reloadCycleData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.state.selectedCycle;n.clearCycleData();var t=e.get("billrun_key","");""!==t&&n.props.dispatch(fr("cycle_data",Gr(t)))},n.getCycleData=function(e){var t=Object(g.b)({billrun_key:e});return n.reloadCycleData(t),t},n.onChangeSelectedCycle=function(e){n.props.dispatch(Pc("billruns")),n.setState({selectedCycle:n.getCycleData(e),selectedCycleName:e})},n.renderCyclesSelect=function(){var e=n.state.selectedCycleName;return r.a.createElement(Fu,{onChange:n.onChangeSelectedCycle,statusesToDisplay:Object(g.a)(["running","to_run","finished","confirmed","to_rerun"]),selectedCycles:e})},n.getStatusStyle=function(e){switch(e){case"to_run":case"to_rerun":return"info";case"running":case"current":return"primary";case"future":return"warning";case"finished":case"confirmed":return"success";default:return"default"}},n.renderCycleStatus=function(){var e=n.getSelectedCycleStatus();return r.a.createElement(f.p,{bsStyle:n.getStatusStyle(e),className:"non-editable-field"},e.toUpperCase())},n.renderStartDate=function(){var e=n.props.cycleAdditionalData,t=n.state.selectedCycle;return r.a.createElement("div",{className:"non-editable-field"},e.get("start_date",t.get("start_date","-")))},n.renderEndDate=function(){var e=n.props.cycleAdditionalData,t=n.state.selectedCycle;return r.a.createElement("div",{className:"non-editable-field"},e.get("end_date",t.get("end_date","-")))},n.renderCycleCompletionPercentage=function(){var e=n.props.cycleAdditionalData.get("completion_percentage",!1);return r.a.createElement("div",{className:"non-editable-field"},e?"".concat(e,"%"):"-")},n.renderCycleConfirmationPercentage=function(){var e=n.props.cycleAdditionalData.get("confirmation_percentage",!1);return r.a.createElement("div",{className:"non-editable-field"},e?"".concat(e,"%"):"-")},n.fields=Object(g.a)([{label:"Select cycle",renderFunc:n.renderCyclesSelect},{label:"Status",renderFunc:n.renderCycleStatus},{label:"Start date",renderFunc:n.renderStartDate},{label:"End date",renderFunc:n.renderEndDate},{label:"Completion percentage",renderFunc:n.renderCycleCompletionPercentage},{label:"Confirmation percentage",renderFunc:n.renderCycleConfirmationPercentage}]),n.renderFields=function(){return n.fields.map(function(e,t){return r.a.createElement(f.l,{key:t},r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},e.label),r.a.createElement(f.g,{sm:6,lg:6},e.renderFunc()))})},n.renderRunButton=function(){return"to_run"===n.getSelectedCycleStatus()&&r.a.createElement(f.c,{onClick:n.onClickRun},"Run!")},n.renderRerunButton=function(){return("finished"===n.getSelectedCycleStatus()||"to_rerun"===n.getSelectedCycleStatus())&&r.a.createElement(f.c,{onClick:n.onClickRerun},"Re-run")},n.onTogglePdf=function(e){var t=e.target.value;n.setState({generatePdf:t})},n.renderGeneratePdfCheckbox=function(){var e=n.state.generatePdf,t=n.props.cycleAdditionalData;return null===e&&(e=t.get("generate_pdf",!0)),"finished"===n.getSelectedCycleStatus()||"to_run"===n.getSelectedCycleStatus()?r.a.createElement(en,{fieldType:"checkbox",value:e,onChange:n.onTogglePdf,label:"Generate PDF invoices"}):null},n.renderResetButton=function(){return"finished"===n.getSelectedCycleStatus()&&r.a.createElement(f.c,{onClick:n.onClickReset},"Reset")},n.isChargingStatusProcessing=function(){var e=n.props.chargeStatusRefreshed,t=n.state.ChargedAllClicked,a=null!==e.get("start_date",null);return t||a},n.renderChargeAllButton=function(){var e=n.props.chargeStatus,t=!0,a="";if(n.isChargingStatusProcessing())t=!0,a="Processing...";else if(e.get("status",!1)){var i=0!==e.get("owed_amount",0);t=!i,a=i?"Charge All":"Nothing to charge"}else t=!0,a="Charge is running...";return r.a.createElement(f.c,{disabled:t,onClick:n.onClickChargeAll},a)},n.onRerunCancel=function(){n.setState({showRerunConfirm:!1})},n.onResetCancel=function(){n.setState({showResetConfirm:!1})},n.onRerunOk=function(){n.runCycle(!0),n.setState({showRerunConfirm:!1})},n.onResetOk=function(){n.resetCycle(),n.setState({showResetConfirm:!1})},n.renderRerunConfirmationModal=function(){var e=n.state.showRerunConfirm,t=n.props.cycleAdditionalData,a="Are you sure you want to re-run ".concat(sn(t),"?");return r.a.createElement(Ke,{onOk:n.onRerunOk,onCancel:n.onRerunCancel,show:e,message:a,labelOk:"Yes"},r.a.createElement(f.l,{validationState:"error"},r.a.createElement(f.n,null,"Cycle data will be reset (except for confirmed invoices)")))},n.renderResetConfirmationModal=function(){var e=n.state.showResetConfirm,t=n.props.cycleAdditionalData,a="Are you sure you want to reset ".concat(sn(t),"?");return r.a.createElement(Ke,{onOk:n.onResetOk,onCancel:n.onResetCancel,show:e,message:a,labelOk:"Yes"},r.a.createElement(f.l,{validationState:"error"},r.a.createElement(f.n,null,"Cycle data will be reset (except for confirmed invoices)")))},n.onChargeAllCancel=function(){n.setState({showChargeAllConfirm:!1})},n.onChargeAllOk=function(){n.setState({showChargeAllConfirm:!1}),n.chargeAll()},n.renderChargeAllConfirmationModal=function(){var e=n.state.showChargeAllConfirm;return r.a.createElement(Ke,{onOk:n.onChargeAllOk,onCancel:n.onChargeAllCancel,show:e,message:'Are you sure you want to run a "Charge All" request?',labelOk:"Yes"},r.a.createElement(f.l,{validationState:"error"},r.a.createElement(f.n,null,"The action will charge all customers")))},n.autoRefresh=null,n.autoRefreshChargingStatus=null,n.refreshAfterRun=null,n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(fr("charge_status",{api:"billrun",action:"chargestatus"}))}},{key:"componentWillReceiveProps",value:function(){var e=this.props.cycleAdditionalData,t=this.state,n=t.autoRefreshRunning;t.showRefreshButton||n||"running"!==e.get("cycle_status","")||this.initAutoRefresh()}},{key:"componentWillUnmount",value:function(){this.unsetAutoRefresh(),clearTimeout(this.autoRefreshChargingStatus),clearTimeout(this.refreshAfterRun),this.clearData()}},{key:"render",value:function(){var e=this.state.selectedCycle,t=this.props.cycleAdditionalData,n=e.get("billrun_key",""),a=Object(g.a)(["running","finished","confirmed","to_rerun"]).contains(this.getSelectedCycleStatus()),i="finished"===this.getSelectedCycleStatus(),o="confirmed"===this.getSelectedCycleStatus(),l={billrun_key:n};return r.a.createElement("div",null,r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement("div",{className:"pull-right",style:{paddingBottom:10}},this.renderChargeAllButton()))),r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:this.renderPanelHeader()},r.a.createElement(f.j,{horizontal:!0},this.renderFields(),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h}),r.a.createElement(f.g,{sm:6,lg:6},this.renderRunButton(),this.renderRerunButton(),this.renderResetButton(),r.a.createElement("div",{className:"pull-right",style:{paddingBottom:10}},this.renderGeneratePdfCheckbox())))),a&&r.a.createElement(uv,{billrunKey:n,selectedCycle:t,baseFilter:l,reloadCycleData:this.reloadCycleData,showConfirmAllButton:i,isCycleConfirmed:o}),this.renderRerunConfirmationModal(),this.renderResetConfirmationModal(),this.renderChargeAllConfirmationModal()))))}}]),t}(a.Component);pv.defaultProps={cycleAdditionalData:Object(g.b)(),chargeStatus:Object(g.b)(),chargeStatusRefreshed:Object(g.b)()};var dv=Object(l.connect)(function(e){return{cycleAdditionalData:e.list.get("cycle_data",Object(g.a)()).get(0)||Object(g.b)(),chargeStatus:e.list.get("charge_status",Object(g.a)()).get(0)||Object(g.b)(),chargeStatusRefreshed:e.list.get("charge_status_refresh",Object(g.a)()).get(0)||Object(g.b)()}})(pv),mv=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.line,n=e.onClickCancel,a=["_id","in_plan","over_plan","interconnect_aprice","out_plan"];return r.a.createElement("form",{className:"form-horizontal"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("button",{type:"button",onClick:n,className:"btn btn-default"},"Back"))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-body"},t.keySeq().map(function(e,n){var i=t.get(e);return"calc_time"===e?i=S.a.unix(t.get(e)).format(Y("datetimeFormat","DD/MM/YYYY HH:mm")):"urt"!==e&&"process_time"!==e||(i=S.a.unix(t.getIn([e,"sec"])).format(Y("datetimeLongFormat","DD/MM/YYYY HH:mm:ss"))),a.includes(e)?null:r.a.createElement("div",{className:"form-group",key:n},r.a.createElement("label",{className:"col-lg-2 control-label",htmlFor:"input"},G(e,"queue")),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("input",{disabled:!0,className:"form-control",value:i})))}))),r.a.createElement("button",{type:"button",onClick:n,className:"btn btn-default"},"Back"))))}}]),t}(a.Component);mv.defaultProps={line:g.c.Map(),onClickCancel:function(){}};var gv=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={line:null,viewing:!1,page:0,size:10,sort:g.c.Map({calc_time:-1}),filter:{}},n.onFilter=function(e){n.setState({filter:e,page:0},n.fetchItems)},n.onSort=function(e){var t=g.c.Map(e);n.setState({sort:t},n.fetchItems)},n.onClickLine=function(e){n.setState({line:e,viewing:!0})},n.onCancelView=function(){n.setState({line:null,viewing:!1})},n.getNextCalculator=function(e){var t=n.props.calculators;return t.get(t.indexOf(e)+1)},n.getPreviousCalculator=function(e){var t=n.props.calculators;return t.get(t.indexOf(e)-1)},n.parseCalcName=function(e){var t=e.get("calc_name");return n.getNextCalculator(t)},n.parseCalcTime=function(e){var t=e.get("calc_time",!1);return!1===t?"Never":S.a.unix(t).format(Y("datetimeFormat","DD/MM/YYYY HH:mm"))},n.fetchItems=function(){n.props.dispatch(fr("queue_lines",n.buildQuery()))},n.handlePageClick=function(e){n.setState({page:e},n.fetchItems)},n.urtQueryBuilder=function(){var e=n.state.filter.urt,t=void 0===e?{}:e,a=Object.assign({},t);return a.from?(a.$gte=a.from,delete a.from):""===a.from&&delete a.from,a.to?(a.$lte=a.to,delete a.to):""===a.to&&delete a.to,a},n.handleQuerySpecialValues=function(){var e=n.state.filter,t=void 0===e?{}:e,a=Object.assign({},t);if(a.calc_name){var r=n.getPreviousCalculator(a.calc_name);a.calc_name=!1===r?{$in:[!1]}:{$regex:r,$options:"i"}}return a.urt&&(a.urt=n.urtQueryBuilder(),Object.keys(a.urt).length||delete a.urt),a},n.buildQuery=function(){var e=n.state,t=e.page,a=e.size,r=e.sort,i=n.handleQuerySpecialValues();return Or(i,t,r,a)},n.getFilterFields=function(){return[{id:"type",title:"Type",type:"text"},{id:"calc_name",title:"Calculator Stage",type:"text"},{id:"urt",title:"Date",type:"date-range"}]},n.getTableFields=function(){return[{id:"type",title:"Type"},{id:"calc_time",title:"Last Calculation Time",sort:!0,parser:n.parseCalcTime,cssClass:"long-date"},{id:"calc_name",title:"Calculator Stage",sort:!0,parser:n.parseCalcName},{id:"urt",title:"Time",type:"fullDate",cssClass:"long-date",sort:!0}]},n.renderPanelTitle=function(){return r.a.createElement("div",null,r.a.createElement("span",null,"List of queue data"),r.a.createElement("div",{className:"pull-right"},r.a.createElement(s.b,{to:"/usage",className:"btn btn-default btn-xs"},"Back to Usage")))},n.renderQueueList=function(){var e=n.props.items,t=n.state.sort,a=n.getTableFields(),i=n.getFilterFields();return r.a.createElement("div",null,r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:n.renderPanelTitle()},r.a.createElement(sp,{fields:i,onFilter:n.onFilter}),r.a.createElement(ec,{items:e,fields:a,edit:!0,onClickEdit:n.onClickLine,editText:"view",onSort:n.onSort,sort:t})))),r.a.createElement(up,{onClick:n.handlePageClick,size:n.state.size,count:e.size}))},n.renderQueueItem=function(){var e=n.state.line;return r.a.createElement(mv,{line:e,onClickCancel:n.onCancelView})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.fetchItems()}},{key:"render",value:function(){var e=this.state.viewing;return r.a.createElement("div",{className:"QueueList"},e?this.renderQueueItem():this.renderQueueList())}}]),t}(a.Component);gv.defaultProps={items:g.c.List(),calculators:g.c.List([!1].concat(Object(w.a)(Y("queue_calculators",[])),["-"]))};var fv=Object(l.connect)(function(e){return{items:e.list.get("queue_lines")}})(gv),hv=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={page:0,size:10,sort:g.c.Map({invoice_id:-1}),filter:{}},n.buildQuery=function(){var e=n.props.collection,t=n.state,a=t.page,r=t.size,i=t.filter,o=t.sort,l=Object.assign({},i,{action:"query_bills_invoices",type:"inv"});return l.aid&&(l.aid={$in:[l.aid]}),l.invoice_id&&(l.invoice_id={$in:[l.invoice_id]}),{entity:e,action:"get",params:[{size:r},{page:a},{sort:JSON.stringify(o)},{query:JSON.stringify(l)}]}},n.onFilter=function(e){n.setState({filter:e,page:0},n.fetchItems)},n.handlePageClick=function(e){n.setState({page:e},n.fetchItems)},n.onSort=function(e){var t=g.c.Map(e);n.setState({sort:t},n.fetchItems)},n.fetchItems=function(){n.props.dispatch(fr("invoices",n.buildQuery())),n.props.dispatch(fr("billrun",n.buildQuery()))},n.downloadURL=function(e,t,n){return"".concat(Y(["env","serverApiUrl"],""),"/api/accountinvoices?action=download&aid=").concat(e,"&billrun_key=").concat(t,"&iid=").concat(n)},n.renderMainPanelTitle=function(){return r.a.createElement("div",null,r.a.createElement("span",null,"List of all invoices"))},n.parserPaidBy=function(e){var t=e.get("paid",!1);return[!0,"1"].includes(t)?r.a.createElement("span",{style:{color:"#3c763d"}},"Paid"):"2"===t?r.a.createElement("span",{style:{color:"#5b5e5b"}},"Pending"):S()(e.get("due_date")).isAfter(S()())?r.a.createElement("span",{style:{color:"#8a6d3b"}},"Due"):r.a.createElement("span",{style:{color:"#a94442"}},"Not Paid")},n.parserDownload=function(e){var t=n.downloadURL(e.get("aid"),e.get("billrun_key"),e.get("invoice_id"));return e.get("invoice_file",!1)&&r.a.createElement("form",{method:"post",action:t,target:"_blank"},r.a.createElement("input",{type:"hidden",name:"a",value:"a"}),r.a.createElement("button",{className:"btn btn-link",type:"submit"},r.a.createElement("i",{className:"fa fa-download"})," Download"))},n.parseCycleDataEmailSent=function(e){var t=e.getIn(["email_sent","sec"],!1);return t?S.a.unix(t).format(Y("datetimeFormat","DD/MM/YYYY HH:mm")):"Not Sent"},n.getTableFields=function(){return[{id:"invoice_id",title:"Invoice Id",sort:!0},{id:"invoice_date",title:"Date",cssClass:"short-date",sort:!0,type:"mongodate"},{id:"due_date",title:"Due",cssClass:"short-date",sort:!0,type:"mongodate"},{id:"amount",title:"Amount",sort:!0},{id:"paid",title:"Status",parser:n.parserPaidBy},{id:"billrun_key",title:"Cycle",sort:!0},{id:"aid",title:"Customer ID",sort:!0},{id:"payer_name",title:"Name",sort:!0},{title:"Download",parser:n.parserDownload},{id:"email_sent",title:"Email Sent",sort:!0,parser:n.parseCycleDataEmailSent,display:n.props.settings.get("billrun",g.c.Map()).get("email_after_confirmation",!1)}]},n.getFilterFields=function(){var e=n.props.baseFilter;return[{id:"aid",placeholder:"Customer ID",type:"number",showFilter:!Object.prototype.hasOwnProperty.call(e,"aid")},{id:"invoice_id",placeholder:"Invoice Id",type:"number",showFilter:!Object.prototype.hasOwnProperty.call(e,"invoice_id")}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillUnmount",value:function(){this.props.dispatch(gr("invoices"))}},{key:"render",value:function(){var e=this.props,t=e.items,n=e.baseFilter,a=this.state.sort,i=this.getTableFields(),o=this.getFilterFields();return r.a.createElement("div",{className:"InvoicesList"},r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:this.renderMainPanelTitle()},r.a.createElement(lp,{fields:o,onFilter:this.onFilter,base:n}),r.a.createElement(ec,{items:t,fields:i,onSort:this.onSort,sort:a,className:"invoices-list"})))),r.a.createElement(up,{onClick:this.handlePageClick,size:this.state.size,count:t.size}))}}]),t}(a.Component);hv.defaultProps={settings:g.c.Map(),items:g.c.List(),baseFilter:{},collection:"bills"};var vv=Object(l.connect)(function(e,t){return{settings:e.settings,baseFilter:t.location.query.base?JSON.parse(t.location.query.base):{},items:e.list.get("invoices")}})(hv),yv=n(270),bv=n.n(yv),Ev=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChange=function(e){n.props.onChange("billrun","timezone",e)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.data,n=e.timeZoneOptions;return r.a.createElement("div",{className:"DateTime"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{controlId:"timezone",key:"timezone"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Time Zone"),r.a.createElement(f.g,{sm:6},r.a.createElement(en,{fieldType:"select",options:n,onChange:this.onChange,value:t.get("timezone",""),clearable:!1})))))}}]),t}(a.Component);Ev.defaultProps={data:g.c.Map(),timeZoneOptions:bv.a.tz.names().map(function(e){return{label:e,value:e}})};var Cv=function(e){var t=e.data,n=e.currencies;return r.a.createElement("div",{className:"CurrencyTax"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{controlId:"currency",key:"currency"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Currency"),r.a.createElement(f.g,{sm:6},r.a.createElement(en,{fieldType:"select",options:n,value:t,onChange:function(t){e.onChange("pricing","currency",t)}})))))};Cv.defaultProps={data:"",currencies:[]};var _v=Cv,Ov=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChange=function(e){var t=e.target,a=t.id,r=t.value;n.props.onChange("billrun",a,r)},n.onToggleDetailedInvoices=function(e){var t=e.target.value;n.props.onChange("billrun","detailed_invoices",t)},n.onToggleEmailAfterConfirmation=function(e){var t=e.target.value;n.props.onChange("billrun","email_after_confirmation",t)},n.onToggleGeneratePdf=function(e){var t=e.target.value;n.props.onChange("billrun","generate_pdf",t)},n.renderOption=function(e,t){return r.a.createElement("option",{value:e,key:t},e)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props.data,n={marginTop:10},a=Object(w.a)(Array(28)).map(function(t,n){return e.renderOption(n+1,n)});return r.a.createElement("div",{className:"Invoicing"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{controlId:"charging_day",key:"charging_day"},r.a.createElement(f.g,{componentClass:f.h,sm:2},"Charging Day"),r.a.createElement(f.g,{sm:6},r.a.createElement("select",{id:"charging_day",name:"charging_day",value:t.get("charging_day",""),onChange:this.onChange,className:"form-control"},[r.a.createElement("option",{value:"",key:"select_charging_day"},"Select charging day...")].concat(Object(w.a)(a))))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:10,smOffset:2,style:n},r.a.createElement(en,{fieldType:"checkbox",label:"Billing cycle generates PDF invoices",value:t.get("generate_pdf",!0),onChange:this.onToggleGeneratePdf}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:10,smOffset:2,style:n},r.a.createElement(en,{fieldType:"checkbox",label:"Detailed Invoices",value:t.get("detailed_invoices",!1),onChange:this.onToggleDetailedInvoices,disabled:!t.get("generate_pdf",!0)}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:10,smOffset:2,style:n},r.a.createElement(en,{fieldType:"checkbox",label:"Send invoices to customers by email",value:t.get("email_after_confirmation",!1),onChange:this.onToggleEmailAfterConfirmation,disabled:!t.get("generate_pdf",!0)}),r.a.createElement(f.n,{style:{marginLeft:20,marginTop:0}},Pi.email_after_confirmation)))))}}]),t}(a.Component),Sv=function(e){var t=e.play,n=e.index,a=e.isDefaultDisabled,i=e.showEnableAction,o=e.onChangeDefault,l=e.onEdit,s=e.onDisable,c=[{type:"edit",helpText:"Edit",onClick:l},{type:"enable",helpText:"Enable",onClick:e.onEnable,show:i},{type:"disable",helpText:"Disable",onClick:s,show:!i},{type:"remove",helpText:"Remove",onClick:e.onRemove}];return r.a.createElement("tr",{key:n},r.a.createElement("td",null,r.a.createElement(N,{status:t.get("enabled",!0)?"active":"expired"})),r.a.createElement("td",null,t.get("name","")),r.a.createElement("td",null,t.get("label","")),r.a.createElement("td",{className:"text-center"},r.a.createElement(en,{fieldType:"radio",name:"default-play",onChange:o,checked:t.get("default",!1),disabled:a})),r.a.createElement("td",{className:"td-actions"},r.a.createElement(Xe,{actions:c,data:t})))};Sv.defaultProps={play:g.c.Map(),isNameEditable:!1,isDefaultDisabled:!1,showEnableAction:!0};var Tv=Sv,kv=function(e){var t=e.item,n=e.isNameHasError,a=e.isAllowedDisableAction,i=e.isAllowedEditName,o=e.isAllowedEditDefault,l=e.onChangeName,s=e.onChangeLabel,c=e.onChangeDefault,u=e.onChangeEnabled;return r.a.createElement(f.j,{horizontal:!0},i&&r.a.createElement(f.l,{validationState:n?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Name ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:7},r.a.createElement(en,{onChange:l,value:t.get("name","")}),n&&r.a.createElement(f.n,null,n))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Description"),r.a.createElement(f.g,{sm:7},r.a.createElement(en,{onChange:s,value:t.get("label","")}))),o&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:7,smOffset:3},r.a.createElement(en,{fieldType:"checkbox",label:"Default",value:t.get("default",!1),onChange:c}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:7,smOffset:3},r.a.createElement(en,{fieldType:"checkbox",label:"Enabled",value:t.get("enabled",!1),onChange:u,disabled:!a}))))};kv.defaultProps={item:g.c.Map(),isNameHasError:!1,isAllowedDisableAction:!0,isAllowedEditName:!0,isAllowedEditDefault:!0};var Iv=kv,Nv=Object(l.connect)(function(e,t){return{isAllowedDisableAction:!t.item.get("default",!1),isAllowedEditName:"create"===t.mode,isAllowedEditDefault:"create"===t.mode,isNameHasError:t.errors&&t.errors.get("name",!1)}},function(e,t){return{onChangeName:function(e){var n=t.item,a=t.updateField,r=t.setError,i=t.existingNames,o=t.errors,l=e.target.value.toUpperCase().replace(Y("keyUppercaseCleanRegex",/./),"");a(["name"],l),i.includes(l)?r("name","Name already exists"):o.get("name",!1)&&r("name"),""!==n.get("label","")&&n.get("label","").toUpperCase()!==n.get("name","").toUpperCase()||a("label",Object(x.titleCase)(l))},onChangeLabel:function(e){(0,t.updateField)("label",e.target.value)},onChangeDefault:function(e){var n=t.updateField,a=e.target.value;n("default",a),a&&n("enabled",!0)},onChangeEnabled:function(e){(0,t.updateField)("enabled",e.target.value)}}})(Iv),wv=Object(l.connect)(function(e,t){return{isDefaultDisabled:!t.play.get("enabled",!0),isDisableAllowd:!t.play.get("default",!1),showEnableAction:!t.play.get("enabled",!0)}},function(e,t){var n=t.index,a=t.play,r=t.plays,i=t.onChange,o=t.onRemove;Object(pt.a)(t,["index","play","plays","onChange","onRemove"]);return{onChangeDefault:function(){return a.get("enabled",!0)?(r.forEach(function(e,t){i([t,"default"],!1)}),i([n,"default"],!0),e(rl(["plays"])).then(function(e){return!!e.status||Promise.reject()}).then(function(){return e(il("plays"))}).catch(function(){return e(il("plays")),Promise.reject()})):e(Ja("Disabled play can not be default"))},onEdit:function(t){var a={title:"Edit Play ".concat(t.get("name","")),onOk:function(t){return i([n],t),e(rl(["plays"])).then(function(e){return!!e.status||Promise.reject()}).then(function(){return e(il("plays"))}).catch(function(){return e(il("plays")),Promise.reject()})},mode:"edit"};return e(mo(t,Nv,a))},onRemove:function(t){if(t.get("default",!1))return e(Ja("Default play can not be removed"));var a={message:'Are you sure you want to remove Play "'.concat(t.get("name",""),'"?'),onOk:function(){return o(n),e(rl(["plays"])).then(function(){return e(il("plays"))})},labelOk:"Delete",type:"delete"};return e(po(a))},onEnable:function(){return i([n,"enabled"],!0),e(rl("plays")).then(function(){return e(il("plays"))})},onDisable:function(t){if(t.get("default",!1))return e(Ja("Default play can not be disabled"));var a={message:'Are you sure you want to disable Play "'.concat(t.get("name",""),'"?'),onOk:function(){return i([n,"enabled"],!1),e(rl(["plays"])).then(function(){return e(il("plays"))})},type:"delete",labelOk:"Disable"};return e(po(a))}}})(Tv),jv=function(e){var t=e.data,n=e.onChange,a=e.onRemove,i=e.onAdd;return r.a.createElement("div",{className:"Plays List row panel-body"},r.a.createElement(f.z,{className:"table table-hover table-striped table-bordered"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"state"},"Status"),r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Label"),r.a.createElement("th",{className:"text-center list-status-col"},"Default"),r.a.createElement("th",null,"\xa0"))),r.a.createElement("tbody",null,t.map(function(e,i){return r.a.createElement(wv,{key:"play_".concat(i),index:i,play:e,onChange:n,onRemove:a,plays:t})}))),r.a.createElement(Je,{onClick:i,type:"Play",action:"Add"}))};jv.defaultProps={data:g.c.List()};var Rv=jv,xv=Object(l.connect)(null,function(e,t){return{onChange:function(t,n){e(Zo("plays",t,n))},onRemove:function(t){e(el("plays",t))},onAdd:function(){var n=t.data,a=g.c.Map({name:"",label:"",enabled:!0,default:n.isEmpty()}),r={title:"Create New Play",onOk:function(t){return""===t.get("name","")?(e(go("name","Name is required")),!1):(t.get("default",!1)&&n.forEach(function(t,n){e(Zo("plays",[n,"default"],!1))}),e(Zo("plays",n.size,t)),e(rl(["plays"])).then(function(e){return!!e.status||Promise.reject()}).then(function(){return e(il("plays"))}).catch(function(){return e(il("plays")),Promise.reject()}))},mode:"create",existingNames:n.map(function(e){return e.get("name","")})};return e(mo(a,Nv,r))}}})(Rv),Fv=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeOrigNum=function(e){var t=n.props,a=t.fileType,r=t.usageType;n.props.onChange(a,r,"orig_num",e)},n.onChangeTermNum=function(e){var t=n.props,a=t.fileType,r=t.usageType;n.props.onChange(a,r,"term_num",e)},n.getOptions=function(){return n.props.options.map(function(e){return{label:"".concat(G(e,"lines",Object(x.sentenceCase)(e))),value:e}}).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.props.disabled!==e.disabled||this.props.fileType!==e.fileType||this.props.usageType!==e.usageType||!g.c.is(this.props.options,e.options)||!g.c.is(this.props.csiMap,e.csiMap)}},{key:"render",value:function(){var e=this.props,t=e.fileType,n=e.usageType,a=e.csiMap,i=e.disabled,o=this.getOptions();return r.a.createElement(f.v,{header:"".concat(t," - ").concat(n)},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Origin Number"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"select",value:a.get("orig_num",""),onChange:this.onChangeOrigNum,options:o,disabled:i}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Term Number"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"select",value:a.get("term_num",""),onChange:this.onChangeTermNum,options:o,disabled:i}))))}}]),t}(a.Component);Fv.defaultProps={fileType:"",usageType:"",csiMap:g.c.Map(),options:g.c.List(),disabled:!1};var Pv=Fv,Mv=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeProvider=function(e){var t=n.props.csi.set("provider",e);n.props.onChange(t)},n.onChangeOptionalCharges=function(e){var t=e.target.value,a=n.props.csi.set("apply_optional_charges",t);n.props.onChange(a)},n.onChangeAuthToken=function(e){var t=e.target.value,a=n.props.csi.set("auth_code",t);n.props.onChange(a)},n.onChangeTaxationMapping=function(e,t,a,r){var i=n.props.csi.update("taxation_mapping",g.c.List(),function(n){var i=n.findIndex(function(n){return n.get("file_type","")===e&&n.get("usaget","")===t});if(-1===i){var o=g.c.Map(Object(vr.a)({usaget:t,file_type:e},a,r));return n.push(o)}return n.setIn([i,a],r)});n.props.onChange(i)},n.getProviderOptions=function(){return n.props.csi.get("available_providers",g.c.Map({a:"A",b:"B"})).map(function(e,t){return{value:t,label:e}}).toList().toArray()},n.getMapperFileType=function(e){return n.props.csi.get("taxation_mapping",g.c.List()).find(function(t){return t.get("file_type","")===e.get("fileType","")&&t.get("usaget","")===e.get("usageType","")},null,g.c.Map())},n.renderTaxationMapping=function(){var e=n.props,t=e.fileTypes,a=e.disabled;return t.map(function(e,t){return r.a.createElement(Pv,{key:t,csiMap:n.getMapperFileType(e),fileType:e.get("fileType",""),usageType:e.get("usageType",""),options:e.get("customKeys",g.c.List()),disabled:a,onChange:n.onChangeTaxationMapping})}).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.props.disabled!==e.disabled||!g.c.is(this.props.fileTypes,e.fileTypes)||!g.c.is(this.props.csi,e.csi)}},{key:"render",value:function(){var e=this.props,t=e.csi,n=e.disabled,a=this.getProviderOptions();return r.a.createElement("div",{className:"csi"},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Authentication Token"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{value:t.get("auth_code",""),onChange:this.onChangeAuthToken,disabled:n}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Provider"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"select",value:t.get("provider",""),onChange:this.onChangeProvider,options:a,disabled:n}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"\xa0"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"checkbox",value:t.get("apply_optional_charges",""),onChange:this.onChangeOptionalCharges,label:"Apply Optional Charges",disabled:n}))),this.renderTaxationMapping())}}]),t}(a.Component);Mv.defaultProps={csi:g.c.Map(),fileTypes:g.c.List(),disabled:!1,onChange:function(){}};var Av=Mv,Dv=function(e){var t=e.data,n=e.csiOptions,a=e.taxRateOptions,i=e.onChange,o="CSI"===t.get("tax_type",""),l=function(e){var t=e.target.value;i("taxation","tax_type",t)},s=a.map(function(e){return{label:e.get("description",""),value:e.get("key","")}}).toArray();return r.a.createElement("div",{className:"tax"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{controlId:"tax_type"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Tax Type"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(en,{fieldType:"radio",onChange:l,name:"tax_type",value:"usage",label:"Custom",checked:!o})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(en,{fieldType:"radio",onChange:l,name:"tax_type",value:"CSI",label:"CSI",checked:o})))),r.a.createElement("hr",null),o&&r.a.createElement(Av,{csi:t.get("CSI",g.c.Map()),onChange:function(e){i("taxation","CSI",e)},fileTypes:n}),!o&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Default Tax Rate"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"select",value:t.getIn(["default","key"],""),onChange:function(e){i("taxation",["default","key"],e)},options:s})))))};Dv.defaultProps={data:g.c.Map(),csiOptions:g.c.List(),taxRateOptions:g.c.List()};var Lv=Dv,Uv=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={logo:""},n.onChangeField=function(e){var t=e.target,a=t.id,r=t.value;n.props.onChange("tenant",a,r)},n.updateLogoPreview=function(e){var t=new FileReader;t.onload=function(e){n.setState({logo:e.target.result})},t.readAsDataURL(e)},n.uploadFile=function(e){var t=e.target.files;if(t.length>0){var a=1024*Y("logoMaxSize",2)*1024;t[0].size<=a?(nl(t[0],{billtype:"logo"}),n.props.onChange("tenant","logo",t[0].name),n.updateLogoPreview(t[0])):n.props.dispatch(Ja("Max file size is ".concat(Gc()(a).human())))}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.data,t=this.state.logo.length>0?this.state.logo:this.props.logo;return r.a.createElement("div",{className:"Tenant"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{controlId:"name",key:"name"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Name"),r.a.createElement(f.g,{sm:6},r.a.createElement(f.k,{type:"text",name:"name",onChange:this.onChangeField,value:e.get("name","")}))),r.a.createElement(f.l,{controlId:"address",key:"address"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Address"),r.a.createElement(f.g,{sm:6},r.a.createElement(f.k,{componentClass:"textarea",name:"address",onChange:this.onChangeField,value:e.get("address","")}))),r.a.createElement(f.l,{controlId:"phone",key:"phone"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Phone"),r.a.createElement(f.g,{sm:6},r.a.createElement(f.k,{type:"text",name:"phone",onChange:this.onChangeField,value:e.get("phone","")}))),r.a.createElement(f.l,{controlId:"email",key:"email"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Email"),r.a.createElement(f.g,{sm:6},r.a.createElement(f.k,{type:"email",name:"email",onChange:this.onChangeField,value:e.get("email","")}))),r.a.createElement(f.l,{controlId:"website",key:"website"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Website"),r.a.createElement(f.g,{sm:6},r.a.createElement(f.k,{type:"text",name:"website",onChange:this.onChangeField,value:e.get("website","")}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,md:2},"Logo"),r.a.createElement(f.g,{sm:6},r.a.createElement(f.k,{type:"file",name:"logo",onChange:this.uploadFile}),t.length>0&&r.a.createElement("img",{src:t,style:{height:100,marginTop:20},alt:"Logo"})))))}}]),t}(a.Component);Uv.defaultProps={data:g.c.Map()};var Vv=Object(l.connect)(function(e){return{logo:e.settings.getIn(["files","logo"])}})(Uv),Bv=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={item:n.props.item,title:n.props.item.isEmpty()?"New":"Edit",action:n.props.item.isEmpty()?"create":"edit"},n.onChangeName=function(e){var t=n.state.item,a=e.target.value;n.setState({item:t.set("name",a)})},n.onChangeDateFrom=function(e){var t=n.state.item,a=Y("apiDateFormat","YYYY-MM-DD"),r=e?e.format(a):"";n.setState({item:t.set("from",r)})},n.onChangeDateTo=function(e){var t=n.state.item,a=Y("apiDateFormat","YYYY-MM-DD"),r=e?e.format(a):"";n.setState({item:t.set("to",r)})},n.onSave=function(){var e=n.state,t=e.item,a=e.action;n.props.onSave(t,a)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.item,n=e.action,a="create"===n?"New":"Edit";return r.a.createElement(Ye,{title:"".concat(a," Secret"),show:!0,onOk:this.onSave,onCancel:this.props.onCancel,labelOk:"Save"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{controlId:"name",key:"name"},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Name"),r.a.createElement(f.g,{sm:8},r.a.createElement(f.k,{type:"text",name:"name",onChange:this.onChangeName,value:t.get("name","")}))),r.a.createElement(f.l,{controlId:"key",key:"key"},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Secret Key"),r.a.createElement(f.g,{sm:8},r.a.createElement(f.k,{type:"text",name:"key",value:t.get("key",""),disabled:!0}),"create"===n&&r.a.createElement(f.n,null,"Secret will be available after saving"))),r.a.createElement(f.l,{controlId:"from",key:"from"},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Creation Date"),r.a.createElement(f.g,{sm:8},r.a.createElement("div",{className:"pull-left"},r.a.createElement(Et.a,{className:"form-control",dateFormat:Y("dateFormat","DD/MM/YYYY"),selected:t.get("from","").length?S()(t.get("from","")):null,onChange:this.onChangeDateFrom,isClearable:!0,placeholderText:"Select Date..."})))),r.a.createElement(f.l,{controlId:"to",key:"to"},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Expiration Date"),r.a.createElement(f.g,{sm:8},r.a.createElement("div",{className:"pull-left"},r.a.createElement(Et.a,{className:"form-control",dateFormat:Y("dateFormat","DD/MM/YYYY"),selected:t.get("to","").length?S()(t.get("to","")):null,onChange:this.onChangeDateTo,isClearable:!0,placeholderText:"Select Date..."}))))))}}]),t}(a.Component);Bv.defaultProps={item:g.c.Map()};var qv=Bv,zv=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showConfirmRemove:!1,itemToRemove:null,currentItem:null},n.parseDate=function(e,t){var n=ee(e,t.id,!1);return n?n.format(Y("dateFormat","DD/MM/YYYY")):""},n.parserState=function(e){return r.a.createElement(N,{from:ee(e,"from",S()(0)).toISOString(),to:ee(e,"to",S()(0)).toISOString()})},n.onClickEdit=function(e){n.setState({currentItem:e})},n.onClickRemove=function(e){n.setState({showConfirmRemove:!0,itemToRemove:e})},n.onClickRemoveClose=function(){n.setState({showConfirmRemove:!1,itemToRemove:null})},n.onCancel=function(){n.setState({currentItem:null})},n.handleSave=function(e,t){n.props.dispatch(ll(e,t)).then(n.afterSave)},n.afterSave=function(e){1===e.status&&(n.setState({currentItem:null}),n.props.dispatch(il(["shared_secret"])))},n.onClickRemoveOk=function(){var e=n.state.itemToRemove.get("key","");n.props.dispatch(ll(e,"remove")).then(n.afterRemove)},n.afterRemove=function(e){1===e.status&&(n.setState({showConfirmRemove:!1,itemToRemove:null}),n.props.dispatch(il(["shared_secret"])))},n.onClickNew=function(){n.setState({currentItem:g.c.Map()})},n.renderList=function(){var e=n.props.data,t=n.getListFields(),a=n.getListActions();return r.a.createElement(ec,{items:e,fields:t,edit:!1,actions:a})},n.getListFields=function(){return[{id:"state",title:"Status",parser:n.parserState,cssClass:"state"},{id:"name",title:"Name"},{id:"key",title:"Secret Key"},{id:"from",title:"Creation Date",parser:n.parseDate,cssClass:"long-date text-center"},{id:"to",title:"Expiration Date",parser:n.parseDate,cssClass:"long-date text-center"}]},n.getListActions=function(){return[{type:"edit",showIcon:!0,helpText:"Edit",onClick:n.onClickEdit},{type:"remove",showIcon:!0,helpText:"Remove",onClick:n.onClickRemove}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.showConfirmRemove,n=e.currentItem;return r.a.createElement("div",null,this.renderList(),r.a.createElement(Je,{onClick:this.onClickNew,label:"Add New"}),null!==n&&r.a.createElement(qv,{item:n,show:!0,onSave:this.handleSave,onCancel:this.onCancel}),r.a.createElement(Ke,{onOk:this.onClickRemoveOk,onCancel:this.onClickRemoveClose,show:t,message:"Are you sure you want to remove this key ?",labelOk:"Yes"}))}}]),t}(a.Component);zv.defaultProps={data:g.c.List()};var Hv=Object(s.f)(Object(l.connect)()(zv)),Yv=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChangeTitle=function(e){var t=e.target.value,a=n.state.menuItem;n.setState({menuItem:a.set("title",t)})},n.onChangeRoles=function(e){var t=n.state.menuItem,a=e.length?e.split(","):[];n.setState({menuItem:t.set("roles",g.c.List(a))})},n.onChangeShowHide=function(e){var t=e.target.value,a=n.props.item;n.props.onChangeField(a.get("id"),"show",t)},n.onCancelAdvencedEdit=function(){var e=n.state.menuItem;n.setState({menuItem:e.remove("title").remove("roles")}),n.closeEdit()},n.onSaveAdvencedEdit=function(){var e=Object(ki.a)(n),t=e.props.item,a=e.state.menuItem,r=t.get("id");a.forEach(function(e,a){t.get(a,"")!==e&&n.props.onChangeField(r,a,e)}),n.closeEdit()},n.onMouseEnter=function(e){n.setState({mouseOver:!0})},n.onMouseLeave=function(e){n.setState({mouseOver:!1})},n.toggleEdit=function(e){e.preventDefault();var t=n.state.editMode;n.setState({editMode:!t})},n.closeEdit=function(){n.setState({editMode:!1})},n.renderEditModal=function(){var e=Object(ki.a)(n),t=e.props.item,a=e.state,i=a.editMode,o=a.menuItem,l=o.title,s=o.roles,c=t.get("title",""),u=["admin","read","write"].map(function(e){return{value:e,label:e}});return r.a.createElement(Ye,{show:i,onOk:n.onSaveAdvencedEdit,onCancel:n.onCancelAdvencedEdit,title:"Edit ".concat(c," Details")},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Label"),r.a.createElement(f.g,{sm:10},r.a.createElement(en,{autoFocus:!0,onChange:n.onChangeTitle,value:l}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Roles"),r.a.createElement(f.g,{sm:10},r.a.createElement(en,{fieldType:"select",multi:!0,value:s.join(","),options:u,onChange:n.onChangeRoles})))))},n.renderRole=function(){var e=n.state.menuItem.roles;return 0===e.size?r.a.createElement("small",null,"Visible to all roles"):r.a.createElement("small",null,e.join(","))},n.renderTitle=function(){var e=Object(ki.a)(n),t=e.props.item,a=e.state.menuItem.title,i=t.get("icon",""),o=i.length?r.a.createElement("i",{className:"fa ".concat(i," fa-fw")}):null;return r.a.createElement("span",null,o," ",a)},n.renderMouseOver=function(){return r.a.createElement("span",null,"\xa0",r.a.createElement("i",{className:"fa fa-pencil-square-o fa-fw"}))};var a=g.c.Record({title:e.item.get("title",""),roles:e.item.get("roles",g.c.List())});return n.state={editMode:!1,mouseOver:!1,menuItem:new a},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,e.item)||this.state!==t}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.editShow,a=this.state,i=a.mouseOver,o=a.editMode,l=t.get("show",!1);return r.a.createElement(f.g,{md:12,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},r.a.createElement(f.g,{md:6,style:{color:"#008cba",cursor:"pointer"},onClick:this.toggleEdit},this.renderTitle(),i&&!o&&this.renderMouseOver()),r.a.createElement(f.g,{md:4,className:"text-right",style:{cursor:"pointer"},onClick:this.toggleEdit},this.renderRole(),i&&!o&&this.renderMouseOver()),r.a.createElement(f.g,{md:2,className:"text-right",style:{marginTop:10}},r.a.createElement(en,{onChange:this.onChangeShowHide,value:l,fieldType:"checkbox",disabled:!n})),this.renderEditModal())}}]),t}(a.Component);Yv.defaultProps={editShow:!0,item:g.c.Map(),onChangeField:function(){}};var Gv=Yv,Kv=Object(et.SortableElement)(function(e){var t=e.data,n=t.item,a=t.onChangeField,i=t.subMenus,o=t.renderTree,l=t.newPath,s=t.editShow;return r.a.createElement(f.g,{md:12,className:"pr0",style:{borderTop:"1px solid #eee",borderBottom:"1px solid #eee",lineHeight:"35px"}},r.a.createElement(f.g,{md:1},r.a.createElement(rt,null)),r.a.createElement(f.g,{md:11,className:"pr0"},r.a.createElement(Gv,{item:n,onChangeField:a,editShow:s}),i.size>0&&o(i,[].concat(Object(w.a)(l),["subMenus"]),n.get("id"))))}),Wv=Object(et.SortableContainer)(function(e){var t=e.data,n=t.items,a=t.renderMenu,i=t.path;return r.a.createElement(f.g,{lg:12,md:12,className:"pr0"},n.map(function(e,t){return a(e,t,i)}))}),Jv=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeField=function(e,t,a){n.props.onChange("menu",["main",e,t],a)},n.onChangeOrder=function(e){n.props.onChangeMenuOrder(["main"],e)},n.onDragEnd=function(e){var t=e.oldIndex,a=e.newIndex,r=e.collection,i=n.props.data,o=""===r?[]:r.split("-"),l=g.c.Map();i.getIn(o).forEach(function(e){var n=e.get("order"),r=e.get("id");n>=Math.min(a,t)&&n<=Math.max(a,t)&&(l=n===t?l.set(r,a):n>t?l.set(r,n-1):l.set(r,n+1))}),n.onChangeOrder(l)},n.renderMenu=function(e,t,a){var i=n.props.disallowEditShow,o=a.join("-"),l=g.c.Record({item:e,newPath:[].concat(Object(w.a)(a),[t]),onChangeField:n.onChangeField,renderTree:n.renderTree,subMenus:e.get("subMenus",g.c.List()),editShow:!0});return r.a.createElement(Kv,{collection:o,index:t,key:e.get("id"),data:new l({editShow:!i.includes(e.get("id"))})})},n.renderTree=function(e,t,a){var i=g.c.Record({path:t,items:e,renderMenu:n.renderMenu});return r.a.createElement(Wv,{lockAxis:"y",helperClass:"draggable-row",key:a,onSortEnd:n.onDragEnd,useDragHandle:!0,data:new i})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.data,e.data)}},{key:"render",value:function(){var e=this.props.data;return r.a.createElement("div",null,r.a.createElement(f.g,{md:6,className:"text-left"},"Main Menu"),r.a.createElement(f.g,{md:4,className:"text-right"},"Roles"),r.a.createElement(f.g,{md:2,className:"text-right"},"Show/Hide"),r.a.createElement(f.m,{bsClass:"wrapper",style:{paddingTop:35}},this.renderTree(e,[],"root")))}}]),t}(a.Component);Jv.defaultProps={disallowEditShow:g.c.List(["settings","settings_general","input_processors","custom_fields"]),data:g.c.Map()};var Qv=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={currentItem:null,createNew:!1,index:-1},n.getItemIndex=function(e){return n.props.usageTypesData.indexOf(e)},n.onClickEdit=function(e){n.setState({currentItem:e,createNew:!1,index:n.getItemIndex(e)})},n.onCancel=function(){n.setState({currentItem:null,createNew:!1})},n.handleSave=function(){var e=n.state,t=e.index,a=e.currentItem;n.setState({currentItem:null,createNew:!1}),n.props.dispatch(Zo("usage_types",t,a)),n.props.dispatch(rl("usage_types")),n.props.dispatch(il("usage_types"))},n.onUpdateItem=function(e,t){var a=n.state.currentItem,r=Array.isArray(e)?e:[e],i=Array.isArray(t)?t:[t];n.setState({currentItem:a.withMutations(function(e){r.forEach(function(t,n){return e.set(t,i[n])})})})},n.onClickNew=function(){var e=n.props.usageTypesData;n.setState({currentItem:g.c.Map(),createNew:!0,index:e.size})},n.renderList=function(){var e=n.props.usageTypesData,t=n.getListFields(),a=n.getListActions();return r.a.createElement(ec,{items:e,fields:t,actions:a})},n.getListFields=function(){return[{id:"usage_type",title:"Usage Type"},{id:"label",title:"Label"},{id:"property_type",title:"Property Type"},{id:"invoice_uom",title:"Invoice Unit of Measure"},{id:"input_uom",title:"Default Unit of Measure"}]},n.getListActions=function(){return[{type:"edit",showIcon:!0,helpText:"Edit",onClick:n.onClickEdit}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(il(["usage_types","property_types"]))}},{key:"render",value:function(){var e=this.props.propertyTypes,t=this.state,n=t.currentItem,a=t.createNew;return r.a.createElement("div",null,this.renderList(),r.a.createElement(Je,{onClick:this.onClickNew,label:"Add New"}),null!==n&&r.a.createElement(Zc,{item:n,propertyTypes:e,onUpdateItem:this.onUpdateItem,onSave:this.handleSave,onCancel:this.onCancel,selectUoms:!0,editBase:a}))}}]),t}(a.Component);Qv.defaultProps={usageTypesData:g.c.List(),propertyTypes:g.c.List()};var $v=Object(l.connect)(function(e,t){return{usageTypesData:Un(e,t),propertyTypes:Vn(e,t)}})(Qv),Zv=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onToggleClosedCycleChanges=function(e){var t=e.target.value;n.props.onChange("system","closed_cycle_changes",t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.data;return r.a.createElement("div",{className:"DateTime"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,md:2}),r.a.createElement(f.g,{sm:6,style:{marginTop:10}},r.a.createElement(en,{fieldType:"checkbox",value:e.get("closed_cycle_changes",""),onChange:this.onToggleClosedCycleChanges,label:"Allow making changes to entities in closed billing cycles"})))))}}]),t}(a.Component);Zv.defaultProps={data:g.c.Map()};var Xv=Zv,ey=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={currencyOptions:[],changeCategories:g.c.Set()},n.initCurrencyOptions=function(e){if(e.status){var t=g.c.fromJS(e.data).map(function(e){return{label:"".concat(e.get("code","")," - ").concat(e.get("name","")," ").concat(e.get("symbol","")),value:e.get("code","")}}).toArray();n.setState({currencyOptions:t})}},n.onChangeFieldValue=function(e,t,a){n.setState(function(t){return{changeCategories:t.changeCategories.add(e)}}),n.props.dispatch(Zo(e,t,a))},n.onChangeMenuOrder=function(e,t){var a=n.props.settings.getIn(["menu"].concat(Object(w.a)(e)),g.c.Map()).withMutations(function(e){t.forEach(function(t,n){if(e.has(n))e.setIn([n,"order"],t);else{var a=g.c.Map({order:t});e.set(n,a)}})});n.props.dispatch(Zo("menu",e,a))},n.onSave=function(){var e=n.state.changeCategories;if(!e.isEmpty()){var t=e.toArray();n.props.dispatch(rl(t)).then(function(e){n.afterSave(e,t)})}},n.afterSave=function(e,t){var a=n.props.settings;if(e&&(1===e.status||2===e.status)){var r=a.getIn(["menu","main"],g.c.Map());n.props.dispatch(Lo(r)),n.setState(function(){return{changeCategories:g.c.Set()}}),t.includes("tenant")&&a.getIn(["tenant","logo"],"").length>0&&(localStorage.removeItem("logo"),n.props.dispatch(al({filename:a.getIn(["tenant","logo"],"")},"logo")))}},n.handleSelectTab=function(e){var t=n.props.location,a=t.pathname,r=t.query;n.props.router.push({pathname:a,query:Object.assign({},r,{tab:e})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(il(["pricing","billrun","tenant","shared_secret","menu","taxation","file_types","system","plays"])),this.props.dispatch(function(e){var t=S()(),n=JSON.parse(localStorage.getItem("currencies-options"));return n&&S()(n.time).add(60,"minutes").isAfter(t)?Promise.resolve(n.data):(e(Aa()),ir({api:"currencies",params:[{simpleArray:!0}]}).then(function(n){var a=e(tr(n));return localStorage.setItem("currencies-options",JSON.stringify({time:t,data:a})),a}).catch(function(t){return e(nr(t,"Error retreiving currencies"))}))}).then(this.initCurrencyOptions),this.props.dispatch(fr("available_taxRates",xr("taxes",{key:1,description:1})))}},{key:"componentWillUnmount",value:function(){var e=this.state.changeCategories;e.isEmpty()||this.props.dispatch(il(e.toArray())),this.props.dispatch(gr("available_taxRates"))}},{key:"render",value:function(){var e=this.props,t=e.settings,n=e.activeTab,a=e.csiOptions,i=e.rasRatesOptions,o=e.taxation,l=e.system,s=e.plays,c=this.state.currencyOptions,u=t.getIn(["pricing","currency"],""),p=t.get("billrun",g.c.Map()),d=t.get("shared_secret",g.c.List()),m=t.get("tenant",g.c.Map()),h=t.getIn(["menu","main"],g.c.Map()),y=Vo(Uo(h),"root");return r.a.createElement("div",null,r.a.createElement(f.A,{defaultActiveKey:n,animation:!1,id:"SettingsTab",onSelect:this.handleSelectTab},r.a.createElement(f.y,{title:"Company",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Vv,{onChange:this.onChangeFieldValue,data:m}))),r.a.createElement(f.y,{title:"Locale",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Ev,{onChange:this.onChangeFieldValue,data:p}),r.a.createElement(_v,{onChange:this.onChangeFieldValue,data:u,currencies:c}))),r.a.createElement(f.y,{title:"Tax",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Lv,{data:o,csiOptions:a,taxRateOptions:i,onChange:this.onChangeFieldValue}))),r.a.createElement(f.y,{title:"Menu",eventKey:4},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Jv,{data:y,onChange:this.onChangeFieldValue,onChangeMenuOrder:this.onChangeMenuOrder}))),r.a.createElement(f.y,{title:"Security",eventKey:5},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Hv,{data:d}))),r.a.createElement(f.y,{title:"Invoicing",eventKey:6},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Ov,{onChange:this.onChangeFieldValue,data:p}))),r.a.createElement(f.y,{title:"Plays",eventKey:7},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(xv,{data:s}))),r.a.createElement(f.y,{title:"Activity Types",eventKey:8},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement($v,null))),r.a.createElement(f.y,{title:"System",eventKey:9},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Xv,{onChange:this.onChangeFieldValue,data:l})))),r.a.createElement(v,{onClickSave:this.onSave,hideCancel:!0,hideSave:[5,7,8].includes(n)}))}}]),t}(a.Component);ey.defaultProps={activeTab:1,settings:g.c.Map(),csiOptions:g.c.List(),taxation:g.c.Map(),system:g.c.Map(),plays:g.c.List()};var ty=Object(s.f)(Object(l.connect)(function(e,t){return{activeTab:ri(e,t,"settings"),settings:e.settings,csiOptions:yn(e,t),taxation:Sn(e,t),system:In(e,t),plays:Nn(e,t),rasRatesOptions:e.list.get("available_taxRates")}})(ey)),ny=n(71),ay=n.n(ny),ry=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChangeParam=function(){var e=n.props;(0,e.onChangeParam)(e.gateway.get("name"))},n.onChangeParamValue=function(e){var t=e.target,a=t.id,r=t.value,i=n.state.gateway;n.setState({gateway:Object.assign({},i,{params:Object.assign({},i.params,Object(vr.a)({},a,r))})})},n.onChangeReceiverValue=function(e){var t=e.target,a=t.id,r=t.value,i=n.state,o=i.gateway,l=i.connections,s=i.connection;s[a]=r,l.length>0?l[0][a]=r:l.push(s),n.setState({connection:s,gateway:Object.assign({},o,{receiver:Object.assign({},o.receiver,{connections:l})})})},n.onChangeExportValue=function(e){var t=e.target,a=t.id,r=t.value,i=n.state.gateway;n.setState({gateway:Object.assign({},i,{export:Object.assign({},i.export,Object(vr.a)({},a,r))})})},n.onSave=function(){var e=n.state.gateway;(0,n.props.onSave)(e)},n.onClose=function(){n.props.onClose(),n.setState({gateway:{params:{}}})},n.handleSelectTab=function(e){n.setState({activeTab:e})},n.renderTabsBody=function(){var e=n.props.settings,t=n.state,a=t.gateway,i=t.activeTab,o=void 0!==a.export?a.export:[],l=void 0!==a.receiver?a.receiver:[],s=void 0!==l.connections?l.connections:[],c=void 0!==s[0]?s[0]:[];return r.a.createElement(f.A,{activeKey:i,animation:!1,id:"PaymentGatewayTab",onSelect:n.handleSelectTab},r.a.createElement(f.y,{title:"API Parameters",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement("form",{className:"form-horizontal"},e.get("params").keySeq().map(function(e,t){return r.a.createElement("div",{className:"form-group",key:t},r.a.createElement("label",{className:"col-lg-3 control-label"},e),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("input",{type:"text",id:e,onChange:n.onChangeParamValue,className:"form-control",value:a.params[e]})))})))),r.a.createElement(f.y,{title:"File Based Export",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement("form",{className:"form-horizontal"},e.get("export").keySeq().map(function(e,t){return r.a.createElement("div",{className:"form-group",key:t},r.a.createElement("label",{className:"col-lg-3 control-label"},e),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("input",{type:"text",id:e,onChange:n.onChangeExportValue,className:"form-control",value:o[e]})))})))),r.a.createElement(f.y,{title:"File Based Receiver",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement("form",{className:"form-horizontal"},e.get("receiver").keySeq().map(function(e,t){return r.a.createElement("div",{className:"form-group",key:t},r.a.createElement("label",{className:"col-lg-3 control-label"},e),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("input",{type:"text",id:e,onChange:n.onChangeReceiverValue,className:"form-control",value:c[e]})))})))))},n.renderSingularBody=function(){var e=n.props.settings,t=n.state.gateway;return r.a.createElement("form",{className:"form-horizontal"},e.get("params").keySeq().map(function(e,a){return r.a.createElement("div",{className:"form-group",key:a}," ",r.a.createElement("label",{className:"col-lg-3 control-label"},e),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("input",{type:"text",id:e,onChange:n.onChangeParamValue,className:"form-control",value:t.params[e]})))}))},n.renderModalBody=function(){var e=n.props.settings;return!e.get("receiver").isEmpty()&&!e.get("export").isEmpty()?n.renderTabsBody():n.renderSingularBody()},n.state={gateway:{params:{},receiver:{},export:{}},connections:[],activeTab:1,connection:{}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.gateway,n=e.settings;if(t){var a=void 0===t.getIn(["receiver","connections",0])?{}:t.getIn(["receiver","connections",0]).toJS();return this.setState({connection:a,gateway:t.toJS()})}return this.setState({gateway:{name:n.get("name"),params:{}}})}},{key:"render",value:function(){var e=this.props,t=e.settings,n=e.show,a=void 0!==n&&n;return r.a.createElement(ay.a,{show:a,onHide:this.onClose},r.a.createElement(ay.a.Header,{closeButton:!0},r.a.createElement(ay.a.Title,null,t.get("name")," parameters")),r.a.createElement(ay.a.Body,null,this.renderModalBody()),r.a.createElement(ay.a.Footer,null,r.a.createElement("button",{type:"button",className:"btn btn-default",onClick:this.onClose},"Cancel"),r.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.onSave},"Save")))}}]),t}(a.Component),iy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(){var e=n.props,t=e.enabled,a=e.onClickEnable,r=e.onClickDisable;return t?r():a()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.enabled!==e.enabled}},{key:"render",value:function(){var e=this.props.enabled,t=e?"Disable":"Enable",n=e?"btn btn-danger":"btn btn-success";return r.a.createElement("button",{type:"button",className:n,onClick:this.onClick},t)}}]),t}(a.Component),oy=Object(l.connect)()(function(e){return r.a.createElement(f.r,{show:e.show,onHide:e.onClose},r.a.createElement(f.r.Header,{closeButton:!0},r.a.createElement(f.r.Title,null,"Unsupported")),r.a.createElement(f.r.Body,null,e.gateway," is not yet supported, but will be added soon!"),r.a.createElement(f.r.Footer,null,r.a.createElement("button",{type:"button",className:"btn btn-default",onClick:e.onClose},"Close")))}),ly=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={showParamsModal:!1,showUnsupported:!1},n.onShowParams=function(){n.props.settings.get("supported",!1)?n.setState({showParamsModal:!0}):n.setState({showUnsupported:!0})},n.onCloseParams=function(){n.setState({showParamsModal:!1,showUnsupported:!1})},n.onSaveParams=function(e){var t=n.props;(0,t.onSaveParams)(e,void 0!==t.enabled),n.onCloseParams()},n.onClickEnable=function(){n.onShowParams()},n.onClickDisable=function(){var e=n.props,t=e.onDisable,a=e.settings;window.confirm("Are you sure you want to disable this payment gateway?")&&t(a.get("name"))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.settings,n=e.enabled,a=this.state,i=a.showParamsModal,o=a.showUnsupported,l={};return n||(l.WebkitFilter=l.filter="grayscale(100%)"),r.a.createElement("div",{className:"PaymentGateway"},t.get("supported",!1)?r.a.createElement(ry,{settings:t,show:i,gateway:n,onSave:this.onSaveParams,onClose:this.onCloseParams}):r.a.createElement(oy,{show:o,onClose:this.onCloseParams,gateway:t.get("name")}),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-8 col-md-8"},t.get("image_url")?r.a.createElement("img",{src:"".concat(Y(["env","serverApiUrl"],""),"/").concat(t.get("image_url")),alt:"Logo",style:l,width:"200",height:"51"}):t.get("name")),r.a.createElement("div",{className:"col-lg-4 col-md-4"},r.a.createElement("div",{className:"pull-right"},r.a.createElement("button",{onClick:this.onShowParams,type:"button",className:"btn btn-default btn-lg",disabled:!n},r.a.createElement("i",{className:"fa fa-gear"}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-12 col-md-12"},r.a.createElement("div",{className:"pull-right"},r.a.createElement(iy,{enabled:n,onClickEnable:this.onClickEnable,onClickDisable:this.onClickDisable})))),r.a.createElement("div",{className:"separator"}))}}]),t}(a.Component),sy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onSaveGatewayParams=function(e,t){ir(Ir(e)).then(function(a){n.props.dispatch(Wa("Payment gateway enabled!")),t?n.props.dispatch($o(e)):n.props.dispatch(Jo(e))},function(e){n.props.dispatch(Qa("Error saving payment gateway"))}).catch(function(e){n.props.dispatch(Qa("Network error - please try again"))})},n.onDisableGateway=function(e){ir(Nr(e)).then(function(t){n.props.dispatch(Wa("Payment gateway disabled!")),n.props.dispatch(Qo(e))},function(e){console.log("failed!",e),n.props.dispatch(Qa("Error saving payment gateway"))}).catch(function(e){console.log(e),n.props.dispatch(Qa("Network error - please try again"))})},n.renderPaymentGateways=function(){var e=n.props,t=e.supported_gateways,a=e.payment_gateways;return t.map(function(e,t){var i=a.find(function(t){return t.get("name")===e.get("name")});return r.a.createElement("div",{className:"col-lg-4 col-md-4",key:t},r.a.createElement(ly,{enabled:i,settings:e,onDisable:n.onDisableGateway,onSaveParams:n.onSaveGatewayParams}))})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(il("payment_gateways"));this.props.dispatch(fr("supported_gateways",{api:"paymentgateways",action:"list"}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},"Available payment gateways"),r.a.createElement("div",{className:"panel-body"},r.a.createElement("form",{className:"form-horizontal"},this.renderPaymentGateways())))}}]),t}(a.Component);sy.defaultProps={payment_gateways:g.c.List(),supported_gateways:g.c.List()};var cy=Object(l.connect)(function(e){return{payment_gateways:e.settings.get("payment_gateways")||void 0,supported_gateways:e.list.get("supported_gateways")||void 0}})(sy),uy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={showConfirmDelete:!1,itemToDelete:null,confirmDeleteMessage:"",refreshString:""},n.getActions=function(){return[{type:"edit"},{type:"remove",showIcon:!0,onClick:n.onAskDelete,helpText:"Remove"}]},n.getFields=function(){return[{id:"username",placeholder:"User Name",sort:!0},{id:"roles",placeholder:"Roles",parser:n.parseRoles}]},n.getProjectFields=function(){return{username:1,roles:1}},n.onAskDelete=function(e){n.setState({showConfirmDelete:!0,itemToDelete:e,confirmDeleteMessage:'Are you sure you want to delete "'.concat(e.get("username",""),'" user ?')})},n.onDeleteClose=function(){n.setState({showConfirmDelete:!1,itemToDelete:null,confirmDeleteMessage:""})},n.onDeleteOk=function(){var e=n.state.itemToDelete;n.props.dispatch(Rl(e)).then(n.afterDelete)},n.afterDelete=function(e){n.onDeleteClose(),e.status&&(n.setState({refreshString:S()().format()}),n.props.dispatch(Wa("User was deleted")))},n.parseRoles=function(e){return e.get("roles").join(", ")},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.showConfirmDelete,n=e.confirmDeleteMessage,a=e.refreshString,i=this.getFields(),o=this.getActions(),l=this.getProjectFields();return r.a.createElement("div",null,r.a.createElement(qc,{api:"get",itemType:"user",itemsType:"users",filterFields:i,tableFields:i,projectFields:l,actions:o,refreshString:a}),r.a.createElement(Ke,{onOk:this.onDeleteOk,onCancel:this.onDeleteClose,show:t,message:n,labelOk:"Yes"}))}}]),t}(a.Component),py=Object(l.connect)()(uy),dy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={enableChangePassword:"create"===n.props.action,password:"",password1:"",errors:{password:"",password1:""}},n.initDefaultValues=function(){n.props.onUpdateValue("roles",["read"])},n.onPasswordChange=function(e){var t=n.state.errors,a=e.target.value.trim(),r="";0===a.length&&(r="Password is required"),n.props.onUpdateValue("password",""),n.setState({errors:Object.assign({},t,{password:r}),password:a,password1:""})},n.onPassword1Change=function(e){var t=n.state,a=t.errors,r=t.password,i=e.target.value.trim(),o="";0===i.length&&(o="Please fill confirm password"),i!==r&&(o="Passwords do not match"),0===o.length?n.props.onUpdateValue("password",i):n.props.onUpdateValue("password",""),n.setState({errors:Object.assign({},a,{password1:o}),password1:i})},n.onUserNameChange=function(e){var t=e.target.value;n.props.onUpdateValue("username",t)},n.onChangeRoles=function(e){var t=e.length>0?e.split(","):[];n.props.onUpdateValue("roles",t)},n.onChangeRole=function(e){n.props.onUpdateValue("role",e)},n.onEnableChangePassword=function(e){var t=n.state.errors,a=e.target.checked;a?(n.props.onUpdateValue("password",""),n.setState({enableChangePassword:a})):(n.props.onDeleteValue("password"),n.setState({enableChangePassword:a,errors:Object.assign({},t,{password1:"",password:""}),password:"",password1:""}))},n.renderChangePassword=function(){var e=n.props.action,t=n.state,a=t.password,i=t.password1,o=t.enableChangePassword,l=t.errors,s=l.password.length>0||l.password1.length>0;return r.a.createElement("span",null,"create"!==e&&r.a.createElement(f.l,{validationState:s?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"\xa0"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("label",{htmlFor:"enable-change-password"},r.a.createElement("input",{id:"enable-change-password",type:"checkbox",checked:o,onChange:n.onEnableChangePassword,style:{verticalAlign:"text-bottom"}}),"\xa0Enable Password Change"))),r.a.createElement(f.l,{validationState:s?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Password"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("input",{onChange:n.onPasswordChange,value:a,className:"form-control",id:"password",type:"password",disabled:!o}),l.password.length>0&&r.a.createElement(f.n,null,l.password))),r.a.createElement(f.l,{validationState:l.password1.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Confirm Password"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("input",{onChange:n.onPassword1Change,value:i,className:"form-control",id:"password1",type:"password",disabled:!o}),l.password1.length>0&&r.a.createElement(f.n,null,l.password1))))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){"create"===this.props.action?this.initDefaultValues():this.props.onDeleteValue("password")}},{key:"render",value:function(){var e=this.props,t=e.user,n=e.availableRoles.map(function(e){return{value:e,label:Object(x.titleCase)(e)}});return r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"User Name (email)"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{onChange:this.onUserNameChange,value:t.get("username","")}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Roles"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"select",multi:!0,value:t.get("roles",[]).join(","),options:n,onChange:this.onChangeRoles,placeholder:"Add role..."}))),this.renderChangePassword())))}}]),t}(a.Component);dy.defaultProps={user:g.c.Map(),availableRoles:["admin","read","write","reports"],action:"create"};var my=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={username:""},n.onBack=function(){n.props.router.push("/users")},n.onSave=function(){var e=n.props,t=e.item,a=e.mode;n.validate()&&n.props.dispatch(jl(t,a)).then(n.afterSave)},n.afterSave=function(e){var t=n.props.mode;if(e.status){n.props.dispatch(Pc("users"));var a="create"===t?"created":"updated";n.props.dispatch(Wa("User was ".concat(a))),n.onBack()}},n.onUpdateValue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n.props.dispatch(xl(e,t))},n.onDeleteValue=function(e){n.props.dispatch(Fl(e))},n.validate=function(){var e=n.props,t=e.item;return"create"===e.mode?0===t.get("username","").length?(n.props.dispatch(Qa("User name field is required")),!1):0===t.get("password","").length?(n.props.dispatch(Qa("Password field is required")),!1):0!==t.get("roles").length||(n.props.dispatch(Qa("Roles field is required")),!1):t.has("username")&&0===t.get("username","").length?(n.props.dispatch(Qa("User name field is required")),!1):t.has("password")&&0===t.get("password","").length?(n.props.dispatch(Qa("Password field is required")),!1):!t.has("roles")||0!==t.get("roles").length||(n.props.dispatch(Qa("Roles field is required")),!1)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.itemId,n=e.mode;t&&this.props.dispatch(wl(t)),"create"===n?this.props.dispatch(ro("Create New User")):this.props.dispatch(ro("Edit user"))}},{key:"componentWillReceiveProps",value:function(e){var t=this.state.username,n=e.item,a=e.mode;""===t&&this.setState({username:n.get("username","")}),"update"===a&&""!==t&&this.props.dispatch(ro("Edit user - ".concat(t)))}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:dl,collection:"users"})}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.mode;return"update"===n&&"undefined"===typeof t.getIn(["_id","$id"])?r.a.createElement(_,{onClick:this.onBack}):r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,null,r.a.createElement(dy,{action:n,user:t,onUpdateValue:this.onUpdateValue,onDeleteValue:this.onDeleteValue})),r.a.createElement(v,{onClickSave:this.onSave,onClickCancel:this.onBack}))}}]),t}(a.Component);my.defaultProps={user:g.c.Map()};var gy=Object(s.f)(Object(l.connect)(function(e,t){var n=t.params.itemId;return{mode:t.location.query.action||(n?"update":"create"),item:e.entity.get("users",g.c.Map()),itemId:n}})(my)),fy=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onSelectFormat=function(e){var t=e.target.value;n.setState({format:t})},n.onSelectType=function(e){var t=e.target.value;n.setState({type:t})},n.onCheck=function(e){var t=e.target.value;n.setState({selected:t})},n.onSelectTemplate=function(e){var t=e.target.value;n.setState({template:t})},n.handleCancel=function(){n.context.router.push({pathname:"input_processors"})},n.buildQuery=function(){var e=n.state,t=e.type,a=e.format,r=e.selected,i=e.template;return"api"===t?{action:"new",type:t,format:a}:"predefined"===r?{action:"new",template:i}:{action:"new"}},n.handleNext=function(){var e=n.state,t=e.selected,a=e.type;""===t&&"api"!==a?n.props.dispatch(Qa("Please choose one option")):n.context.router.push({pathname:"input_processor",query:n.buildQuery()})},n.state={type:"api",selected:"",format:"json",template:Object.keys(vh)[0]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.selected,n=e.template,a=Object.keys(vh).map(function(e,t){return r.a.createElement("option",{value:e,key:t},e)});return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},r.a.createElement("span",null,"Create new input processor")),r.a.createElement("div",{className:"panel-body"},r.a.createElement("form",{className:"form-horizontal"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3 col-md-4"},r.a.createElement("label",null,r.a.createElement("input",{type:"radio",name:"select-type",value:"api",checked:"api"===this.state.type,onChange:this.onSelectType})," API-based"))),r.a.createElement("div",{className:"form-group",style:{marginLeft:15}},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",null,r.a.createElement("input",{type:"radio",name:"format",value:"json",disabled:"api"!==this.state.type,checked:"json"===this.state.format||"api"===this.state.type,onChange:this.onSelectFormat})," I will manually configure a JSON API"))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3 col-md-4"},r.a.createElement("label",null,r.a.createElement("input",{type:"radio",name:"select-type",value:"file",checked:"file"===this.state.type,onChange:this.onSelectType})," File-based"))),r.a.createElement("div",{className:"form-group",style:{marginLeft:15}},r.a.createElement("div",{className:"col-lg-3 col-md-4"},r.a.createElement("label",null,r.a.createElement("input",{type:"radio",name:"select-template",value:"predefined",disabled:"file"!==this.state.type,checked:"predefined"===this.state.selected,onChange:this.onCheck})," I will use predefined input processor")),r.a.createElement("div",{className:"col-lg-7 col-md-7"},r.a.createElement("select",{className:"form-control",value:n,onChange:this.onSelectTemplate,disabled:"predefined"!==t||"file"!==this.state.type},a))),r.a.createElement("div",{className:"form-group",style:{marginLeft:15}},r.a.createElement("div",{className:"col-lg-3 col-md-4"},r.a.createElement("label",null,r.a.createElement("input",{type:"radio",name:"select-template",value:"manual",disabled:"file"!==this.state.type,checked:"manual"===this.state.selected,onChange:this.onCheck})," I will configure a custom input processor"))),r.a.createElement("div",{style:{marginTop:12,float:"right"}},r.a.createElement("button",{className:"btn btn-default",type:"button",onClick:this.handleCancel,style:{marginRight:12}},"Cancel"),r.a.createElement("button",{className:"btn btn-primary",type:"button",onClick:this.handleNext},"Next")))))))}}]),t}(a.Component);fy.contextTypes={router:pc.a.object.isRequired};var hy=function(e){return function(t,n){var a=na(n()).findIndex(function(t){return t.get("id","")===e.get("id","")});return-1!==a&&t(function(e){return{type:Go,category:"collection",name:["steps",e]}}(a))}},vy=function(e,t,n){return function(a,r){var i=na(r()).findIndex(function(t){return t.get("id","")===e.get("id","")});return-1!==i&&a(function(e,t,n){return{type:Bo,category:"collection",name:["steps",e].concat(Object(w.a)(Pe(t))),value:n}}(i,t,n))}},yy=function(e){return function(t,n){return e.has("id")?-1!==na(n()).findIndex(function(t){return t.get("id","")===e.get("id","")})&&t(vy(e,[],e)):t((a=e.set("id",Mt.a.v4()),{type:Ko,category:"collection",path:"steps",value:a}));var a}},by=function(){return rl(["collection.steps"])},Ey=function(){return il(["collection.steps"])},Cy=function(){return rl(["collection.settings"])},_y=function(e,t){return{type:Bo,category:"collection",name:["settings"].concat(Object(w.a)(Pe(e))),value:t}},Oy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeMinDeb=function(e){var t=e.target.value;n.props.dispatch(_y("min_debt",t))},n.onChangeChangeStateUrl=function(e){var t=e.target.value;n.props.dispatch(_y("change_state_url",t))},n.onChangeChangeStateMethod=function(e){n.props.dispatch(_y("change_state_method",e))},n.onSave=function(){n.props.dispatch(Cy())},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(il(["collection.settings"]))}},{key:"render",value:function(){var e=this.props,t=e.settings,n=e.httpMethods,a=t.get("min_debt",""),i=t.get("change_state_url",""),o=t.get("change_state_method",""),l=n.map(oe).toArray();return r.a.createElement("div",null,r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{header:"General settings"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Minimum debt"),r.a.createElement(f.g,{sm:6},r.a.createElement(en,{value:a,onChange:this.onChangeMinDeb,fieldType:"number"}))))),r.a.createElement(f.v,{header:r.a.createElement("h4",null,"Collection State Change",r.a.createElement("br",null),r.a.createElement("small",null,"HTTP requests will be triggered to this URL when a customer enters / exits from collection"))},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"URL"),r.a.createElement(f.g,{sm:6},r.a.createElement(en,{value:i,onChange:this.onChangeChangeStateUrl}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"HTTP Method"),r.a.createElement(f.g,{sm:6},r.a.createElement(en,{fieldType:"select",options:l,onChange:this.onChangeChangeStateMethod,value:o,clearable:!1})))))),r.a.createElement(f.g,{sm:12},r.a.createElement(v,{onClickSave:this.onSave,hideCancel:!0})))}}]),t}(a.Component);Oy.defaultProps={settings:g.c.Map(),httpMethods:Y(["collections","http","mthods"],g.c.List())};var Sy=Object(l.connect)(function(e,t){return{settings:ta(e,t)}})(Oy),Ty=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onSaveCollectionsSteps=function(){n.props.dispatch(by()).then(n.afterSaveCollectionsSteps)},n.afterSaveCollectionsSteps=function(){n.props.dispatch(Ey())},n.onRemoveOk=function(e){n.props.dispatch(hy(e))},n.onToggleOk=function(e,t){var a="enable"===t;n.props.dispatch(vy(e,["active"],a))},n.onClickRemove=function(e){var t={message:'Are you sure you want to delete "'.concat(e.get("name"),'" step?'),onOk:function(){return n.onRemoveOk(e)},type:"delete",labelOk:"Delete"};n.props.dispatch(po(t))},n.onClickToggle=function(e,t){var a="disable"===t?"disable":"enable",r={message:"Are you sure you want to ".concat(a,' "').concat(e.get("name"),'" step?'),onOk:function(){return n.onToggleOk(e,t)},type:"enable"===t?"confirm":"delete",labelOk:Object(x.titleCase)(a)};n.props.dispatch(po(r))},n.parserStatus=function(e){return r.a.createElement(N,{status:e.get("active",!1)?"active":"expired"})},n.parserType=function(e){return r.a.createElement("span",null,r.a.createElement("i",{className:"fa ".concat(Y(["collections","step_types",e.get("type",""),"icon"],"fa-circle-o"))}),"\xa0",Y(["collections","step_types",e.get("type",""),"label"],""))},n.parserTriger=function(e){return"Within ".concat(e.get("do_after_days","")," days")},n.parseShowEnable=function(e){return!e.get("active",!0)},n.parseShowDisable=function(e){return!n.parseShowEnable(e)},n.getListFields=function(){return[{id:"active",title:"Status",parser:n.parserStatus,cssClass:"state"},{id:"do_after_days",title:"Trigger after",parser:n.parserTriger},{id:"name",title:"Step Name"},{id:"type",title:"Type",parser:n.parserType}]},n.getListActions=function(){return[{type:"edit",showIcon:!0,helpText:"Edit",onClick:n.props.onClickEdit},{type:"enable",showIcon:!0,helpText:"Enable",onClick:n.onClickToggle,show:n.parseShowEnable},{type:"disable",showIcon:!0,helpText:"Disable",onClick:n.onClickToggle,show:n.parseShowDisable},{type:"clone",showIcon:!0,helpText:"Clone",onClick:n.props.onClickClone},{type:"remove",showIcon:!0,helpText:"Remove",onClick:n.onClickRemove}]},n.renderPanelHeader=function(){var e=Y(["collections","step_types"],g.c.Map()).filter(function(e){return e.get("enable",!1)}).map(function(e,t){return{type:"add",actionStyle:"primary",actionSize:"xsmall",label:"Add new ".concat(Y(["collections","step_types",t,"label"],"")," step"),onClick:n.props.onAddStep(t)}}).toList().toArray();return r.a.createElement("div",null,"\xa0",r.a.createElement("div",{className:"pull-right"},r.a.createElement(Xe,{actions:e})))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(Ey())}},{key:"render",value:function(){var e=this.props.items,t=this.getListFields(),n=this.getListActions();return r.a.createElement("div",null,r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{header:this.renderPanelHeader()},r.a.createElement(ec,{items:e,fields:t,actions:n}))),r.a.createElement(f.g,{sm:12},r.a.createElement(v,{onClickSave:this.onSaveCollectionsSteps,hideCancel:!0})))}}]),t}(a.Component);Ty.defaultProps={items:g.c.List()};var ky=Object(l.connect)(function(e,t){return{items:aa(e,t)}})(Ty),Iy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeDays=function(e){var t=e.target.value;n.props.onChange(["do_after_days"],t)},n.onChangeName=function(e){var t=e.target.value;n.props.onChange(["name"],t)},n.onChangeActive=function(e){var t=e.target.value;n.props.onChange(["active"],"yes"===t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.errors;return r.a.createElement("div",null,r.a.createElement(f.l,{validationState:n.has("name")?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Title",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{onChange:this.onChangeName,value:t.get("name","")}),n.has("name")&&r.a.createElement(f.n,null,n.get("name","")))),r.a.createElement(f.l,{validationState:n.has("do_after_days")?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Trigger after",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:4},r.a.createElement(f.o,null,r.a.createElement(en,{onChange:this.onChangeDays,value:t.get("do_after_days",""),fieldType:"number",min:"1",style:{minWidth:50}}),r.a.createElement(f.o.Addon,null,"Days")),r.a.createElement(f.n,{className:"mb0"},"Days since entering debt collection process"),n.has("do_after_days")&&r.a.createElement(f.n,null,n.get("do_after_days","")))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Status"),r.a.createElement(f.g,{sm:4},r.a.createElement("span",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(en,{fieldType:"radio",onChange:this.onChangeActive,name:"step-active-status",value:"yes",label:"Active",checked:t.get("active",!0)})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(en,{fieldType:"radio",onChange:this.onChangeActive,name:"step-active-status",value:"no",label:"Not Active",checked:!t.get("active",!0)}))))))}}]),t}(a.Component);Iy.defaultProps={item:g.c.Map(),errors:g.c.Map()};var Ny=Iy,wy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeSubject=function(e){var t=e.target.value;n.props.onChange(["subject"],t)},n.onChangeBody=function(e){n.props.onChange(["body"],e)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props,a=n.content,r=n.templateToken;return!g.c.is(a,e.content)||!g.c.is(r,e.templateToken)}},{key:"render",value:function(){var e=this.props,t=e.content,n=e.templateToken,a=e.editor;return r.a.createElement("div",null,r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Subject"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{onChange:this.onChangeSubject,value:t.get("subject","")}))),r.a.createElement("div",null,r.a.createElement(en,{fieldType:"textEditor",value:t.get("body"),editorName:"editor",fields:n.toArray(),onChange:this.onChangeBody,configName:a})))}}]),t}(a.Component);wy.defaultProps={content:g.c.Map(),templateToken:g.c.List(),editor:"mails"};var jy=Object(l.connect)(function(e,t){return{templateToken:ea(e,t,["general","account","collection"])}})(wy),Ry=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeMethod=function(e){n.props.onChange(["method"],e)},n.onChangeDcoder=function(e){n.props.onChange(["decoder"],e)},n.onChangeUrl=function(e){var t=e.target.value;n.props.onChange(["url"],t)},n.onChangeCustomParameter=function(e){return function(t){n.props.onChange(["custom_parameter",e],t)}},n.onAddCustomParameter=function(e){n.props.content.hasIn(["custom_parameter",e])?n.props.dispatch(Ja("Custom Parameter ".concat(e," already exists"))):n.props.onChange(["custom_parameter",e],"")},n.onRemoveCustomParameter=function(e){return function(){var t=n.props.content;if(t.hasIn(["custom_parameter",e])){var a=t.get("custom_parameter",g.c.Map()).filter(function(t,n){return n!==e});n.props.onChange(["custom_parameter"],a)}else n.props.dispatch(Ja("Custom Parameter ".concat(e," not exists")))}},n.renderCustomParameters=function(){var e=n.props,t=e.content,a=e.errors;return t.get("custom_parameter",g.c.Map()).map(function(e,t){return r.a.createElement(f.l,{validationState:a.has(t)?"error":null,key:"custom_parameter_".concat(t)},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},t),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(nn,{key:"custom_parameter_".concat(t),onChange:n.onChangeCustomParameter(t),onAction:n.onRemoveCustomParameter(t),actionType:"remove",value:e}),a.has(t)&&r.a.createElement(f.n,null,a.get(t,""))))}).toList().toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props.content;return!g.c.is(n,e.content)}},{key:"render",value:function(){var e=this.props,t=e.content,n=e.httpMethods,a=e.httpDecoders,i=e.errors,o=n.map(oe).toArray(),l=a.map(oe).toArray();return r.a.createElement("div",null,r.a.createElement(f.l,{validationState:i.has("url")?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"URL",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{onChange:this.onChangeUrl,value:t.get("url","")}),i.has("url")&&r.a.createElement(f.n,null,i.get("url","")))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"HTTP Method"),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{fieldType:"select",options:o,onChange:this.onChangeMethod,value:t.get("method",""),clearable:!1}))),r.a.createElement(f.l,{validationState:i.has("decoder")?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Decoder"),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{fieldType:"select",options:l,onChange:this.onChangeDcoder,value:t.get("decoder",""),clearable:!1}),i.has("decoder")&&r.a.createElement(f.n,null,i.get("decoder","")))),this.renderCustomParameters(),r.a.createElement("hr",null),r.a.createElement(f.l,{validationState:i.has("decoder")?"error":null},r.a.createElement(f.g,{sm:3,lg:2},"\xa0"),r.a.createElement(f.g,{componentClass:f.h,sm:8,lg:9},r.a.createElement(nn,{onAction:this.onAddCustomParameter,actionLabel:"Add custom parameter",clearAfterAction:!0}))))}}]),t}(a.Component);Ry.defaultProps={content:g.c.Map(),errors:g.c.Map(),httpMethods:Y(["collections","http","mthods"],g.c.List()),httpDecoders:Y(["collections","http","decoders"],g.c.List())};var xy=Object(l.connect)(null)(Ry),Fy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeContent=function(e,t){n.props.onChange(["content"].concat(Object(w.a)(e)),t)},n.renderStepByType=function(e){var t=e.get("content");switch(e.get("type","")){case"mail":return r.a.createElement(jy,{content:t,onChange:n.onChangeContent,editor:"mails"});case"sms":return r.a.createElement(jy,{content:t,onChange:n.onChangeContent,editor:"sms"});case"http":return r.a.createElement(xy,{content:t,onChange:n.onChangeContent});default:return r.a.createElement("p",null)}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.errors;return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(Ny,{item:t,onChange:this.props.onChange,errors:n}),r.a.createElement("hr",null),this.renderStepByType(t))))}}]),t}(a.Component);Fy.defaultProps={item:g.c.Map(),errors:g.c.Map()};var Py=Fy,My=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={editedItem:null,editedItemName:"",errors:g.c.Map()},n.onCloseEditStep=function(){n.setState(function(){return{editedItem:null,editedItemName:"",errors:g.c.Map()}})},n.onChangeEditStep=function(e,t){n.setState(function(n){return{editedItem:n.editedItem.setIn(e,t),errors:n.errors.deleteIn(e)}})},n.onAddStep=function(e){return function(){var t=Y(["collections","default_new_step_status"],!1);n.setState(function(){return{editedItem:g.c.Map({type:e,active:t})}})}},n.onSaveEditStep=function(){var e=n.state.editedItem;n.validateStep(e)||(n.props.dispatch(yy(e)),n.onCloseEditStep())},n.onClickEdit=function(e){n.setState(function(){return{editedItem:e,editedItemName:e.get("name",""),errors:g.c.Map()}})},n.onClickClone=function(e){n.onClickEdit(e.delete("id")),n.setState(function(){return{editedItemName:""}})},n.validateStep=function(e){var t=!1;return["",null].includes(e.get("name",""))&&(n.setState(function(e){return{errors:e.errors.setIn(["name"],"Title field is required")}}),t=!0),["",null].includes(e.get("do_after_days",""))&&(n.setState(function(e){return{errors:e.errors.setIn(["do_after_days"],"Trigger after field is required")}}),t=!0),t},n.renderEventForm=function(){var e=n.state,t=e.editedItem,a=e.editedItemName,i=e.errors;if(null===t)return null;var o=""!==a?'Edit "'.concat(a,'" step'):r.a.createElement("span",null,"Create ",Y(["collections","step_types",t.get("type",""),"label"],"")," Step");return r.a.createElement(Ye,{title:o,show:!0,onOk:n.onSaveEditStep,onCancel:n.onCloseEditStep,labelOk:"Save",modalSize:"large"},r.a.createElement(Py,{item:t,onChange:n.onChangeEditStep,errors:i}))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(il("template_token"))}},{key:"render",value:function(){var e=this.props.location;return r.a.createElement("div",null,r.a.createElement(Ei,{id:"CollectionsTab",location:e},r.a.createElement(f.y,{title:"Steps",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(ky,{onAddStep:this.onAddStep,onClickEdit:this.onClickEdit,onClickClone:this.onClickClone}))),r.a.createElement(f.y,{title:"Settings",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Sy,null)))),this.renderEventForm())}}]),t}(a.Component);My.defaultProps={};var Ay=Object(l.connect)(null)(My),Dy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).loadTemplate=function(e){var t=n.props.name;n.props.loadTemplate(t,e)},n.onChange=function(e){var t=n.props.name;n.props.onChange(t,e)},n.onChangeStatus=function(e){var t=e.target.value,a=n.props.name;n.props.onChangeStatus(a,t)},n.renderPanelHeader=function(){var e=n.props,t=e.name,a=e.templates,i=e.enabled;return r.a.createElement("span",null,"Invoice ".concat(t),r.a.createElement("div",{className:"pull-right"},a.length>0&&r.a.createElement(f.e,{className:"inline",style:{verticalAlign:"middle"}},r.a.createElement(f.i,{bsSize:"xsmall",title:"Load default",id:"dropdown-size-medium",onSelect:n.loadTemplate},a.map(function(e,t){return r.a.createElement(f.q,{key:t,eventKey:t},e)}))),r.a.createElement("div",{className:"inline",style:{marginLeft:a.length?10:0}},r.a.createElement(en,{fieldType:"checkbox",value:i,onChange:n.onChangeStatus,label:"Enable"}))))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.content,a=e.fields;return r.a.createElement(f.v,{header:this.renderPanelHeader()},r.a.createElement(en,{fieldType:"textEditor",value:n,editorName:"editor-".concat(t),name:t,configName:"invoices",editorHeight:150,fields:a,onChange:this.onChange}))}}]),t}(a.PureComponent);Dy.defaultProps={content:"",fields:[],templates:[],enabled:!1,loadTemplate:function(){},onChangeStatus:function(){}};var Ly=Dy,Uy=Object(on.a)(function(e,t){return e.get(t,g.c.List())},function(e){return e.map(function(e){return e.get("label","Template")}).toArray()}),Vy=Object(on.a)(function(e){return e},function(e){return"undefined"!==typeof e?e.toArray():void 0}),By=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).loadTemplate=function(e,t){var a=n.props.templates.getIn([e,t,"content"]);n.props.onChange(e,a)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.getData()}},{key:"render",value:function(){var e=this.props,t=e.header,n=e.footer,a=e.suggestions,i=e.templates,o=e.status,l=Vy(a),s=Uy(i,"header"),c=Uy(i,"footer"),u=o.get("header",!1),p=o.get("footer",!1);return r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(f.j,{horizontal:!0},null!==t&&r.a.createElement(Ly,{name:"header",content:t,onChange:this.props.onChange,fields:l,templates:s,loadTemplate:this.loadTemplate,enabled:u,onChangeStatus:this.props.onChangeStatus}),null!==n&&r.a.createElement(Ly,{name:"footer",content:n,onChange:this.props.onChange,fields:l,templates:c,loadTemplate:this.loadTemplate,enabled:p,onChangeStatus:this.props.onChangeStatus})))),r.a.createElement(v,{onClickSave:this.props.onSave,cancelLabel:"Rollback",onClickCancel:this.props.onCancel}))}}]),t}(a.Component);By.defaultProps={header:"",footer:"",suggestions:g.c.List(),templates:g.c.Map(),status:g.c.Map(),onChange:function(){},onSave:function(){},onCancel:function(){},getData:function(){},onChangeStatus:function(){}};var qy=By,zy=Object(l.connect)(function(e,t){return{header:ia(e,t),footer:oa(e,t),suggestions:la(e),templates:sa(e),status:ca(e)}},function(e){return{getData:function(){e(il("invoice_export"))},onChange:function(t,n){e(Zo("invoice_export",t,n))},onChangeStatus:function(t,n){e(Zo("invoice_export",["status",t],n))},onSave:function(){e(rl("invoice_export")).then(function(t){t&&1===t.status&&e(il("invoice_export"))})},onCancel:function(){var t={message:"Are you sure you want to discard editing Invoice Template?",onOk:function(){e(il("invoice_export"))},labelOk:"Discard",type:"delete"};e(po(t))}}})(qy),Hy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).isDataReady=function(){var e=n.props,t=e.fields,a=e.emailTemplates;return!(!t||!a)},n.onSave=function(){n.props.dispatch(rl("email_templates")).then(function(e){e&&1===e.status&&n.props.dispatch(il("email_templates"))})},n.onCancel=function(){n.props.dispatch(il("email_templates"))},n.onChangeContent=function(e){var t=n.props.name;n.props.dispatch(Zo("email_templates",[t,"content"],e))},n.onChangeSubject=function(e){var t=e.target.value,a=n.props.name;n.props.dispatch(Zo("email_templates",[a,"subject"],t))},n.getContent=function(){var e=n.props,t=e.name;return e.emailTemplates.getIn([t,"content"],"")},n.getSubject=function(){var e=n.props,t=e.name;return e.emailTemplates.getIn([t,"subject"],"")},n.getFields=function(){var e=n.props,t=e.name,a=e.fields,r=e.emailTemplates.getIn([t,"html_translation"],g.c.List());return[].concat(Object(w.a)(a.toArray()),Object(w.a)(r.toArray()))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(il(["email_templates","subscribers"]))}},{key:"render",value:function(){var e=this.props.name;return this.isDataReady()?r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:1},"Subject"),r.a.createElement(f.g,{sm:8},r.a.createElement(en,{onChange:this.onChangeSubject,value:this.getSubject()}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:12},r.a.createElement(en,{fieldType:"textEditor",value:this.getContent(),editorName:"editor-".concat(e),name:e,configName:"invoices",editorHeight:150,fields:this.getFields(),onChange:this.onChangeContent}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:12},r.a.createElement(v,{onClickSave:this.onSave,cancelLabel:"Rollback",onClickCancel:this.onCancel})))):r.a.createElement(_,null)}}]),t}(a.Component);Hy.defaultProps={name:"",fields:null,emailTemplates:null};var Yy=Object(l.connect)(function(e,t){return{emailTemplates:pa(e,t)}})(Hy),Gy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).getFields=function(){return n.props.accountFields.map(function(e){return"customer_".concat(e)})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(il(["subscribers"]))}},{key:"render",value:function(){return r.a.createElement(Yy,{name:"invoice_ready",fields:this.getFields()})}}]),t}(a.Component);Gy.defaultProps={accountFields:g.c.List()};var Ky=Object(l.connect)(function(e,t){return{accountFields:zn(e,t)}})(Gy),Wy=function(e){var t=e.location;return r.a.createElement("div",null,r.a.createElement(Ei,{id:"EmailTemplatesTab",location:t},r.a.createElement(f.y,{title:"Invoice ready",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Ky,null)))))},Jy=function(){return r.a.createElement(qc,{collection:"plans",itemType:"prepaid_plan",itemsType:"prepaid_plans",filterFields:[{id:"description",placeholder:"Title"},{id:"name",placeholder:"Key"}],baseFilter:{connection_type:{$regex:"^prepaid$"},type:{$regex:"^customer$"}},tableFields:[{id:"description",title:"Title",sort:!0},{id:"name",title:"Key",sort:!0},{id:"code",title:"Code",sort:!0}],projectFields:{description:1,name:1,code:1},showRevisionBy:"key",actions:[{type:"edit"}]})},Qy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={errors:{name:""}},n.onChangeName=function(e){var t=n.props.errorMessages.name.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=Y("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{name:i})}),n.props.onChangePlanField(["name"],r)},n.onChangeDescription=function(e){var t=e.target.value;n.props.onChangePlanField(["description"],t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,e.item)||this.props.mode!==e.mode}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.item,a=t.mode,i="view"!==a;return r.a.createElement("div",{className:"PrepaidPlanDetails"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Title",r.a.createElement(Ii,{contents:Ni.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{value:n.get("description",""),onChange:this.onChangeDescription,editable:i}))),["clone","create"].includes(a)&&r.a.createElement(f.l,{validationState:e.name.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Key",r.a.createElement(Ii,{contents:Ni.name})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{value:n.get("name",""),onChange:this.onChangeName,editable:i}),e.name.length>0&&r.a.createElement(f.n,null,e.name)))))}}]),t}(a.Component);Qy.defaultProps={errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var $y=Object(l.connect)()(function(e){var t=e.notification,n=e.first,a=e.last,i=e.index,o=e.editable,l=e.unitLabel,s=function(t){var n=t.target,a=n.id,r=n.value;e.onUpdateField(i,a,r)};return r.a.createElement("div",{className:"Notification"},r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:2,md:2,sm:2},r.a.createElement(f.l,{style:{margin:0}},n&&r.a.createElement(f.h,null,l),r.a.createElement(en,{id:"value",value:t.get("value",""),onChange:s,fieldType:"number",editable:o}))),r.a.createElement(f.g,{lg:2,md:2,sm:2},r.a.createElement(f.l,{style:{margin:0}},n&&r.a.createElement(f.h,null,"Type"),r.a.createElement(en,{id:"type",value:t.get("type",""),onChange:s,editable:o}))),r.a.createElement(f.g,{lg:6,md:6,sm:6},r.a.createElement(f.l,{style:{margin:0}},n&&r.a.createElement(f.h,null,"Message"),r.a.createElement(en,{id:"msg",value:t.get("msg",""),onChange:s,editable:o}))),r.a.createElement(f.g,{lg:1,md:1,sm:1,className:"text-right"},!n&&a&&o&&r.a.createElement(f.c,{bsSize:"small",className:"pull-right",onClick:function(){e.onRemove(i)}},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0Remove")),!a&&r.a.createElement(f.g,{lg:12,md:12,sm:12,xs:12},r.a.createElement("hr",{style:{marginTop:8,marginBottom:8}}))))}),Zy=Object(l.connect)()(function(e){var t=function(t){e.onRemove(e.pp_id,t)},n=function(t,n,a){e.onUpdateField(e.pp_id,t,n,a)},a=r.a.createElement("h3",null,e.name,e.editable&&r.a.createElement(f.c,{onClick:function(){e.onRemoveBalance(e.pp_id)},bsSize:"xsmall",className:"pull-right",style:{minWidth:80}},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0Remove"));return r.a.createElement("div",{className:"Notifications"},r.a.createElement(f.v,{header:a},e.notifications.map(function(a,i){var o=0===i,l=i===e.notifications.size-1;return r.a.createElement($y,{editable:e.editable,notification:a,first:o,last:l,onRemove:t,onUpdateField:n,index:i,key:i,unitLabel:e.unitLabel})}),r.a.createElement("br",null),e.editable&&r.a.createElement(Je,{onClick:function(){e.onAdd(e.pp_id)},label:"Add New"})))}),Xy=function(e){var t=e.plan,n=e.ppIncludes,a=e.mode,i=e.usageTypesData,o=e.propertyTypes,l=e.currency,s="view"!==a,c=function(t){e.onAddNotification(t)},u=function(t,n){e.onRemoveNotification(t,n)},p=function(t,n,a,r){e.onUpdateNotificationField(t,n,a,r)},d=function(t){e.onRemoveBalanceNotifications(t)},m=n.map(function(e){return{value:e.get("external_id"),label:e.get("name")}}).toJS();return r.a.createElement("div",{className:"PlanNotifications"},r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,null,s&&r.a.createElement(f.v,{header:r.a.createElement("h4",null,"Select prepaid bucket")},r.a.createElement(en,{fieldType:"select",placeholder:"Select",options:m,onChange:function(t){e.onSelectBalance(t.toString())},value:""})),s&&r.a.createElement("hr",null),t.get("notifications_threshold",Object(g.b)()).keySeq().filter(function(e){return"on_load"!==e}).map(function(e,a){var m=t.getIn(["notifications_threshold",e],Object(g.a)()),f=function(e){return n.find(function(t){return t.get("external_id","")===parseInt(e)})||Object(g.b)()}(e),h=f.get("name",""),v=f.get("charging_by_usaget_unit",!1),y=f.get("charging_by_usaget",""),b=v?"Volume (".concat(ye(o,i,y,v),")"):"Cost (".concat(Nu()(l),")");return m.size?r.a.createElement(Zy,{editable:s,notifications:m,onAdd:c,onRemove:u,onUpdateField:p,onRemoveBalance:d,name:h,pp_id:e,key:a,unitLabel:b}):null})))))};Xy.defaultProps={plan:Object(g.b)(),ppIncludes:Object(g.a)(),mode:"create",usageTypesData:Object(g.a)(),propertyTypes:Object(g.a)(),currency:""};var eb=Object(l.connect)()(Xy),tb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={options:[]},n.loadOptions=function(){return ir(Mr({key:1,description:1})).then(function(e){var t=Object(w.a)(new Set(e.data[0].data.details.map(function(e){return e.key}))).map(function(e){return{value:e,label:e}});n.setState({options:t})}).catch(function(){n.setState({options:[]})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.loadOptions()}},{key:"render",value:function(){var e=this.props,t=e.plan,n=e.mode,a=this.state.options,i="view"!==n,o=t.get("disallowed_rates",g.c.List()).join(",");return r.a.createElement("div",{className:"BlockedProducts"},r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Blocked products")},r.a.createElement(en,{fieldType:"select",value:o,options:a,onChange:this.props.onChangeBlockProduct,multi:!0,disabled:!i,placeholder:"Add product...",noResultsText:"No products found.",searchPromptText:"Type product key to search"})))}}]),t}(a.Component);tb.defaultProps={plan:g.c.Map(),mode:"create",onChangeBlockProduct:function(){}};var nb=tb,ab=function(e){var t=e.name,n=e.unitLabel,a=e.ppId,i=e.value,o=e.editable,l=[{type:"remove",showIcon:!0,onClick:function(){e.onRemove(a)}}];return r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,md:2},"".concat(t," (").concat(n,")")),r.a.createElement(f.g,{md:7},r.a.createElement(en,{fieldType:"number",onChange:function(t){e.onChange(a,t.target.value)},value:i,editable:o})),r.a.createElement(f.g,{md:2},r.a.createElement(Xe,{actions:l})))};ab.defaultProps={name:"",unitLabel:"",value:"",ppId:"",editable:!0};var rb=Object(l.connect)()(ab),ib=function(e){var t=e.plan,n=e.ppIncludes,a=e.mode,i=e.propertyTypes,o=e.usageTypesData,l=e.currency,s=e.onAddBalance,c=e.onChangeThreshold,u=e.onRemoveThreshold,p="view"!==a,d=n.map(function(e){return{value:e.get("external_id").toString(),label:e.get("name")}}).toJS(),m=t.get("pp_threshold",Object(g.b)());return r.a.createElement("div",{className:"Thresholds"},r.a.createElement(f.j,{horizontal:!0},p&&r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Select prepaid bucket")},r.a.createElement(en,{fieldType:"select",placeholder:"Select",options:d,onChange:s,value:""})),p&&r.a.createElement("hr",null),r.a.createElement(f.v,null,m.isEmpty()&&r.a.createElement("p",null,"No charging limits"),!m.isEmpty()&&m.keySeq().filter(function(e){return"on_load"!==e}).map(function(e,a){var s=function(e){return n.find(function(t){return t.get("external_id","")===parseInt(e)})||Object(g.b)()}(e),d=s.get("name",""),m=s.get("charging_by_usaget_unit",!1),f=s.get("charging_by_usaget",""),h=m?ye(i,o,f,m):Nu()(l);return r.a.createElement(rb,{key:a,editable:p,name:d,ppId:e,value:t.getIn(["pp_threshold",e],0),onChange:c,onRemove:u,unitLabel:h})}))))};ib.defaultProps={plan:Object(g.b)(),ppIncludes:Object(g.a)(),currency:"",usageTypesData:Object(g.a)(),propertyTypes:Object(g.a)(),mode:"create"};var ob=ib,lb="ADD_NOTIFICATION",sb="REMOVE_NOTIFICATION",cb="UPDATE_NOTIFICATION_FIELD",ub="ADD_BALANCE_NOTIFICATIONS",pb="REMOVE_BALANCE_NOTIFICATIONS",db="BLOCK_PRODUCT",mb="ADD_BALANCE_THRESHOLD",gb="CHANGE_BALANCE_THRESHOLD",fb="REMOVE_BALANCE_THRESHOLD";var hb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:parseInt(n.props.activeTab)},n.initDefaultValues=function(){var e=n.props.mode;if("create"===e){var t=S()().add(1,"days").toISOString();n.props.dispatch(Um(["from"],t)),n.props.dispatch(Um(["connection_type"],"prepaid")),n.props.dispatch(Um(["charging_type"],"prepaid")),n.props.dispatch(Um(["type"],"customer")),n.props.dispatch(qm()),n.props.dispatch(Um(["price",0,"price"],0)),n.props.dispatch(Um(["upfront"],!0)),n.props.dispatch(Um(["recurrence"],g.c.Map({unit:1,periodicity:"month"}))),n.props.dispatch(Um(["prorated"],!1)),n.props.dispatch(Um(["tax"],g.c.Map({service_code:" ",product_code:" ",safe_harbor_override_pct:" "})))}"clone"===e&&(n.props.dispatch(Hm()),n.handleSelectTab(1))},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&te(t,!1)){var a=t.get("name","");n.props.dispatch(Ac("plans","name",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Qm(e,!0)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("name","");n.props.dispatch(xc("plans",e))},n.clearItemsList=function(){n.props.dispatch(Pc("prepaid_plans"))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onChangePlanField=function(e,t){n.props.dispatch(Um(e,t))},n.onSelectBalance=function(e){var t=n.props,a=t.item,r=t.dispatch;a.getIn(["notifications_threshold",e],g.c.List()).size?r(Ja("There are already notifications for selected prepaid bucket")):r({type:ub,balance:e})},n.onAddNotification=function(e){n.props.dispatch(function(e){return{type:lb,thresholdId:e}}(e))},n.onRemoveNotification=function(e,t){n.props.dispatch(function(e,t){return{type:sb,thresholdId:e,index:t}}(e,t))},n.onUpdateNotificationField=function(e,t,a,r){n.props.dispatch(function(e,t,n,a){return{type:cb,thresholdId:e,index:t,field:n,value:a}}(e,t,a,r))},n.onRemoveBalanceNotifications=function(e){n.props.dispatch(function(e){return{type:pb,balanceId:e}}(e))},n.onChangeBlockProduct=function(e){var t,a=e.length?e.split(","):[];n.props.dispatch((t=g.c.List(a),{type:db,rates:t}))},n.onChangeThreshold=function(e,t){n.props.dispatch(function(e,t){return{type:gb,balanceId:e,value:t}}(e,t))},n.onRemoveThreshold=function(e){n.props.dispatch(function(e){return{type:fb,balanceId:e}}(e))},n.onAddBalanceThreshold=function(e){var t=n.props,a=t.item,r=t.dispatch;a.getIn(["pp_threshold",e])?r(Ja("Prepaid bucket already defined")):r(function(e){return{type:mb,balanceId:e}}(e))},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.props.dispatch(Wm(t,a)).then(n.afterSave)},n.afterSave=function(e){var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Wa("The plan was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleBack=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&n.clearItemsList();var e=Y(["systemItems","prepaid_plan","itemsType"],"");n.props.router.push("/".concat(e))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(fr("pp_includes",Pr())),this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if(["clone","create"].includes(e)){var t=X(e,"prepaid_plan");this.props.dispatch(ro(t))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=e.ppIncludes,i=this.props,o=i.item,l=i.itemId,s=i.mode,c=i.ppIncludes;if(n!==s||te(t)!==te(o)){var u=X(n,"prepaid_plan",t);this.props.dispatch(ro(u))}(a!==l||n!==s&&"clone"===n||!g.c.is(r,c))&&this.fetchItem(a)}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"PLAN_CLEAR"})}},{key:"render",value:function(){var e=this.state.activeTab,t=this.props,n=t.item,a=t.mode,i=t.ppIncludes,o=t.revisions,l=t.propertyTypes,s=t.usageTypesData,c=t.currency;if("loading"===a)return r.a.createElement(_,{onClick:this.handleBack});var u="view"!==a,p=n.get("rates",g.c.Map());return r.a.createElement("div",{className:"PrepaidPlan"},r.a.createElement(f.v,null,r.a.createElement(Mu,{itemName:"prepaid_plan",revisions:o,item:n,mode:a,onChangeFrom:this.onChangePlanField,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.A,{activeKey:e,animation:!1,id:"PrepaidPlan",onSelect:this.handleSelectTab},r.a.createElement(f.y,{title:"Details",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Qy,{item:n,mode:a,onChangePlanField:this.onChangePlanField}))),r.a.createElement(f.y,{title:"Override Product Price",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Nm,{itemName:"plan",mode:a,planRates:p,onChangeFieldValue:this.onChangePlanField}))),r.a.createElement(f.y,{title:"Notifications",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(eb,{plan:n,mode:a,ppIncludes:i,propertyTypes:l,usageTypesData:s,currency:c,onAddNotification:this.onAddNotification,onRemoveNotification:this.onRemoveNotification,onUpdateNotificationField:this.onUpdateNotificationField,onSelectBalance:this.onSelectBalance,onRemoveBalanceNotifications:this.onRemoveBalanceNotifications}))),r.a.createElement(f.y,{title:"Blocked Products",eventKey:4},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(nb,{plan:n,mode:a,onChangeBlockProduct:this.onChangeBlockProduct}))),r.a.createElement(f.y,{title:"Charging Limits",eventKey:5},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(ob,{plan:n,mode:a,ppIncludes:i,propertyTypes:l,usageTypesData:s,currency:c,onChangeThreshold:this.onChangeThreshold,onRemoveThreshold:this.onRemoveThreshold,onAddBalance:this.onAddBalanceThreshold})))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!u,cancelLabel:u?void 0:"Back"}))}}]),t}(a.Component);hb.defaultProps={item:g.c.Map(),revisions:g.c.List(),ppIncludes:g.c.List(),activeTab:1,currency:"",usageTypesData:g.c.List(),propertyTypes:g.c.List()};var vb=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:pi(e,t,"plan"),item:ui(e,t,"plan"),mode:di(e,t,"plan"),activeTab:ri(e,t,"plan"),revisions:ai(e,t,"plan"),ppIncludes:e.list.get("pp_includes"),usageTypesData:Un(e,t),propertyTypes:Vn(e,t),currency:Mn(e,t)}})(hb)),yb=function(e){var t=e.item,n=Object(a.useState)(!1),i=Object(Ti.a)(n,2),o=i[0],l=i[1],s=function(){l(!1)};return r.a.createElement("div",null,""!==t.get("details","")&&r.a.createElement("p",null,t.get("details","")),["login"].includes(t.get("type",""))&&r.a.createElement("p",null,"IP: ",t.get("ip","")),!["login"].includes(t.get("type",""))&&r.a.createElement("p",null,function(e){switch(e){case"closeandnew":return"New revision";case"update":return"Updated";case"delete":return"Deleted";case"create":return"Created";case"close":return"Closed";case"move":return"Moved";case"permanentchange":return"Updated";case"reopen":return"Reopened";default:return""}}(t.get("type","")),"\xa0",r.a.createElement(f.c,{bsStyle:"link",onClick:function(){l(!0)},style:{verticalAlign:"bottom"}},r.a.createElement("i",{className:"fa fa-compress"}),"\xa0",t.get("new",null)&&t.get("old",null)?"Compare":"Details"),function(){var e=t.get("new",null),n=t.get("old",null),a=g.c.Map.isMap(e)?e.delete("_id").toJS():"",i=g.c.Map.isMap(n)?n.delete("_id").toJS():"";return r.a.createElement(E,{show:o,onClose:s,inputNew:a,inputOld:i})}()))};yb.defaultProps={item:g.c.Map()};var bb=yb,Eb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={fields:{},page:0,size:10,sort:g.c.Map({urt:-1}),filter:{}},n.onSort=function(e){var t=g.c.Map(e);n.setState({sort:t},n.fetchItems)},n.onFilter=function(e){n.setState({filter:e,page:0},n.fetchItems)},n.fetchItems=function(){n.props.dispatch(fr("log",n.buildQuery()))},n.fetchUser=function(){var e=Lr();n.props.dispatch(fr("autocompleteUser",e))},n.fetchEnityTypes=function(){var e=kr();n.props.dispatch(fr("autocompleteAuditTrailEntityTypes",e))},n.handlePageClick=function(e){n.setState({page:e},n.fetchItems)},n.buildQuery=function(){var e=n.state,t=e.fields,a=e.size,r=e.page,i=e.sort,o=e.filter,l=Object.assign({},o);return l.source="audit",l.urt&&(l.urt=n.urtQueryBuilder(l.urt)),isNaN(l.key)?l.key&&(l.key={$regex:l.key,$options:"i"}):l.key={$in:[l.key,Number(l.key)]},Br(l,r,t,i,a)},n.userParser=function(e){return e.getIn(["user","name"],"")},n.collectionParser=function(e){return F.a.sentenceCase(e.get("collection",""))},n.keyParser=function(e){return"login"===e.get("type","")?"":e.get("key","")},n.detailsParser=function(e){return r.a.createElement(bb,{item:e})},n.urtQueryBuilder=function(e){return{$gte:S()(e).startOf("day"),$lt:S()(e).add(1,"days")}},n.getFilterFields=function(){var e=n.props;return[{id:"urt",title:"Date",type:"date"},{id:"user.name",title:"User",type:"select",options:e.userNames},{id:"collection",title:"Entity Type",type:"select",options:e.auditTrailEntityTypes},{id:"key",title:"Entity Key"}]},n.getTableFields=function(){return[{id:"urt",title:"Date",type:"datetime",cssClass:"long-date",sort:!0},{id:"user.name",title:"User",parser:n.userParser,sort:!0},{id:"collection",title:"Module Type",parser:n.collectionParser,sort:!0},{id:"key",title:"Module Key",parser:n.keyParser,sort:!0},{title:"Details",parser:n.detailsParser}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.fetchUser(),this.fetchEnityTypes()}},{key:"componentWillReceiveProps",value:function(e){g.c.is(this.props.userNames,e.userNames)||this.fetchItems()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(gr("log")),this.props.dispatch(gr("autocompleteUser")),this.props.dispatch(gr("autocompleteAuditTrailEntityTypes"))}},{key:"render",value:function(){var e=this.props.items,t=this.state.sort,n=this.getFilterFields(),a=this.getTableFields();return r.a.createElement("div",{className:"Audit-Trail"},r.a.createElement(f.x,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:r.a.createElement(sp,{fields:n,onFilter:this.onFilter})},r.a.createElement(ec,{items:e,fields:a,edit:!1,sort:t,onSort:this.onSort})))),r.a.createElement(up,{onClick:this.handlePageClick,size:this.state.size,count:e.size}))}}]),t}(a.Component);Eb.defaultProps={items:g.c.List(),userNames:g.c.List(),auditTrailEntityTypes:g.c.List()};var Cb=Object(l.connect)(function(e){return{items:Ra(e),userNames:xa(e),auditTrailEntityTypes:Fa(e)}})(Eb),_b=function(){return yl("prepaid_include","prepaid_include")},Ob=function(e,t){return Cl("prepaidincludes",e,t)},Sb=function(e){return Sl("prepaidincludes",e)},Tb=function(e,t){return gl("prepaid_include",e,t)},kb=function(e){return function(t){t(Aa());var n=function(e){return Rr("prepaidincludes",e)}(e);return ir(n).then(function(e){var n=e.data[0].data.details[0];return n.originalValue=n.from,t(hl("prepaid_include",n)),t(tr(e))}).catch(function(e){return t(nr(e,"Error retreiving prepaid bucket"))})}},Ib=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={showConfirmRemove:!1,prepaidIncludes:null,refreshString:""},n.fields=[{id:"name",sort:!0},{id:"charging_by",showFilter:!1},{id:"charging_by_usaget",showFilter:!1},{id:"priority",showFilter:!1,sort:!0}],n.projectFields={charging_by_usaget:1,charging_by:1,priority:1,name:1},n.onClickRemoveItem=function(e){n.setState({showConfirmRemove:!0,prepaidIncludes:e})},n.onClickRemoveCancel=function(){n.setState({showConfirmRemove:!1,prepaidIncludes:null})},n.onClickRemoveOk=function(){var e=n.state.prepaidIncludes;n.setState({showConfirmRemove:!1,prepaidIncludes:null}),n.props.dispatch(Sb(e)).then(function(e){e.status&&n.setState({refreshString:S()().format()})})},n.actions=[{type:"edit"},{type:"remove",showIcon:!0,helpText:"Remove",onClick:n.onClickRemoveItem,show:!0}],n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.showConfirmRemove,n=e.prepaidIncludes,a=e.refreshString,i=n?"Are you sure you want to remove ".concat(n.get("name",""),"?"):"";return r.a.createElement("div",{className:"prepaid-includes-list"},r.a.createElement(qc,{collection:"prepaidincludes",itemType:"prepaid_include",itemsType:"prepaid_includes",filterFields:this.fields,tableFields:this.fields,projectFields:this.projectFields,showRevisionBy:"name",actions:this.actions,refreshString:a}),r.a.createElement(Ke,{onOk:this.onClickRemoveOk,onCancel:this.onClickRemoveCancel,show:t,message:i,labelOk:"Yes"}))}}]),t}(a.Component),Nb=Object(l.connect)()(Ib),wb=function(e){var t=e.prepaidInclude,n=e.chargingByOptions,a=e.mode,i=function t(n){return function(a){if("charging_by"===n){var r="total_cost"===a?"total_cost":"";t("charging_by_usaget")(r),"usagev"!==a&&t("charging_by_usaget_unit")("")}e.onChangeField({target:{id:n,value:a}})}},o={marginTop:10},l="view"!==a;return r.a.createElement("div",{className:"PrepaidInclude"},r.a.createElement(f.v,null,r.a.createElement(f.j,{horizontal:!0},["clone","create"].includes(a)&&r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Name"),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(en,{id:"name",value:t.get("name",""),onChange:e.onChangeField,editable:l}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"External ID"),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(en,{id:"external_id",value:t.get("external_id",""),onChange:e.onChangeField,fieldType:"number",editable:"create"===a}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Priority"),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(en,{id:"priority",value:t.get("priority",""),onChange:e.onChangeField,tooltip:"Lower number represents higher priority",fieldType:"number",editable:l}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Charging by"),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(en,{fieldType:"select",value:t.get("charging_by",""),options:n,onChange:i("charging_by"),editable:l}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Usage type"),r.a.createElement(f.g,{lg:7,md:7},"total_cost"===t.get("charging_by")?r.a.createElement(en,{fieldType:"select",disabled:!0,value:"All",editable:l}):l?r.a.createElement(eu,{usaget:t.get("charging_by_usaget",""),unit:t.get("charging_by_usaget_unit",""),onChangeUsaget:i("charging_by_usaget"),onChangeUnit:i("charging_by_usaget_unit"),showUnits:"usagev"===t.get("charging_by","")}):r.a.createElement("div",{className:"non-editable-field"},t.get("charging_by_usaget","")))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Shared bucket"),r.a.createElement(f.g,{lg:7,md:7,style:o},r.a.createElement(en,{id:"shared",value:t.get("shared",!1),onChange:e.onChangeField,fieldType:"checkbox",editable:l}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Unlimited"),r.a.createElement(f.g,{lg:7,md:7,style:o},r.a.createElement(en,{id:"unlimited",value:t.get("unlimited",!1),onChange:e.onChangeField,fieldType:"checkbox",editable:l}))))))};wb.defaultProps={prepaidInclude:Object(g.b)(),chargingByOptions:[],mode:"create"};var jb=Object(l.connect)()(wb),Rb=function(e){var t=e.name,n=e.rates,a=e.allRates,i=e.onChange,o=e.onRemove,l=e.editable,s=[{type:"remove",showIcon:!0,onClick:function(){o(t)}}];return r.a.createElement("div",{className:"LimitedDestination"},r.a.createElement(f.v,{header:r.a.createElement("div",null,t,r.a.createElement("div",{className:"pull-right",style:{marginTop:-5}},r.a.createElement(Xe,{actions:s})))},r.a.createElement(en,{fieldType:"select",multi:!0,value:n.join(","),options:a,onChange:function(e){i(t,Object(g.a)(e.split(",")))},editable:l})))};Rb.defaultProps={name:"",rates:Object(g.a)(),allRates:[],actions:[],editable:!0};var xb=Rb,Fb=function(e){var t=e.limitedDestinations,n=e.allRates,a="view"!==e.mode,i=t.keySeq().toArray();return r.a.createElement("div",{className:"LimitedDestinations"},a&&r.a.createElement(f.v,null,r.a.createElement(Zr,{onSelectPlan:e.onSelectPlan,selectedOptions:i,planType:"prepaid"})),t.keySeq().filter(function(e){return"BASE"!==e}).map(function(i,o){return r.a.createElement(xb,{editable:a,key:o,rates:t.get(i,Object(g.a)()),onChange:e.onChange,onRemove:e.onRemove,allRates:n,name:i})}))};Fb.defaultProps={limitedDestinations:Object(g.b)(),allRates:[],mode:"create"};var Pb=Object(l.connect)()(Fb),Mb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:parseInt(n.props.activeTab)},n.initDefaultValues=function(){var e=n.props,t=e.mode,a=e.item;if("create"===t){var r=S()().add(1,"days").toISOString();n.onChangeFieldValue(["from"],r),n.onChangeFieldValue(["shared"],!1),n.onChangeFieldValue(["unlimited"],!1)}"clone"===t&&(n.props.dispatch(_b()),n.handleSelectTab(1));var i=a.get("allowed_in",g.c.Map());g.c.Map.isMap(i)||n.onChangeFieldValue(["allowed_in"],g.c.Map())},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&te(t,!1)){var a=t.get("name","");n.props.dispatch(Ac("prepaidincludes","name",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(kb(e)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("name","");n.props.dispatch(xc("prepaidincludes",e))},n.clearItemsList=function(){var e=Y(["systemItems","prepaid_include","itemsType"],"");n.props.dispatch(Pc(e))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onChangeFieldValue=function(e,t){n.props.dispatch(Tb(e,t))},n.onChangeField=function(e){var t=e.target,a=t.id,r=t.value;n.onChangeFieldValue(a,r)},n.onChangeLimitedDestinations=function(e,t){n.onChangeFieldValue(["allowed_in",e],t)},n.onRemoveLimitedDestinations=function(e){var t=n.props.item.get("allowed_in",g.c.Map());n.onChangeFieldValue(["allowed_in"],t.remove(e))},n.onSelectPlan=function(e){var t=n.props,a=t.item,r=t.dispatch;a.getIn(["allowed_in",e])?r(Qa("Plan already exists")):n.onChangeFieldValue(["allowed_in",e],g.c.List())},n.afterSave=function(e){var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Wa("The prepaid bucket was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.validatePrepaidBucket=function(){return n.props.item.get("allowed_in",g.c.Map()).every(function(e){return e.first()})},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.validatePrepaidBucket()?n.props.dispatch(Ob(t,a)).then(n.afterSave):n.props.dispatch(Qa("Associate Products - cannot have plan without products in it"))},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Y(["systemItems","prepaid_include","itemsType"],"");e&&n.clearItemsList(),n.props.router.push("/".concat(t))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if("create"===e){var t=X(e,"prepaid_include");this.props.dispatch(ro(t))}this.props.dispatch(fr("all_rates",Mr())),this.props.dispatch(il("usage_types")),this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=this.props,i=r.item,o=r.itemId,l=r.mode;if(n!==l||te(t)!==te(i)){var s=X(n,"prepaid_include",t);this.props.dispatch(ro(s))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"componentWillUnmount",value:function(){this.props.dispatch(bl("prepaid_include"))}},{key:"render",value:function(){var e=this.state.activeTab,t=this.props,n=t.item,a=t.mode,i=t.allRates,o=t.revisions;if("loading"===a)return r.a.createElement(_,{onClick:this.handleBack});var l=i.map(function(e){return{value:e.get("key"),label:e.get("key")}}).toArray(),s=n.get("allowed_in",g.c.Map());return g.c.Map.isMap(s)||(s=g.c.Map()),r.a.createElement("div",{className:"PrepaidIncludeSetup"},r.a.createElement(f.v,null,r.a.createElement(Mu,{itemName:"prepaid_include",revisions:o,item:n,mode:a,onChangeFrom:this.onChangeFieldValue,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.A,{activeKey:e,id:"PrepaidInclude",animation:!1,onSelect:this.handleSelectTab},r.a.createElement(f.y,{title:"Details",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(jb,{mode:a,prepaidInclude:n,chargingByOptions:[{value:"usagev",label:"Usage volume"},{value:"cost",label:"Cost"},{value:"total_cost",label:"Total cost"}],onChangeField:this.onChangeField,onChangeSelectField:this.onChangeSelectField}))),r.a.createElement(f.y,{title:"Associate Products",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Pb,{mode:a,limitedDestinations:s,allRates:l,onSelectPlan:this.onSelectPlan,onChange:this.onChangeLimitedDestinations,onRemove:this.onRemoveLimitedDestinations})))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave}))}}]),t}(a.Component);Mb.defaultProps={item:g.c.Map(),revisions:g.c.List(),allRates:g.c.List(),activeTab:1};var Ab=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:pi(e,t,"prepaid_include"),item:ui(e,t,"prepaid_include"),mode:di(e,t,"prepaid_include"),activeTab:ri(e,t,"prepaid_include"),revisions:ai(e,t,"prepaid_include"),allRates:e.list.get("all_rates")}})(Mb)),Db=function(){return r.a.createElement(qc,{collection:"prepaidgroups",itemType:"charging_plan",itemsType:"charging_plans",filterFields:[{id:"description",placeholder:"Title"},{id:"name",placeholder:"Key"}],tableFields:[{id:"description",title:"Title",sort:!0},{id:"name",title:"Key",sort:!0},{id:"operation",title:"Operation",sort:!0},{id:"charging_value",title:"Charging value",sort:!0}],projectFields:{charging_value:1,description:1,operation:1,name:1},showRevisionBy:"name",actions:[{type:"edit"}]})},Lb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={errors:{name:""}},n.onChangeName=function(e){var t=n.props.errorMessages.name.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=Y("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{name:i})}),n.props.onChangeField(["name"],r)},n.onChangeDescription=function(e){var t=e.target.value;n.props.onChangeField(["description"],t)},n.onChangeOperation=function(e){n.props.onChangeField(["operation"],e)},n.onChangeChargingValue=function(e){var t=e.target.value;n.props.onChangeField(["charging_value"],t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,e.item)||this.props.mode!==e.mode}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.item,a=t.mode,i="view"!==a;return r.a.createElement("div",{className:"PrepaidPlanDetails"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Title",r.a.createElement(Ii,{contents:Ni.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{value:n.get("description",""),onChange:this.onChangeDescription,editable:i}))),["clone","create"].includes(a)&&r.a.createElement(f.l,{validationState:e.name.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Key",r.a.createElement(Ii,{contents:Ni.name})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{value:n.get("name",""),onChange:this.onChangeName,editable:i}),e.name.length>0&&r.a.createElement(f.n,null,e.name))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Operation"),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{fieldType:"select",options:[{value:"new",label:"New"},{value:"inc",label:"Increment"},{value:"set",label:"Set"}],value:n.get("operation",""),onChange:this.onChangeOperation}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Charging value"),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{value:n.get("charging_value",0),fieldType:"number",onChange:this.onChangeChargingValue,editable:i})))))}}]),t}(a.Component);Lb.defaultProps={errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var Ub=function(e){var t=e.include,n=e.index,a=e.editable,i=[{type:"remove",showIcon:!0,onClick:function(){e.onRemove(n)}}],o=r.a.createElement("div",null,t.get("pp_includes_name",""),r.a.createElement("div",{className:"pull-right",style:{marginTop:-5}},r.a.createElement(Xe,{actions:i})));return r.a.createElement("div",{className:"ChargingPlanInclude"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:o},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,md:2}," Operation "),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{fieldType:"select",options:[{value:"default",label:"Default"},{value:"new",label:"New"},{value:"inc",label:"Increment"},{value:"set",label:"Set"}],value:t.get("operation",""),onChange:function(t){e.onUpdateField(n,"operation",t)},editable:a}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,md:2},t.get("unit_label","Value")),r.a.createElement(f.g,{md:9},r.a.createElement(en,{id:"usagev",value:t.get("usagev",0),onChange:function(t){var a=t.target,r=a.id,i=a.value;e.onUpdateField(n,r,i)},fieldType:"number",editable:e.editable}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,md:2}," Duration "),r.a.createElement(f.g,{md:9},r.a.createElement(f.g,{md:6,style:{paddingLeft:0}},r.a.createElement(en,{fieldType:"number",id:"duration",value:t.getIn(["period","duration"],0),onChange:function(t){var a=t.target,r=a.id,i=a.value;e.onUpdatePeriodField(n,r,i)},editable:e.editable}),!a&&r.a.createElement("div",{className:"non-editable-field"},t.getIn(["period","unit"],""))),r.a.createElement(f.g,{md:6},r.a.createElement(en,{fieldType:"select",options:[{value:"days",label:"Days"},{value:"months",label:"Months"}],value:t.getIn(["period","unit"],""),onChange:function(t){e.onUpdatePeriodField(n,"unit",t)},editable:a})))))))};Ub.defaultProps={include:Object(g.b)(),index:0,editable:!0};var Vb=Object(l.connect)()(Ub),Bb=function(e){var t=e.includes,n=e.mode,a=e.prepaidIncludesOptions,i=e.onSelectPPInclude,o=e.onUpdateField,l=e.onUpdatePeriodField,s=e.onRemoveChargingPlan,c="view"!==n;return r.a.createElement("div",{className:"ChargingPlanIncludes"},c&&r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Select prepaid bucket")},r.a.createElement(en,{fieldType:"select",value:"",options:a,onChange:i})),c&&r.a.createElement("hr",null),t.keySeq().filter(function(e){return!["cost","groups"].includes(e)}).map(function(e,n){return r.a.createElement(Vb,{key:n,editable:c,include:t.get(e),onUpdateField:o,onUpdatePeriodField:l,onRemove:s,index:e})}))};Bb.defaultProps={includes:Object(g.a)(),prepaidIncludesOptions:[],mode:"create"};var qb=Bb,zb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:parseInt(n.props.activeTab)},n.initDefaultValues=function(){var e=n.props.mode;if("create"===e){var t=S()().add(1,"days").toISOString();n.props.dispatch(Um(["from"],t)),n.props.dispatch(Um(["connection_type"],"prepaid")),n.props.dispatch(Um(["charging_type"],"prepaid")),n.props.dispatch(Um(["type"],"charging")),n.props.dispatch(qm()),n.props.dispatch(Um(["price",0,"price"],0)),n.props.dispatch(Um(["upfront"],!0)),n.props.dispatch(Um(["recurrence"],g.c.Map({unit:1,periodicity:"month"}))),n.props.dispatch(Um(["operation"],"inc"))}"clone"===e&&(n.props.dispatch(Hm()),n.handleSelectTab(1))},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&te(t,!1)){var a=t.get("name","");n.props.dispatch(Ac("prepaidgroups","name",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch($m(e)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("name","");n.props.dispatch(xc("prepaidgroups",e))},n.clearItemsList=function(){n.props.dispatch(Pc("charging_plans"))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onChangeField=function(e,t){n.props.dispatch(Um(e,t))},n.onSelectPPInclude=function(e){var t=n.props,a=t.prepaidIncludes,r=t.item,i=t.propertyTypes,o=t.usageTypesData,l=t.currency;if(""!==e){var s=a.find(function(t){return t.get("name")===e}),c=s.get("name"),u=s.get("external_id"),p=s.get("charging_by_usaget_unit",!1),d=s.get("charging_by_usaget",""),m=p?"Volume (".concat(ye(i,o,d,p),")"):"Cost (".concat(Nu()(l),")");void 0!==r.get("include",g.c.List()).find(function(t){return t.get("pp_includes_name","")===e})||n.props.dispatch(Ym(c,u,m))}},n.onUpdatePeriodField=function(e,t,a){n.props.dispatch(Um(["include",e,"period",t],a))},n.onUpdateIncludeField=function(e,t,a){n.props.dispatch(Um(["include",e,t],a))},n.onRemoveChargingPlan=function(e){var t=n.props.item;n.props.dispatch(Um(["include"],t.get("include").remove(e)))},n.afterSave=function(e){var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Wa("The plan was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.props.dispatch(Jm(t,a)).then(n.afterSave)},n.handleBack=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&n.clearItemsList();var e=Y(["systemItems","charging_plan","itemsType"],"");n.props.router.push("/".concat(e))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(fr("pp_includes",Pr())),this.fetchItem(),this.initDefaultValues()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if(["clone","create"].includes(e)){var t=X(e,"charging_plan");this.props.dispatch(ro(t))}}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=e.prepaidIncludes,i=this.props,o=i.item,l=i.itemId,s=i.mode,c=i.prepaidIncludes;if(n!==s||te(t)!==te(o)){var u=X(n,"charging_plan",t);this.props.dispatch(ro(u))}(a!==l||n!==s&&"clone"===n||!g.c.is(r,c))&&this.fetchItem(a)}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"PLAN_CLEAR"})}},{key:"render",value:function(){var e=this.state.activeTab,t=this.props,n=t.item,a=t.prepaidIncludes,i=t.mode,o=t.revisions;if("loading"===i)return r.a.createElement(_,{onClick:this.handleBack});var l=a.map(function(e){return{label:e.get("name"),value:e.get("name")}}).toJS();return r.a.createElement("div",{className:"ChargingPlanSetup"},r.a.createElement(f.v,null,r.a.createElement(Mu,{itemName:"charging_plan",revisions:o,item:n,mode:i,onChangeFrom:this.onChangeField,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.A,{activeKey:e,id:"ChargingPlan",animation:!1,onSelect:this.handleSelectTab},r.a.createElement(f.y,{title:"Details",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Lb,{item:n,mode:i,onChangeField:this.onChangeField}))),r.a.createElement(f.y,{title:"Prepaid Buckets",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(qb,{mode:i,includes:n.get("include",g.c.List()),prepaidIncludesOptions:l,onSelectPPInclude:this.onSelectPPInclude,onUpdatePeriodField:this.onUpdatePeriodField,onUpdateField:this.onUpdateIncludeField,onRemoveChargingPlan:this.onRemoveChargingPlan})))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave}))}}]),t}(a.Component);zb.defaultProps={item:g.c.Map(),revisions:g.c.List(),prepaidIncludes:g.c.List(),activeTab:1,currency:"",usageTypesData:g.c.List(),propertyTypes:g.c.List()};var Hb=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:pi(e,t,"plan"),item:ui(e,t,"plan"),mode:di(e,t,"plan"),activeTab:ri(e,t,"plan"),revisions:ai(e,t,"charging_plan"),prepaidIncludes:e.list.get("pp_includes"),currency:Mn(e,t),usageTypesData:Un(e,t),propertyTypes:Vn(e,t)}})(zb)),Yb=function(e,t){return Cl("autorenew",e,t)},Gb=function(e){return Sl("autorenew",e)},Kb=function(e,t){return gl("autorenew",e,t)},Wb=function(e){return Ol("autorenew",function(e){return Rr("autorenew",e)}(e))},Jb=function(e){var t=e.get("last_renew",!1);return t?S()(t).format(Y("datetimeFormat","DD/MM/YYYY HH:mm")):"Not Renewed Yet"},Qb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={itemToDelete:null,refreshString:""},n.getFilterFields=function(){return[{id:"aid",placeholder:G("aid","autorenew")},{id:"sid",placeholder:G("sid","autorenew")},{id:"bucket_group",placeholder:G("bucket_group","autorenew")}]},n.getTableFields=function(){return[{id:"aid",title:G("aid","autorenew"),sort:!0},{id:"sid",title:G("sid","autorenew"),sort:!0},{id:"bucket_group",title:G("bucket_group","autorenew"),sort:!0},{id:"cycles",title:G("cycles","autorenew"),sort:!0},{id:"cycles_remaining",title:G("cycles_remaining","autorenew"),sort:!0},{id:"next_renew",title:G("next_renew","autorenew"),sort:!0,type:"datetime"},{id:"last_renew",title:G("last_renew","autorenew"),sort:!0,type:"datetime",parser:Jb},{id:"interval",title:G("interval","autorenew"),sort:!0}]},n.getProjectFields=function(){return{aid:1,sid:1,bucket_group:1,cycles:1,cycles_remaining:1,next_renew:1,last_renew:1,interval:1}},n.onAskDelete=function(e){var t={message:"Are you sure you want to delete this recurring charge ?",onOk:n.onDeleteOk,labelOk:"Delete",type:"delete",onCancel:n.onDeleteClose};n.props.dispatch(po(t)),n.setState({itemToDelete:e})},n.onDeleteClose=function(){n.setState({itemToDelete:null})},n.onDeleteOk=function(){var e=n.state.itemToDelete;n.props.dispatch(Gb(e)).then(n.afterDelete)},n.afterDelete=function(e){n.onDeleteClose(),e.status&&(n.props.dispatch(Wa("Recurring charge removed successfully")),n.setState({refreshString:S()().format()}))},n.getActions=function(){return[{type:"edit",onClickColumn:null},{type:"remove",showIcon:!0,onClick:n.onAskDelete}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state.refreshString,t=this.getFilterFields(),n=this.getTableFields(),a=this.getActions(),i=this.getProjectFields();return r.a.createElement(qc,{collection:"autorenew",api:"get",itemType:"auto_renew",itemsType:"auto_renews",filterFields:t,tableFields:n,projectFields:i,actions:a,refreshString:e})}}]),t}(a.Component);Qb.defaultProps={};var $b=Object(l.connect)()(Qb),Zb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).initDefaultValues=function(){"create"!==n.props.mode&&n.props.dispatch(Kb("immediate",!1))},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Wb(e)).then(n.afterItemReceived)},n.afterItemReceived=function(e){e.status?n.initDefaultValues():n.handleBack()},n.onChangeFieldValue=function(e,t){n.props.dispatch(Kb(e,t))},n.onChangeInputField=function(e){var t=e.target,a=t.id,r=t.value;n.onChangeFieldValue(a,r)},n.onChangeSelectField=function(e){return function(t){n.onChangeFieldValue(e,t)}},n.onChangeDateField=function(e){return function(t){n.onChangeFieldValue(e,t.toISOString())}},n.onChangeImmediate=function(e){n.onChangeFieldValue("next_renew",void 0),n.onChangeInputField(e)},n.afterSave=function(e){e.status&&(n.props.dispatch(Wa("The auto renew charge was saved")),n.handleBack(!0))},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.props.dispatch(Yb(t,a)).then(n.afterSave)},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Y(["systemItems","auto_renew","itemsType"],"");e&&n.props.dispatch(Pc(t)),n.props.router.push("/".concat(t))},n.getBucketGroupsOptions=function(){return n.props.bucketGroups.map(function(e){return{value:e.get("name",""),label:e.get("description",e.get("name",""))}}).toArray()},n.getIntervalOptions=function(){return[{value:"month",label:"Monthly"},{value:"day",label:"Daily"}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(fr("bucket_groups",xr("prepaidgroups"))),this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;this.initDefaultValues();var t=X(e,"auto_renew");this.props.dispatch(ro(t))}},{key:"componentWillReceiveProps",value:function(e){var t=e.itemId;t!==this.props.itemId&&this.fetchItem(t)}},{key:"componentWillUnmount",value:function(){this.props.dispatch(bl("autorenew"))}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.mode,a=this.getBucketGroupsOptions(),i=this.getIntervalOptions(),o="create"===n,l=S()(new Date(t.get("next_renew"))),s=S()(new Date).add(1,"days").startOf("day");return r.a.createElement("div",{className:"AutoRenewSetup"},r.a.createElement(f.v,null,r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},G("aid","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(en,{id:"aid",value:t.get("aid",""),onChange:this.onChangeInputField,fieldType:"number"}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},G("sid","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(en,{id:"sid",value:t.get("sid",""),onChange:this.onChangeInputField,fieldType:"number"}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},G("bucket_group","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(en,{fieldType:"select",value:t.get("bucket_group",""),onChange:this.onChangeSelectField("bucket_group"),options:a}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},G("cycles","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(en,{id:"cycles",value:t.get("cycles",""),onChange:this.onChangeInputField,fieldType:"number",disabled:!o}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},G("cycles_remaining","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(en,{id:"cycles_remaining",value:t.get("cycles_remaining",t.get("cycles","")),onChange:this.onChangeInputField,fieldType:"number",disabled:o}))),o&&r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Immediate Charge"),r.a.createElement(f.g,{lg:7,md:7,style:{marginTop:10}},r.a.createElement(en,{id:"immediate",value:t.get("immediate",!1),onChange:this.onChangeImmediate,fieldType:"checkbox"}),t.get("immediate",!1)&&r.a.createElement(f.n,null,"The cusomter first charge will occur as soon as you will click save"))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},G("next_renew","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(en,{id:"next_renew",value:l,minDate:s,onChange:this.onChangeDateField("next_renew"),disabled:t.get("immediate",!1),fieldType:"date"}))),!o&&r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},G("last_renew","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(en,{id:"last_renew",value:Jb(t),editable:!1}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},G("interval","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(en,{fieldType:"select",value:t.get("interval",""),onChange:this.onChangeSelectField("interval"),options:i}))))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave}))}}]),t}(a.Component);Zb.defaultProps={item:g.c.Map(),itemId:"",mode:"",bucketGroups:g.c.List()};var Xb=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:pi(e,t,"autorenew"),item:ui(e,t,"autorenew"),mode:di(e,t,"autorenew"),bucketGroups:e.list.get("bucket_groups")}})(Zb)),eE=function(e){var t=e.field,n=e.entity,a=e.actions,i=e.fieldTypeLabel,o=e.isSortable,l=e.isReordable;return r.a.createElement(f.x,{className:"CustomFieldsListRow ".concat(n," table-row withHover")},r.a.createElement(f.g,{sm:1,className:"text-center"},l&&r.a.createElement(rt,{disabled:!o})),r.a.createElement(f.g,{sm:2,style:{wordBreak:"break-all"}},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Field Name:\xa0")),t.get("field_name","")),r.a.createElement(f.g,{sm:3},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Title:\xa0")),t.get("title","")),r.a.createElement(f.g,{sm:1},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Type:\xa0")),i),r.a.createElement(f.g,{sm:3},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Default Value:\xa0")),r.a.createElement("span",{className:"text-center"},r.a.createElement(Lu,{field:t.set("field_name","default_value"),entity:Object(g.b)({default_value:t.get("default_value")}),onlyInput:!0,editable:!1}))),r.a.createElement(f.g,{sm:2,className:"actions"},r.a.createElement(Xe,{actions:a,data:t})),r.a.createElement(f.g,{sm:12},r.a.createElement("hr",{style:{marginTop:0,marginBottom:0}})))};eE.defaultProps={field:Object(g.b)(),fieldType:"text",fieldTypeLabel:"Text",entity:"",actions:[],isSortable:!0,isEditable:!0,isRemoveable:!0,isReordable:!0};var tE=eE,nE=Object(on.a)(Kn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.a)()).filter(Le)}),aE=Object(on.a)(function(e,t,n){return n},qn,Yn,Wn,Qn,Zn,$n,nE,function(e,t,n,a,r,i,o,l){var s=Object(g.b)({customer:t,account_subscribers:n,subscription:n,product:a,service:r,plan:i,tax:o,usage:l});return"undefined"===typeof e||"all"===e?s:s.get(e)}),rE=Object(on.a)(function(e){return e.get("field_name","")},function(e){return e.get("generated",!1)},function(e,t){return t.get("hiddenFields",Object(g.a)())},function(e,t,n){return!t&&!n.includes(e)}),iE=Object(on.a)(function(e){return e.get("field_name","")},function(e,t){return t.get("unReorderFields",Object(g.a)())},function(e,t){return!t.includes(e)}),oE=Object(on.a)(function(e){return e.get("field_name","")},function(e){return e.get("system",!1)},function(e,t){return t.get("disabledFields",Object(g.a)())},function(e,t,n){return!t&&!n.includes(e)}),lE=Object(on.a)(function(e){return e},function(e){return Object(x.titleCase)(Y(["systemItems",W(e),"itemName"],G(e,"foreign")))}),sE=Object(on.a)(function(e){return e.getIn(["foreign","field"],"")},function(e,t){return t.get(W(e.getIn(["foreign","entity"],"")),Object(g.a)())},function(e,t){return t.reduce(function(t,n){return n.get("field_name","")===e?n.get("title",e):t},e)}),cE=Object(on.a)(function(){return Y("customFields",Object(g.b)())},function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.b)()).get("foreignFields",Object(g.b)())}),uE=Object(on.a)(cE,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.b)()).get("conditions",Object(g.a)())}),pE=Object(on.a)(uE,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.b)()).map(le).toArray()}),dE=Object(l.connect)(function(e,t){var n=t.field,a=t.fieldsConfig,r=oE(n,a),i=n.get("type","text");return{fieldTypeLabel:Y(["customFields","fields"],Object(g.a)()).find(function(e){return e.get("id","")===i},null,Object(g.b)()).get("title",i),isSortable:iE(n,a),isEditable:Ve(n,r),isRemoveable:Ve(n,r,"delete")}},function(e,t){return{}},function(e,t,n){var a=e.isEditable,r=e.isRemoveable,i=Object(pt.a)(e,["isEditable","isRemoveable"]),o=n.entity,l=n.onEdit,s=n.onRemove,c=(n.fieldsConfig,Object(pt.a)(n,["entity","onEdit","onRemove","fieldsConfig"])),u=function(e){return s(o,e)},p=function(e){return l(o,e)},d=[{type:"edit",onClick:p,enable:a},{type:"remove",onClick:u,enable:r}];return Object(Fo.a)({},i,t,c,{entity:o,actions:d,onRemove:u,onEdit:p})})(Object(et.SortableElement)(tE)),mE=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).getprintableFields=function(){var e=n.props,t=e.entity,a=e.fields,i=e.fieldsConfig,o=e.onRemove,l=e.onEdit,s=e.reordering;return a.reduce(function(e,n,a){return rE(n,i)?e.push(r.a.createElement(dE,{key:"item-".concat(t,"-").concat(n.get("field_name",""),"-").concat(a),index:a,disabled:!iE(n,i)||iE(n,i)&&!s,collection:t,entity:t,field:n,fieldsConfig:i,isReordable:s,onRemove:o,onEdit:l})):e},Object(g.a)())},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillUnmount",value:function(){var e=this.props,t=e.onReorederCancel;e.reordering&&t()}},{key:"render",value:function(){var e=this.props,t=e.fields,n=e.reordering,a=e.onReorder,i=e.onNew,o=e.onReorederStart,l=e.onReorederSave,s=e.onReorederCancel;return r.a.createElement("div",{className:"CustomFieldsList"},r.a.createElement(f.x,null,r.a.createElement(f.g,{xsHidden:!0,sm:1},"\xa0"),r.a.createElement(f.g,{xsHidden:!0,sm:2},r.a.createElement(f.h,null,"Key")),r.a.createElement(f.g,{xsHidden:!0,sm:3},r.a.createElement(f.h,null,"Title")),r.a.createElement(f.g,{xsHidden:!0,sm:1},r.a.createElement(f.h,null,"Type")),r.a.createElement(f.g,{xsHidden:!0,sm:3,className:"text-center"},r.a.createElement(f.h,null,"Default Value")),r.a.createElement(f.g,{xsHidden:!0,sm:2},"\xa0")),r.a.createElement(f.x,null,r.a.createElement(f.g,{sm:12,xsHidden:!0},r.a.createElement("hr",{style:{marginTop:5,marginBottom:0}}))),!t.isEmpty()&&r.a.createElement(nt,{lockAxis:"y",helperClass:"draggable-row",useDragHandle:!0,items:this.getprintableFields(),onSortEnd:a}),t.isEmpty()&&r.a.createElement(f.g,{sm:12,className:"text-center mb10"},"No custom field"),!n&&r.a.createElement(f.g,{sm:12,className:"mt10"},r.a.createElement(Je,{onClick:i,type:"Field",action:"Add",buttonStyle:{marginTop:0}}),!t.isEmpty()&&r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:o,title:"Change fields order",style:{float:"right",minWidth:90}},r.a.createElement("i",{className:"fa fa-arrows-alt"})," Reorder")),n&&r.a.createElement(f.g,{sm:12,className:"text-right mt10"},r.a.createElement(f.c,{bsSize:"xsmall",onClick:l,title:"Save new order",bsStyle:"primary",style:{minWidth:90,marginRight:10}},"Save order"),r.a.createElement(f.c,{bsSize:"xsmall",onClick:s,title:"Cancel new order",style:{minWidth:90}},"Cancel order")))}}]),t}(a.Component);mE.defaultProps={entity:"",fields:Object(g.a)(),fieldsConfig:Object(g.b)(),reordering:!1};var gE=mE,fE=Object(l.connect)(function(e,t){return{reordering:jo(e,t,"customFields","reorder.".concat(t.entity)),fieldsConfig:t.fieldsSettings.get(t.entity,Object(g.b)()).delete("fields"),fields:t.fieldsSettings.getIn([t.entity,"fields"])}},function(e,t){var n=t.entity,a=t.onNew,r=t.onReorder,i=t.onReorederSave,o=t.onReorederCancel,l=t.orderChanged;return{onNew:function(){return a(n)},onReorder:function(e){return r(n,e)},onReorederSave:function(){return i(n,!0===l)},onReorederCancel:function(){return o(n,!0===l)},onReorederStart:function(){return e(fo("customFields","reorder.".concat(n),!0))}}})(gE),hE=function(e){var t=e.field,n=e.actions,a=e.entitiesFieldsConfig;return r.a.createElement(f.g,{sm:12,className:"table-row row CustomFieldsListRow CustomFieldsListRow usage withHover"},r.a.createElement(f.g,{sm:2,style:{wordBreak:"break-all"}},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Title:\xa0")),t.get("title","")),r.a.createElement(f.g,{sm:2},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Entity:\xa0")),lE(t.getIn(["foreign","entity"],""))),r.a.createElement(f.g,{sm:2},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Entity Field:\xa0")),sE(t,a)),r.a.createElement(f.g,{sm:2,className:"text-center"},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Translate:\xa0")),Y(["customFields","foreignFields","translate",t.getIn(["foreign","translate","type"],""),"title"],"")),r.a.createElement(f.g,{sm:2,className:"text-center"},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Constition:\xa0")),t.get("conditions",Object(g.a)()).isEmpty()?"No":"Yes"),r.a.createElement(f.g,{sm:2,className:"actions"},r.a.createElement(Xe,{actions:n,data:t})),r.a.createElement(f.g,{sm:12},r.a.createElement("hr",{style:{marginTop:0,marginBottom:0}})))};hE.defaultProps={field:Object(g.b)(),entitiesFieldsConfig:Object(g.b)(),actions:[]};var vE=hE,yE=function(e){var t=e.fields,n=e.addAction,a=e.rowActions,i=e.entitiesFieldsConfig;return r.a.createElement("div",{className:"CustomFieldsList"},r.a.createElement(f.g,{sm:12,xsHidden:!0,className:"table-row row"},r.a.createElement(f.g,{sm:2},r.a.createElement(f.h,null,"Title")),r.a.createElement(f.g,{sm:2},r.a.createElement(f.h,null,"Entity")),r.a.createElement(f.g,{sm:2},r.a.createElement(f.h,null,"Entity Field")),r.a.createElement(f.g,{sm:2,className:"text-center"},r.a.createElement(f.h,null,"Translate")),r.a.createElement(f.g,{sm:2,className:"text-center"},r.a.createElement(f.h,null,"Condition")),r.a.createElement(f.g,{sm:2},"\xa0")),r.a.createElement(f.g,{sm:12,xsHidden:!0},r.a.createElement("hr",{style:{marginTop:5,marginBottom:15}})),!t.isEmpty()&&t.map(function(e,t){return r.a.createElement(vE,{key:t,field:e,actions:a,entitiesFieldsConfig:i})}),t.isEmpty()&&r.a.createElement(f.g,{sm:12,className:"text-center mb10"},"No foreign field"),r.a.createElement(f.g,{sm:12,className:"mt10"},r.a.createElement(Xe,{actions:n,data:"usage"})))};yE.defaultProps={fields:Object(g.a)(),entitiesFieldsConfig:Object(g.b)(),addAction:[],rowActions:[]};var bE=yE,EE=function(e){var t=e.condition,n=e.index,a=e.onRemove,i=e.onUpdate,o=e.error,l=e.conditionsFields,s=e.conditionsOperatorsSelectOptions,c=e.conditionField,u=e.conditionOperator,p=function(e){return["nin","in","$nin","$in"].includes(e)},d=t.getIn(["field"],""),m=t.getIn(["op"],""),h=""===d,v=""===m||h,y=p(m)?t.set("value",t.get("value",Object(g.a)()).join(",")):t,b=l.map(oe);return r.a.createElement(f.l,{className:"form-inner-edit-row",validationState:o?"error":null},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"condition_field"},"field")),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{id:"condition_field",fieldType:"select",options:b,onChange:function(e){var t=Object(g.b)({field:e,op:"",value:""});i([n],t)},value:d})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"condition_operator"},"Operator")),r.a.createElement(f.g,{sm:3},r.a.createElement(en,{id:"condition_operator",fieldType:"select",options:s,onChange:function(e){i([n,"op"],e);var a=t.getIn(["op"],"");if(p(a)!==p(e)){var r=p(e)?Object(g.a)():"";i([n,"value"],r)}},value:t.getIn(["op"],""),disabled:h})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"condition_value"},"Value")),r.a.createElement(f.g,{sm:4},r.a.createElement(Ud,{field:y,config:c,operator:u,disabled:v,onChange:function(e){var a=t.getIn(["op"],"");if(p(a)){var r=Object(g.a)(e.length?e.split(","):[]);i([n,"value"],r)}else i([n,"value"],e)}})),r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(f.c,{onClick:function(){a(n)},bsSize:"small",className:"pull-left"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))),o&&r.a.createElement(f.g,{sm:12},r.a.createElement(f.n,null,r.a.createElement("small",null,o))))};EE.defaultProps={condition:Object(g.b)(),conditionField:Object(g.b)(),conditionsFields:[],conditionOperator:Object(g.b)(),conditionsOperatorsSelectOptions:[],error:""};var CE=EE,_E=function(e){var t=e.item,n=e.mode,a=e.onChangeTitle,i=e.isErrorTitle,o=e.onChangeEntity,l=e.isErrorForeigEntity,s=e.foreignEntities,c=e.onChangeField,u=e.isErrorForeignField,p=e.foreignFields,d=e.onChangeTranslateType,m=e.isErrorForeignTranslateType,h=e.translateTypes,v=e.onChangeTranslateFormat,y=e.translateTypeFormats,b=e.foreignFieldsConditionsOperators,E=e.onAddCondition,C=e.onUpdateCondition,_=e.onRemoveCondition,O=e.isErrorConditions;return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(Lu,{field:Object(g.b)({title:"Title",field_name:"title",mandatory:!0}),entity:t,onChange:a,error:i}),r.a.createElement(Lu,{field:Object(g.b)({title:"Entity",field_name:"foreign.entity",mandatory:!0,select_list:!0,select_options:s}),entity:t,onChange:o,disabled:"edit"===n,error:l}),r.a.createElement(Lu,{field:Object(g.b)({title:"Entity Field",field_name:"foreign.field",mandatory:!0,select_list:!0,select_options:p}),entity:t,onChange:c,disabled:""===t.getIn(["foreign","entity"],"")||"edit"===n,error:u}),r.a.createElement(f.v,{header:"Translate"},r.a.createElement(Lu,{field:Object(g.b)({title:"Type",field_name:"foreign.translate.type",select_list:!0,select_options:h}),entity:t,onChange:d,error:m}),0!==y.length&&r.a.createElement(Lu,{field:Object(g.b)({title:"Format",field_name:"foreign.translate.format",select_list:!0,select_options:y}),entity:t,onChange:v})),r.a.createElement(f.v,{header:"Conditions"},r.a.createElement("div",{className:"fraud-event-conditions"},!t.get("conditions",Object(g.a)()).isEmpty()&&r.a.createElement(f.g,{sm:12,className:"form-inner-edit-rows"},r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"operator_field"},"Operator")),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"value_field"},"Value")))),r.a.createElement(f.g,{sm:12},t.get("conditions",Object(g.a)()).isEmpty()&&r.a.createElement("small",null,"No conditions found"),t.get("conditions",Object(g.a)()).map(function(e,t){return r.a.createElement(CE,{key:t,condition:e,index:t,conditionsFields:p,onUpdate:C,onRemove:_,conditionsOperatorsSelectOptions:b,error:O.get("".concat(t),"")})})),r.a.createElement(f.g,{sm:12,className:"pl0 pr0"},r.a.createElement(Je,{onClick:E,label:"Add Condition",disabled:""===t.getIn(["foreign","entity"],"")})))))};_E.defaultProps={item:Object(g.b)(),mode:"create",foreignEntities:[],foreignFields:[],translateTypes:[],translateTypeFormats:[],foreignFieldsConditionsOperators:[],isErrorTitle:!1,isErrorForeigEntity:!1,isErrorForeignField:!1,isErrorForeignTranslateType:!1,isErrorConditions:Object(g.b)()};var OE=_E,SE=n(125),TE=function(e){return function(t){var n=(Array.isArray(e)?e:[e]).map(function(e){return de(e,!1,["fields"])});return t(il(n))}},kE=function(e,t){return function(n){var a=de(e,!0,["fields"]),r=Object(SE.a)(a),i=r[0],o=r.slice(1);return n(Xo(i,t,o))}},IE=function(e,t){return function(n,a){var r=aE(a(),{},e).findIndex(function(e){return e.getIn(["field_name"],"")===t.getIn(["field_name"],"")});if(-1!==r){var i=de(e,!0,["fields",r]),o=Object(SE.a)(i),l=o[0],s=o.slice(1);return n(Zo(l,s,t))}return!1}},NE=function(e,t){return function(n,a){var r=aE(a(),{},e).findIndex(function(e){return e.getIn(["field_name"],"")===t.getIn(["field_name"],"")});if(-1!==r){var i=de(e,!0,["fields",r]),o=Object(SE.a)(i),l=o[0],s=o.slice(1);return n(el(l,s))}return!1}},wE=function(e){return function(t){return t(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(t){var n=(Array.isArray(e)?e:[e]).map(function(e){return de(e,!1,["fields"])});return t(rl(n))}}(e)).then(function(e){return!!e.status||Promise.reject()}).then(function(){return t(TE(e))}).catch(function(){return t(TE(e)).then(function(){return Promise.reject()})})}},jE=function(e){return fo("customFields",e)},RE=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return""!==e||"".concat(t," is required")},xE=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return RE(e,"Title")},FE=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return RE(e,"Entity")},PE=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return RE(e,"Entity Field")},ME=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(g.a)();return Y("fieldKeyRegex","").test(e)?""===e?"Key is required":!t.includes(e)||"Key already exists":"Key contains illegal characters, field name should contain only alphabets, numbers and underscores (A-Z, a-z, 0-9, ., _)"},AE=function(e){var t=Object(g.b)().withMutations(function(t){e.forEach(function(e,n){var a=function(e){var t=e.has("field")&&""===e.get("field",""),n=e.has("op")&&""===e.get("op",""),a=e.has("value")&&(""===e.get("value","")||Object(g.d)(e.get("value",Object(g.a)()),Object(g.a)()));return t?"Conditions field can not be empty":n?"Conditions operator can not be empty":!a||"Conditions value can not be empty"}(e);!0!==a&&t.set(n,a)})});return!!t.isEmpty()||t},DE=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(g.a)();return function(n){var a=!0,r=e.getIn(["foreign","entity"],""),i=e.getIn(["foreign","field"],""),o=e.get("conditions",Object(g.a)()),l=xE(e.get("title",""));!0!==l&&(a=!1,n(go("title",l)));var s=FE(r);!0!==s&&(a=!1,n(go("foreign.entity",s)));var c=PE(i);if(!0!==c&&(a=!1,n(go("foreign.field",c))),!t.isEmpty()){var u=t.reduce(function(e,t){var n=t.getIn(["foreign","entity"],""),a=t.getIn(["foreign","field"],"");return r===n&&i===a?t:e},!1);if(u){a=!1;var p=Object(x.titleCase)(Y(["systemItems",K(e.getIn(["foreign","entity"],"")),"itemName"],e.getIn(["foreign","entity"],""))),d=Object(x.titleCase)(G(e.getIn(["foreign","field"],""),K(e.getIn(["foreign","entity"],"")))),m=u.get("title",u.get("field_name","")),f="Foreign field ".concat(d," from entity ").concat(p," already exists with title '").concat(m,"'");n(go("foreign.field",f))}}var h=!!o.isEmpty()||AE(o);return!0!==h&&(a=!1,h.forEach(function(e,t){n(go("conditions.".concat(t),e))})),a}},LE=function(e,t){return"foreign.".concat(e,".").concat(t)},UE=Object(g.b)({field:"",op:"",value:""}),VE=Object(l.connect)(function(e,t){var n=t.item,a=void 0===n?Object(g.b)():n,r=t.errors,i=void 0===r?Object(g.b)():r,o=t.entity,l=void 0===o?"":o,s=pE(e,t),c=W(a.getIn(["foreign","entity"],"")),u=(aE(e,t)||Object(g.b)()).get(c,Object(g.a)()).map(function(e){return Object(g.b)({value:e.get("field_name",""),label:e.get("title","")})}).toArray(),p=Y(["customFields","foreignFields","entities",l],Object(g.a)()).map(function(e){return Object(g.b)({value:Y(["customFields","entities",e],e),label:lE(e)})}).toList().toArray(),d=Y(["customFields","foreignFields","translate"],Object(g.b)()).map(function(e,t){return Object(g.b)({value:t,label:e.get("title",Object(x.titleCase)(t))})}).toList().toArray(),m=g.b.isMap(a)?a.getIn(["foreign","translate","type"],""):"",f=Y(["customFields","foreignFields","translate",m,"options"],Object(g.a)()).map(function(e){return Object(g.b)({value:e,label:e})}).toArray(),h=i.reduce(function(e,t,n){return"conditions"===n.split(".")[0]?e.set(n.split(".")[1],t):e},Object(g.b)());return{foreignFields:u,foreignEntities:p,translateTypes:d,translateTypeFormats:f,foreignFieldsConditionsOperators:s,isErrorTitle:i.get("title",!1),isErrorForeigEntity:i.get("foreign.entity",!1),isErrorForeignField:i.get("foreign.field",!1),isErrorForeignTranslateType:i.get("foreign.translate.type",!1),isErrorConditions:h}},function(e,t){var n=t.item,a=void 0===n?Object(g.b)():n,r=t.updateField,i=t.removeField,o=t.setError;return{onChangeTitle:function(e,t){var n=e.join("."),a=xE(t);!0!==a?o(n,a):o(n),r(e,t)},onChangeEntity:function(e,t){var n=e.join("."),a=FE(t);!0!==a?o(n,a):o(n),r(["foreign"],Object(g.b)({entity:t})),r(["conditions"],Object(g.a)()),r("field_name",LE(t,""))},onChangeField:function(e,t){var n=e.join("."),i=PE(t);!0!==i?o(n,i):o(n),r(e,t),r("field_name",LE(a.getIn(["foreign","entity"],""),t))},onChangeTranslateType:function(e,t){var n=["foreign","translate"];""!==t?r(n,Object(g.b)({type:t})):i(n)},onChangeTranslateFormat:function(e,t){""!==t?r(e,t):i(e)},onAddCondition:function(){var e=a.get("conditions",Object(g.a)()),t=!!e.isEmpty()||AE(e);!0!==t?t.forEach(function(e,t){o("conditions.".concat(t),e)}):r("conditions",e.push(UE))},onUpdateCondition:function(e,t){o("conditions.".concat(e[0])),r(["conditions"].concat(Object(w.a)(e)),t)},onRemoveCondition:function(e){o("conditions.".concat(e)),r("conditions",a.get("conditions",Object(g.a)()).delete(e))}}})(OE),BE=Object(g.b)({field_name:"",title:"",foreign:Object(g.b)({entity:"",field:""})}),qE=Object(l.connect)(function(e,t){var n=aE(e,t)||Object(g.b)();return{fields:n.get("usage"),entitiesFieldsConfig:n}},function(e,t){return{onNew:function(t,n){var a=Y(["systemItems",t,"itemName"],t),r={title:Object(x.titleCase)("".concat("create"," new ").concat(a," foreign field")),onOk:function(a){return!!e(DE(a,n))&&(e(kE(t,a)),e(wE(t)))},mode:"create",entity:t};return e(mo(BE,VE,r))},onEdit:function(t){var n=Y(["systemItems","usage","itemName"],"usage"),a={title:"".concat(Object(x.titleCase)("".concat("edit"," ").concat(n," foreign field"))," - ").concat(t.get("title","")),onOk:function(t){return!!e(DE(t))&&(e(IE("usage",t)),e(wE("usage")))},mode:"edit",entity:"usage"};return e(mo(t,VE,a))},onRemove:function(t){var n={message:'Are you sure you want to delete "'.concat(t.get("title",t.get("field_name","")),'" foreign field?'),onOk:function(){return e(NE("usage",t)),e(wE("usage"))},labelOk:"Delete",type:"delete"};return e(po(n))}}},function(e,t,n){var a=e.fields,r=t.onEdit,i=t.onRemove,o=t.onNew,l=Object(pt.a)(t,["onEdit","onRemove","onNew"]),s=[{type:"add",onClick:function(e){return o(e,a)},label:"Add new foreign field",actionStyle:"primary",actionSize:"xsmall"}],c=[{type:"edit",onClick:r},{type:"remove",onClick:i}];return Object(Fo.a)({},e,l,n,{addAction:s,rowActions:c})})(bE),zE=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).renderUsageTab=function(){var e=n.props.tabs,t=Object(x.titleCase)(Y(["systemItems","usage","itemName"],"usage"));return r.a.createElement(f.y,{title:t,eventKey:e.size,key:"custom-fields-tab-".concat("usage")},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(qE,null)))},n.renderTab=function(e,t){var a=n.props,i=a.fieldsSettings,o=a.onReorder,l=a.onNew,s=a.onRemove,c=a.onEdit,u=a.onSave,p=a.onCancel,d=a.orderChanged,m=Object(x.titleCase)(Y(["systemItems",e,"itemName"],e));return r.a.createElement(f.y,{title:m,eventKey:t,key:"custom-fields-tab-".concat(e)},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(fE,{entity:e,fieldsSettings:i,onReorder:o,onNew:l,onRemove:s,onEdit:c,onReorederSave:u,onReorederCancel:p,orderChanged:d.get(e,!1)})))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props;(0,e.loadFields)(e.tabs.toJS())}},{key:"componentWillUnmount",value:function(){(0,this.props.clearFlags)()}},{key:"render",value:function(){var e=this.props,t=e.location,n=e.tabs.filter(function(e){return"usage"!==e}).map(this.renderTab).push(this.renderUsageTab());return r.a.createElement("div",null,r.a.createElement(Ei,{id:"CustomFieldsTabs",location:t},n))}}]),t}(a.Component);zE.defaultProps={tabs:Object(g.a)(),fieldsSettings:Object(g.b)(),orderChanged:Object(g.b)()};var HE=zE,YE=function(e){var t=e.item,n=e.onChangeOptions,a=e.onChangePlay,i=e.onChangeType,o=e.onChangeTitle,l=e.onChangeFieldName,s=e.onChangeEntityField,c=e.disableUnique,u=e.disableMandatory,p=e.disableFieldType,d=e.disabledEditable,m=e.disabledDisplay,h=e.disabledShowInList,v=e.disableSearchable,y=e.disableMultiple,b=e.disableSelectList,E=e.disableSelectOptions,C=e.disableTitle,_=e.disableFieldName,O=e.disableHelp,S=e.disableDescription,T=e.disableDefaultValue,k=e.isErrorTitle,I=e.isErrorFieldName,N=e.fieldTypesOptions,w=e.playsOptions,j=e.fieldType,R=e.showPlays,x=e.plays,F=e.checkboxStyle,P=e.helpTextStyle;return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(Lu,{field:Object(g.b)({title:"Key",field_name:"field_name",mandatory:!0}),entity:t,disabled:_,onChange:l,error:I}),r.a.createElement(Lu,{field:Object(g.b)({title:"Title",field_name:"title",mandatory:!0}),entity:t,disabled:C,onChange:o,error:k}),!p&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Field Type"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"select",options:N,onChange:i,value:j,disabled:p,clearable:!1}))),R&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Play"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(en,{fieldType:"select",options:w,onChange:a,value:x,multi:!0,clearable:!0}))),!S&&r.a.createElement(Lu,{field:Object(g.b)({title:"Description",field_name:"description",description:"Long text will appear in question mark after the field label"}),entity:t,onChange:s,disabled:S}),!O&&r.a.createElement(Lu,{field:Object(g.b)({title:"Help Text",field_name:"help",description:"Short text will appear below the field"}),entity:t,onChange:s,disabled:O}),r.a.createElement(f.v,{header:"Options"},!c&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Unique"),r.a.createElement(f.g,{sm:8,lg:9,style:F},r.a.createElement(en,{id:"unique",onChange:n,value:t.get("unique",""),fieldType:"checkbox",disabled:c,className:"inline mr10"}))),(!u||u&&t.get("unique",!1))&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Mandatory"),r.a.createElement(f.g,{sm:8,lg:9,style:F},r.a.createElement(en,{id:"mandatory",onChange:n,value:t.get("mandatory",""),fieldType:"checkbox",disabled:u,className:"inline mr10"}),u&&t.get("unique",!1)&&r.a.createElement("small",{style:P},"Unique field must be mandatory"))),!d&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Editable"),r.a.createElement(f.g,{sm:8,lg:9,style:F},r.a.createElement(en,{fieldType:"checkbox",id:"editable",onChange:n,value:t.get("editable",""),disabled:d,className:"inline mr10"}))),!m&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Display"),r.a.createElement(f.g,{sm:7,style:F},r.a.createElement(en,{fieldType:"checkbox",id:"display",onChange:n,value:t.get("display",""),disabled:m,className:"inline mr10"}))),!h&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Show in list"),r.a.createElement(f.g,{sm:8,lg:9,style:F},r.a.createElement(en,{fieldType:"checkbox",id:"show_in_list",onChange:n,value:t.get("show_in_list",""),disabled:h,className:"inline mr10"}))),!v&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Searchable"),r.a.createElement(f.g,{sm:8,lg:9,style:F},r.a.createElement(en,{fieldType:"checkbox",id:"searchable",className:"inline mr10",onChange:n,value:t.get("searchable",""),disabled:v}))),!y&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Multiple"),r.a.createElement(f.g,{sm:8,lg:9,style:F},r.a.createElement(en,{id:"multiple",onChange:n,value:t.get("multiple",""),fieldType:"checkbox",disabled:y,className:"inline mr10"}))),(!b||!E)&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Select list"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement(en,{id:"select_list",onChange:n,value:t.get("select_list",""),fieldType:"checkbox",disabled:b})),r.a.createElement(en,{id:"select_options",onChange:n,value:t.get("select_options",""),disabled:E})),r.a.createElement(f.n,{style:{marginLeft:40}},"Select Options ",r.a.createElement("small",null,"(comma-separated list)"))))),(!T||T&&t.get("unique",!1))&&r.a.createElement(f.v,{header:"Preview and Default Value"},r.a.createElement(Lu,{field:t.set("field_name","default_value"),entity:t,onChange:s,disabled:T||t.get("unique",!1)}),t.get("unique",!1)&&r.a.createElement(f.n,{className:"text-center"},"Default value can't be set for unique field")))};YE.defaultProps={item:Object(g.b)(),fieldTypeLabel:"",isErrorTitle:!1,isErrorFieldName:!1,disableUnique:!1,disableMandatory:!1,disableFieldType:!1,disabledEditable:!1,disabledDisplay:!1,disabledShowInList:!1,disableSearchable:!1,disableMultiple:!1,disableSelectList:!1,disableSelectOptions:!1,disableTitle:!1,disableFieldName:!1,disableHelp:!1,disableDescription:!1,disableDefaultValue:!1,fieldTypesOptions:[],fieldType:"",showPlays:!1,plays:"",playsOptions:[],checkboxStyle:{},helpTextStyle:{}};var GE=YE,KE=Object(l.connect)(function(e,t){var n=t.item,a=t.mode,r=t.entity,i=n.get("type","text"),o=Y(["customFields","fields"],Object(g.a)()),l=o.filter(function(e){return!Ae(e,r,"excludeEntity")&&De(e,r,"includeEntity")}).map(le).toArray(),s=o.find(function(e){return e.get("id","")===i},null,Object(g.b)()),c=oE(n,o),u=Rn(e,t)||Object(g.a)(),p=u.map(function(e){return{value:e.get("name",""),label:e.get("label",e.get("name",""))}}).toArray(),d=["subscription"].includes(r)&&u.size>1;return{availablePlays:Rn(e,t),fieldType:i,fieldTypeLabel:s.get("title",i),fieldTypesOptions:l,playsOptions:p,showPlays:d,checkboxStyle:{marginTop:10,paddingLeft:26},helpTextStyle:{color:"#626262",verticalAlign:"text-top"},plays:n.get("plays",[]).join(","),disableTitle:Ae(s,"title")||!Ve(n,c,"title"),disableFieldName:"create"!==a,disableUnique:Ae(s,"unique")||!Ve(n,c,"unique"),disableMandatory:Ae(s,"mandatory")||!Ve(n,c,"mandatory")||n.get("unique",!1),disableFieldType:Ae(s,"type")||!Ve(n,c,"type"),disabledEditable:Ae(s,"editable")||!Ve(n,c,"editable"),disabledDisplay:Ae(s,"display")||!Ve(n,c,"display"),disabledShowInList:Ae(s,"show_in_list")||!Ve(n,c,"show_in_list"),disableSearchable:Ae(s,"searchable")||!Ve(n,c,"searchable"),disableMultiple:Ae(s,"multiple")||!Ve(n,c,"multiple"),disableSelectList:Ae(s,"select_list")||!Ve(n,c,"select_list"),disableSelectOptions:!n.get("select_list",!1)||!Ve(n,c,"select_options"),disableHelp:Ae(s,"help")||!Ve(n,c,"help"),disableDescription:Ae(s,"description")||!Ve(n,c,"description"),disableDefaultValue:Ae(s,"default_value")||!Ve(n,c,"default_value"),isErrorTitle:t.errors&&t.errors.get("title",!1),isErrorFieldName:t.errors&&t.errors.get("fieldName",!1)}},function(e,t){var n=t.item,a=void 0===n?Object(g.b)():n,r=t.existingFields,i=void 0===r?Object(g.a)():r,o=t.updateField,l=t.removeField,s=t.setError;return{onChangeTitle:function(e,t){var n=xE(t);!0!==n?s("title",n):s("title"),o("title",t)},onChangeFieldName:function(e,t){var n=ME(t,i);!0!==n?s("fieldName",n):s("fieldName"),o("field_name",t)},onChangeEntityField:function(e,t){["description","help"].includes(e[0])&&""===t?l(e):"default_value"===e[0]?"ranges"===a.get("type","text")&&t.isEmpty()?l("default_value"):""===t?l("default_value"):o(e,t):o(e,t)},onChangeOptions:function(e){var t=e.target,n=t.id,r=t.value;"unique"===n?!0===r?(o("unique",!0),o("mandatory",!0),l("default_value")):l("unique"):"select_list"===n?!0===r?(o("select_list",!0),o("select_options",a.get("select_options",""))):(l("select_list"),l("select_options")):"select_options"===n?o("select_options",r):!0===r?o(n,!0):l(n)},onChangePlay:function(e){o("plays",Object(g.a)(e.split(",")))},onChangeType:function(e){var t=a.get("type","text"),n=Y(["customFields","fields"],Object(g.a)()).find(function(t){return t.get("id","")===e},null,Object(g.b)()),r=Y(["customFields","fields"],Object(g.a)()).find(function(e){return e.get("id","")===t},null,Object(g.b)());"text"===e?l("type"):o("type",e),n.get("type","")!==r.get("type","")&&(n.has("defaultValue")?o("default_value",n.get("defaultValue")):l("default_value")),a.forEach(function(e,t){Ae(n,t)&&l(t)})}}},function(e,t,n){n.entity,n.errors,n.existingFields,n.mode,n.removeField,n.setError,n.setItem,n.updateField;var a=Object(pt.a)(n,["entity","errors","existingFields","mode","removeField","setError","setItem","updateField"]);return Object(Fo.a)({},a,e,t)})(GE),WE=Object(g.b)({field_name:"",title:"",editable:!0,display:!0}),JE=Object(l.connect)(function(e,t){var n=Y(["customFields","entities"],Object(g.b)()).keySeq().toList(),a=n.reduce(function(n,a){return n.set(a,Object(g.b)({fields:aE(e,t,a)||Object(g.a)(),hiddenFields:Y(["customFields","defaultHiddenFields",a],Object(g.a)()),disabledFields:Y(["customFields","defaultDisabledFields",a],Object(g.a)()),unReorderFields:Y(["customFields","unReorderFields",a],Object(g.a)())}))},Object(g.b)()),r=n.reduce(function(n,a){return n.set(a,jo(e,t,"customFields","orderChanged.".concat(a)))},Object(g.b)());return{tabs:n,fieldsSettings:a,orderChanged:r}},function(e,t){return{loadFields:function(t){return e(TE(t))},clearFlags:function(){return e(fo("customFields"))},onRemove:function(t,n){var a={message:'Are you sure you want to delete "'.concat(n.get("title",n.get("field_name","")),'" field?'),onOk:function(){return e(NE(t,n)),e(wE(t))},labelOk:"Delete",type:"delete"};return e(po(a))},onEdit:function(t,n){var a=Y(["systemItems",t,"itemName"],t),r={title:"".concat(Object(x.titleCase)("".concat("edit"," ").concat(a," field"))," - ").concat(n.get("title","")),onOk:function(n){return e(IE(t,n)),e(wE(t))},mode:"edit",entity:t};return e(mo(n,KE,r))},onNew:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(g.a)(),a=Y(["customFields","fields"],Object(g.a)()).filter(function(e){return!Ae(e,t,"excludeEntity")&&De(e,t,"includeEntity")}).reduce(function(e,t){return e.push(t.get("id",""))},Object(g.a)());if(a.isEmpty())return e(Ja("No available field types "));var r=Y(["systemItems",t,"itemName"],t),i={title:Object(x.titleCase)("".concat("create"," new ").concat(r," field")),onOk:function(a){var r,i,o="tax"!==t?a:a.withMutations(function(e){var t=a.get("field_name");t.startsWith("params.")||e.set("field_name","params.".concat(t))});return!!e((r=o,i=n,function(e){var t=!0,n=xE(r.get("title",""));!0!==n&&(t=!1,e(go("title",n)));var a=ME(r.get("field_name",""),i);return!0!==a&&(t=!1,e(go("fieldName",a))),t}))&&(e(kE(t,o)),e(wE(t)))},mode:"create",entity:t,existingFields:n},o=a.includes("text")?WE:WE.set("type",a.first());return e(mo(o,KE,i))},onReorder:function(t,n){var a,r=n.oldIndex,i=n.newIndex;if(r===i)return!0;e((a="orderChanged.".concat(t),fo("customFields",a,!0)));var o=de(t,!0,["fields"]);return e(function(e,t,n){return{type:Wo,oldIndex:e,newIndex:t,path:n}}(r,i,o))},onCancel:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e(jE("reorder.".concat(t))),e(jE("orderChanged.".concat(t))),!n||e(TE(t))},onSave:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e(jE("reorder.".concat(t))),e(jE("orderChanged.".concat(t))),!n||e(wE(t))}}},function(e,t,n){n.children,n.dispatch,n.history,n.params,n.route,n.routeParams,n.routes;var a=Object(pt.a)(n,["children","dispatch","history","params","route","routeParams","routes"]),r=e.fieldsSettings,i=t.onNew,o=Object(pt.a)(t,["onNew"]);return Object(Fo.a)({},a,e,o,{onNew:function(e){var t=r.getIn([e,"fields"],Object(g.a)()).map(function(e){return Object(x.lowerCase)(e.get("field_name",""))});return i(e,t)}})})(HE),QE=function(){return Y("events",g.c.Map())},$E=Object(on.a)(QE,function(e,t){return t.eventType},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1?arguments[1]:void 0;return e.getIn(["operators",t,"conditions"],g.c.List())}),ZE=Object(on.a)($E,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).map(le).toArray()}),XE=Object(on.a)(QE,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("conditionsFields",g.c.List())}),eC=Object(on.a)(Kn,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List()).filter(Le).filter(Ue)}),tC=Object(on.a)(XE,eC,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.List();return g.c.List().withMutations(function(n){t.forEach(function(e){e.withMutations(function(t){t.set("title",Fe(e).get("title","")),t.set("type","string"),t.set("id",e.get("field_name")),n.push(t)})}),e.forEach(function(e){n.push(Fe(e,null,"id"))})})}),nC=Object(on.a)(tC,function(e,t){return t.condition.get("field")},function(e,t){return t.usedFields},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.filter(function(e){return e.get("id","")===t||!n.includes(e.get("id",""))}).sort(Me).map(le).toArray()}),aC=Object(on.a)(QE,function(e,t){return t.eventType},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1?arguments[1]:void 0;return e.getIn(["operators",t,"threshold"],g.c.List())}),rC=Object(on.a)(aC,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).map(le).toArray()}),iC=Object(on.a)(QE,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("thresholdFields",g.c.List()).map(function(e){return Fe(e,null,"id")})}),oC=Object(on.a)(tC,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).filter(function(e){return e.get("effectOnUsaget",!1)}).map(function(e){return e.get("id","")})}),lC=Object(on.a)(Xr,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).getIn(["ui_flags","eventUsageType"],g.c.Map())}),sC=Object(on.a)(lC,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("usaget",g.c.List())}),cC=Object(on.a)(lC,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map()).get("arate_key",g.c.List())}),uC=Object(on.a)(lC,bn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.List();return g.c.Set().withMutations(function(n){t.filter(function(t,n){return e.get("type",g.c.List()).includes(n)}).forEach(function(e){n.union(e)})})}),pC=Object(on.a)(Ca,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return g.c.Map().withMutations(function(t){e.forEach(function(e){var n=e.get("rates",g.c.Map()).keySeq().first();t.set(e.get("key",""),n)})})}),dC=Object(on.a)(cC,pC,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Map();return e.reduce(function(e,n){return e.push(t.get(n,""))},g.c.List())}),mC=Object(on.a)(Un,uC,sC,dC,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.List(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.c.List(),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.c.List(),r=g.c.List().withMutations(function(r){[t,n,a].forEach(function(t){if(!t.isEmpty()){var n=t.map(function(t){return e.find(function(e){return e.get("usage_type","")===t},null,g.c.Map()).get("property_type","")});r.push(n.filter(function(e){return""!==e}))}})});return r.isEmpty()?g.c.Set():1===r.size?g.c.Set(r.first()):g.c.Set(r.reduce(function(e,t){return e.filter(function(e){return t.includes(e)})}))}),gC=Object(on.a)(iC,mC,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Set();return e.filter(function(e){var n=e.get("allowedWithUsage",g.c.List());return!!n.isEmpty()||(t.isEmpty()?n.includes("empty"):1===t.size?n.includes("single"):n.includes("multiple"))}).sort(Me).map(le).toArray()}),fC=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=n.get("conditions",g.c.List()).withMutations(function(n){n.forEach(function(r,i){var o=r.get("unit",""),l=r.get("usaget","");if(""!==o&&""!==l){var s=r.get("value",0),c=be(e,t,l,o,s,a);n.setIn([i,"value"],c)}})});return r.isEmpty()?g.c.List():r},hC=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=n.getIn(["threshold_conditions",0],g.c.List()).withMutations(function(n){n.forEach(function(r,i){var o=r.get("unit",""),l=r.get("usaget",""),s=r.get("value",0);if(""!==o&&""!==l)if(g.c.List.isList(s)||Array.isArray(s)){var c=s.map(function(n){var r=be(e,t,l,o,n,a);return R()(r)?parseFloat(r):r});n.setIn([i,"value"],c)}else{var u=be(e,t,l,o,s,a),p=R()(u)?parseFloat(u):u;n.setIn([i,"value"],p)}!a&&g.c.Iterable.isIterable(s)&&n.setIn([i,"value"],s.toList()),a||g.c.Iterable.isIterable(s)||!["in","nin"].includes(r.get("op",""))||n.setIn([i,"value"],g.c.List([s]))})});return r.isEmpty()?g.c.List():r},vC=function(e,t,n){return e.withMutations(function(e){var a=n.propertyTypes,r=n.usageTypesData;if(e.delete("ui_flags"),"fraud"===t){var i=e.getIn(["conditions",0],g.c.List()).filter(function(e){return""!==e.get("field","")&&e.get("op","")});e.setIn(["conditions",0],i)}e.set("conditions",fC(a,r,e,!0)),e.setIn(["threshold_conditions",0],hC(a,r,e,!0))})},yC=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(t,n){var a=""===e?"events":"events.".concat(e);return t(il(a)).then(function(){var a=n(),r={usageTypesData:Un(a),propertyTypes:Vn(a),effectOnUsagetFields:oC(a,{eventType:"fraud"})};a.settings.get("events",g.c.List()).forEach(function(n,a){if(!["settings"].includes(a)&&(""===e||e===a)){var i=n.map(function(e){return function(e,t,n){return e.withMutations(function(a){var r=n.propertyTypes,i=n.usageTypesData,o=n.effectOnUsagetFields,l=g.c.Map().withMutations(function(n){"fraud"===t&&e.getIn(["conditions",0]).forEach(function(e){o.includes(e.get("field",""))&&n.set(e.get("field",""),e.get("value",g.c.List()))})}),s=g.c.Map({id:Mt.a.v4(),eventUsageType:l});a.set("conditions",fC(r,i,e,!1)),a.setIn(["threshold_conditions",0],hC(r,i,e,!1)),a.set("ui_flags",s)})}(e,a,r)});t(Zo("events",a,i))}})})}},bC=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(t,n){var a=n(),r=Un(a),i=Vn(a),o=a.settings.get("events",g.c.List()),l={usageTypesData:r,propertyTypes:i};o.forEach(function(n,a){if(!["settings"].includes(a)&&(""===e||e===a)){var r=n.map(function(e){return vC(e,a,l)});t(Zo("events",a,r))}});var s=""===e?"events":"events.".concat(e);return t(rl([s]))}},EC=function(e,t){return function(n,a){var r=a(),i=Un(r),o=Vn(r),l=vC(t,e,{usageTypesData:i,propertyTypes:o}),s="event.".concat(e),c=br(l,s);return ir(c).then(function(e){return n(tr(e))}).catch(function(e){return n(nr(e))})}},CC=function(e,t){return function(n,a){var r=da(a(),{eventType:e}).findIndex(function(e){return e.getIn(["ui_flags","id"],"")===t.getIn(["ui_flags","id"],"")});return-1!==r?n(Zo("events",[e,r],t)):Promise.reject()}},_C=function(e){return function(t){return t(hr("event_products",zr(e.toArray(),{key:1,rates:1})))}},OC=function(){return""!==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")||"Event Code is required"},SC=function(){return""!==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")||"Field is required"},TC=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return""===e.get("field","")?"Threshold field is required":""===e.get("op","")?"Threshold Operator is required":!["",[]].includes(e.get("value",""))&&!g.c.is(g.c.List(),e.get("value",g.c.List()))||"Threshold value is required"},kC=function(e,t){return function(n){var a=!0,r=OC(e.get("event_code",""));if(!0!==r&&(a=!1,n(go("event_code",r))),"fraud"===t){var i=SC(e.getIn(["recurrence","value"],""));!0!==i&&(a=!1,n(go("recurrence.value",i)));var o=SC(e.getIn(["date_range","value"],""));!0!==o&&(a=!1,n(go("date_range.value",o)));var l=e.getIn(["threshold_conditions",0],g.c.List());l.isEmpty()?(a=!1,n(go("threshold_condition.0",TC()))):l.forEach(function(e,t){var r=TC(e);!0!==r&&(a=!1,n(go("threshold_condition.".concat(t),r)))})}return a}},IC=function(e){var t,n=e.eventsSettings,a=e.methodOptions,i=e.decoderOptions,o=Object(pt.a)(e,["eventsSettings","methodOptions","decoderOptions"]),l=function(e,t){return function(n){o.onEdit(e,t,n)}};return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{header:"HTTP",key:"http"},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Url ",r.a.createElement(Ii,{contents:"URL to send the requests to"})),r.a.createElement(f.g,{sm:6},r.a.createElement(en,{id:"url",value:n.getIn(["http","url"],""),onChange:(t="http",function(e){var n=e.target,a=n.value,r=n.id;o.onEdit(t,r,a)})}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Method ",r.a.createElement(Ii,{contents:"HTTP method"})),r.a.createElement(f.g,{sm:6},r.a.createElement(en,{fieldType:"select",value:n.getIn(["http","method"],""),onChange:l("http","method"),options:a}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Decoder ",r.a.createElement(Ii,{contents:"Method to decode HTTP response"})),r.a.createElement(f.g,{sm:6},r.a.createElement(en,{fieldType:"select",value:n.getIn(["http","decoder"],""),onChange:l("http","decoder"),options:i})))),r.a.createElement(f.v,{header:"Mail",key:"mail"},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Mails ",r.a.createElement(Ii,{contents:"Send events to the following email addresses (For supported events)"})),r.a.createElement(f.g,{sm:6},r.a.createElement(en,{fieldType:"tags",value:n.getIn(["email","global_addresses"],g.c.List()).toArray(),onChange:function(e){o.onEdit("email","global_addresses",g.c.List(e))},addOnPaste:!0,pasteSplit:function(e){return e.split(new RegExp([",",";","\\(","\\)","\\*","/",":","\\?","\n","\r","\t"].join("|"))).map(function(e){return e.trim()})}}))))),r.a.createElement(f.g,{sm:12},r.a.createElement(v,{onClickSave:o.onSave,onClickCancel:o.onCancel})))};IC.defaultProps={eventsSettings:g.c.Map(),methodOptions:[{value:"post",label:"POST"},{value:"get",label:"GET"}],decoderOptions:[{value:"json",label:"JSON"},{value:"xml",label:"XML"}]};var NC=IC,wC=Object(l.connect)(function(e,t){return{eventsSettings:ra(e,t)}},function(e){return{onCancel:function(){var t={message:"Are you sure you want to cancel event settings changes?",onOk:function(){e(function(e){return e(il(["events.settings"]))})},labelOk:"Yes",labelCancel:"No",type:"delete"};return e(po(t))},onEdit:function(t,n,a){e(function(e,t){return function(n){return n(Zo("events",["settings"].concat(Object(w.a)(e)),t))}}([t,n],a))},onSave:function(){e(function(e){return e(rl(["events.settings"]))})}}})(NC),jC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).parseShowEnable=function(e){return!e.get("active",!0)},n.parseShowDisable=function(e){return!n.parseShowEnable(e)},n.parserStatus=function(e){return r.a.createElement(N,{status:e.get("active",!0)?"active":"expired"})},n.parserThreshold=function(e){var t=n.props.thresholdFields;return e.getIn(["threshold_conditions",0],g.c.List()).map(function(e){return e.get("field","")}).map(function(e){return t.find(function(t){return t.get("id","")===e},null,g.c.Map()).get("title",Object(x.sentenceCase)(e))}).join(", ")},n.getListFields=function(){var e=n.props.eventType,t=[{id:"active",title:"Status",parser:n.parserStatus,cssClass:"state"},{id:"event_code",title:"Event Code"},{id:"event_description",title:"Description"}];return"fraud"===e&&t.push({id:"threshold",title:"Threshold",parser:n.parserThreshold}),t},n.getListActions=function(){return[{type:"enable",showIcon:!0,helpText:"Enable",onClick:n.props.onEnable,show:n.parseShowEnable},{type:"disable",showIcon:!0,helpText:"Disable",onClick:n.props.onDisable,show:n.parseShowDisable},{type:"edit",showIcon:!0,helpText:"Edit",onClick:n.props.onEdit},{type:"clone",showIcon:!0,helpText:"Clone",onClick:n.props.onClone},{type:"remove",showIcon:!0,helpText:"Remove",onClick:n.props.onRemove}]},n.getPanelActions=function(){return[{type:"add",actionStyle:"primary",actionSize:"xsmall",label:"Add new",onClick:n.props.onNew}]},n.renderPanelHeader=function(){return r.a.createElement("div",null,"\xa0",r.a.createElement("div",{className:"pull-right"},r.a.createElement(Xe,{actions:n.getPanelActions()})))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.items,t=this.getListFields(),n=this.getListActions();return r.a.createElement("div",null,r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{header:this.renderPanelHeader()},r.a.createElement(ec,{items:e,fields:t,actions:n}))))}}]),t}(a.Component);jC.defaultProps={items:g.c.List(),thresholdFields:g.c.List()};var RC=jC,xC=function(e){return Y(["events","operators","balance","conditions"],g.c.Map()).find(function(t){return t.get("id","")===e},null,g.c.Map())},FC=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};switch(t){case"group":return"balance.groups.".concat(n.groupName,".").concat(e);case"activity_type":return n.hasOwnProperty("overGroup")&&"over_group"===n.overGroup?"balance.totals.".concat(n.activityType,".over_group.").concat(e):"balance.totals.".concat(n.activityType,".").concat(e);case"none":default:return"balance.cost"}},PC=function(e){return e.substr(e.lastIndexOf(".")+1)},MC=function(e){return-1!==e.indexOf(".over_group.")?"over_group":"none"},AC=function(e,t){if("activity_type"!==t)return"";var n="over_group"===MC(e)?e.lastIndexOf(".over_group"):e.lastIndexOf(".");return e.substring(e.lastIndexOf(".totals.")+8,n)},DC=function(e,t){return"group"===t?e.substring(e.lastIndexOf(".groups.")+8,e.lastIndexOf(".")):""},LC=function(e){var t=function(e){return-1!==e.indexOf(".groups.")?"group":-1!==e.indexOf(".totals.")?"activity_type":"none"}(e),n=MC(e);return{trigger:PC(e),limitation:t,overGroup:n,activityType:AC(e,t),groupName:DC(e,t)}},UC=function(e){return xC(e.get("type","")).get("title","")},VC=function(e,t,n,a,r,i){return"usagev"===t||""!==e?ye(a,r,n,e):Nu()(i)},BC=function(e,t){var n=LC(e.get("path","")),a=n.trigger,r=n.limitation,i=n.activityType,o="group"===r?e.get("usaget",""):i;return"".concat(e.get("value","")," ").concat(VC(e.get("unit",""),a,o,t.propertyTypes,t.usageTypesData,t.currency))},qC=function(e,t,n){var a=LC(t.get("path","")),r=a.trigger,i=a.limitation,o=a.activityType,l=a.groupName,s="usagev"===r?"Usage":"Cost";switch(t&&-1!==t.get("path","").indexOf("over_group")&&(s="Exceeding ".concat(s.toLowerCase())),i){case"group":return"".concat(s," of group ").concat(l," ").concat(UC(t)," ").concat(BC(t,n));case"activity_type":return"".concat(s," of ").concat(o," activity ").concat(UC(t)," ").concat(BC(t,n));case"none":default:return"Total cost ".concat(UC(t)," ").concat(BC(t,n))}},zC=function(e){switch(e){case"minutely":return"Minutes";case"hourly":return"Hours";default:return"Select unit..."}},HC=function(e){return"minutely"===e?[{value:15,label:"15"},{value:30,label:"30"}]:"hourly"===e?Array.from(new Array(24),function(e,t){return t+1}).map(function(e){return{value:e,label:"".concat(e)}}):[]},YC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={unitLabel:""},n.onChangeTrigger=function(e){var t=n.props,a=t.onChangeField,r=t.item,i=t.index,o=t.limitation,l=e.target.value,s=FC(l,"usagev"===l&&"none"===o?"group":o,{activityType:"",groupName:"",overGroup:""});a(["conditions",i],r.withMutations(function(e){e.set("path",s),e.set("unit",""),e.set("usaget","")}))},n.onChangeOverGroup=function(e){var t=n.props,a=t.onChangeField,r=t.index,i=t.trigger,o=t.activityType,l=t.groupName,s=t.limitation,c=e.target.value;a(["conditions",r,"path"],FC(i,s,{activityType:o,groupName:l,overGroup:c}))},n.onChangeLimitation=function(e){var t=n.props,a=t.onChangeField,r=t.index,i=t.trigger,o=t.activityType,l=t.groupName,s=e.target.value;a(["conditions",r,"path"],FC(i,s,{activityType:o,groupName:l,overGroup:""}))},n.onChangeActivityType=function(e){var t=n.props,a=t.onChangeField,r=t.item,i=t.index,o=t.trigger,l=t.limitation,s=t.overGroup,c=FC(o,l,{activityType:e,groupName:"",overGroup:s});a(["conditions",i],r.withMutations(function(t){t.set("path",c),t.set("unit",""),t.set("usaget",e)}))},n.onChangeGroupName=function(e){var t=n.props,a=t.onChangeField,r=t.item,i=t.index,o=t.trigger,l=t.limitation,s=FC(o,l,{activityType:"",groupName:e}),c=n.getGroupUnit(e),u=n.getGroupActivityType(e);a(["conditions",i],r.withMutations(function(e){e.set("path",s),e.set("unit",c),e.set("usaget",u)}))},n.onChangeType=function(e){var t=n.props;(0,t.onChangeField)(["conditions",t.index,"type"],e)},n.onChangeValue=function(e){var t=n.props;(0,t.onChangeField)(["conditions",t.index,"value"],e.target.value)},n.onChangeTagValue=function(e){var t=n.props;(0,t.onChangeField)(["conditions",t.index,"value"],e)},n.onChangeUnit=function(e){var t=n.props;(0,t.onChangeField)(["conditions",t.index,"unit"],e)},n.filterRelevantGroups=function(e){var t=n.props.trigger;return"usagev"===t&&!n.props.groupsData.hasIn([e,"cost"])||"cost"===t&&n.props.groupsData.hasIn([e,"cost"])},n.getGroupNamesOptions=function(){return n.props.groupsOptions.filter(n.filterRelevantGroups).map(function(e){return{value:e,label:e}}).toArray()},n.getGroupUnit=function(e){return n.props.groupsData.getIn([e,"unit"],"")},n.getGroupActivityType=function(e){return Oe(n.props.groupsData.get(e,g.c.Map()))},n.onChangeMultiValues=function(e){Array.isArray(e)?n.onChangeTagValue(e.join(",")):n.onChangeTagValue("")},n.renderCustomInputNumber=function(e){e.addTag;var t=e.onChange,n=e.value,a=Object(pt.a)(e,["addTag","onChange","value"]);return r.a.createElement("input",Object.assign({type:"number",onChange:t,value:n},a))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(Ed())}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.index,a=e.conditionsOperators,i=e.trigger,o=e.limitation,l=e.activityType,s=e.groupName,c=e.overGroup,u=e.propertyTypes,p=e.usageTypesData,d=e.currency,m="group"===o?t.get("usaget",""):l,g=VC(t.get("unit",""),i,m,u,p,d),h=xC(t.get("type",""));return r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,smOffset:1,style:{textAlign:"left"},componentClass:f.h},"Condition Trigger: "),r.a.createElement(f.g,{sm:8},r.a.createElement(f.g,{sm:12},r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(en,{fieldType:"radio",name:"condition-trigger-".concat(n),id:"condition-trigger-monetary-".concat(n),value:"cost",checked:"cost"===i,onChange:this.onChangeTrigger,label:"Monetary"})),r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(en,{fieldType:"radio",name:"condition-trigger-".concat(n),id:"condition-trigger-usagev-".concat(n),value:"usagev",checked:"usagev"===i,onChange:this.onChangeTrigger,label:"Usage"}))))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,smOffset:1,style:{textAlign:"left"},componentClass:f.h},"Condition Limitations: ")),r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,smOffset:1},r.a.createElement(en,{fieldType:"radio",name:"condition-limitation-".concat(n),id:"condition-limitation-none-".concat(n),value:"none",checked:"none"===o,onChange:this.onChangeLimitation,disabled:"usagev"===i,label:"Total Amount"}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,smOffset:1},r.a.createElement(en,{fieldType:"radio",name:"condition-limitation-".concat(n),id:"condition-limitation-group-".concat(n),value:"group",checked:"group"===o,onChange:this.onChangeLimitation,label:"Limit to Group"})),r.a.createElement(f.g,{sm:8},r.a.createElement(f.g,{sm:7,style:{paddingRight:0}},r.a.createElement(en,{fieldType:"select",onChange:this.onChangeGroupName,value:s,options:this.getGroupNamesOptions(),disabled:"group"!==o})),r.a.createElement(f.g,{sm:5},r.a.createElement(eu,{usaget:m,unit:t.get("unit",""),onChangeUsaget:this.onChangeActivityType,onChangeUnit:this.onChangeUnit,enabled:"group"===o,showUnits:"usagev"===i&&"group"===o,showAddButton:!1,showSelectTypes:!1})))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,smOffset:1},r.a.createElement(en,{fieldType:"radio",name:"condition-limitation-".concat(n),id:"condition-limitation-activity-".concat(n),value:"activity_type",checked:"activity_type"===o,onChange:this.onChangeLimitation,label:"Limit to Activity Type"})),r.a.createElement(f.g,{sm:8},r.a.createElement(f.g,{sm:12},r.a.createElement(eu,{usaget:l,unit:t.get("unit",""),onChangeUsaget:this.onChangeActivityType,onChangeUnit:this.onChangeUnit,enabled:"activity_type"===o,showUnits:"usagev"===i&&"activity_type"===o}))),"usagev"===i&&"activity_type"===o&&r.a.createElement(f.g,{sm:8,smOffset:4},r.a.createElement(f.g,{sm:12},r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(en,{fieldType:"radio",name:"condition-over-group-".concat(n),id:"condition-over-group-all-units-".concat(n),value:"none",checked:"over_group"!==c,onChange:this.onChangeOverGroup,label:"All units",enabled:"activity_type"===o})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(en,{fieldType:"radio",name:"condition-over-group-".concat(n),id:"condition-over-group-exceeding-units-".concat(n),value:"over_group",checked:"over_group"===c,onChange:this.onChangeOverGroup,label:"Exceeding units",disabled:"activity_type"!==o}))))),r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:5,componentClass:f.h},"Type"),r.a.createElement(f.g,{sm:4},r.a.createElement(en,{fieldType:"select",onChange:this.onChangeType,value:t.get("type",""),options:a})))),h.get("extra_field",!0)&&"tags"!==h.get("type","text")&&r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:5,componentClass:f.h},"Value"),r.a.createElement(f.g,{sm:4},r.a.createElement(f.o,{style:{width:"100%"}},r.a.createElement(en,{id:"cond-value-".concat(n),onChange:this.onChangeValue,value:t.get("value",""),fieldType:h.get("type","text")}),""!==g&&r.a.createElement(f.o.Addon,null,g))))),h.get("extra_field",!0)&&"tags"===h.get("type","text")&&r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:5,componentClass:f.h},"Value"),r.a.createElement(f.g,{sm:4},r.a.createElement(f.o,null,r.a.createElement(en,{fieldType:"tags",id:"cond-value-".concat(n),onChange:this.onChangeMultiValues,value:String(t.get("value","")).split(",").filter(function(e){return""!==e}),renderInput:this.renderCustomInputNumber,onlyUnique:"tags"===h.get("type","")}),""!==g&&r.a.createElement(f.o.Addon,null,g)))))))}}]),t}(a.Component);YC.defaultProps={item:g.c.Map(),index:-1,onChangeField:function(){},trigger:"",limitation:"",activityType:"",groupName:"",overGroup:"none",conditionsOperators:[],groupsOptions:g.c.List(),propertyTypes:g.c.List(),usageTypesData:g.c.List(),groupsData:g.c.Map(),currency:""};var GC=Object(l.connect)(function(e,t){var n=LC(t.item.get("path",""));return{trigger:n.trigger,limitation:n.limitation,activityType:n.activityType,groupName:n.groupName,overGroup:n.overGroup,groupsOptions:Na(e,t)||g.c.List(),groupsData:Pa(e,t)||g.c.Map(),currency:Mn(e,t),conditionsOperators:ZE(null,{eventType:"balance"})}})(YC),KC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={editedConditionIndex:-1},n.onChangeEventCode=function(e){var t=e.target.value,a=OC(t);n.props.setError("event_code",!0===a?null:a),n.props.updateField(["event_code"],t)},n.onChangeField=function(e){return function(t){var a=t.target.value;n.props.updateField(e,a)}},n.onChangeActive=function(e){var t=e.target.value;n.props.updateField(["active"],"yes"===t)},n.addCondition=function(){var e=n.props.item.get("conditions",g.c.List()).push(g.c.Map());n.props.updateField(["conditions"],e),n.setState({editedConditionIndex:e.size-1})},n.editCondition=function(e){return function(){n.setState({editedConditionIndex:e})}},n.hideEditCondition=function(){n.setState({editedConditionIndex:-1})},n.removeCondition=function(e){return function(){var t=n.props.item.get("conditions",g.c.List()).delete(e);n.props.updateField(["conditions"],t)}},n.renderConditionEditForm=function(e,t){var a=n.props,i=a.conditionType,o=a.propertyTypes,l=a.usageTypesData;switch(i){case"balance":default:return r.a.createElement(GC,{item:e,index:t,onChangeField:n.props.updateField,propertyTypes:o,usageTypesData:l})}},n.showConditionDetails=function(e){return n.state.editedConditionIndex===e},n.getConditionActions=function(e){return[{type:"edit",onClick:n.editCondition(e),show:!n.showConditionDetails(e)},{type:"collapse",onClick:n.hideEditCondition,show:n.showConditionDetails(e)},{type:"remove",onClick:n.removeCondition(e)}]},n.renderCondition=function(e,t){var a=n.props,i=a.conditionType,o={propertyTypes:a.propertyTypes,usageTypesData:a.usageTypesData,currency:a.currency,activityType:"counter"};return r.a.createElement(f.l,{key:t,className:"mb0"},r.a.createElement(f.g,{sm:12},r.a.createElement("div",{style:{paddingRight:100,display:"inline-block"}},qC(i,e,o)),r.a.createElement("span",{style:{marginLeft:-100,paddingRight:15},className:"pull-right List row"},r.a.createElement(Xe,{actions:n.getConditionActions(t)}))),r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{collapsible:!0,expanded:n.state.editedConditionIndex===t},n.renderConditionEditForm(e,t))))},n.renderConditions=function(){return n.props.item.get("conditions",g.c.List()).map(n.renderCondition).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.errors.get("event_code",!1);return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:r.a.createElement("span",null,"Details")},r.a.createElement(f.l,{validationState:n?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Event Code",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:7},r.a.createElement(en,{id:"label",onChange:this.onChangeEventCode,value:t.get("event_code","")}),n&&r.a.createElement(f.n,null,n))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Description"),r.a.createElement(f.g,{sm:7},r.a.createElement(en,{id:"description",onChange:this.onChangeField(["event_description"]),value:t.get("event_description","")}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Status"),r.a.createElement(f.g,{sm:7},r.a.createElement("span",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(en,{fieldType:"radio",onChange:this.onChangeActive,name:"step-active-status",value:"yes",label:"Active",checked:t.get("active",!0)})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(en,{fieldType:"radio",onChange:this.onChangeActive,name:"step-active-status",value:"no",label:"Not Active",checked:!t.get("active",!0)})))))),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Conditions")},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:12},this.renderConditions()),r.a.createElement(f.g,{sm:12},r.a.createElement(Je,{onClick:this.addCondition,label:"Add Condition"})))))}}]),t}(a.Component);KC.defaultProps={item:g.c.Map(),conditionType:"balance",propertyTypes:g.c.List(),usageTypesData:g.c.List(),errors:g.c.Map(),currency:""};var WC=Object(l.connect)(function(e,t){return{propertyTypes:Vn(e,t),usageTypesData:Un(e,t),currency:Mn(e,t)}})(KC),JC=function(e){var t=e.item,n=e.eventsSettings,a=e.errors,i=e.onUpdate,o=e.setError,l=t.getIn(["recurrence","type"],""),s=zC(l),c=HC(l),u=t.getIn(["date_range","type"],""),p=zC(u),d=HC(u),m=n.getIn(["email","global_addresses"],g.c.List()),h=function(e){i(["recurrence","type"],e),i(["recurrence","value"],"")},v=function(e){i(["date_range","type"],e),i(["date_range","value"],"")},y=function(e){var t=e.target.value;i(["active"],"yes"===t)},b=m.isEmpty()?[]:[{value:"global",label:"Global emails (".concat(m.join(", "),")")}],E=function(){var e=t.getIn(["notify_by_email","additional_addresses"],g.c.List());return t.getIn(["notify_by_email","use_global_addresses"],!1)&&!m.isEmpty()?e.insert(0,"global").toArray():e.toArray()}(),C=t.getIn(["notify_by_email","notify"],!1),_=a.get("event_code",!1),O=a.get("recurrence.value",!1),S=a.get("date_range.value",!1);return r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,{validationState:_?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Event Code ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:7},r.a.createElement(en,{onChange:function(e){var t=e.target.value;i(["event_code"],t);var n=OC(t);o("event_code",!0===n?null:n)},value:t.get("event_code","")}),_&&r.a.createElement(f.n,null,_))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Description"),r.a.createElement(f.g,{sm:7},r.a.createElement(en,{onChange:function(e){var t=e.target.value;i(["event_description"],t)},value:t.get("event_description","")}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Notify also by email"),r.a.createElement(f.g,{sm:7},r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement(en,{fieldType:"checkbox",id:"computed-must-met",value:C,onChange:function(e){var t=e.target.value;i(["notify_by_email","notify"],t),i(["notify_by_email","use_global_addresses"],t),t||i(["notify_by_email","additional_addresses"],g.c.List())},label:""})),r.a.createElement(en,{allowCreate:!0,multi:!0,placeholder:C?"Select or add new email address":"No",addLabelText:"Add {label}?",noResultsText:"Add email address...",clearable:!0,fieldType:"select",options:b,value:E.join(","),onChange:function(e){var t=g.c.List(e.length?e.split(","):[]);t.includes("global")?i(["notify_by_email","use_global_addresses"],!0):i(["notify_by_email","use_global_addresses"],!1);var n=t.findIndex(function(e){return"global"===e}),a=-1===n?t:t.remove(n);i(["notify_by_email","additional_addresses"],a)},disabled:!C})))),r.a.createElement(f.l,{validationState:O?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Run every ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:7},r.a.createElement(f.o,null,r.a.createElement(en,{fieldType:"select",options:c,value:t.getIn(["recurrence","value"],""),onChange:function(e){i(["recurrence","value"],e);var t=SC(e);o("recurrence.value",!0===t?null:t)}}),r.a.createElement(f.i,{id:"balance-period-unit",componentClass:f.o.Button,title:s},r.a.createElement(f.q,{eventKey:"minutely",onSelect:h},"Minutes"),r.a.createElement(f.q,{eventKey:"hourly",onSelect:h},"Hours"))),O&&r.a.createElement(f.n,null,O))),r.a.createElement(f.l,{validationState:S?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3},"For the previous ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:7},r.a.createElement(f.o,null,r.a.createElement(en,{fieldType:"select",options:d,value:t.getIn(["date_range","value"],""),onChange:function(e){i(["date_range","value"],e);var t=function(){return""!==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")||"Field is required"}(e);o("date_range.value",!0===t?null:t)}}),r.a.createElement(f.i,{id:"balance-period-unit",componentClass:f.o.Button,title:p},r.a.createElement(f.q,{eventKey:"minutely",onSelect:v},"Minutely"),r.a.createElement(f.q,{eventKey:"hourly",onSelect:v},"Hourly"))),S&&r.a.createElement(f.n,null,S))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Status"),r.a.createElement(f.g,{sm:7},r.a.createElement("span",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(en,{fieldType:"radio",onChange:y,name:"step-active-status",value:"yes",label:"Active",checked:t.get("active",!0)})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(en,{fieldType:"radio",onChange:y,name:"step-active-status",value:"no",label:"Not Active",checked:!t.get("active",!0)}))))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"\xa0"),r.a.createElement(f.g,{sm:7,style:{marginTop:10,paddingLeft:18}},r.a.createElement(en,{fieldType:"checkbox",id:"computed-must-met",value:t.get("lines_overlap",""),onChange:function(e){var t=e.target.value;i(["lines_overlap"],t)},label:"Events' lines overlap is allowed"}))))};JC.defaultProps={item:g.c.Map(),eventsSettings:g.c.Map(),errors:g.c.Map()};var QC=JC,$C=function(e){var t=e.condition,n=e.eventUsageTypes,i=e.effectOnUsagetFields,o=e.index,l=e.conditionField,s=e.conditionsFieldSelectOptions,c=e.conditionOperator,u=e.conditionsOperatorsSelectOptions,p=e.onUpdate,d=e.onRemove,m=e.setEventUsageType,h=e.getEventRates,v=t.getIn(["field"],""),y=t.getIn(["op"],""),b=i.includes(v),E=""===v,C=""===y||E,_=t.set("value",t.get("value",g.c.List()).join(",")),O=Object(a.useCallback)(function(e){b&&m(n.set(v,e))},[b,m,n,v]),S=Object(a.useCallback)(function(e){var t=g.c.Map({field:e,op:"",value:g.c.List()});O(g.c.List()),p([o],t)},[o,p,O]),T=Object(a.useCallback)(function(e){p([o,"op"],e)},[o,p]),k=Object(a.useCallback)(function(e){var t=g.c.List(e.length?e.split(","):[]);if(p([o,"value"],t),b&&(O(t),"arate_key"===v)){var a=t.filter(function(e){return!n.get("arate_key",g.c.List()).includes(e)});h(a)}},[o,p,h,b,O,v,n]),I=Object(a.useMemo)(function(){return[{type:"remove",onClick:function(e){O(g.c.List()),d(e)},actionStyle:"default",helpText:"Remove Condition"}]},[d,O]);return r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"condition_filter"},"Filter")),r.a.createElement(f.g,{sm:4,className:"pl0"},r.a.createElement(en,{id:"condition_field",fieldType:"select",options:s,onChange:S,value:v})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"condition_operator"},"Operator")),r.a.createElement(f.g,{sm:3},r.a.createElement(en,{id:"condition_operator",fieldType:"select",options:u,onChange:T,value:t.getIn(["op"],""),disabled:E})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"condition_value"},"Value")),r.a.createElement(f.g,{sm:4},r.a.createElement(Ud,{field:_,config:l,operator:c,disabled:C,onChange:k})),r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(Xe,{actions:I,data:o})))};$C.defaultProps={condition:g.c.Map(),eventUsageTypes:g.c.Map(),effectOnUsagetFields:g.c.List(),conditionField:g.c.Map(),conditionsFieldSelectOptions:[],conditionOperator:g.c.Map(),conditionsOperatorsSelectOptions:[]};var ZC=Object(l.connect)(function(e,t){return{conditionField:tC(e,{eventType:"fraud"}).find(function(e){return e.get("id","")===t.condition.getIn(["field"],"")},null,g.c.Map()),conditionsFieldSelectOptions:nC(e,Object(Fo.a)({},t,{eventType:"fraud"})),conditionOperator:$E(e,{eventType:"fraud"}).find(function(e){return e.get("id","")===t.condition.getIn(["op"],"")},null,g.c.Map()),conditionsOperatorsSelectOptions:ZE(null,{eventType:"fraud"}),effectOnUsagetFields:oC(e,{eventType:"fraud"})}})($C),XC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeThresholdField=function(e){var t=n.props.index;n.props.onUpdate([t,"field"],e),n.props.setError("threshold_condition.".concat(t),null)},n.onChangeThresholdOperator=function(e){var t=n.props,a=t.index,r=t.threshold;n.props.onUpdate([a,"op"],e),["in","nin"].includes(e)&&!["in","nin"].includes(r.getIn(["op"],""))&&n.props.onUpdate([a,"value"],g.c.List()),!["in","nin"].includes(e)&&["in","nin"].includes(r.getIn(["op"],""))&&n.props.onUpdate([a,"value"],""),n.props.setError("threshold_condition.".concat(a),null)},n.onChangeThresholdValue=function(e){var t=n.props,a=t.index,r=t.threshold;if(["in","nin"].includes(r.getIn(["op"],""))){var i=g.c.List(e.length?e.split(","):[]).map(function(e){return R()(e)?parseFloat(e):e});n.props.onUpdate([a,"value"],i)}else{var o=R()(e)?parseFloat(e):e;n.props.onUpdate([a,"value"],o),n.props.setError("threshold_condition.".concat(a),null)}},n.onChangeThresholdUnit=function(e){var t=n.props,a=t.index,r=t.usaget;n.props.onUpdate([a,"unit"],e),n.props.onUpdate([a,"usaget"],r),n.props.setError("threshold_condition.".concat(a),null)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.index,a=t.eventPropertyType;g.c.is(a,e.eventPropertyType)||this.props.onUpdate([n],g.c.Map())}},{key:"render",value:function(){var e=this.props,t=e.index,n=e.threshold,a=e.eventPropertyType,i=e.thresholdFields,o=e.thresholdFieldsSelectOptions,l=e.thresholdOperatorsSelectOptions,s=e.usaget,c=e.currency,u=e.errors,p=n.get("value",g.c.List()),d=g.c.List.isList(p)||Array.isArray(p)?n.set("value",p.join(",")):n,m=n.getIn(["field"],""),h=n.getIn(["op"],""),v=""===m,y=""===h||v,b=i.find(function(e){return e.get("id")===m},null,g.c.Map()),E=["aprice","final_charge"].includes(m)?g.c.Map({suffix:c}):g.c.Map(),C=u.get("threshold_condition.".concat(t),!1),_=1===a.size&&!["aprice","final_charge"].includes(m);return r.a.createElement(f.l,{className:"form-inner-edit-row pl0 pr0",validationState:C?"error":null},r.a.createElement(f.g,{componentClass:f.h,smHidden:!0,mdHidden:!0,lgHidden:!0},"Field ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:_?3:4},r.a.createElement(en,{id:"threshold_field",fieldType:"select",options:o,onChange:this.onChangeThresholdField,value:n.getIn(["field"],"")})),r.a.createElement(f.g,{componentClass:f.h,smHidden:!0,mdHidden:!0,lgHidden:!0},"Operator ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:_?3:4},r.a.createElement(en,{id:"threshold_operator",fieldType:"select",options:l,onChange:this.onChangeThresholdOperator,disabled:v,value:n.getIn(["op"],"")})),r.a.createElement(f.g,{componentClass:f.h,smHidden:!0,mdHidden:!0,lgHidden:!0},"Value ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:_?3:4},r.a.createElement(Ud,{field:d,config:b,operator:E,disabled:y,onChange:this.onChangeThresholdValue})),_&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.g,{componentClass:f.h,smHidden:!0,mdHidden:!0,lgHidden:!0},"Unit of measure ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:3,className:"pr0 pl5"},r.a.createElement(eu,{usaget:s,unit:n.get("unit",""),onChangeUnit:this.onChangeThresholdUnit,enabled:!0,showUnits:!0,showSelectTypes:!1}))),C&&r.a.createElement(f.g,{sm:12},r.a.createElement(f.n,null,C)))}}]),t}(a.Component);XC.defaultProps={threshold:g.c.Map(),eventPropertyType:g.c.Set(),thresholdFieldsSelectOptions:[],thresholdFields:g.c.List(),thresholdOperatorsSelectOptions:[],currency:"",usaget:"",errors:g.c.Map()};var e_=Object(l.connect)(function(e,t){var n=Un(e,t);return{currency:Mn(e,t),thresholdFields:iC(null,{eventType:"fraud"}),usaget:1===t.eventPropertyType.size?n.find(function(e){return e.get("property_type","")===t.eventPropertyType.first()},null,g.c.Map()).get("usage_type",""):""}})(XC),t_=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={status:"loading"},n.initEvent=function(){n.props.dispatch(il(["lines.fields"])).then(n.initEventRates).then(n.setStatusDone).catch(n.setStatusError)},n.initEventRates=function(){var e=n.props.item.getIn(["ui_flags","eventUsageType","arate_key"],g.c.List());return e.isEmpty()?Promise.resolve():n.props.dispatch(_C(e))},n.setStatusDone=function(){n.setState(function(){return{status:"done"}})},n.setStatusError=function(){n.setState(function(){return{status:"error"}})},n.getEventRates=function(e){e.isEmpty()||n.props.dispatch(_C(e))},n.onChangeText=function(e){return function(t){var a=t.target.value;n.props.updateField(e,a)}},n.onChangeSelect=function(e){return function(t){n.props.updateField(e,t)}},n.onRemoveCondition=function(e){var t=n.props.item.getIn(["conditions",0],g.c.List()).delete(e);n.props.updateField(["conditions",0],t)},n.onUpdateCondition=function(e,t){n.props.updateField(["conditions",0].concat(Object(w.a)(e)),t)},n.onChangeThreshold=function(e,t){n.props.updateField(["threshold_conditions",0].concat(Object(w.a)(e)),t)},n.setEventUsageType=function(e){n.props.updateField(["ui_flags","eventUsageType"],e)},n.onAddCondition=function(){var e=n.props.item,t=g.c.List([].concat(Object(w.a)(e.getIn(["conditions",0],g.c.List())),[g.c.Map({field:"",op:"",value:g.c.List()})]));n.props.updateField(["conditions",0],t)},n.renderConditions=function(){var e=n.props.item,t=e.getIn(["conditions",0],g.c.List()).map(function(e){return e.get("field","")}),a=e.getIn(["ui_flags","eventUsageType"],g.c.Map()),i=e.getIn(["conditions",0],g.c.List()).map(function(e,i){return r.a.createElement(ZC,{key:"condition_0_".concat(i),condition:e,index:i,usedFields:t,eventUsageTypes:a,onUpdate:n.onUpdateCondition,onRemove:n.onRemoveCondition,setEventUsageType:n.setEventUsageType,getEventRates:n.getEventRates})});return r.a.createElement("div",{className:"fraud-event-conditions"},r.a.createElement(f.g,{sm:12,className:"form-inner-edit-rows"},!i.isEmpty()&&r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Filter")),r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"operator_field"},"Operator")),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"value_field"},"Value")))),r.a.createElement(f.g,{sm:12},i),r.a.createElement(f.g,{sm:12,className:"pl0 pr0"},r.a.createElement(Je,{onClick:n.onAddCondition,label:"Add Condition",disabled:!1,title:""})))},n.renderThreshold=function(){var e=n.props,t=e.item,a=e.eventPropertyType,i=e.thresholdFieldsSelectOptions,o=e.thresholdOperatorsSelectOptions,l=e.errors,s=t.getIn(["threshold_conditions",0,0],g.c.Map());return r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"threshold_field"},"Field",r.a.createElement("span",{className:"danger-red"}," *"))),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"threshold_operator"},"Operator",r.a.createElement("span",{className:"danger-red"}," *"))),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"threshold_value"},"Value ",r.a.createElement("span",{className:"danger-red"}," *"))),1===a.size&&!["aprice","final_charge"].includes(s.getIn(["field"],""))&&r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"threshold_uof"},"Unit of measure",r.a.createElement("span",{className:"danger-red"}," *")))),r.a.createElement(e_,{threshold:s,index:0,eventPropertyType:a,thresholdFieldsSelectOptions:i,thresholdOperatorsSelectOptions:o,onUpdate:n.onChangeThreshold,errors:l,setError:n.props.setError}))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.initEvent()}},{key:"render",value:function(){var e=this.state.status,t=this.props,n=t.mode,a=t.item,i=t.eventsSettings,o=t.errors;return"loading"===e?r.a.createElement(_,null):"error"===e?r.a.createElement(f.p,{bsStyle:"danger"},"Oops! Something went wrong, please try again."):r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:r.a.createElement("span",null,"Details")},r.a.createElement(QC,{item:a,eventsSettings:i,onUpdate:this.props.updateField,setError:this.props.setError,errors:o})),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Conditions"),collapsible:!0,defaultExpanded:["create","clone"].includes(n),className:"collapsible"},this.renderConditions()),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Threshold")},this.renderThreshold()))}}]),t}(a.Component);t_.defaultProps={item:g.c.Map(),mode:"create",eventsSettings:g.c.Map(),eventPropertyType:g.c.Set(),thresholdFieldsSelectOptions:[],thresholdOperatorsSelectOptions:[],errors:g.c.Map()};var n_={balance:WC,fraud:Object(l.connect)(function(e,t){return{eventPropertyType:mC(e,t),thresholdFieldsSelectOptions:gC(e,Object(Fo.a)({},t,{eventType:"fraud"})),thresholdOperatorsSelectOptions:rC(null,{eventType:"fraud"}),eventsSettings:ra(e,t)}})(t_)},a_={balance:g.c.Map({active:!1}),fraud:g.c.Map({active:!1,date_range:g.c.Map({type:"hourly"}),recurrence:g.c.Map({type:"hourly"}),lines_overlap:!0,notify_by_email:g.c.Map({notify:!1})})},r_=Object(l.connect)(function(e,t){return{items:da(e,t),thresholdFields:iC(null,{eventType:"fraud"})}},function(e,t){return{onRemove:function(n){var a={message:'Are you sure you want to delete "'.concat(n.get("event_code"),'" event?'),onOk:function(){var a,r;return e((a=t.eventType,r=n,function(e,t){var n=da(t(),{eventType:a}).findIndex(function(e){return e.getIn(["ui_flags","id"],"")===r.getIn(["ui_flags","id"],"")});return-1!==n&&e(el("events",[a,n]))})),e(bC(t.eventType)).then(function(){return e(yC(t.eventType))})},labelOk:"Delete",type:"delete"};return e(po(a))},onEdit:function(n){var a={title:'Edit "'.concat(n.get("event_code"),'" event'),onOk:function(n){return!!e(kC(n,t.eventType))&&(e(CC(t.eventType,n)),e(bC(t.eventType)).then(function(e){return!!e.status||Promise.reject()}).then(function(){return e(yC(t.eventType))}).catch(function(){return e(yC(t.eventType)),Promise.reject()}))},mode:"edit"};return e(mo(n,n_[t.eventType],a))},onClone:function(n){var a=n.withMutations(function(e){e.deleteIn(["ui_flags","id"]),e.set("active",!1)}),r={title:'Clone "'.concat(n.get("event_code"),'" event'),onOk:function(n){return!!e(kC(n,t.eventType))&&e(EC(t.eventType,n)).then(function(e){return!!e.status||Promise.reject()}).then(function(){return e(Wa("New event ".concat(n.get("event_code","")," saved successfuly")))}).then(function(){return e(yC(t.eventType))}).catch(function(){return Promise.reject()})},mode:"clone"};return e(mo(a,n_[t.eventType],r))},onNew:function(){var n=Y(["events","entities",t.eventType,"title"],t.eventType),a={title:"Create new ".concat(n," event"),onOk:function(n){return!!e(kC(n,t.eventType))&&e(EC(t.eventType,n)).then(function(e){return!!e.status||Promise.reject()}).then(function(){return e(Wa("New event ".concat(n.get("event_code","")," saved successfuly")))}).then(function(){return e(yC(t.eventType))}).catch(function(){return Promise.reject()})},mode:"create"},r=a_[t.eventType];return e(mo(r,n_[t.eventType],a))},onEnable:function(n){var a={message:'Are you sure you want to enable "'.concat(n.get("event_code"),'" event?'),onOk:function(){var a=n.set("active",!0);return e(CC(t.eventType,a)),e(bC(t.eventType)).then(function(){return e(yC(t.eventType))})},type:"confirm",labelOk:"Enable"};e(po(a))},onDisable:function(n){var a={message:'Are you sure you want to disable "'.concat(n.get("event_code"),'" event?'),onOk:function(){var a=n.set("active",!1);return e(CC(t.eventType,a)),e(bC(t.eventType)).then(function(){return e(yC(t.eventType))})},type:"delete",labelOk:"Disable"};e(po(a))}}})(RC),i_=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(yC())}},{key:"render",value:function(){var e=this.props.location;return r.a.createElement("div",null,r.a.createElement(Ei,{id:"EventsTab",location:e},r.a.createElement(f.y,{title:"Balance Events",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(r_,{eventType:"balance"}))),r.a.createElement(f.y,{title:"Fraud Events",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(r_,{eventType:"fraud"}))),r.a.createElement(f.y,{title:"Settings",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(wC,null)))))}}]),t}(a.Component);i_.defaultProps={};var o_=Object(l.connect)(null)(i_),l_=function(){return r.a.createElement($s,null,r.a.createElement(s.d,{history:s.e},r.a.createElement(s.c,{path:"/",component:Js},r.a.createElement(s.a,{component:Qs(Fs),title:""}),r.a.createElement(s.c,{path:"users"},r.a.createElement(s.a,{component:Qs(py),title:"Users"}),r.a.createElement(s.c,{path:"user/:itemId",component:Qs(gy)}),r.a.createElement(s.c,{path:"user",component:Qs(gy)})),r.a.createElement(s.c,{path:"plans"},r.a.createElement(s.a,{component:Qs(fm),title:"Plans"}),r.a.createElement(s.c,{path:"plan/:itemId",component:Qs(ag)}),r.a.createElement(s.c,{path:"plan",component:Qs(ag)})),r.a.createElement(s.c,{path:"services"},r.a.createElement(s.a,{component:Qs(yg),title:"Services"}),r.a.createElement(s.c,{path:"service/:itemId",component:Qs(wg)}),r.a.createElement(s.c,{path:"service",component:Qs(wg)})),r.a.createElement(s.c,{path:"discounts"},r.a.createElement(s.a,{component:Qs(rg),title:"Discounts"}),r.a.createElement(s.c,{path:"discount/:itemId",component:Qs(gg)}),r.a.createElement(s.c,{path:"discount",component:Qs(gg)})),r.a.createElement(s.c,{path:"products"},r.a.createElement(s.a,{component:Qs(yp),title:"Products"}),r.a.createElement(s.c,{path:"product/:itemId",component:Qs($p)}),r.a.createElement(s.c,{path:"product",component:Qs($p)})),r.a.createElement(s.c,{path:"prepaid_plans"},r.a.createElement(s.a,{component:Qs(Jy),title:"Prepaid Plans"}),r.a.createElement(s.c,{path:"prepaid_plan/:itemId",component:Qs(vb)}),r.a.createElement(s.c,{path:"prepaid_plan",component:Qs(vb)})),r.a.createElement(s.c,{path:"charging_plans"},r.a.createElement(s.a,{component:Qs(Db),title:"Buckets Groups"}),r.a.createElement(s.c,{path:"charging_plan/:itemId",component:Qs(Hb)}),r.a.createElement(s.c,{path:"charging_plan",component:Qs(Hb)})),r.a.createElement(s.c,{path:"auto_renews"},r.a.createElement(s.a,{component:Qs($b),title:"Recurring Charges"}),r.a.createElement(s.c,{path:"auto_renew/:itemId",component:Qs(Xb)}),r.a.createElement(s.c,{path:"auto_renew",component:Qs(Xb)})),r.a.createElement(s.c,{path:"prepaid_includes"},r.a.createElement(s.a,{component:Qs(Nb),title:"Prepaid Buckets"}),r.a.createElement(s.c,{path:"prepaid_include/:itemId",component:Qs(Ab)}),r.a.createElement(s.c,{path:"prepaid_include",component:Qs(Ab)})),r.a.createElement(s.c,{path:"customers"},r.a.createElement(s.a,{component:Qs(ku),title:"Customers"}),r.a.createElement(s.c,{path:"customer/:itemId",component:Qs(hp)}),r.a.createElement(s.c,{path:"customer",component:Qs(hp)})),r.a.createElement(s.c,{path:"taxes"},r.a.createElement(s.a,{component:Qs(_p),title:"Tax Rates"}),r.a.createElement(s.c,{path:"tax/:itemId",component:Qs(Pp)}),r.a.createElement(s.c,{path:"tax",component:Qs(Pp)}),r.a.createElement(s.c,{path:"tax",component:Qs(Pp)}),r.a.createElement(s.c,{path:"mapping-rules",component:Qs(Ap)})),r.a.createElement(s.c,{path:"reports"},r.a.createElement(s.a,{component:Qs(_d),title:"Reports"}),r.a.createElement(s.c,{path:"report/:itemId",component:Qs(mm)}),r.a.createElement(s.c,{path:"report",component:Qs(mm)})),r.a.createElement(s.c,{path:"/input_processor",component:Qs(Qh)}),r.a.createElement(s.c,{path:"/input_processors",component:Qs(Af),title:"Input Processors"}),r.a.createElement(s.c,{path:"/export_generator",component:Qs(dh),title:"Export Generator"}),r.a.createElement(s.c,{path:"/export_generators",component:Qs(gh),title:"Export Generators"}),r.a.createElement(s.c,{path:"/usage",component:Qs(tv),title:"Usage"}),r.a.createElement(s.c,{path:"/run_cycle",component:Qs(dv),title:"Billing Cycle"}),r.a.createElement(s.c,{path:"/queue",component:Qs(fv),title:"Queue"}),r.a.createElement(s.c,{path:"/invoices",component:Qs(vv),title:"Invoices"}),r.a.createElement(s.c,{path:"/settings",component:Qs(ty),title:"General Settings"}),r.a.createElement(s.c,{path:"/payment_gateways",component:Qs(cy),title:"Payment Gateways"}),r.a.createElement(s.c,{path:"/select_input_processor_template",component:Qs(fy),title:"Create New Input Processor"}),r.a.createElement(s.c,{path:"/collections",component:Qs(Ay),title:"Collection"}),r.a.createElement(s.c,{path:"/invoice-template",component:Qs(zy),title:"Invoice Template"}),r.a.createElement(s.c,{path:"/audit-trail",component:Qs(Cb),title:"Audit Trail"}),r.a.createElement(s.c,{path:"/custom_fields",component:Qs(JE),title:"Custom Fields"}),r.a.createElement(s.c,{path:"/events",component:Qs(o_),title:"Events"}),r.a.createElement(s.c,{path:"/email_templates",component:Qs(Wy),title:"Email Templates"}),r.a.createElement(s.c,{path:"/login",component:Ks,title:"Login"}),r.a.createElement(s.c,{path:"/about",component:Ds,title:"About"}),r.a.createElement(s.c,{path:"/changepassword(/:itemId)",component:Ys,title:"Change Password"}),r.a.createElement(s.c,{path:"/import(/:itemType)",component:Qs(Su)}),r.a.createElement(s.c,{path:"*",component:ks,title:" "}))))},s_=n(271),c_=n(272),u_=n.n(c_),p_=g.c.List(),d_=g.c.Map(),m_=g.c.Map(),g_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case bc:return t.collection&&t.collection.length>0?e.set(t.collection,g.c.fromJS(t.list).toList()):e;case hc:case vc:return t.collection&&t.collection.length>0?e.set(t.collection,g.c.List()):e;case Nl:return m_;default:return e}},f_=g.c.Map(),h_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hc:return t.collection&&t.collection.length>0?e.delete(t.collection):e;case Cc:return t.collection&&t.collection.length>0?e.set(t.collection,t.page):e;case Nl:return f_;default:return e}},v_=g.c.Map(),y_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hc:return t.collection&&t.collection.length>0?e.delete(t.collection):e;case _c:return t.collection&&t.collection.length>0?e.set(t.collection,g.c.fromJS(t.sort)):e;case Nl:return v_;default:return e}},b_=g.c.Map(),E_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hc:return t.collection&&t.collection.length>0?e.delete(t.collection):e;case Ec:return t.collection&&t.collection.length>0?e.set(t.collection,g.c.fromJS(t.filter)):e;case Nl:return b_;default:return e}},C_=g.c.Map(),__=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hc:return t.collection&&t.collection.length>0?e.delete(t.collection):e;case yc:return t.collection&&t.collection.length>0?e.set(t.collection,t.nextPage):e;case Nl:return C_;default:return e}},O_=g.c.Map(),S_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hc:return t.collection&&t.collection.length>0?e.delete(t.collection):e;case Oc:return t.collection&&t.collection.length>0&&R()(t.size)?e.set(t.collection,parseInt(t.size)):e;case Nl:return O_;default:return e}},T_=g.c.Map({}),k_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hc:return t.collection&&t.collection.length>0?e.delete(t.collection):e;case Sc:return t.collection&&t.collection.length>0?t.state.isEmpty()?e.set(t.collection,g.c.List([0,1,2])):e.set(t.collection,t.state):e;case Nl:return T_;default:return e}},I_=g.c.Map(),N_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case kc:var n=t.collection,a=void 0===n?null:n,r=t.key,i=void 0===r?null:r;if(a&&i){var o=Pe(i).join("_");return e.deleteIn([a,o])}return a&&!i?e.delete(t.collection):e;case Tc:var l=t.collection,s=void 0===l?null:l,c=t.key,u=void 0===c?null:c,p=t.revisions,d=void 0===p?[]:p,m=g.c.fromJS(d).toList();if(s&&u){var f=Pe(u).join("_");return e.setIn([s,f],m)}return e;case Nl:return I_;default:return e}},w_=Object(fu.c)({items:g_,page:h_,sort:y_,filter:E_,nextPage:__,size:S_,state:k_,revisions:N_}),j_=g.c.Map(),R_=g.c.fromJS({file_type:"",usaget_type:"static",delimiter:"",fields:[],unfiltered_fields:[],field_widths:[],processor:{usaget_mapping:[]},customer_identification_fields:{},rate_calculators:{retail:{}},receiver:[],pricing:{},unify:{}}),x_=g.c.fromJS({target_key:"sid",src_key:"",conditions:[{field:"usaget",regex:"/.*/"}],clear_regex:"//"}),F_="".concat("","/assets/img/").concat(Y("defaultLogo","billRun-cloud-logo.png")),P_=g.c.fromJS({subscribers:{account:{fields:[]},subscriber:{fields:[]}},files:{logo:F_},payment_gateways:[]}),M_=Y("productUnlimitedValue","UNLIMITED"),A_=g.c.Map({key:"",description:"",pricing_method:"tiered"}),D_=g.c.Record({from:0,to:M_,interval:"",price:"",uom_display:g.c.Map({range:"",interval:""})}),L_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PRODUCT_UPDATE_FIELD_VALUE":return e.setIn(t.path,t.value);case"PRODUCT_UPDATE_TO_VALUE":return e.updateIn(t.path,g.c.List(),function(e){if(t.index<e.size-1){var n=t.index+1;return e.update(n,g.c.Map(),function(e){return e.set("from",t.value)}).update(t.index,g.c.Map(),function(e){return e.set("to",t.value)})}return e.update(t.index,g.c.Map(),function(e){return e.set("to",t.value)})});case"PRODUCT_UPDATE_USAGET_VALUE":var n=[].concat(Object(w.a)(t.path),[t.oldUsaget]),a=[].concat(Object(w.a)(t.path),[t.newUsaget]);return e.setIn(a,e.getIn(n,g.c.List())).deleteIn(n);case"PRODUCT_ADD_RATE":return 0===e.getIn(t.path,g.c.List()).size?e.updateIn(t.path,g.c.List(),function(e){return e.push(new D_)}):e.updateIn(t.path,g.c.List(),function(e){var t=e.last().set("to",M_),n=e.size-1;return e.update(n,g.c.Map(),function(e){return e.set("to","")}).push(t)});case"PRODUCT_REMOVE_RATE":return e.updateIn(t.path,function(e){if(t.index>0){var n=t.index-1;return e.update(n,function(e){return e.set("to",M_)}).delete(t.index)}return e.delete(t.index)});case"PRODUCT_CLONE_RESET":var r=["_id","from","to","originalValue"].concat(Object(w.a)(t.uniquefields));return e.withMutations(function(e){r.forEach(function(t){e.delete(t)})});case"PRODUCT_GOT":return g.c.fromJS(t.product);case"PRODUCT_CLEAR":return A_;default:return e}},U_=g.c.Record({auth:null,name:"",roles:["guest"],error:"",lastLogin:null}),V_=g.c.Map(),B_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_GROUP":var n=g.c.Map({}).withMutations(function(e){if(e.set("account_shared",t.shared),e.set("account_pool",t.pooled),e.set("quantity_affected",t.quantityAffected),e.set("rates",g.c.List(t.products)),"cost"===t.usages.get(0,""))e.set("cost",t.value);else{var n=g.c.Map().withMutations(function(e){t.usages.forEach(function(n){e.set(n,g.c.Map({unit:t.unit}))})});e.set("value",t.value),e.set("usage_types",n)}});return e.updateIn(["include","groups"],g.c.Map(),function(e){return e.isEmpty()?g.c.Map():e}).setIn(["include","groups",t.groupName],n);case"REMOVE_GROUP":return e.deleteIn(["include","groups",t.groupName]);default:return e}},q_=g.c.Map(),z_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SERVICE_PRODUCTS_REMOVE":case"PLAN_PRODUCTS_REMOVE":return e.deleteIn([].concat(Object(w.a)(t.path),[t.name]));case"SERVICE_PRODUCTS_RATE_UPDATE_TO":case"PLAN_PRODUCTS_RATE_UPDATE_TO":var n=Object.assign(t,{type:"PRODUCT_UPDATE_TO_VALUE"});return L_(e,n);case"SERVICE_PRODUCTS_RATE_UPDATE":case"PLAN_PRODUCTS_RATE_UPDATE":var a=Object.assign(t,{type:"PRODUCT_UPDATE_FIELD_VALUE"});return L_(e,a);case"SERVICE_PRODUCTS_RATE_REMOVE":case"PLAN_PRODUCTS_RATE_REMOVE":var r=Object.assign(t,{type:"PRODUCT_REMOVE_RATE"});return L_(e,r);case"SERVICE_PRODUCTS_RATE_ADD":case"PLAN_PRODUCTS_RATE_ADD":var i=Object.assign(t,{type:"PRODUCT_ADD_RATE"});return L_(e,i);case"SERVICE_PRODUCTS_RATE_INIT":case"PLAN_PRODUCTS_RATE_INIT":var o=t.product.get("rates",g.c.Map()).keySeq().first();return e.setIn(t.path,t.product.getIn(["rates",o,"BASE","rate"]));default:return e}},H_=Y("planCycleUnlimitedValue","UNLIMITED"),Y_=g.c.Map(),G_=g.c.Map({price:"",from:0,to:H_}),K_=g.c.Map({value:0,type:"",msg:""}),W_=function(e,t,n){return e.reduce(function(e,a,r){if(r===t)return a="undefined"===typeof n?a.set("to",parseInt(a.get("to",0)||0)-parseInt(a.get("from",0)||0)):n===H_?a.set("to",n):a.set("to",parseInt(a.get("from")||0)+parseInt(n)),0===t&&(a=a.set("from",0)),e.push(a);if(r>t){var i=a.get("from",0),o=a.get("to",""),l=parseInt(e.last().get("to",0)||0);if(a=a.set("from",l),""===o)a=a.set("to",a.get("from"));else if(o===H_);else{var s=parseInt(o||0)-parseInt(i||0);a=a.set("to",l+s)}return e.push(a)}return e.push(a)},g.c.List())},J_=g.c.fromJS({name:"",inputProcess:{},segments:[{field:null,from:null,to:null}]}),Q_=g.c.fromJS({description:"",name:"",price:[{from:0,to:Y("serviceCycleUnlimitedValue","UNLIMITED"),price:""}]}),$_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CLEAR_SERVICE":return Q_;case"GOT_SERVICE":return g.c.fromJS(t.item);case"UPDATE_SERVICE":return e.setIn(t.path,t.value);case"CLONE_RESET_SERVICE":var n=["_id","from","to","originalValue"].concat(Object(w.a)(t.uniquefields));return e.withMutations(function(e){n.forEach(function(t){e.delete(t)})});case"ADD_GROUP_SERVICE":var a=Object.assign({},t,{type:"ADD_GROUP"});return B_(e,a);case"REMOVE_GROUP_SERVICE":var r=Object.assign({},t,{type:"REMOVE_GROUP"});return B_(e,r);case"SERVICE_PRODUCTS_REMOVE":case"SERVICE_PRODUCTS_RATE_UPDATE_TO":case"SERVICE_PRODUCTS_RATE_UPDATE":case"SERVICE_PRODUCTS_RATE_REMOVE":case"SERVICE_PRODUCTS_RATE_ADD":case"SERVICE_PRODUCTS_RATE_INIT":return z_(e,t);default:return e}},Z_=g.c.Map({title:" ",systemRequirementsLoad:!1,onBoarding:g.c.Map({step:0,state:Zi}),confirm:g.c.Map({})}),X_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Qi:var n="undefined"!==typeof t.title?t.title:Z_.get("title");return e.set("title",n);case $i:return e.set("systemRequirementsLoad",!0);case"SET_ON_BOARDING_STEP":return e.setIn(["onBoarding","step"],t.step);case"SET_ON_BOARDING_STATE":return e.setIn(["onBoarding","state"],t.state);case"LOGIN":return t.data&&null===t.data.last_login?e.setIn(["onBoarding","state"],to):e;case"CONFIRM_SHOW":return e.setIn(["confirm"],g.c.Map(Object(Fo.a)({},t.confirm,{show:!0})));case"CONFIRM_HIDE":return e.setIn(["confirm"],g.c.Map());case"EDIT_FORM_SHOW":var a=t.item,r=t.component,i=t.config;return e.setIn(["formModalData"],g.c.Map({item:a,component:r,config:g.c.fromJS(i),show:!0}));case"EDIT_FORM_HIDE":return e.setIn(["formModalData"],g.c.Map());case"EDIT_FORM_SET_ITEM":return e.setIn(["formModalData","item"],t.item);case"EDIT_FORM_SET_ERROR":var o=t.fieldId,l=t.message,s=void 0===l?null:l;return null===s?e.deleteIn(["formModalData","errors",o]):e.setIn(["formModalData","errors",o],s);case"EDIT_FORM_UPDATE_ITEM_FIELD":var c=t.path,u=t.value,p=Array.isArray(c)?c:[c];return e.setIn(["formModalData","item"].concat(Object(w.a)(p)),u);case"EDIT_FORM_DELETE_ITEM_FIELD":var d=t.path,m=Array.isArray(d)?d:[d];return e.deleteIn(["formModalData","item"].concat(Object(w.a)(m)));case"SET_PAGE_FLAG":var f=t.page,h=t.flag,v=t.value;if(null===h)return e.deleteIn(["flag",f]);var y=Array.isArray(h)?h:[h];return null===v?e.deleteIn(["flag",f].concat(Object(w.a)(y))):e.setIn(["flag",f].concat(Object(w.a)(y)),v);default:return e}},eO=g.c.Map({main:g.c.Map(),collapseSideBar:!1}),tO=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:eO,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TOGGLE_SIDE_BAR":return null===t.state?e.set("collapseSideBar",!e.get("collapseSideBar",!0)):e.set("collapseSideBar",t.state);case"PREPARE_MAIN_MENU_STRUCTURE":var n=g.c.fromJS(t.mainMenuOverrides);return e.set("main",Vo(Uo(n),"root"));default:return e}},nO=Object(fu.c)({page:X_,menu:tO}),aO=g.c.Map({nextPage:!0}),rO=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:aO,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ur:return e.set("nextPage",t.nextPage);default:return e}},iO=Object(fu.c)({progressIndicator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch((arguments.length>1?arguments[1]:void 0).type){case"PROGRESS_INDICATOR_START":return e+1;case"PROGRESS_INDICATOR_FINISH":return e>0?e-1:0;case"PROGRESS_INDICATOR_DISMISS":return 0;default:return e}},product:L_,user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new U_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return new U_({auth:!0,roles:t.data.permissions,name:t.data.user,lastLogin:t.data.last_login?S()(t.data.last_login):null});case Nl:return new U_({auth:!1});case"LOGIN_ERROR":return e.set("error",t.error);case"CLEAR_LOGIN_ERROR":return e.set("error","");default:return e}},alerts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ha:return e.insert(0,t.alert);case za:return e.filter(function(e){return e.get("id")!==t.id});case qa:return p_;default:return e}},entityList:w_,list:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d_,t=arguments.length>1?arguments[1]:void 0,n=t.collection;switch(t.type){case or:return e.set(n,g.c.fromJS(t.list).toList());case lr:var a=g.c.fromJS(t.items).toList();return e.update(n,g.c.List(),function(e){return e.push.apply(e,Object(w.a)(a))});case sr:return e.update(n,g.c.List(),function(e){return e.delete(t.index)});case cr:return n?e.set(n,g.c.List()):d_;default:return e}},entity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j_,t=arguments.length>1?arguments[1]:void 0,n=t.collection,a=t.path,r=t.value,i=t.type,o=t.entity;switch(i){case cl:return["reports","sourceReports"].includes(n)||(o.originalValue=o.from),e.set(n,g.c.fromJS(o));case ul:return Array.isArray(a)?e.setIn([n].concat(Object(w.a)(a)),r):e.setIn([n,a],r);case pl:return Array.isArray(a)?e.deleteIn([n].concat(Object(w.a)(a))):e.deleteIn([n,a]);case ml:var l=["_id","from","to","originalValue","revision_info","creation_time"];return"string"===typeof t.uniquefields?l.push(t.uniquefields):Array.isArray(t.uniquefields)&&l.push.apply(l,Object(w.a)(t.uniquefields)),e.withMutations(function(e){l.forEach(function(t){e.deleteIn([n,t])})});case"PLAN_CLEAR":case"CLEAR_SERVICE":return n?e.set("source".concat(Object(x.upperCaseFirst)(n)),g.c.Map()):j_;case dl:return n?e.set(n,g.c.Map()).set("source".concat(Object(x.upperCaseFirst)(n)),g.c.Map()):j_;default:return e}},inputProcessor:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R_,a=arguments.length>1?arguments[1]:void 0,r=a.field,i=a.mapping,o=a.width,l=a.index,s=a.priority;switch(a.type){case Xg:return g.c.fromJS(a.settings);case xg:return n.set("file_type",a.file_type);case bf:return n.set("type",a.processor_type);case Fg:return n.set("delimiter_type",a.delimiter_type);case Pg:return n.setIn(a.fieldPath,a.value);case Mg:return n.set("delimiter",a.delimiter);case Ag:return n.get("unfiltered_fields").size>0?n.update("unfiltered_fields",function(e){return[].concat(Object(w.a)(e),Object(w.a)(a.fields))}).set("fields",g.c.List(n.get("unfiltered_fields").filter(function(e){return!0===e.get("checked")}).map(function(e){return e.get("name")}))):n.set("unfiltered_fields",g.c.fromJS(a.fields)).set("fields",g.c.fromJS(a.fields).map(function(e){return e.get("name")}));case ef:return n.setIn(["field_widths",l],o);case Dg:return n.setIn(["processor",r],i);case Lg:var c=g.c.Map({name:r,checked:!0});return n.update("unfiltered_fields",function(e){return e.push(c)}).update("fields",function(e){return e.push(r)});case af:var u=n.getIn(["unfiltered_fields",l,"name"]),p=n.update("unfiltered_fields",function(e){return e.delete(l)}),d=p.get("fields").findIndex(function(e){return e===u});return-1!==d?p.update("fields",function(e){return e.delete(d)}):p;case uf:return n.set("unfiltered_fields",g.c.List()).set("fields",g.c.List());case pf:var m=a.checked;return n.update("unfiltered_fields",g.c.List(),function(e){return e.map(function(e){return e.set("checked",!0===m)})}).update("fields",g.c.List(),function(e){return m?n.get("unfiltered_fields").map(function(e){return e.get("name")}):g.c.List()});case of:return n.set("usaget_type",a.usaget_type).set("customer_identification_fields",g.c.Map()).set("pricing",g.c.Map()).setIn(["processor","usaget_mapping"],g.c.List()).setIn(["processor","default_usaget"],"").setIn(["processor","src_field"],"").setIn(["rate_calculators"],g.c.Map({retail:g.c.Map()}));case df:var f=n.get("rate_calculators",g.c.Map()).map(function(){return g.c.Map(Object(vr.a)({},a.usaget,g.c.List()))});return n.setIn(["processor","default_usaget"],a.usaget).set("rate_calculators",f).update("pricing",g.c.Map(),function(e){return e.clear().set(a.usaget,g.c.Map())}).update("customer_identification_fields",g.c.Map(),function(e){return e.clear().set(a.usaget,g.c.List())});case nf:var h=a.mapping,v=h.usaget,y=h.pattern,b=h.unit,E=h.volumeType,C=h.volumeSrc,_=h.fieldName,O=h.conditions,S=g.c.fromJS({usaget:v,pattern:y,unit:b,volume_type:E,volume_src:C,src_field:_,conditions:O}),T=n.get("rate_calculators",g.c.Map()).map(function(e){return e.has(v)?e:e.set(v,g.c.List())});return n.updateIn(["processor","usaget_mapping"],function(e){return e.push(S)}).set("rate_calculators",T).update("pricing",g.c.Map(),function(e){return e.has(v)?e:e.set(v,g.c.Map())}).update("customer_identification_fields",g.c.Map(),function(e){return e.has(v)?e:e.set(v,g.c.List())});case rf:var k=n.getIn(["processor","usaget_mapping",a.index,"usaget"]),I=n.getIn(["processor","usaget_mapping"]).map(function(e){return e.get("usaget")}).countBy(function(e){return e===k?"found":"notfound"}).get("found",0),N=n.get("rate_calculators",g.c.Map()).map(function(e){return 1===I?e.delete(k):e});return n.updateIn(["processor","usaget_mapping"],function(e){return e.remove(a.index)}).updateIn(["customer_identification_fields"],g.c.Map(),function(e){return 1===I?e.delete(k):e}).updateIn(["pricing"],g.c.Map(),function(e){return 1===I?e.delete(k):e}).set("rate_calculators",N);case Kg:return n.setIn(["customer_identification_fields",a.usaget,a.index,r],i);case Wg:return n.setIn(["pricing",a.usaget,r],i);case Jg:return n.updateIn(["customer_identification_fields",a.usaget],function(e){return e?e.push(x_):g.c.List([x_])});case Qg:return n.updateIn(["customer_identification_fields",a.usaget],function(e){return e.remove(s)});case Vg:var j=a.rateCategory,R=n.get("rate_calculators",g.c.Map()).first().map(function(){return g.c.List()});return n.setIn(["rate_calculators",j],R);case Bg:var x=a.rateCategory;return n.deleteIn(["rate_calculators",x]);case qg:var F=a.rate_key,P=a.value,M=a.rateCategory,A=a.usaget,D=g.c.fromJS({type:P,rate_key:F,line_key:n.getIn(["rate_calculators",M,A,s,l,"line_key"])}),L=n.getIn(["rate_calculators",M,A,s,l,"computed"]);return L&&!L.isEmpty()&&(D=D.set("computed",L)),n.setIn(["rate_calculators",M,A,s,l],D);case zg:var U=a.rateCategory,V=a.usaget,B=g.c.fromJS({type:"",rate_key:"",line_key:""});return n.updateIn(["rate_calculators",U,V,s],function(e){return e?e.push(B):g.c.List([B])});case Hg:var q=a.rateCategory,z=a.usaget,H=g.c.fromJS({type:"",rate_key:"",line_key:""});return n.updateIn(["rate_calculators",q,z],function(e){return e.push(g.c.List([H]))});case Yg:var Y=a.rateCategory,G=a.usaget;return n.updateIn(["rate_calculators",Y,G],function(e){return e.remove(s)});case Gg:var K=a.rateCategory,W=a.usaget;return n.updateIn(["rate_calculators",K,W,s],function(e){return e.remove(l)});case Of:return n.update("receiver",g.c.List(),function(e){return e.remove(l)});case Sf:var J=g.c.fromJS({});return n.update("receiver",g.c.List(),function(e){return e.push(J)});case lf:var Q=a.value,$=a.rateCategory,Z=a.usaget;return n.setIn(["rate_calculators",$,Z,s,l,"line_key"],Q);case sf:return n.withMutations(function(e){a.paths.forEach(function(t,n){e.setIn(["rate_calculators"].concat(Object(w.a)(t)),a.values[n])})});case cf:return n.deleteIn(["rate_calculators",a.rateCategory,a.usaget,a.priority,a.index,"computed"]);case $g:return n.setIn(["receiver",l,r],i);case Zg:return n.deleteIn(["receiver",l,r]);case tf:return R_;case mf:return g.c.fromJS(a.template);case gf:return e=r||n.getIn(["unfiltered_fields",l]),t=o||n.getIn(["field_widths",l]),n.update("unfiltered_fields",function(t){return t.delete(l).insert(l-1,e)}).update("field_widths",function(e){return e.delete(l).insert(l-1,t)});case ff:return e=r||n.getIn(["unfiltered_fields",l]),t=o||n.getIn(["field_widths",l]),n.update("unfiltered_fields",function(t){return t.delete(l).insert(l+1,e)}).update("field_widths",function(e){return e.delete(l).insert(l+1,t)});case hf:var X=a.value,ee=n.getIn(["unfiltered_fields",l,"name"]),te=n.updateIn(["unfiltered_fields",l],function(e){return e.set("name",X)}),ne=te.get("fields").findIndex(function(e){return e===ee});return-1!==ne?te.update("fields",function(e){return e.set(ne,X)}):te;case vf:return n.deleteIn(a.path);case yf:return n.setIn(["parser",a.name],a.value);case Ef:return n.setIn(["realtime",a.name],g.c.fromJS(a.value));case Cf:return n.setIn(["realtime","default_values",a.name],a.value);case _f:var ae=a.checked,re=n.getIn(["unfiltered_fields",l,"name"]);return n.updateIn(["unfiltered_fields",l],function(e){return e.set("checked",ae)}).update("fields",function(e){if(!1===ae){var t=e.findIndex(function(e){return e===re});return-1!==t?e.delete(t):e}return e.push(re)});default:return n}},settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P_,t=arguments.length>1?arguments[1]:void 0,n=t.name,a=t.value,r=t.category,i=t.settings,o=t.gateway;switch(t.type){case Nl:return P_;case Bo:return Array.isArray(n)?e.setIn([r].concat(Object(w.a)(n)),a):e.setIn([r,n],a);case Ko:var l;return l=t.path?t.path&&Array.isArray(t.path)?[r].concat(Object(w.a)(t.path)):[r,t.path]:[r],e.updateIn(l,g.c.List(),function(e){return e.push(t.value)});case Ug:return e.update("usage_types",function(e){return e.push(t.usaget)});case qo:return e.withMutations(function(e){i.forEach(function(t){var n=g.c.fromJS(t.data.details);"taxation"===t.name&&""!==n.get("vat","")&&(n=n.set("vat",100*n.get("vat",""))),"taxation.vat"===t.name&&""!==n&&(n*=100),e.setIn(t.name.split("."),n)})});case zo:var s=e.get("payment_gateways").filterNot(function(e){return e.get("name")===o.name}).push(g.c.fromJS(o));return e.set("payment_gateways",s);case Ho:var c=e.get("payment_gateways").filterNot(function(e){return e.get("name")===o});return e.set("payment_gateways",c);case Yo:var u=e.get("payment_gateways").find(function(e){return e.get("name")===o.name}).set("params",o.params),p=e.get("payment_gateways").filterNot(function(e){return e.get("name")===o.name}).push(u);return e.set("payment_gateways",p);case Go:return Array.isArray(n)?e.deleteIn([r].concat(Object(w.a)(n))):e.deleteIn([r,n]);case Wo:var d=e.getIn([].concat(Object(w.a)(t.path),[t.oldIndex]));return e.updateIn(t.path,g.c.List(),function(e){return e.delete(t.oldIndex).insert(t.newIndex,d)});default:return e}},plan:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PLAN_PRODUCTS_REMOVE":case"PLAN_PRODUCTS_RATE_UPDATE_TO":case"PLAN_PRODUCTS_RATE_UPDATE":case"PLAN_PRODUCTS_RATE_REMOVE":case"PLAN_PRODUCTS_RATE_ADD":case"PLAN_PRODUCTS_RATE_INIT":return z_(e,t);case"REMOVE_GROUP_PLAN":var n=Object.assign({},t,{type:"REMOVE_GROUP"});return B_(e,n);case"ADD_GROUP_PLAN":var a=Object.assign({},t,{type:"ADD_GROUP"});return B_(e,a);case"PLAN_UPDATE_FIELD_VALUE":return e.setIn(t.path,t.value);case"PLAN_REMOVE_FIELD":return e.deleteIn(t.path);case"PLAN_UPDATE_PLAN_CYCLE":return e.updateIn(["price"],function(e){return W_(e,t.index,t.value)});case"PLAN_ADD_TARIFF":if(t.trial){var r=G_.set("trial",!0);return e.get("price",g.c.List()).isEmpty()?e.update("price",g.c.List(),function(e){return e.unshift(r)}):e.update("price",g.c.List(),function(e){return e.unshift(r.set("to",""))})}return e.get("price",g.c.List()).isEmpty()?e.update("price",g.c.List(),function(e){return e.push(G_)}):e.update("price",g.c.List(),function(e){return e.update(e.size-1,g.c.Map(),function(e){return e.set("to","")}).push(G_.set("from",""))});case"PLAN_REMOVE_TARIFF":return 0===t.index?e.update("price",g.c.List(),function(e){return e.size>1?e.update(t.index+1,g.c.Map(),function(e){return e.set("from",0)}).delete(t.index):e.delete(t.index)}):e.update("price",g.c.List(),function(e){return e.update(t.index-1,function(e){return e.set("to",H_)}).delete(t.index)});case"PLAN_GOT":return g.c.fromJS(t.plan);case"PLAN_CLEAR":return Y_;case"PLAN_CLONE_RESET":var i=["_id","from","to","originalValue"].concat(Object(w.a)(t.uniquefields));return e.withMutations(function(e){i.forEach(function(t){e.delete(t)})});case ub:var o=g.c.List([K_]);return e.setIn(["notifications_threshold",t.balance],o);case lb:return e.updateIn(["notifications_threshold",t.thresholdId],g.c.List(),function(e){return e.push(K_)});case sb:return e.updateIn(["notifications_threshold",t.thresholdId],g.c.List(),function(e){return e.remove(t.index)});case cb:var l=["notifications_threshold",t.thresholdId,t.index,t.field];return e.setIn(l,t.value);case pb:var s=["notifications_threshold",t.balanceId];return e.setIn(s,g.c.List());case db:return e.set("disallowed_rates",t.rates);case mb:return e.setIn(["pp_threshold",t.balanceId],0);case gb:return e.setIn(["pp_threshold",t.balanceId],t.value);case fb:return e.deleteIn(["pp_threshold",t.balanceId]);case"ADD_USAGET_INCLUDE":var c=g.c.fromJS({usagev:0,period:{unit:"",duration:0},pp_includes_name:t.ppIncludesName,pp_includes_external_id:t.ppIncludesExternalId,unit_label:t.unitLabel}),u=e.get("include",g.c.List());return e.set("include",u.push(c));default:return e}},exportGenerator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Hf:return g.c.fromJS(t.generator);case Df:return e.set("name",t.name);case Lf:return e.set("inputProcess",t.inputProcessor).set("file_type",t.inputProcessor.get("file_type"));case Uf:var n=e.get("segments").get(t.index),a=e.get("segments");return n=n.set(t.key,t.value),a=a.set(t.index,n),e.set("segments",a);case Vf:var r=g.c.fromJS({field:null,from:null,to:null});return e.update("segments",function(e){return e.push(r)});case Bf:return e.set("segments",e.get("segments").delete(t.index));case qf:return J_;case zf:return e.setIn(["receiver",t.field],t.value);default:return e}},service:$_,guiState:nO,pager:rO}),oO=function(){var e={key:Y(["env","storageVersion"],"app"),slicer:function(){return function(e){return{entityList:{size:e.entityList.size,filter:e.entityList.filter,sort:e.entityList.sort,state:e.entityList.state},guiState:{menu:e.guiState.menu},settings:e.settings}}},deserialize:function(e){var t=["entityList","guiState"],n=JSON.parse(e);return n&&Object.keys(n).forEach(function(e){t.includes(e)?Object.keys(n[e]).forEach(function(t){n[e][t]=g.c.fromJS(n[e][t])}):n[e]=g.c.fromJS(n[e])}),n}};return Object(fu.d)(u_()(null,e),Object(fu.a)(s_.a))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(519),n(520),n(521),n(522),n(523),n(524),n(525),n(526),n(527),Object(a.lazy)(function(){return Promise.all([n.e(3),n.e(4)]).then(n.bind(null,787))});var lO=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=oO();return Object(fu.e)(iO,e,t)}();o.a.render(r.a.createElement(l.Provider,{store:lO},r.a.createElement(l_,null),!1),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[282,1,2]]]);
//# sourceMappingURL=main.b83caacf.chunk.js.map