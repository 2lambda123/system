mongo --quiet --eval 'db.getMongo().setReadPref("secondaryPreferred"); var output = new Object();db.lines.aggregate({$match:{urt:{$gte:ISODate("2013-06-25T00:00:00+02:00"),$lt:ISODate("2013-12-25T00:00:00+02:00")},aid:{$gt:0},billrun:"000000",process_time:{$lt:"2013-12-25 00:00:00"}}}/*,{$limit:200}*/,{$group:{_id:{aid:"$aid"},subs:{$addToSet:"$sid"}}}).result.forEach(function(obj) {var subs = new Array();obj.subs.forEach(function(sub){var new_sub = new Object();new_sub.subscriber_id=sub.toString();new_sub.curr_plan=new_sub.next_plan="NULL";subs.push(new_sub);}) ;output[obj._id.aid] = new Object();output[obj._id.aid]["subscribers"]=subs;});printjson(output);' billing -u reading -pguprgri | sudo -u billrun tee /var/www/billrun/files/201312_leftover_aggregator_input > /dev/null